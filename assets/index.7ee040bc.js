var bu=Object.defineProperty;var wu=(m,e,t)=>e in m?bu(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var Io=(m,e,t)=>(wu(m,typeof e!="symbol"?e+"":e,t),t);const Su=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const g of u.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function t(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerpolicy&&(u.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?u.credentials="include":a.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(a){if(a.ep)return;a.ep=!0;const u=t(a);fetch(a.href,u)}};Su();/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const no="141",vn={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_n={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Mu=0,Fo=1,Tu=2,zc=1,Cu=2,wr=3,Gn=0,Kt=1,Si=2,Eu=1,Ni=0,Un=1,ko=2,Bo=3,No=4,Au=5,In=100,Lu=101,Pu=102,zo=103,Uo=104,Du=200,Ru=201,Ou=202,Iu=203,Uc=204,Vc=205,Fu=206,ku=207,Bu=208,Nu=209,zu=210,Uu=0,Vu=1,Gu=2,Fa=3,Hu=4,Wu=5,ju=6,Xu=7,Fs=0,Yu=1,qu=2,$t=0,Gc=1,Hc=2,Wc=3,jc=4,Ku=5,Xc=300,Hn=301,Wn=302,Ms=303,ka=304,ks=306,Vi=1e3,_t=1001,Ts=1002,mt=1003,Ba=1004,Na=1005,rt=1006,Yc=1007,hn=1008,on=1009,$u=1010,Zu=1011,qc=1012,Ju=1013,tn=1014,Yt=1015,xi=1016,Qu=1017,ef=1018,Vn=1020,tf=1021,Kc=1022,Bt=1023,nf=1024,rf=1025,sn=1026,jn=1027,sf=1028,af=1029,of=1030,lf=1031,cf=1033,Xs=33776,Ys=33777,qs=33778,Ks=33779,Vo=35840,Go=35841,Ho=35842,Wo=35843,hf=36196,jo=37492,Xo=37496,Yo=37808,qo=37809,Ko=37810,$o=37811,Zo=37812,Jo=37813,Qo=37814,el=37815,tl=37816,il=37817,nl=37818,rl=37819,sl=37820,al=37821,ol=36492,Lr=2300,Xn=2301,$s=2302,ll=2400,cl=2401,hl=2402,uf=2500,ff=2501,df=1,$c=2,Gi=3e3,ze=3001,pf=3200,mf=3201,un=0,gf=1,kt="srgb",nn="srgb-linear",Zs=7680,vf=519,za=35044,ul="300 es",Ua=1035;class fn{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const a=this._listeners[e];if(a!==void 0){const u=a.indexOf(t);u!==-1&&a.splice(u,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const a=i.slice(0);for(let u=0,g=a.length;u<g;u++)a[u].call(this,e);e.target=null}}}const pt=[];for(let m=0;m<256;m++)pt[m]=(m<16?"0":"")+m.toString(16);let fl=1234567;const Mr=Math.PI/180,Pr=180/Math.PI;function Zt(){const m=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(pt[m&255]+pt[m>>8&255]+pt[m>>16&255]+pt[m>>24&255]+"-"+pt[e&255]+pt[e>>8&255]+"-"+pt[e>>16&15|64]+pt[e>>24&255]+"-"+pt[t&63|128]+pt[t>>8&255]+"-"+pt[t>>16&255]+pt[t>>24&255]+pt[i&255]+pt[i>>8&255]+pt[i>>16&255]+pt[i>>24&255]).toLowerCase()}function ht(m,e,t){return Math.max(e,Math.min(t,m))}function ro(m,e){return(m%e+e)%e}function _f(m,e,t,i,a){return i+(m-e)*(a-i)/(t-e)}function yf(m,e,t){return m!==e?(t-m)/(e-m):0}function Tr(m,e,t){return(1-t)*m+t*e}function xf(m,e,t,i){return Tr(m,e,1-Math.exp(-t*i))}function bf(m,e=1){return e-Math.abs(ro(m,e*2)-e)}function wf(m,e,t){return m<=e?0:m>=t?1:(m=(m-e)/(t-e),m*m*(3-2*m))}function Sf(m,e,t){return m<=e?0:m>=t?1:(m=(m-e)/(t-e),m*m*m*(m*(m*6-15)+10))}function Mf(m,e){return m+Math.floor(Math.random()*(e-m+1))}function Tf(m,e){return m+Math.random()*(e-m)}function Cf(m){return m*(.5-Math.random())}function Ef(m){m!==void 0&&(fl=m);let e=fl+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Af(m){return m*Mr}function Lf(m){return m*Pr}function Va(m){return(m&m-1)===0&&m!==0}function Zc(m){return Math.pow(2,Math.ceil(Math.log(m)/Math.LN2))}function Cs(m){return Math.pow(2,Math.floor(Math.log(m)/Math.LN2))}function Pf(m,e,t,i,a){const u=Math.cos,g=Math.sin,s=u(t/2),n=g(t/2),o=u((e+i)/2),f=g((e+i)/2),r=u((e-i)/2),l=g((e-i)/2),c=u((i-e)/2),d=g((i-e)/2);switch(a){case"XYX":m.set(s*f,n*r,n*l,s*o);break;case"YZY":m.set(n*l,s*f,n*r,s*o);break;case"ZXZ":m.set(n*r,n*l,s*f,s*o);break;case"XZX":m.set(s*f,n*d,n*c,s*o);break;case"YXY":m.set(n*c,s*f,n*d,s*o);break;case"ZYZ":m.set(n*d,n*c,s*f,s*o);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}function Df(m,e){switch(e.constructor){case Float32Array:return m;case Uint16Array:return m/65535;case Uint8Array:return m/255;case Int16Array:return Math.max(m/32767,-1);case Int8Array:return Math.max(m/127,-1);default:throw new Error("Invalid component type.")}}function Rf(m,e){switch(e.constructor){case Float32Array:return m;case Uint16Array:return Math.round(m*65535);case Uint8Array:return Math.round(m*255);case Int16Array:return Math.round(m*32767);case Int8Array:return Math.round(m*127);default:throw new Error("Invalid component type.")}}var Xt=Object.freeze({__proto__:null,DEG2RAD:Mr,RAD2DEG:Pr,generateUUID:Zt,clamp:ht,euclideanModulo:ro,mapLinear:_f,inverseLerp:yf,lerp:Tr,damp:xf,pingpong:bf,smoothstep:wf,smootherstep:Sf,randInt:Mf,randFloat:Tf,randFloatSpread:Cf,seededRandom:Ef,degToRad:Af,radToDeg:Lf,isPowerOfTwo:Va,ceilPowerOfTwo:Zc,floorPowerOfTwo:Cs,setQuaternionFromProperEuler:Pf,normalize:Rf,denormalize:Df});class De{constructor(e=0,t=0){this.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6],this.y=a[1]*t+a[4]*i+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),a=Math.sin(t),u=this.x-e.x,g=this.y-e.y;return this.x=u*i-g*a+e.x,this.y=u*a+g*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class qt{constructor(){this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,a,u,g,s,n,o){const f=this.elements;return f[0]=e,f[1]=a,f[2]=s,f[3]=t,f[4]=u,f[5]=n,f[6]=i,f[7]=g,f[8]=o,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,a=t.elements,u=this.elements,g=i[0],s=i[3],n=i[6],o=i[1],f=i[4],r=i[7],l=i[2],c=i[5],d=i[8],p=a[0],h=a[3],v=a[6],_=a[1],y=a[4],x=a[7],b=a[2],w=a[5],M=a[8];return u[0]=g*p+s*_+n*b,u[3]=g*h+s*y+n*w,u[6]=g*v+s*x+n*M,u[1]=o*p+f*_+r*b,u[4]=o*h+f*y+r*w,u[7]=o*v+f*x+r*M,u[2]=l*p+c*_+d*b,u[5]=l*h+c*y+d*w,u[8]=l*v+c*x+d*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],a=e[2],u=e[3],g=e[4],s=e[5],n=e[6],o=e[7],f=e[8];return t*g*f-t*s*o-i*u*f+i*s*n+a*u*o-a*g*n}invert(){const e=this.elements,t=e[0],i=e[1],a=e[2],u=e[3],g=e[4],s=e[5],n=e[6],o=e[7],f=e[8],r=f*g-s*o,l=s*n-f*u,c=o*u-g*n,d=t*r+i*l+a*c;if(d===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return e[0]=r*p,e[1]=(a*o-f*i)*p,e[2]=(s*i-a*g)*p,e[3]=l*p,e[4]=(f*t-a*n)*p,e[5]=(a*u-s*t)*p,e[6]=c*p,e[7]=(i*n-o*t)*p,e[8]=(g*t-i*u)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,a,u,g,s){const n=Math.cos(u),o=Math.sin(u);return this.set(i*n,i*o,-i*(n*g+o*s)+g+e,-a*o,a*n,-a*(-o*g+n*s)+s+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),a=this.elements,u=a[0],g=a[3],s=a[6],n=a[1],o=a[4],f=a[7];return a[0]=t*u+i*n,a[3]=t*g+i*o,a[6]=t*s+i*f,a[1]=-i*u+t*n,a[4]=-i*g+t*o,a[7]=-i*s+t*f,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let a=0;a<9;a++)if(t[a]!==i[a])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function Jc(m){for(let e=m.length-1;e>=0;--e)if(m[e]>65535)return!0;return!1}function Dr(m){return document.createElementNS("http://www.w3.org/1999/xhtml",m)}function an(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)}function _s(m){return m<.0031308?m*12.92:1.055*Math.pow(m,.41666)-.055}const Js={[kt]:{[nn]:an},[nn]:{[kt]:_s}},It={legacyMode:!0,get workingColorSpace(){return nn},set workingColorSpace(m){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(m,e,t){if(this.legacyMode||e===t||!e||!t)return m;if(Js[e]&&Js[e][t]!==void 0){const i=Js[e][t];return m.r=i(m.r),m.g=i(m.g),m.b=i(m.b),m}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(m,e){return this.convert(m,this.workingColorSpace,e)},toWorkingColorSpace:function(m,e){return this.convert(m,e,this.workingColorSpace)}},Qc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ct={r:0,g:0,b:0},Vt={h:0,s:0,l:0},jr={h:0,s:0,l:0};function Qs(m,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?m+(e-m)*6*t:t<1/2?e:t<2/3?m+(e-m)*6*(2/3-t):m}function Xr(m,e){return e.r=m.r,e.g=m.g,e.b=m.b,e}class Te{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=kt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,It.toWorkingColorSpace(this,t),this}setRGB(e,t,i,a=nn){return this.r=e,this.g=t,this.b=i,It.toWorkingColorSpace(this,a),this}setHSL(e,t,i,a=nn){if(e=ro(e,1),t=ht(t,0,1),i=ht(i,0,1),t===0)this.r=this.g=this.b=i;else{const u=i<=.5?i*(1+t):i+t-i*t,g=2*i-u;this.r=Qs(g,u,e+1/3),this.g=Qs(g,u,e),this.b=Qs(g,u,e-1/3)}return It.toWorkingColorSpace(this,a),this}setStyle(e,t=kt){function i(u){u!==void 0&&parseFloat(u)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let u;const g=a[1],s=a[2];switch(g){case"rgb":case"rgba":if(u=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(u[1],10))/255,this.g=Math.min(255,parseInt(u[2],10))/255,this.b=Math.min(255,parseInt(u[3],10))/255,It.toWorkingColorSpace(this,t),i(u[4]),this;if(u=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(u[1],10))/100,this.g=Math.min(100,parseInt(u[2],10))/100,this.b=Math.min(100,parseInt(u[3],10))/100,It.toWorkingColorSpace(this,t),i(u[4]),this;break;case"hsl":case"hsla":if(u=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(u[1])/360,o=parseInt(u[2],10)/100,f=parseInt(u[3],10)/100;return i(u[4]),this.setHSL(n,o,f,t)}break}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const u=a[1],g=u.length;if(g===3)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,It.toWorkingColorSpace(this,t),this;if(g===6)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,It.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=kt){const i=Qc[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=an(e.r),this.g=an(e.g),this.b=an(e.b),this}copyLinearToSRGB(e){return this.r=_s(e.r),this.g=_s(e.g),this.b=_s(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=kt){return It.fromWorkingColorSpace(Xr(this,ct),e),ht(ct.r*255,0,255)<<16^ht(ct.g*255,0,255)<<8^ht(ct.b*255,0,255)<<0}getHexString(e=kt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=nn){It.fromWorkingColorSpace(Xr(this,ct),t);const i=ct.r,a=ct.g,u=ct.b,g=Math.max(i,a,u),s=Math.min(i,a,u);let n,o;const f=(s+g)/2;if(s===g)n=0,o=0;else{const r=g-s;switch(o=f<=.5?r/(g+s):r/(2-g-s),g){case i:n=(a-u)/r+(a<u?6:0);break;case a:n=(u-i)/r+2;break;case u:n=(i-a)/r+4;break}n/=6}return e.h=n,e.s=o,e.l=f,e}getRGB(e,t=nn){return It.fromWorkingColorSpace(Xr(this,ct),t),e.r=ct.r,e.g=ct.g,e.b=ct.b,e}getStyle(e=kt){return It.fromWorkingColorSpace(Xr(this,ct),e),e!==kt?`color(${e} ${ct.r} ${ct.g} ${ct.b})`:`rgb(${ct.r*255|0},${ct.g*255|0},${ct.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Vt),Vt.h+=e,Vt.s+=t,Vt.l+=i,this.setHSL(Vt.h,Vt.s,Vt.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Vt),e.getHSL(jr);const i=Tr(Vt.h,jr.h,t),a=Tr(Vt.s,jr.s,t),u=Tr(Vt.l,jr.l,t);return this.setHSL(i,a,u),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Te.NAMES=Qc;let yn;class eh{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{yn===void 0&&(yn=Dr("canvas")),yn.width=e.width,yn.height=e.height;const i=yn.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=yn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=Dr("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const a=i.getImageData(0,0,e.width,e.height),u=a.data;for(let g=0;g<u.length;g++)u[g]=an(u[g]/255)*255;return i.putImageData(a,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(an(t[i]/255)*255):t[i]=an(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class th{constructor(e=null){this.isSource=!0,this.uuid=Zt(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},a=this.data;if(a!==null){let u;if(Array.isArray(a)){u=[];for(let g=0,s=a.length;g<s;g++)a[g].isDataTexture?u.push(ea(a[g].image)):u.push(ea(a[g]))}else u=ea(a);i.url=u}return t||(e.images[this.uuid]=i),i}}function ea(m){return typeof HTMLImageElement!="undefined"&&m instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&m instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&m instanceof ImageBitmap?eh.getDataURL(m):m.data?{data:Array.prototype.slice.call(m.data),width:m.width,height:m.height,type:m.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Of=0;class at extends fn{constructor(e=at.DEFAULT_IMAGE,t=at.DEFAULT_MAPPING,i=_t,a=_t,u=rt,g=hn,s=Bt,n=on,o=1,f=Gi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Of++}),this.uuid=Zt(),this.name="",this.source=new th(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=a,this.magFilter=u,this.minFilter=g,this.anisotropy=o,this.format=s,this.internalFormat=null,this.type=n,this.offset=new De(0,0),this.repeat=new De(1,1),this.center=new De(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new qt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=f,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Xc)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Vi:e.x=e.x-Math.floor(e.x);break;case _t:e.x=e.x<0?0:1;break;case Ts:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Vi:e.y=e.y-Math.floor(e.y);break;case _t:e.y=e.y<0?0:1;break;case Ts:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}at.DEFAULT_IMAGE=null;at.DEFAULT_MAPPING=Xc;class Ye{constructor(e=0,t=0,i=0,a=1){this.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=a}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,a){return this.x=e,this.y=t,this.z=i,this.w=a,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,a=this.z,u=this.w,g=e.elements;return this.x=g[0]*t+g[4]*i+g[8]*a+g[12]*u,this.y=g[1]*t+g[5]*i+g[9]*a+g[13]*u,this.z=g[2]*t+g[6]*i+g[10]*a+g[14]*u,this.w=g[3]*t+g[7]*i+g[11]*a+g[15]*u,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,a,u;const n=e.elements,o=n[0],f=n[4],r=n[8],l=n[1],c=n[5],d=n[9],p=n[2],h=n[6],v=n[10];if(Math.abs(f-l)<.01&&Math.abs(r-p)<.01&&Math.abs(d-h)<.01){if(Math.abs(f+l)<.1&&Math.abs(r+p)<.1&&Math.abs(d+h)<.1&&Math.abs(o+c+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(o+1)/2,x=(c+1)/2,b=(v+1)/2,w=(f+l)/4,M=(r+p)/4,S=(d+h)/4;return y>x&&y>b?y<.01?(i=0,a=.707106781,u=.707106781):(i=Math.sqrt(y),a=w/i,u=M/i):x>b?x<.01?(i=.707106781,a=0,u=.707106781):(a=Math.sqrt(x),i=w/a,u=S/a):b<.01?(i=.707106781,a=.707106781,u=0):(u=Math.sqrt(b),i=M/u,a=S/u),this.set(i,a,u,t),this}let _=Math.sqrt((h-d)*(h-d)+(r-p)*(r-p)+(l-f)*(l-f));return Math.abs(_)<.001&&(_=1),this.x=(h-d)/_,this.y=(r-p)/_,this.z=(l-f)/_,this.w=Math.acos((o+c+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class li extends fn{constructor(e,t,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ye(0,0,e,t),this.scissorTest=!1,this.viewport=new Ye(0,0,e,t);const a={width:e,height:t,depth:1};this.texture=new at(a,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:rt,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new th(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ih extends at{constructor(e=null,t=1,i=1,a=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:a},this.magFilter=mt,this.minFilter=mt,this.wrapR=_t,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class If extends at{constructor(e=null,t=1,i=1,a=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:a},this.magFilter=mt,this.minFilter=mt,this.wrapR=_t,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class St{constructor(e=0,t=0,i=0,a=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=a}static slerp(e,t,i,a){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,a)}static slerpFlat(e,t,i,a,u,g,s){let n=i[a+0],o=i[a+1],f=i[a+2],r=i[a+3];const l=u[g+0],c=u[g+1],d=u[g+2],p=u[g+3];if(s===0){e[t+0]=n,e[t+1]=o,e[t+2]=f,e[t+3]=r;return}if(s===1){e[t+0]=l,e[t+1]=c,e[t+2]=d,e[t+3]=p;return}if(r!==p||n!==l||o!==c||f!==d){let h=1-s;const v=n*l+o*c+f*d+r*p,_=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const b=Math.sqrt(y),w=Math.atan2(b,v*_);h=Math.sin(h*w)/b,s=Math.sin(s*w)/b}const x=s*_;if(n=n*h+l*x,o=o*h+c*x,f=f*h+d*x,r=r*h+p*x,h===1-s){const b=1/Math.sqrt(n*n+o*o+f*f+r*r);n*=b,o*=b,f*=b,r*=b}}e[t]=n,e[t+1]=o,e[t+2]=f,e[t+3]=r}static multiplyQuaternionsFlat(e,t,i,a,u,g){const s=i[a],n=i[a+1],o=i[a+2],f=i[a+3],r=u[g],l=u[g+1],c=u[g+2],d=u[g+3];return e[t]=s*d+f*r+n*c-o*l,e[t+1]=n*d+f*l+o*r-s*c,e[t+2]=o*d+f*c+s*l-n*r,e[t+3]=f*d-s*r-n*l-o*c,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,a){return this._x=e,this._y=t,this._z=i,this._w=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,a=e._y,u=e._z,g=e._order,s=Math.cos,n=Math.sin,o=s(i/2),f=s(a/2),r=s(u/2),l=n(i/2),c=n(a/2),d=n(u/2);switch(g){case"XYZ":this._x=l*f*r+o*c*d,this._y=o*c*r-l*f*d,this._z=o*f*d+l*c*r,this._w=o*f*r-l*c*d;break;case"YXZ":this._x=l*f*r+o*c*d,this._y=o*c*r-l*f*d,this._z=o*f*d-l*c*r,this._w=o*f*r+l*c*d;break;case"ZXY":this._x=l*f*r-o*c*d,this._y=o*c*r+l*f*d,this._z=o*f*d+l*c*r,this._w=o*f*r-l*c*d;break;case"ZYX":this._x=l*f*r-o*c*d,this._y=o*c*r+l*f*d,this._z=o*f*d-l*c*r,this._w=o*f*r+l*c*d;break;case"YZX":this._x=l*f*r+o*c*d,this._y=o*c*r+l*f*d,this._z=o*f*d-l*c*r,this._w=o*f*r-l*c*d;break;case"XZY":this._x=l*f*r-o*c*d,this._y=o*c*r-l*f*d,this._z=o*f*d+l*c*r,this._w=o*f*r+l*c*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+g)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,a=Math.sin(i);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],a=t[4],u=t[8],g=t[1],s=t[5],n=t[9],o=t[2],f=t[6],r=t[10],l=i+s+r;if(l>0){const c=.5/Math.sqrt(l+1);this._w=.25/c,this._x=(f-n)*c,this._y=(u-o)*c,this._z=(g-a)*c}else if(i>s&&i>r){const c=2*Math.sqrt(1+i-s-r);this._w=(f-n)/c,this._x=.25*c,this._y=(a+g)/c,this._z=(u+o)/c}else if(s>r){const c=2*Math.sqrt(1+s-i-r);this._w=(u-o)/c,this._x=(a+g)/c,this._y=.25*c,this._z=(n+f)/c}else{const c=2*Math.sqrt(1+r-i-s);this._w=(g-a)/c,this._x=(u+o)/c,this._y=(n+f)/c,this._z=.25*c}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ht(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const a=Math.min(1,t/i);return this.slerp(e,a),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,a=e._y,u=e._z,g=e._w,s=t._x,n=t._y,o=t._z,f=t._w;return this._x=i*f+g*s+a*o-u*n,this._y=a*f+g*n+u*s-i*o,this._z=u*f+g*o+i*n-a*s,this._w=g*f-i*s-a*n-u*o,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,a=this._y,u=this._z,g=this._w;let s=g*e._w+i*e._x+a*e._y+u*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=g,this._x=i,this._y=a,this._z=u,this;const n=1-s*s;if(n<=Number.EPSILON){const c=1-t;return this._w=c*g+t*this._w,this._x=c*i+t*this._x,this._y=c*a+t*this._y,this._z=c*u+t*this._z,this.normalize(),this._onChangeCallback(),this}const o=Math.sqrt(n),f=Math.atan2(o,s),r=Math.sin((1-t)*f)/o,l=Math.sin(t*f)/o;return this._w=g*r+this._w*l,this._x=i*r+this._x*l,this._y=a*r+this._y*l,this._z=u*r+this._z*l,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),a=2*Math.PI*Math.random(),u=2*Math.PI*Math.random();return this.set(t*Math.cos(a),i*Math.sin(u),i*Math.cos(u),t*Math.sin(a))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class X{constructor(e=0,t=0,i=0){this.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(dl.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dl.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,a=this.z,u=e.elements;return this.x=u[0]*t+u[3]*i+u[6]*a,this.y=u[1]*t+u[4]*i+u[7]*a,this.z=u[2]*t+u[5]*i+u[8]*a,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,a=this.z,u=e.elements,g=1/(u[3]*t+u[7]*i+u[11]*a+u[15]);return this.x=(u[0]*t+u[4]*i+u[8]*a+u[12])*g,this.y=(u[1]*t+u[5]*i+u[9]*a+u[13])*g,this.z=(u[2]*t+u[6]*i+u[10]*a+u[14])*g,this}applyQuaternion(e){const t=this.x,i=this.y,a=this.z,u=e.x,g=e.y,s=e.z,n=e.w,o=n*t+g*a-s*i,f=n*i+s*t-u*a,r=n*a+u*i-g*t,l=-u*t-g*i-s*a;return this.x=o*n+l*-u+f*-s-r*-g,this.y=f*n+l*-g+r*-u-o*-s,this.z=r*n+l*-s+o*-g-f*-u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,a=this.z,u=e.elements;return this.x=u[0]*t+u[4]*i+u[8]*a,this.y=u[1]*t+u[5]*i+u[9]*a,this.z=u[2]*t+u[6]*i+u[10]*a,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,a=e.y,u=e.z,g=t.x,s=t.y,n=t.z;return this.x=a*n-u*s,this.y=u*g-i*n,this.z=i*s-a*g,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return ta.copy(this).projectOnVector(e),this.sub(ta)}reflect(e){return this.sub(ta.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ht(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,a=this.z-e.z;return t*t+i*i+a*a}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const a=Math.sin(t)*e;return this.x=a*Math.sin(i),this.y=Math.cos(t)*e,this.z=a*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),a=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=a,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ta=new X,dl=new St;class Qn{constructor(e=new X(1/0,1/0,1/0),t=new X(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,a=1/0,u=-1/0,g=-1/0,s=-1/0;for(let n=0,o=e.length;n<o;n+=3){const f=e[n],r=e[n+1],l=e[n+2];f<t&&(t=f),r<i&&(i=r),l<a&&(a=l),f>u&&(u=f),r>g&&(g=r),l>s&&(s=l)}return this.min.set(t,i,a),this.max.set(u,g,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,a=1/0,u=-1/0,g=-1/0,s=-1/0;for(let n=0,o=e.count;n<o;n++){const f=e.getX(n),r=e.getY(n),l=e.getZ(n);f<t&&(t=f),r<i&&(i=r),l<a&&(a=l),f>u&&(u=f),r>g&&(g=r),l>s&&(s=l)}return this.min.set(t,i,a),this.max.set(u,g,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=qi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const u=i.attributes.position;for(let g=0,s=u.count;g<s;g++)qi.fromBufferAttribute(u,g).applyMatrix4(e.matrixWorld),this.expandByPoint(qi)}else i.boundingBox===null&&i.computeBoundingBox(),ia.copy(i.boundingBox),ia.applyMatrix4(e.matrixWorld),this.union(ia);const a=e.children;for(let u=0,g=a.length;u<g;u++)this.expandByObject(a[u],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,qi),qi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(gr),Yr.subVectors(this.max,gr),xn.subVectors(e.a,gr),bn.subVectors(e.b,gr),wn.subVectors(e.c,gr),Ai.subVectors(bn,xn),Li.subVectors(wn,bn),Ki.subVectors(xn,wn);let t=[0,-Ai.z,Ai.y,0,-Li.z,Li.y,0,-Ki.z,Ki.y,Ai.z,0,-Ai.x,Li.z,0,-Li.x,Ki.z,0,-Ki.x,-Ai.y,Ai.x,0,-Li.y,Li.x,0,-Ki.y,Ki.x,0];return!na(t,xn,bn,wn,Yr)||(t=[1,0,0,0,1,0,0,0,1],!na(t,xn,bn,wn,Yr))?!1:(qr.crossVectors(Ai,Li),t=[qr.x,qr.y,qr.z],na(t,xn,bn,wn,Yr))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return qi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(qi).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(di[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),di[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),di[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),di[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),di[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),di[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),di[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),di[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(di),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const di=[new X,new X,new X,new X,new X,new X,new X,new X],qi=new X,ia=new Qn,xn=new X,bn=new X,wn=new X,Ai=new X,Li=new X,Ki=new X,gr=new X,Yr=new X,qr=new X,$i=new X;function na(m,e,t,i,a){for(let u=0,g=m.length-3;u<=g;u+=3){$i.fromArray(m,u);const s=a.x*Math.abs($i.x)+a.y*Math.abs($i.y)+a.z*Math.abs($i.z),n=e.dot($i),o=t.dot($i),f=i.dot($i);if(Math.max(-Math.max(n,o,f),Math.min(n,o,f))>s)return!1}return!0}const Ff=new Qn,pl=new X,Kr=new X,ra=new X;class er{constructor(e=new X,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Ff.setFromPoints(e).getCenter(i);let a=0;for(let u=0,g=e.length;u<g;u++)a=Math.max(a,i.distanceToSquared(e[u]));return this.radius=Math.sqrt(a),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){ra.subVectors(e,this.center);const t=ra.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),a=(i-this.radius)*.5;this.center.add(ra.multiplyScalar(a/i)),this.radius+=a}return this}union(e){return this.center.equals(e.center)===!0?Kr.set(0,0,1).multiplyScalar(e.radius):Kr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(pl.copy(e.center).add(Kr)),this.expandByPoint(pl.copy(e.center).sub(Kr)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const pi=new X,sa=new X,$r=new X,Pi=new X,aa=new X,Zr=new X,oa=new X;class so{constructor(e=new X,t=new X(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,pi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=pi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(pi.copy(this.direction).multiplyScalar(t).add(this.origin),pi.distanceToSquared(e))}distanceSqToSegment(e,t,i,a){sa.copy(e).add(t).multiplyScalar(.5),$r.copy(t).sub(e).normalize(),Pi.copy(this.origin).sub(sa);const u=e.distanceTo(t)*.5,g=-this.direction.dot($r),s=Pi.dot(this.direction),n=-Pi.dot($r),o=Pi.lengthSq(),f=Math.abs(1-g*g);let r,l,c,d;if(f>0)if(r=g*n-s,l=g*s-n,d=u*f,r>=0)if(l>=-d)if(l<=d){const p=1/f;r*=p,l*=p,c=r*(r+g*l+2*s)+l*(g*r+l+2*n)+o}else l=u,r=Math.max(0,-(g*l+s)),c=-r*r+l*(l+2*n)+o;else l=-u,r=Math.max(0,-(g*l+s)),c=-r*r+l*(l+2*n)+o;else l<=-d?(r=Math.max(0,-(-g*u+s)),l=r>0?-u:Math.min(Math.max(-u,-n),u),c=-r*r+l*(l+2*n)+o):l<=d?(r=0,l=Math.min(Math.max(-u,-n),u),c=l*(l+2*n)+o):(r=Math.max(0,-(g*u+s)),l=r>0?u:Math.min(Math.max(-u,-n),u),c=-r*r+l*(l+2*n)+o);else l=g>0?-u:u,r=Math.max(0,-(g*l+s)),c=-r*r+l*(l+2*n)+o;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),a&&a.copy($r).multiplyScalar(l).add(sa),c}intersectSphere(e,t){pi.subVectors(e.center,this.origin);const i=pi.dot(this.direction),a=pi.dot(pi)-i*i,u=e.radius*e.radius;if(a>u)return null;const g=Math.sqrt(u-a),s=i-g,n=i+g;return s<0&&n<0?null:s<0?this.at(n,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,a,u,g,s,n;const o=1/this.direction.x,f=1/this.direction.y,r=1/this.direction.z,l=this.origin;return o>=0?(i=(e.min.x-l.x)*o,a=(e.max.x-l.x)*o):(i=(e.max.x-l.x)*o,a=(e.min.x-l.x)*o),f>=0?(u=(e.min.y-l.y)*f,g=(e.max.y-l.y)*f):(u=(e.max.y-l.y)*f,g=(e.min.y-l.y)*f),i>g||u>a||((u>i||i!==i)&&(i=u),(g<a||a!==a)&&(a=g),r>=0?(s=(e.min.z-l.z)*r,n=(e.max.z-l.z)*r):(s=(e.max.z-l.z)*r,n=(e.min.z-l.z)*r),i>n||s>a)||((s>i||i!==i)&&(i=s),(n<a||a!==a)&&(a=n),a<0)?null:this.at(i>=0?i:a,t)}intersectsBox(e){return this.intersectBox(e,pi)!==null}intersectTriangle(e,t,i,a,u){aa.subVectors(t,e),Zr.subVectors(i,e),oa.crossVectors(aa,Zr);let g=this.direction.dot(oa),s;if(g>0){if(a)return null;s=1}else if(g<0)s=-1,g=-g;else return null;Pi.subVectors(this.origin,e);const n=s*this.direction.dot(Zr.crossVectors(Pi,Zr));if(n<0)return null;const o=s*this.direction.dot(aa.cross(Pi));if(o<0||n+o>g)return null;const f=-s*Pi.dot(oa);return f<0?null:this.at(f/g,u)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Le{constructor(){this.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,a,u,g,s,n,o,f,r,l,c,d,p,h){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=a,v[1]=u,v[5]=g,v[9]=s,v[13]=n,v[2]=o,v[6]=f,v[10]=r,v[14]=l,v[3]=c,v[7]=d,v[11]=p,v[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Le().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,a=1/Sn.setFromMatrixColumn(e,0).length(),u=1/Sn.setFromMatrixColumn(e,1).length(),g=1/Sn.setFromMatrixColumn(e,2).length();return t[0]=i[0]*a,t[1]=i[1]*a,t[2]=i[2]*a,t[3]=0,t[4]=i[4]*u,t[5]=i[5]*u,t[6]=i[6]*u,t[7]=0,t[8]=i[8]*g,t[9]=i[9]*g,t[10]=i[10]*g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,a=e.y,u=e.z,g=Math.cos(i),s=Math.sin(i),n=Math.cos(a),o=Math.sin(a),f=Math.cos(u),r=Math.sin(u);if(e.order==="XYZ"){const l=g*f,c=g*r,d=s*f,p=s*r;t[0]=n*f,t[4]=-n*r,t[8]=o,t[1]=c+d*o,t[5]=l-p*o,t[9]=-s*n,t[2]=p-l*o,t[6]=d+c*o,t[10]=g*n}else if(e.order==="YXZ"){const l=n*f,c=n*r,d=o*f,p=o*r;t[0]=l+p*s,t[4]=d*s-c,t[8]=g*o,t[1]=g*r,t[5]=g*f,t[9]=-s,t[2]=c*s-d,t[6]=p+l*s,t[10]=g*n}else if(e.order==="ZXY"){const l=n*f,c=n*r,d=o*f,p=o*r;t[0]=l-p*s,t[4]=-g*r,t[8]=d+c*s,t[1]=c+d*s,t[5]=g*f,t[9]=p-l*s,t[2]=-g*o,t[6]=s,t[10]=g*n}else if(e.order==="ZYX"){const l=g*f,c=g*r,d=s*f,p=s*r;t[0]=n*f,t[4]=d*o-c,t[8]=l*o+p,t[1]=n*r,t[5]=p*o+l,t[9]=c*o-d,t[2]=-o,t[6]=s*n,t[10]=g*n}else if(e.order==="YZX"){const l=g*n,c=g*o,d=s*n,p=s*o;t[0]=n*f,t[4]=p-l*r,t[8]=d*r+c,t[1]=r,t[5]=g*f,t[9]=-s*f,t[2]=-o*f,t[6]=c*r+d,t[10]=l-p*r}else if(e.order==="XZY"){const l=g*n,c=g*o,d=s*n,p=s*o;t[0]=n*f,t[4]=-r,t[8]=o*f,t[1]=l*r+p,t[5]=g*f,t[9]=c*r-d,t[2]=d*r-c,t[6]=s*f,t[10]=p*r+l}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(kf,e,Bf)}lookAt(e,t,i){const a=this.elements;return Pt.subVectors(e,t),Pt.lengthSq()===0&&(Pt.z=1),Pt.normalize(),Di.crossVectors(i,Pt),Di.lengthSq()===0&&(Math.abs(i.z)===1?Pt.x+=1e-4:Pt.z+=1e-4,Pt.normalize(),Di.crossVectors(i,Pt)),Di.normalize(),Jr.crossVectors(Pt,Di),a[0]=Di.x,a[4]=Jr.x,a[8]=Pt.x,a[1]=Di.y,a[5]=Jr.y,a[9]=Pt.y,a[2]=Di.z,a[6]=Jr.z,a[10]=Pt.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,a=t.elements,u=this.elements,g=i[0],s=i[4],n=i[8],o=i[12],f=i[1],r=i[5],l=i[9],c=i[13],d=i[2],p=i[6],h=i[10],v=i[14],_=i[3],y=i[7],x=i[11],b=i[15],w=a[0],M=a[4],S=a[8],C=a[12],O=a[1],k=a[5],Y=a[9],H=a[13],N=a[2],U=a[6],G=a[10],j=a[14],q=a[3],T=a[7],P=a[11],R=a[15];return u[0]=g*w+s*O+n*N+o*q,u[4]=g*M+s*k+n*U+o*T,u[8]=g*S+s*Y+n*G+o*P,u[12]=g*C+s*H+n*j+o*R,u[1]=f*w+r*O+l*N+c*q,u[5]=f*M+r*k+l*U+c*T,u[9]=f*S+r*Y+l*G+c*P,u[13]=f*C+r*H+l*j+c*R,u[2]=d*w+p*O+h*N+v*q,u[6]=d*M+p*k+h*U+v*T,u[10]=d*S+p*Y+h*G+v*P,u[14]=d*C+p*H+h*j+v*R,u[3]=_*w+y*O+x*N+b*q,u[7]=_*M+y*k+x*U+b*T,u[11]=_*S+y*Y+x*G+b*P,u[15]=_*C+y*H+x*j+b*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],a=e[8],u=e[12],g=e[1],s=e[5],n=e[9],o=e[13],f=e[2],r=e[6],l=e[10],c=e[14],d=e[3],p=e[7],h=e[11],v=e[15];return d*(+u*n*r-a*o*r-u*s*l+i*o*l+a*s*c-i*n*c)+p*(+t*n*c-t*o*l+u*g*l-a*g*c+a*o*f-u*n*f)+h*(+t*o*r-t*s*c-u*g*r+i*g*c+u*s*f-i*o*f)+v*(-a*s*f-t*n*r+t*s*l+a*g*r-i*g*l+i*n*f)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const a=this.elements;return e.isVector3?(a[12]=e.x,a[13]=e.y,a[14]=e.z):(a[12]=e,a[13]=t,a[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],a=e[2],u=e[3],g=e[4],s=e[5],n=e[6],o=e[7],f=e[8],r=e[9],l=e[10],c=e[11],d=e[12],p=e[13],h=e[14],v=e[15],_=r*h*o-p*l*o+p*n*c-s*h*c-r*n*v+s*l*v,y=d*l*o-f*h*o-d*n*c+g*h*c+f*n*v-g*l*v,x=f*p*o-d*r*o+d*s*c-g*p*c-f*s*v+g*r*v,b=d*r*n-f*p*n-d*s*l+g*p*l+f*s*h-g*r*h,w=t*_+i*y+a*x+u*b;if(w===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=_*M,e[1]=(p*l*u-r*h*u-p*a*c+i*h*c+r*a*v-i*l*v)*M,e[2]=(s*h*u-p*n*u+p*a*o-i*h*o-s*a*v+i*n*v)*M,e[3]=(r*n*u-s*l*u-r*a*o+i*l*o+s*a*c-i*n*c)*M,e[4]=y*M,e[5]=(f*h*u-d*l*u+d*a*c-t*h*c-f*a*v+t*l*v)*M,e[6]=(d*n*u-g*h*u-d*a*o+t*h*o+g*a*v-t*n*v)*M,e[7]=(g*l*u-f*n*u+f*a*o-t*l*o-g*a*c+t*n*c)*M,e[8]=x*M,e[9]=(d*r*u-f*p*u-d*i*c+t*p*c+f*i*v-t*r*v)*M,e[10]=(g*p*u-d*s*u+d*i*o-t*p*o-g*i*v+t*s*v)*M,e[11]=(f*s*u-g*r*u-f*i*o+t*r*o+g*i*c-t*s*c)*M,e[12]=b*M,e[13]=(f*p*a-d*r*a+d*i*l-t*p*l-f*i*h+t*r*h)*M,e[14]=(d*s*a-g*p*a-d*i*n+t*p*n+g*i*h-t*s*h)*M,e[15]=(g*r*a-f*s*a+f*i*n-t*r*n-g*i*l+t*s*l)*M,this}scale(e){const t=this.elements,i=e.x,a=e.y,u=e.z;return t[0]*=i,t[4]*=a,t[8]*=u,t[1]*=i,t[5]*=a,t[9]*=u,t[2]*=i,t[6]*=a,t[10]*=u,t[3]*=i,t[7]*=a,t[11]*=u,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,a))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),a=Math.sin(t),u=1-i,g=e.x,s=e.y,n=e.z,o=u*g,f=u*s;return this.set(o*g+i,o*s-a*n,o*n+a*s,0,o*s+a*n,f*s+i,f*n-a*g,0,o*n-a*s,f*n+a*g,u*n*n+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,a,u,g){return this.set(1,i,u,0,e,1,g,0,t,a,1,0,0,0,0,1),this}compose(e,t,i){const a=this.elements,u=t._x,g=t._y,s=t._z,n=t._w,o=u+u,f=g+g,r=s+s,l=u*o,c=u*f,d=u*r,p=g*f,h=g*r,v=s*r,_=n*o,y=n*f,x=n*r,b=i.x,w=i.y,M=i.z;return a[0]=(1-(p+v))*b,a[1]=(c+x)*b,a[2]=(d-y)*b,a[3]=0,a[4]=(c-x)*w,a[5]=(1-(l+v))*w,a[6]=(h+_)*w,a[7]=0,a[8]=(d+y)*M,a[9]=(h-_)*M,a[10]=(1-(l+p))*M,a[11]=0,a[12]=e.x,a[13]=e.y,a[14]=e.z,a[15]=1,this}decompose(e,t,i){const a=this.elements;let u=Sn.set(a[0],a[1],a[2]).length();const g=Sn.set(a[4],a[5],a[6]).length(),s=Sn.set(a[8],a[9],a[10]).length();this.determinant()<0&&(u=-u),e.x=a[12],e.y=a[13],e.z=a[14],Gt.copy(this);const o=1/u,f=1/g,r=1/s;return Gt.elements[0]*=o,Gt.elements[1]*=o,Gt.elements[2]*=o,Gt.elements[4]*=f,Gt.elements[5]*=f,Gt.elements[6]*=f,Gt.elements[8]*=r,Gt.elements[9]*=r,Gt.elements[10]*=r,t.setFromRotationMatrix(Gt),i.x=u,i.y=g,i.z=s,this}makePerspective(e,t,i,a,u,g){g===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,n=2*u/(t-e),o=2*u/(i-a),f=(t+e)/(t-e),r=(i+a)/(i-a),l=-(g+u)/(g-u),c=-2*g*u/(g-u);return s[0]=n,s[4]=0,s[8]=f,s[12]=0,s[1]=0,s[5]=o,s[9]=r,s[13]=0,s[2]=0,s[6]=0,s[10]=l,s[14]=c,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,a,u,g){const s=this.elements,n=1/(t-e),o=1/(i-a),f=1/(g-u),r=(t+e)*n,l=(i+a)*o,c=(g+u)*f;return s[0]=2*n,s[4]=0,s[8]=0,s[12]=-r,s[1]=0,s[5]=2*o,s[9]=0,s[13]=-l,s[2]=0,s[6]=0,s[10]=-2*f,s[14]=-c,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let a=0;a<16;a++)if(t[a]!==i[a])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Sn=new X,Gt=new Le,kf=new X(0,0,0),Bf=new X(1,1,1),Di=new X,Jr=new X,Pt=new X,ml=new Le,gl=new St;class ai{constructor(e=0,t=0,i=0,a=ai.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=a}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,a=this._order){return this._x=e,this._y=t,this._z=i,this._order=a,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const a=e.elements,u=a[0],g=a[4],s=a[8],n=a[1],o=a[5],f=a[9],r=a[2],l=a[6],c=a[10];switch(t){case"XYZ":this._y=Math.asin(ht(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-f,c),this._z=Math.atan2(-g,u)):(this._x=Math.atan2(l,o),this._z=0);break;case"YXZ":this._x=Math.asin(-ht(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(s,c),this._z=Math.atan2(n,o)):(this._y=Math.atan2(-r,u),this._z=0);break;case"ZXY":this._x=Math.asin(ht(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(-r,c),this._z=Math.atan2(-g,o)):(this._y=0,this._z=Math.atan2(n,u));break;case"ZYX":this._y=Math.asin(-ht(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(l,c),this._z=Math.atan2(n,u)):(this._x=0,this._z=Math.atan2(-g,o));break;case"YZX":this._z=Math.asin(ht(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-f,o),this._y=Math.atan2(-r,u)):(this._x=0,this._y=Math.atan2(s,c));break;case"XZY":this._z=Math.asin(-ht(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(l,o),this._y=Math.atan2(s,u)):(this._x=Math.atan2(-f,c),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return ml.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ml,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return gl.setFromEuler(this),this.setFromQuaternion(gl,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}ai.DefaultOrder="XYZ";ai.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class nh{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Nf=0;const vl=new X,Mn=new St,mi=new Le,Qr=new X,vr=new X,zf=new X,Uf=new St,_l=new X(1,0,0),yl=new X(0,1,0),xl=new X(0,0,1),Vf={type:"added"},bl={type:"removed"};class et extends fn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Nf++}),this.uuid=Zt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=et.DefaultUp.clone();const e=new X,t=new ai,i=new St,a=new X(1,1,1);function u(){i.setFromEuler(t,!1)}function g(){t.setFromQuaternion(i,void 0,!1)}t._onChange(u),i._onChange(g),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new Le},normalMatrix:{value:new qt}}),this.matrix=new Le,this.matrixWorld=new Le,this.matrixAutoUpdate=et.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new nh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Mn.setFromAxisAngle(e,t),this.quaternion.multiply(Mn),this}rotateOnWorldAxis(e,t){return Mn.setFromAxisAngle(e,t),this.quaternion.premultiply(Mn),this}rotateX(e){return this.rotateOnAxis(_l,e)}rotateY(e){return this.rotateOnAxis(yl,e)}rotateZ(e){return this.rotateOnAxis(xl,e)}translateOnAxis(e,t){return vl.copy(e).applyQuaternion(this.quaternion),this.position.add(vl.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_l,e)}translateY(e){return this.translateOnAxis(yl,e)}translateZ(e){return this.translateOnAxis(xl,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(mi.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Qr.copy(e):Qr.set(e,t,i);const a=this.parent;this.updateWorldMatrix(!0,!1),vr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?mi.lookAt(vr,Qr,this.up):mi.lookAt(Qr,vr,this.up),this.quaternion.setFromRotationMatrix(mi),a&&(mi.extractRotation(a.matrixWorld),Mn.setFromRotationMatrix(mi),this.quaternion.premultiply(Mn.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Vf)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(bl)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(bl)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),mi.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),mi.multiply(e.parent.matrixWorld)),e.applyMatrix4(mi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,a=this.children.length;i<a;i++){const g=this.children[i].getObjectByProperty(e,t);if(g!==void 0)return g}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vr,e,zf),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vr,Uf,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,a=t.length;i<a;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const a=this.children;for(let u=0,g=a.length;u<g;u++)a[u].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const a={};a.uuid=this.uuid,a.type=this.type,this.name!==""&&(a.name=this.name),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),this.frustumCulled===!1&&(a.frustumCulled=!1),this.renderOrder!==0&&(a.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(a.userData=this.userData),a.layers=this.layers.mask,a.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(a.matrixAutoUpdate=!1),this.isInstancedMesh&&(a.type="InstancedMesh",a.count=this.count,a.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(a.instanceColor=this.instanceColor.toJSON()));function u(s,n){return s[n.uuid]===void 0&&(s[n.uuid]=n.toJSON(e)),n.uuid}if(this.isScene)this.background&&(this.background.isColor?a.background=this.background.toJSON():this.background.isTexture&&(a.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(a.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){a.geometry=u(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const n=s.shapes;if(Array.isArray(n))for(let o=0,f=n.length;o<f;o++){const r=n[o];u(e.shapes,r)}else u(e.shapes,n)}}if(this.isSkinnedMesh&&(a.bindMode=this.bindMode,a.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(u(e.skeletons,this.skeleton),a.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let n=0,o=this.material.length;n<o;n++)s.push(u(e.materials,this.material[n]));a.material=s}else a.material=u(e.materials,this.material);if(this.children.length>0){a.children=[];for(let s=0;s<this.children.length;s++)a.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){a.animations=[];for(let s=0;s<this.animations.length;s++){const n=this.animations[s];a.animations.push(u(e.animations,n))}}if(t){const s=g(e.geometries),n=g(e.materials),o=g(e.textures),f=g(e.images),r=g(e.shapes),l=g(e.skeletons),c=g(e.animations),d=g(e.nodes);s.length>0&&(i.geometries=s),n.length>0&&(i.materials=n),o.length>0&&(i.textures=o),f.length>0&&(i.images=f),r.length>0&&(i.shapes=r),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),d.length>0&&(i.nodes=d)}return i.object=a,i;function g(s){const n=[];for(const o in s){const f=s[o];delete f.metadata,n.push(f)}return n}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const a=e.children[i];this.add(a.clone())}return this}}et.DefaultUp=new X(0,1,0);et.DefaultMatrixAutoUpdate=!0;const Ht=new X,gi=new X,la=new X,vi=new X,Tn=new X,Cn=new X,wl=new X,ca=new X,ha=new X,ua=new X;class si{constructor(e=new X,t=new X,i=new X){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,a){a.subVectors(i,t),Ht.subVectors(e,t),a.cross(Ht);const u=a.lengthSq();return u>0?a.multiplyScalar(1/Math.sqrt(u)):a.set(0,0,0)}static getBarycoord(e,t,i,a,u){Ht.subVectors(a,t),gi.subVectors(i,t),la.subVectors(e,t);const g=Ht.dot(Ht),s=Ht.dot(gi),n=Ht.dot(la),o=gi.dot(gi),f=gi.dot(la),r=g*o-s*s;if(r===0)return u.set(-2,-1,-1);const l=1/r,c=(o*n-s*f)*l,d=(g*f-s*n)*l;return u.set(1-c-d,d,c)}static containsPoint(e,t,i,a){return this.getBarycoord(e,t,i,a,vi),vi.x>=0&&vi.y>=0&&vi.x+vi.y<=1}static getUV(e,t,i,a,u,g,s,n){return this.getBarycoord(e,t,i,a,vi),n.set(0,0),n.addScaledVector(u,vi.x),n.addScaledVector(g,vi.y),n.addScaledVector(s,vi.z),n}static isFrontFacing(e,t,i,a){return Ht.subVectors(i,t),gi.subVectors(e,t),Ht.cross(gi).dot(a)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,a){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[a]),this}setFromAttributeAndIndices(e,t,i,a){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,a),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ht.subVectors(this.c,this.b),gi.subVectors(this.a,this.b),Ht.cross(gi).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return si.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return si.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,a,u){return si.getUV(e,this.a,this.b,this.c,t,i,a,u)}containsPoint(e){return si.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return si.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,a=this.b,u=this.c;let g,s;Tn.subVectors(a,i),Cn.subVectors(u,i),ca.subVectors(e,i);const n=Tn.dot(ca),o=Cn.dot(ca);if(n<=0&&o<=0)return t.copy(i);ha.subVectors(e,a);const f=Tn.dot(ha),r=Cn.dot(ha);if(f>=0&&r<=f)return t.copy(a);const l=n*r-f*o;if(l<=0&&n>=0&&f<=0)return g=n/(n-f),t.copy(i).addScaledVector(Tn,g);ua.subVectors(e,u);const c=Tn.dot(ua),d=Cn.dot(ua);if(d>=0&&c<=d)return t.copy(u);const p=c*o-n*d;if(p<=0&&o>=0&&d<=0)return s=o/(o-d),t.copy(i).addScaledVector(Cn,s);const h=f*d-c*r;if(h<=0&&r-f>=0&&c-d>=0)return wl.subVectors(u,a),s=(r-f)/(r-f+(c-d)),t.copy(a).addScaledVector(wl,s);const v=1/(h+p+l);return g=p*v,s=l*v,t.copy(i).addScaledVector(Tn,g).addScaledVector(Cn,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Gf=0;class it extends fn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Gf++}),this.uuid=Zt(),this.name="",this.type="Material",this.blending=Un,this.side=Gn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Uc,this.blendDst=Vc,this.blendEquation=In,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Fa,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=vf,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Zs,this.stencilZFail=Zs,this.stencilZPass=Zs,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===Eu;continue}const a=this[t];if(a===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}a&&a.isColor?a.set(i):a&&a.isVector3&&i&&i.isVector3?a.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Un&&(i.blending=this.blending),this.side!==Gn&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function a(u){const g=[];for(const s in u){const n=u[s];delete n.metadata,g.push(n)}return g}if(t){const u=a(e.textures),g=a(e.images);u.length>0&&(i.textures=u),g.length>0&&(i.images=g)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const a=t.length;i=new Array(a);for(let u=0;u!==a;++u)i[u]=t[u].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}get vertexTangents(){return console.warn("THREE."+this.type+": .vertexTangents has been removed."),!1}set vertexTangents(e){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}it.fromType=function(){return null};class Bi extends it{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const lt=new X,es=new De;class Tt{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=za,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let a=0,u=this.itemSize;a<u;a++)this.array[e+a]=t.array[i+a];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let a=0,u=e.length;a<u;a++){let g=e[a];g===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",a),g=new Te),t[i++]=g.r,t[i++]=g.g,t[i++]=g.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let a=0,u=e.length;a<u;a++){let g=e[a];g===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",a),g=new De),t[i++]=g.x,t[i++]=g.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let a=0,u=e.length;a<u;a++){let g=e[a];g===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",a),g=new X),t[i++]=g.x,t[i++]=g.y,t[i++]=g.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let a=0,u=e.length;a<u;a++){let g=e[a];g===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",a),g=new Ye),t[i++]=g.x,t[i++]=g.y,t[i++]=g.z,t[i++]=g.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)es.fromBufferAttribute(this,t),es.applyMatrix3(e),this.setXY(t,es.x,es.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)lt.fromBufferAttribute(this,t),lt.applyMatrix3(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)lt.fromBufferAttribute(this,t),lt.applyMatrix4(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)lt.fromBufferAttribute(this,t),lt.applyNormalMatrix(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)lt.fromBufferAttribute(this,t),lt.transformDirection(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=a,this}setXYZW(e,t,i,a,u){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=a,this.array[e+3]=u,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==za&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class ao extends Tt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class rh extends Tt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Ze extends Tt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Hf=0;const Rt=new Le,fa=new et,En=new X,Dt=new Qn,_r=new Qn,ft=new X;class ut extends fn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Hf++}),this.uuid=Zt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Jc(e)?rh:ao)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const u=new qt().getNormalMatrix(e);i.applyNormalMatrix(u),i.needsUpdate=!0}const a=this.attributes.tangent;return a!==void 0&&(a.transformDirection(e),a.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Rt.makeRotationFromQuaternion(e),this.applyMatrix4(Rt),this}rotateX(e){return Rt.makeRotationX(e),this.applyMatrix4(Rt),this}rotateY(e){return Rt.makeRotationY(e),this.applyMatrix4(Rt),this}rotateZ(e){return Rt.makeRotationZ(e),this.applyMatrix4(Rt),this}translate(e,t,i){return Rt.makeTranslation(e,t,i),this.applyMatrix4(Rt),this}scale(e,t,i){return Rt.makeScale(e,t,i),this.applyMatrix4(Rt),this}lookAt(e){return fa.lookAt(e),fa.updateMatrix(),this.applyMatrix4(fa.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(En).negate(),this.translate(En.x,En.y,En.z),this}setFromPoints(e){const t=[];for(let i=0,a=e.length;i<a;i++){const u=e[i];t.push(u.x,u.y,u.z||0)}return this.setAttribute("position",new Ze(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new X(-1/0,-1/0,-1/0),new X(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,a=t.length;i<a;i++){const u=t[i];Dt.setFromBufferAttribute(u),this.morphTargetsRelative?(ft.addVectors(this.boundingBox.min,Dt.min),this.boundingBox.expandByPoint(ft),ft.addVectors(this.boundingBox.max,Dt.max),this.boundingBox.expandByPoint(ft)):(this.boundingBox.expandByPoint(Dt.min),this.boundingBox.expandByPoint(Dt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new er);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new X,1/0);return}if(e){const i=this.boundingSphere.center;if(Dt.setFromBufferAttribute(e),t)for(let u=0,g=t.length;u<g;u++){const s=t[u];_r.setFromBufferAttribute(s),this.morphTargetsRelative?(ft.addVectors(Dt.min,_r.min),Dt.expandByPoint(ft),ft.addVectors(Dt.max,_r.max),Dt.expandByPoint(ft)):(Dt.expandByPoint(_r.min),Dt.expandByPoint(_r.max))}Dt.getCenter(i);let a=0;for(let u=0,g=e.count;u<g;u++)ft.fromBufferAttribute(e,u),a=Math.max(a,i.distanceToSquared(ft));if(t)for(let u=0,g=t.length;u<g;u++){const s=t[u],n=this.morphTargetsRelative;for(let o=0,f=s.count;o<f;o++)ft.fromBufferAttribute(s,o),n&&(En.fromBufferAttribute(e,o),ft.add(En)),a=Math.max(a,i.distanceToSquared(ft))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,a=t.position.array,u=t.normal.array,g=t.uv.array,s=a.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Tt(new Float32Array(4*s),4));const n=this.getAttribute("tangent").array,o=[],f=[];for(let O=0;O<s;O++)o[O]=new X,f[O]=new X;const r=new X,l=new X,c=new X,d=new De,p=new De,h=new De,v=new X,_=new X;function y(O,k,Y){r.fromArray(a,O*3),l.fromArray(a,k*3),c.fromArray(a,Y*3),d.fromArray(g,O*2),p.fromArray(g,k*2),h.fromArray(g,Y*2),l.sub(r),c.sub(r),p.sub(d),h.sub(d);const H=1/(p.x*h.y-h.x*p.y);!isFinite(H)||(v.copy(l).multiplyScalar(h.y).addScaledVector(c,-p.y).multiplyScalar(H),_.copy(c).multiplyScalar(p.x).addScaledVector(l,-h.x).multiplyScalar(H),o[O].add(v),o[k].add(v),o[Y].add(v),f[O].add(_),f[k].add(_),f[Y].add(_))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let O=0,k=x.length;O<k;++O){const Y=x[O],H=Y.start,N=Y.count;for(let U=H,G=H+N;U<G;U+=3)y(i[U+0],i[U+1],i[U+2])}const b=new X,w=new X,M=new X,S=new X;function C(O){M.fromArray(u,O*3),S.copy(M);const k=o[O];b.copy(k),b.sub(M.multiplyScalar(M.dot(k))).normalize(),w.crossVectors(S,k);const H=w.dot(f[O])<0?-1:1;n[O*4]=b.x,n[O*4+1]=b.y,n[O*4+2]=b.z,n[O*4+3]=H}for(let O=0,k=x.length;O<k;++O){const Y=x[O],H=Y.start,N=Y.count;for(let U=H,G=H+N;U<G;U+=3)C(i[U+0]),C(i[U+1]),C(i[U+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Tt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let l=0,c=i.count;l<c;l++)i.setXYZ(l,0,0,0);const a=new X,u=new X,g=new X,s=new X,n=new X,o=new X,f=new X,r=new X;if(e)for(let l=0,c=e.count;l<c;l+=3){const d=e.getX(l+0),p=e.getX(l+1),h=e.getX(l+2);a.fromBufferAttribute(t,d),u.fromBufferAttribute(t,p),g.fromBufferAttribute(t,h),f.subVectors(g,u),r.subVectors(a,u),f.cross(r),s.fromBufferAttribute(i,d),n.fromBufferAttribute(i,p),o.fromBufferAttribute(i,h),s.add(f),n.add(f),o.add(f),i.setXYZ(d,s.x,s.y,s.z),i.setXYZ(p,n.x,n.y,n.z),i.setXYZ(h,o.x,o.y,o.z)}else for(let l=0,c=t.count;l<c;l+=3)a.fromBufferAttribute(t,l+0),u.fromBufferAttribute(t,l+1),g.fromBufferAttribute(t,l+2),f.subVectors(g,u),r.subVectors(a,u),f.cross(r),i.setXYZ(l+0,f.x,f.y,f.z),i.setXYZ(l+1,f.x,f.y,f.z),i.setXYZ(l+2,f.x,f.y,f.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const a in i){if(e.attributes[a]===void 0)continue;const g=i[a].array,s=e.attributes[a],n=s.array,o=s.itemSize*t,f=Math.min(n.length,g.length-o);for(let r=0,l=o;r<f;r++,l++)g[l]=n[r]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ft.fromBufferAttribute(e,t),ft.normalize(),e.setXYZ(t,ft.x,ft.y,ft.z)}toNonIndexed(){function e(s,n){const o=s.array,f=s.itemSize,r=s.normalized,l=new o.constructor(n.length*f);let c=0,d=0;for(let p=0,h=n.length;p<h;p++){s.isInterleavedBufferAttribute?c=n[p]*s.data.stride+s.offset:c=n[p]*f;for(let v=0;v<f;v++)l[d++]=o[c++]}return new Tt(l,f,r)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ut,i=this.index.array,a=this.attributes;for(const s in a){const n=a[s],o=e(n,i);t.setAttribute(s,o)}const u=this.morphAttributes;for(const s in u){const n=[],o=u[s];for(let f=0,r=o.length;f<r;f++){const l=o[f],c=e(l,i);n.push(c)}t.morphAttributes[s]=n}t.morphTargetsRelative=this.morphTargetsRelative;const g=this.groups;for(let s=0,n=g.length;s<n;s++){const o=g[s];t.addGroup(o.start,o.count,o.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const n=this.parameters;for(const o in n)n[o]!==void 0&&(e[o]=n[o]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const n in i){const o=i[n];e.data.attributes[n]=o.toJSON(e.data)}const a={};let u=!1;for(const n in this.morphAttributes){const o=this.morphAttributes[n],f=[];for(let r=0,l=o.length;r<l;r++){const c=o[r];f.push(c.toJSON(e.data))}f.length>0&&(a[n]=f,u=!0)}u&&(e.data.morphAttributes=a,e.data.morphTargetsRelative=this.morphTargetsRelative);const g=this.groups;g.length>0&&(e.data.groups=JSON.parse(JSON.stringify(g)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const a=e.attributes;for(const o in a){const f=a[o];this.setAttribute(o,f.clone(t))}const u=e.morphAttributes;for(const o in u){const f=[],r=u[o];for(let l=0,c=r.length;l<c;l++)f.push(r[l].clone(t));this.morphAttributes[o]=f}this.morphTargetsRelative=e.morphTargetsRelative;const g=e.groups;for(let o=0,f=g.length;o<f;o++){const r=g[o];this.addGroup(r.start,r.count,r.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const n=e.boundingSphere;return n!==null&&(this.boundingSphere=n.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Sl=new Le,An=new so,da=new er,Ri=new X,Oi=new X,Ii=new X,pa=new X,ma=new X,ga=new X,ts=new X,is=new X,ns=new X,rs=new De,ss=new De,as=new De,va=new X,os=new X;class Mt extends et{constructor(e=new ut,t=new Bi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,g=a.length;u<g;u++){const s=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=u}}}}raycast(e,t){const i=this.geometry,a=this.material,u=this.matrixWorld;if(a===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),da.copy(i.boundingSphere),da.applyMatrix4(u),e.ray.intersectsSphere(da)===!1)||(Sl.copy(u).invert(),An.copy(e.ray).applyMatrix4(Sl),i.boundingBox!==null&&An.intersectsBox(i.boundingBox)===!1))return;let g;const s=i.index,n=i.attributes.position,o=i.morphAttributes.position,f=i.morphTargetsRelative,r=i.attributes.uv,l=i.attributes.uv2,c=i.groups,d=i.drawRange;if(s!==null)if(Array.isArray(a))for(let p=0,h=c.length;p<h;p++){const v=c[p],_=a[v.materialIndex],y=Math.max(v.start,d.start),x=Math.min(s.count,Math.min(v.start+v.count,d.start+d.count));for(let b=y,w=x;b<w;b+=3){const M=s.getX(b),S=s.getX(b+1),C=s.getX(b+2);g=ls(this,_,e,An,n,o,f,r,l,M,S,C),g&&(g.faceIndex=Math.floor(b/3),g.face.materialIndex=v.materialIndex,t.push(g))}}else{const p=Math.max(0,d.start),h=Math.min(s.count,d.start+d.count);for(let v=p,_=h;v<_;v+=3){const y=s.getX(v),x=s.getX(v+1),b=s.getX(v+2);g=ls(this,a,e,An,n,o,f,r,l,y,x,b),g&&(g.faceIndex=Math.floor(v/3),t.push(g))}}else if(n!==void 0)if(Array.isArray(a))for(let p=0,h=c.length;p<h;p++){const v=c[p],_=a[v.materialIndex],y=Math.max(v.start,d.start),x=Math.min(n.count,Math.min(v.start+v.count,d.start+d.count));for(let b=y,w=x;b<w;b+=3){const M=b,S=b+1,C=b+2;g=ls(this,_,e,An,n,o,f,r,l,M,S,C),g&&(g.faceIndex=Math.floor(b/3),g.face.materialIndex=v.materialIndex,t.push(g))}}else{const p=Math.max(0,d.start),h=Math.min(n.count,d.start+d.count);for(let v=p,_=h;v<_;v+=3){const y=v,x=v+1,b=v+2;g=ls(this,a,e,An,n,o,f,r,l,y,x,b),g&&(g.faceIndex=Math.floor(v/3),t.push(g))}}}}function Wf(m,e,t,i,a,u,g,s){let n;if(e.side===Kt?n=i.intersectTriangle(g,u,a,!0,s):n=i.intersectTriangle(a,u,g,e.side!==Si,s),n===null)return null;os.copy(s),os.applyMatrix4(m.matrixWorld);const o=t.ray.origin.distanceTo(os);return o<t.near||o>t.far?null:{distance:o,point:os.clone(),object:m}}function ls(m,e,t,i,a,u,g,s,n,o,f,r){Ri.fromBufferAttribute(a,o),Oi.fromBufferAttribute(a,f),Ii.fromBufferAttribute(a,r);const l=m.morphTargetInfluences;if(u&&l){ts.set(0,0,0),is.set(0,0,0),ns.set(0,0,0);for(let d=0,p=u.length;d<p;d++){const h=l[d],v=u[d];h!==0&&(pa.fromBufferAttribute(v,o),ma.fromBufferAttribute(v,f),ga.fromBufferAttribute(v,r),g?(ts.addScaledVector(pa,h),is.addScaledVector(ma,h),ns.addScaledVector(ga,h)):(ts.addScaledVector(pa.sub(Ri),h),is.addScaledVector(ma.sub(Oi),h),ns.addScaledVector(ga.sub(Ii),h)))}Ri.add(ts),Oi.add(is),Ii.add(ns)}m.isSkinnedMesh&&(m.boneTransform(o,Ri),m.boneTransform(f,Oi),m.boneTransform(r,Ii));const c=Wf(m,e,t,i,Ri,Oi,Ii,va);if(c){s&&(rs.fromBufferAttribute(s,o),ss.fromBufferAttribute(s,f),as.fromBufferAttribute(s,r),c.uv=si.getUV(va,Ri,Oi,Ii,rs,ss,as,new De)),n&&(rs.fromBufferAttribute(n,o),ss.fromBufferAttribute(n,f),as.fromBufferAttribute(n,r),c.uv2=si.getUV(va,Ri,Oi,Ii,rs,ss,as,new De));const d={a:o,b:f,c:r,normal:new X,materialIndex:0};si.getNormal(Ri,Oi,Ii,d.normal),c.face=d}return c}class Nr extends ut{constructor(e=1,t=1,i=1,a=1,u=1,g=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:a,heightSegments:u,depthSegments:g};const s=this;a=Math.floor(a),u=Math.floor(u),g=Math.floor(g);const n=[],o=[],f=[],r=[];let l=0,c=0;d("z","y","x",-1,-1,i,t,e,g,u,0),d("z","y","x",1,-1,i,t,-e,g,u,1),d("x","z","y",1,1,e,i,t,a,g,2),d("x","z","y",1,-1,e,i,-t,a,g,3),d("x","y","z",1,-1,e,t,i,a,u,4),d("x","y","z",-1,-1,e,t,-i,a,u,5),this.setIndex(n),this.setAttribute("position",new Ze(o,3)),this.setAttribute("normal",new Ze(f,3)),this.setAttribute("uv",new Ze(r,2));function d(p,h,v,_,y,x,b,w,M,S,C){const O=x/M,k=b/S,Y=x/2,H=b/2,N=w/2,U=M+1,G=S+1;let j=0,q=0;const T=new X;for(let P=0;P<G;P++){const R=P*k-H;for(let L=0;L<U;L++){const V=L*O-Y;T[p]=V*_,T[h]=R*y,T[v]=N,o.push(T.x,T.y,T.z),T[p]=0,T[h]=0,T[v]=w>0?1:-1,f.push(T.x,T.y,T.z),r.push(L/M),r.push(1-P/S),j+=1}}for(let P=0;P<S;P++)for(let R=0;R<M;R++){const L=l+R+U*P,V=l+R+U*(P+1),I=l+(R+1)+U*(P+1),E=l+(R+1)+U*P;n.push(L,V,E),n.push(V,I,E),q+=6}s.addGroup(c,q,C),c+=q,l+=j}}static fromJSON(e){return new Nr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Yn(m){const e={};for(const t in m){e[t]={};for(const i in m[t]){const a=m[t][i];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?e[t][i]=a.clone():Array.isArray(a)?e[t][i]=a.slice():e[t][i]=a}}return e}function gt(m){const e={};for(let t=0;t<m.length;t++){const i=Yn(m[t]);for(const a in i)e[a]=i[a]}return e}const sh={clone:Yn,merge:gt};var jf=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Xf=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Jt extends it{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=jf,this.fragmentShader=Xf,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Yn(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const a in this.uniforms){const g=this.uniforms[a].value;g&&g.isTexture?t.uniforms[a]={type:"t",value:g.toJSON(e).uuid}:g&&g.isColor?t.uniforms[a]={type:"c",value:g.getHex()}:g&&g.isVector2?t.uniforms[a]={type:"v2",value:g.toArray()}:g&&g.isVector3?t.uniforms[a]={type:"v3",value:g.toArray()}:g&&g.isVector4?t.uniforms[a]={type:"v4",value:g.toArray()}:g&&g.isMatrix3?t.uniforms[a]={type:"m3",value:g.toArray()}:g&&g.isMatrix4?t.uniforms[a]={type:"m4",value:g.toArray()}:t.uniforms[a]={value:g}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const a in this.extensions)this.extensions[a]===!0&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class ah extends et{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Le,this.projectionMatrix=new Le,this.projectionMatrixInverse=new Le}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class vt extends ah{constructor(e=50,t=1,i=.1,a=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=a,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Pr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Mr*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Pr*2*Math.atan(Math.tan(Mr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,a,u,g){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=a,this.view.width=u,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Mr*.5*this.fov)/this.zoom,i=2*t,a=this.aspect*i,u=-.5*a;const g=this.view;if(this.view!==null&&this.view.enabled){const n=g.fullWidth,o=g.fullHeight;u+=g.offsetX*a/n,t-=g.offsetY*i/o,a*=g.width/n,i*=g.height/o}const s=this.filmOffset;s!==0&&(u+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(u,u+a,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ln=90,Pn=1;class Yf extends et{constructor(e,t,i){if(super(),this.type="CubeCamera",i.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=i;const a=new vt(Ln,Pn,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new X(1,0,0)),this.add(a);const u=new vt(Ln,Pn,e,t);u.layers=this.layers,u.up.set(0,-1,0),u.lookAt(new X(-1,0,0)),this.add(u);const g=new vt(Ln,Pn,e,t);g.layers=this.layers,g.up.set(0,0,1),g.lookAt(new X(0,1,0)),this.add(g);const s=new vt(Ln,Pn,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new X(0,-1,0)),this.add(s);const n=new vt(Ln,Pn,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new X(0,0,1)),this.add(n);const o=new vt(Ln,Pn,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new X(0,0,-1)),this.add(o)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[a,u,g,s,n,o]=this.children,f=e.getRenderTarget(),r=e.toneMapping,l=e.xr.enabled;e.toneMapping=$t,e.xr.enabled=!1;const c=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,a),e.setRenderTarget(i,1),e.render(t,u),e.setRenderTarget(i,2),e.render(t,g),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,n),i.texture.generateMipmaps=c,e.setRenderTarget(i,5),e.render(t,o),e.setRenderTarget(f),e.toneMapping=r,e.xr.enabled=l,i.texture.needsPMREMUpdate=!0}}class oh extends at{constructor(e,t,i,a,u,g,s,n,o,f){e=e!==void 0?e:[],t=t!==void 0?t:Hn,super(e,t,i,a,u,g,s,n,o,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class qf extends li{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},a=[i,i,i,i,i,i];this.texture=new oh(a,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:rt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},a=new Nr(5,5,5),u=new Jt({name:"CubemapFromEquirect",uniforms:Yn(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Kt,blending:Ni});u.uniforms.tEquirect.value=t;const g=new Mt(a,u),s=t.minFilter;return t.minFilter===hn&&(t.minFilter=rt),new Yf(1,10,this).update(e,g),t.minFilter=s,g.geometry.dispose(),g.material.dispose(),this}clear(e,t,i,a){const u=e.getRenderTarget();for(let g=0;g<6;g++)e.setRenderTarget(this,g),e.clear(t,i,a);e.setRenderTarget(u)}}const _a=new X,Kf=new X,$f=new qt;class Zi{constructor(e=new X(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,a){return this.normal.set(e,t,i),this.constant=a,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const a=_a.subVectors(i,t).cross(Kf.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(a,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(_a),a=this.normal.dot(i);if(a===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const u=-(e.start.dot(this.normal)+this.constant)/a;return u<0||u>1?null:t.copy(i).multiplyScalar(u).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||$f.getNormalMatrix(e),a=this.coplanarPoint(_a).applyMatrix4(e),u=this.normal.applyMatrix3(i).normalize();return this.constant=-a.dot(u),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Dn=new er,cs=new X;class oo{constructor(e=new Zi,t=new Zi,i=new Zi,a=new Zi,u=new Zi,g=new Zi){this.planes=[e,t,i,a,u,g]}set(e,t,i,a,u,g){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(a),s[4].copy(u),s[5].copy(g),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,a=i[0],u=i[1],g=i[2],s=i[3],n=i[4],o=i[5],f=i[6],r=i[7],l=i[8],c=i[9],d=i[10],p=i[11],h=i[12],v=i[13],_=i[14],y=i[15];return t[0].setComponents(s-a,r-n,p-l,y-h).normalize(),t[1].setComponents(s+a,r+n,p+l,y+h).normalize(),t[2].setComponents(s+u,r+o,p+c,y+v).normalize(),t[3].setComponents(s-u,r-o,p-c,y-v).normalize(),t[4].setComponents(s-g,r-f,p-d,y-_).normalize(),t[5].setComponents(s+g,r+f,p+d,y+_).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Dn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Dn)}intersectsSprite(e){return Dn.center.set(0,0,0),Dn.radius=.7071067811865476,Dn.applyMatrix4(e.matrixWorld),this.intersectsSphere(Dn)}intersectsSphere(e){const t=this.planes,i=e.center,a=-e.radius;for(let u=0;u<6;u++)if(t[u].distanceToPoint(i)<a)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const a=t[i];if(cs.x=a.normal.x>0?e.max.x:e.min.x,cs.y=a.normal.y>0?e.max.y:e.min.y,cs.z=a.normal.z>0?e.max.z:e.min.z,a.distanceToPoint(cs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function lh(){let m=null,e=!1,t=null,i=null;function a(u,g){t(u,g),i=m.requestAnimationFrame(a)}return{start:function(){e!==!0&&t!==null&&(i=m.requestAnimationFrame(a),e=!0)},stop:function(){m.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(u){t=u},setContext:function(u){m=u}}}function Zf(m,e){const t=e.isWebGL2,i=new WeakMap;function a(o,f){const r=o.array,l=o.usage,c=m.createBuffer();m.bindBuffer(f,c),m.bufferData(f,r,l),o.onUploadCallback();let d;if(r instanceof Float32Array)d=5126;else if(r instanceof Uint16Array)if(o.isFloat16BufferAttribute)if(t)d=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else d=5123;else if(r instanceof Int16Array)d=5122;else if(r instanceof Uint32Array)d=5125;else if(r instanceof Int32Array)d=5124;else if(r instanceof Int8Array)d=5120;else if(r instanceof Uint8Array)d=5121;else if(r instanceof Uint8ClampedArray)d=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);return{buffer:c,type:d,bytesPerElement:r.BYTES_PER_ELEMENT,version:o.version}}function u(o,f,r){const l=f.array,c=f.updateRange;m.bindBuffer(r,o),c.count===-1?m.bufferSubData(r,0,l):(t?m.bufferSubData(r,c.offset*l.BYTES_PER_ELEMENT,l,c.offset,c.count):m.bufferSubData(r,c.offset*l.BYTES_PER_ELEMENT,l.subarray(c.offset,c.offset+c.count)),c.count=-1)}function g(o){return o.isInterleavedBufferAttribute&&(o=o.data),i.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const f=i.get(o);f&&(m.deleteBuffer(f.buffer),i.delete(o))}function n(o,f){if(o.isGLBufferAttribute){const l=i.get(o);(!l||l.version<o.version)&&i.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}o.isInterleavedBufferAttribute&&(o=o.data);const r=i.get(o);r===void 0?i.set(o,a(o,f)):r.version<o.version&&(u(r.buffer,o,f),r.version=o.version)}return{get:g,remove:s,update:n}}class lo extends ut{constructor(e=1,t=1,i=1,a=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:a};const u=e/2,g=t/2,s=Math.floor(i),n=Math.floor(a),o=s+1,f=n+1,r=e/s,l=t/n,c=[],d=[],p=[],h=[];for(let v=0;v<f;v++){const _=v*l-g;for(let y=0;y<o;y++){const x=y*r-u;d.push(x,-_,0),p.push(0,0,1),h.push(y/s),h.push(1-v/n)}}for(let v=0;v<n;v++)for(let _=0;_<s;_++){const y=_+o*v,x=_+o*(v+1),b=_+1+o*(v+1),w=_+1+o*v;c.push(y,x,w),c.push(x,b,w)}this.setIndex(c),this.setAttribute("position",new Ze(d,3)),this.setAttribute("normal",new Ze(p,3)),this.setAttribute("uv",new Ze(h,2))}static fromJSON(e){return new lo(e.width,e.height,e.widthSegments,e.heightSegments)}}var Jf=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Qf=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ed=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,td=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,id=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,nd=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,rd="vec3 transformed = vec3( position );",sd=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,ad=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,od=`#ifdef USE_IRIDESCENCE
const mat3 XYZ_TO_REC709 = mat3(
    3.2404542, -0.9692660,  0.0556434,
   -1.5371385,  1.8760108, -0.2040259,
   -0.4985314,  0.0415560,  1.0572252
);
vec3 Fresnel0ToIor( vec3 fresnel0 ) {
   vec3 sqrtF0 = sqrt( fresnel0 );
   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
}
vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
}
float IorToFresnel0( float transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
}
vec3 evalSensitivity( float OPD, vec3 shift ) {
   float phase = 2.0 * PI * OPD * 1.0e-9;
   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );
   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );
   xyz /= 1.0685e-7;
   vec3 srgb = XYZ_TO_REC709 * xyz;
   return srgb;
}
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
   vec3 I;
   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
   float cosTheta2Sq = 1.0 - sinTheta2Sq;
   if ( cosTheta2Sq < 0.0 ) {
       return vec3( 1.0 );
   }
   float cosTheta2 = sqrt( cosTheta2Sq );
   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
   float R12 = F_Schlick( R0, 1.0, cosTheta1 );
   float R21 = R12;
   float T121 = 1.0 - R12;
   float phi12 = 0.0;
   if ( iridescenceIOR < outsideIOR ) phi12 = PI;
   float phi21 = PI - phi12;
   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
   vec3 phi23 = vec3( 0.0 );
   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;
   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;
   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;
   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
   vec3 phi = vec3( phi21 ) + phi23;
   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
   vec3 r123 = sqrt( R123 );
   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
   vec3 C0 = R12 + Rs;
   I = C0;
   vec3 Cm = Rs - T121;
   for ( int m = 1; m <= 2; ++m ) {
       Cm *= r123;
       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
       I += Cm * Sm;
   }
   return max( I, vec3( 0.0 ) );
}
#endif`,ld=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,cd=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,hd=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ud=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,fd=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,dd=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,pd=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,md=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,gd=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,vd=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,_d=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,yd=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,xd=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,bd=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,wd=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Sd=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Md="gl_FragColor = linearToOutputTexel( gl_FragColor );",Td=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Cd=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Ed=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Ad=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Ld=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Pd=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Dd=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Rd=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Od=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Id=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Fd=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,kd=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Bd=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Nd=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,zd=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Ud=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,Vd=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Gd=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,Hd=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,Wd=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,jd=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,Xd=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Yd=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
float dotNVi = saturate( dot( normal, geometry.viewDir ) );
if ( material.iridescenceThickness == 0.0 ) {
	material.iridescence = 0.0;
} else {
	material.iridescence = saturate( material.iridescence );
}
if ( material.iridescence > 0.0 ) {
	material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
	material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,qd=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Kd=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,$d=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Zd=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Jd=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Qd=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ep=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,tp=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,ip=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,np=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,rp=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,sp=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,ap=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,op=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,lp=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,cp=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,hp=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,up=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,fp=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dp=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,pp=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,mp=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,gp=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,vp=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,_p=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,yp=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,xp=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,bp=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,wp=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Sp=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Mp=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Tp=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Cp=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Ep=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Ap=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Lp=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Pp=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,Dp=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Rp=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Op=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Ip=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Fp=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,kp=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Bp=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Np=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,zp=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Up=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,Vp=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,Gp=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,Hp=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Wp=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,jp=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,Xp=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Yp=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,qp=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Kp=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,$p=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Zp=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Jp=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Qp=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,em=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,tm=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,im=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,nm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,rm=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,sm=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,am=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,om=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,lm=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cm=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hm=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,um=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fm=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dm=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,pm=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,mm=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gm=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vm=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_m=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ym=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xm=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bm=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,wm=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Sm=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Mm=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Tm=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Cm=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Be={alphamap_fragment:Jf,alphamap_pars_fragment:Qf,alphatest_fragment:ed,alphatest_pars_fragment:td,aomap_fragment:id,aomap_pars_fragment:nd,begin_vertex:rd,beginnormal_vertex:sd,bsdfs:ad,iridescence_fragment:od,bumpmap_pars_fragment:ld,clipping_planes_fragment:cd,clipping_planes_pars_fragment:hd,clipping_planes_pars_vertex:ud,clipping_planes_vertex:fd,color_fragment:dd,color_pars_fragment:pd,color_pars_vertex:md,color_vertex:gd,common:vd,cube_uv_reflection_fragment:_d,defaultnormal_vertex:yd,displacementmap_pars_vertex:xd,displacementmap_vertex:bd,emissivemap_fragment:wd,emissivemap_pars_fragment:Sd,encodings_fragment:Md,encodings_pars_fragment:Td,envmap_fragment:Cd,envmap_common_pars_fragment:Ed,envmap_pars_fragment:Ad,envmap_pars_vertex:Ld,envmap_physical_pars_fragment:Ud,envmap_vertex:Pd,fog_vertex:Dd,fog_pars_vertex:Rd,fog_fragment:Od,fog_pars_fragment:Id,gradientmap_pars_fragment:Fd,lightmap_fragment:kd,lightmap_pars_fragment:Bd,lights_lambert_vertex:Nd,lights_pars_begin:zd,lights_toon_fragment:Vd,lights_toon_pars_fragment:Gd,lights_phong_fragment:Hd,lights_phong_pars_fragment:Wd,lights_physical_fragment:jd,lights_physical_pars_fragment:Xd,lights_fragment_begin:Yd,lights_fragment_maps:qd,lights_fragment_end:Kd,logdepthbuf_fragment:$d,logdepthbuf_pars_fragment:Zd,logdepthbuf_pars_vertex:Jd,logdepthbuf_vertex:Qd,map_fragment:ep,map_pars_fragment:tp,map_particle_fragment:ip,map_particle_pars_fragment:np,metalnessmap_fragment:rp,metalnessmap_pars_fragment:sp,morphcolor_vertex:ap,morphnormal_vertex:op,morphtarget_pars_vertex:lp,morphtarget_vertex:cp,normal_fragment_begin:hp,normal_fragment_maps:up,normal_pars_fragment:fp,normal_pars_vertex:dp,normal_vertex:pp,normalmap_pars_fragment:mp,clearcoat_normal_fragment_begin:gp,clearcoat_normal_fragment_maps:vp,clearcoat_pars_fragment:_p,iridescence_pars_fragment:yp,output_fragment:xp,packing:bp,premultiplied_alpha_fragment:wp,project_vertex:Sp,dithering_fragment:Mp,dithering_pars_fragment:Tp,roughnessmap_fragment:Cp,roughnessmap_pars_fragment:Ep,shadowmap_pars_fragment:Ap,shadowmap_pars_vertex:Lp,shadowmap_vertex:Pp,shadowmask_pars_fragment:Dp,skinbase_vertex:Rp,skinning_pars_vertex:Op,skinning_vertex:Ip,skinnormal_vertex:Fp,specularmap_fragment:kp,specularmap_pars_fragment:Bp,tonemapping_fragment:Np,tonemapping_pars_fragment:zp,transmission_fragment:Up,transmission_pars_fragment:Vp,uv_pars_fragment:Gp,uv_pars_vertex:Hp,uv_vertex:Wp,uv2_pars_fragment:jp,uv2_pars_vertex:Xp,uv2_vertex:Yp,worldpos_vertex:qp,background_vert:Kp,background_frag:$p,cube_vert:Zp,cube_frag:Jp,depth_vert:Qp,depth_frag:em,distanceRGBA_vert:tm,distanceRGBA_frag:im,equirect_vert:nm,equirect_frag:rm,linedashed_vert:sm,linedashed_frag:am,meshbasic_vert:om,meshbasic_frag:lm,meshlambert_vert:cm,meshlambert_frag:hm,meshmatcap_vert:um,meshmatcap_frag:fm,meshnormal_vert:dm,meshnormal_frag:pm,meshphong_vert:mm,meshphong_frag:gm,meshphysical_vert:vm,meshphysical_frag:_m,meshtoon_vert:ym,meshtoon_frag:xm,points_vert:bm,points_frag:wm,shadow_vert:Sm,shadow_frag:Mm,sprite_vert:Tm,sprite_frag:Cm},we={common:{diffuse:{value:new Te(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new qt},uv2Transform:{value:new qt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new De(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Te(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Te(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qt}},sprite:{diffuse:{value:new Te(16777215)},opacity:{value:1},center:{value:new De(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new qt}}},ri={basic:{uniforms:gt([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.fog]),vertexShader:Be.meshbasic_vert,fragmentShader:Be.meshbasic_frag},lambert:{uniforms:gt([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.fog,we.lights,{emissive:{value:new Te(0)}}]),vertexShader:Be.meshlambert_vert,fragmentShader:Be.meshlambert_frag},phong:{uniforms:gt([we.common,we.specularmap,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.fog,we.lights,{emissive:{value:new Te(0)},specular:{value:new Te(1118481)},shininess:{value:30}}]),vertexShader:Be.meshphong_vert,fragmentShader:Be.meshphong_frag},standard:{uniforms:gt([we.common,we.envmap,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.roughnessmap,we.metalnessmap,we.fog,we.lights,{emissive:{value:new Te(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Be.meshphysical_vert,fragmentShader:Be.meshphysical_frag},toon:{uniforms:gt([we.common,we.aomap,we.lightmap,we.emissivemap,we.bumpmap,we.normalmap,we.displacementmap,we.gradientmap,we.fog,we.lights,{emissive:{value:new Te(0)}}]),vertexShader:Be.meshtoon_vert,fragmentShader:Be.meshtoon_frag},matcap:{uniforms:gt([we.common,we.bumpmap,we.normalmap,we.displacementmap,we.fog,{matcap:{value:null}}]),vertexShader:Be.meshmatcap_vert,fragmentShader:Be.meshmatcap_frag},points:{uniforms:gt([we.points,we.fog]),vertexShader:Be.points_vert,fragmentShader:Be.points_frag},dashed:{uniforms:gt([we.common,we.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Be.linedashed_vert,fragmentShader:Be.linedashed_frag},depth:{uniforms:gt([we.common,we.displacementmap]),vertexShader:Be.depth_vert,fragmentShader:Be.depth_frag},normal:{uniforms:gt([we.common,we.bumpmap,we.normalmap,we.displacementmap,{opacity:{value:1}}]),vertexShader:Be.meshnormal_vert,fragmentShader:Be.meshnormal_frag},sprite:{uniforms:gt([we.sprite,we.fog]),vertexShader:Be.sprite_vert,fragmentShader:Be.sprite_frag},background:{uniforms:{uvTransform:{value:new qt},t2D:{value:null}},vertexShader:Be.background_vert,fragmentShader:Be.background_frag},cube:{uniforms:gt([we.envmap,{opacity:{value:1}}]),vertexShader:Be.cube_vert,fragmentShader:Be.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Be.equirect_vert,fragmentShader:Be.equirect_frag},distanceRGBA:{uniforms:gt([we.common,we.displacementmap,{referencePosition:{value:new X},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Be.distanceRGBA_vert,fragmentShader:Be.distanceRGBA_frag},shadow:{uniforms:gt([we.lights,we.fog,{color:{value:new Te(0)},opacity:{value:1}}]),vertexShader:Be.shadow_vert,fragmentShader:Be.shadow_frag}};ri.physical={uniforms:gt([ri.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new De(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Te(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new De},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Te(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Te(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Be.meshphysical_vert,fragmentShader:Be.meshphysical_frag};function Em(m,e,t,i,a,u){const g=new Te(0);let s=a===!0?0:1,n,o,f=null,r=0,l=null;function c(p,h){let v=!1,_=h.isScene===!0?h.background:null;_&&_.isTexture&&(_=e.get(_));const y=m.xr,x=y.getSession&&y.getSession();x&&x.environmentBlendMode==="additive"&&(_=null),_===null?d(g,s):_&&_.isColor&&(d(_,1),v=!0),(m.autoClear||v)&&m.clear(m.autoClearColor,m.autoClearDepth,m.autoClearStencil),_&&(_.isCubeTexture||_.mapping===ks)?(o===void 0&&(o=new Mt(new Nr(1,1,1),new Jt({name:"BackgroundCubeMaterial",uniforms:Yn(ri.cube.uniforms),vertexShader:ri.cube.vertexShader,fragmentShader:ri.cube.fragmentShader,side:Kt,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(b,w,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=_,o.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,(f!==_||r!==_.version||l!==m.toneMapping)&&(o.material.needsUpdate=!0,f=_,r=_.version,l=m.toneMapping),o.layers.enableAll(),p.unshift(o,o.geometry,o.material,0,0,null)):_&&_.isTexture&&(n===void 0&&(n=new Mt(new lo(2,2),new Jt({name:"BackgroundMaterial",uniforms:Yn(ri.background.uniforms),vertexShader:ri.background.vertexShader,fragmentShader:ri.background.fragmentShader,side:Gn,depthTest:!1,depthWrite:!1,fog:!1})),n.geometry.deleteAttribute("normal"),Object.defineProperty(n.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(n)),n.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),n.material.uniforms.uvTransform.value.copy(_.matrix),(f!==_||r!==_.version||l!==m.toneMapping)&&(n.material.needsUpdate=!0,f=_,r=_.version,l=m.toneMapping),n.layers.enableAll(),p.unshift(n,n.geometry,n.material,0,0,null))}function d(p,h){t.buffers.color.setClear(p.r,p.g,p.b,h,u)}return{getClearColor:function(){return g},setClearColor:function(p,h=1){g.set(p),s=h,d(g,s)},getClearAlpha:function(){return s},setClearAlpha:function(p){s=p,d(g,s)},render:c}}function Am(m,e,t,i){const a=m.getParameter(34921),u=i.isWebGL2?null:e.get("OES_vertex_array_object"),g=i.isWebGL2||u!==null,s={},n=h(null);let o=n,f=!1;function r(N,U,G,j,q){let T=!1;if(g){const P=p(j,G,U);o!==P&&(o=P,c(o.object)),T=v(N,j,G,q),T&&_(N,j,G,q)}else{const P=U.wireframe===!0;(o.geometry!==j.id||o.program!==G.id||o.wireframe!==P)&&(o.geometry=j.id,o.program=G.id,o.wireframe=P,T=!0)}q!==null&&t.update(q,34963),(T||f)&&(f=!1,S(N,U,G,j),q!==null&&m.bindBuffer(34963,t.get(q).buffer))}function l(){return i.isWebGL2?m.createVertexArray():u.createVertexArrayOES()}function c(N){return i.isWebGL2?m.bindVertexArray(N):u.bindVertexArrayOES(N)}function d(N){return i.isWebGL2?m.deleteVertexArray(N):u.deleteVertexArrayOES(N)}function p(N,U,G){const j=G.wireframe===!0;let q=s[N.id];q===void 0&&(q={},s[N.id]=q);let T=q[U.id];T===void 0&&(T={},q[U.id]=T);let P=T[j];return P===void 0&&(P=h(l()),T[j]=P),P}function h(N){const U=[],G=[],j=[];for(let q=0;q<a;q++)U[q]=0,G[q]=0,j[q]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:U,enabledAttributes:G,attributeDivisors:j,object:N,attributes:{},index:null}}function v(N,U,G,j){const q=o.attributes,T=U.attributes;let P=0;const R=G.getAttributes();for(const L in R)if(R[L].location>=0){const I=q[L];let E=T[L];if(E===void 0&&(L==="instanceMatrix"&&N.instanceMatrix&&(E=N.instanceMatrix),L==="instanceColor"&&N.instanceColor&&(E=N.instanceColor)),I===void 0||I.attribute!==E||E&&I.data!==E.data)return!0;P++}return o.attributesNum!==P||o.index!==j}function _(N,U,G,j){const q={},T=U.attributes;let P=0;const R=G.getAttributes();for(const L in R)if(R[L].location>=0){let I=T[L];I===void 0&&(L==="instanceMatrix"&&N.instanceMatrix&&(I=N.instanceMatrix),L==="instanceColor"&&N.instanceColor&&(I=N.instanceColor));const E={};E.attribute=I,I&&I.data&&(E.data=I.data),q[L]=E,P++}o.attributes=q,o.attributesNum=P,o.index=j}function y(){const N=o.newAttributes;for(let U=0,G=N.length;U<G;U++)N[U]=0}function x(N){b(N,0)}function b(N,U){const G=o.newAttributes,j=o.enabledAttributes,q=o.attributeDivisors;G[N]=1,j[N]===0&&(m.enableVertexAttribArray(N),j[N]=1),q[N]!==U&&((i.isWebGL2?m:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,U),q[N]=U)}function w(){const N=o.newAttributes,U=o.enabledAttributes;for(let G=0,j=U.length;G<j;G++)U[G]!==N[G]&&(m.disableVertexAttribArray(G),U[G]=0)}function M(N,U,G,j,q,T){i.isWebGL2===!0&&(G===5124||G===5125)?m.vertexAttribIPointer(N,U,G,q,T):m.vertexAttribPointer(N,U,G,j,q,T)}function S(N,U,G,j){if(i.isWebGL2===!1&&(N.isInstancedMesh||j.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;y();const q=j.attributes,T=G.getAttributes(),P=U.defaultAttributeValues;for(const R in T){const L=T[R];if(L.location>=0){let V=q[R];if(V===void 0&&(R==="instanceMatrix"&&N.instanceMatrix&&(V=N.instanceMatrix),R==="instanceColor"&&N.instanceColor&&(V=N.instanceColor)),V!==void 0){const I=V.normalized,E=V.itemSize,F=t.get(V);if(F===void 0)continue;const K=F.buffer,ee=F.type,Z=F.bytesPerElement;if(V.isInterleavedBufferAttribute){const J=V.data,ae=J.stride,ue=V.offset;if(J.isInstancedInterleavedBuffer){for(let Q=0;Q<L.locationSize;Q++)b(L.location+Q,J.meshPerAttribute);N.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=J.meshPerAttribute*J.count)}else for(let Q=0;Q<L.locationSize;Q++)x(L.location+Q);m.bindBuffer(34962,K);for(let Q=0;Q<L.locationSize;Q++)M(L.location+Q,E/L.locationSize,ee,I,ae*Z,(ue+E/L.locationSize*Q)*Z)}else{if(V.isInstancedBufferAttribute){for(let J=0;J<L.locationSize;J++)b(L.location+J,V.meshPerAttribute);N.isInstancedMesh!==!0&&j._maxInstanceCount===void 0&&(j._maxInstanceCount=V.meshPerAttribute*V.count)}else for(let J=0;J<L.locationSize;J++)x(L.location+J);m.bindBuffer(34962,K);for(let J=0;J<L.locationSize;J++)M(L.location+J,E/L.locationSize,ee,I,E*Z,E/L.locationSize*J*Z)}}else if(P!==void 0){const I=P[R];if(I!==void 0)switch(I.length){case 2:m.vertexAttrib2fv(L.location,I);break;case 3:m.vertexAttrib3fv(L.location,I);break;case 4:m.vertexAttrib4fv(L.location,I);break;default:m.vertexAttrib1fv(L.location,I)}}}}w()}function C(){Y();for(const N in s){const U=s[N];for(const G in U){const j=U[G];for(const q in j)d(j[q].object),delete j[q];delete U[G]}delete s[N]}}function O(N){if(s[N.id]===void 0)return;const U=s[N.id];for(const G in U){const j=U[G];for(const q in j)d(j[q].object),delete j[q];delete U[G]}delete s[N.id]}function k(N){for(const U in s){const G=s[U];if(G[N.id]===void 0)continue;const j=G[N.id];for(const q in j)d(j[q].object),delete j[q];delete G[N.id]}}function Y(){H(),f=!0,o!==n&&(o=n,c(o.object))}function H(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:r,reset:Y,resetDefaultState:H,dispose:C,releaseStatesOfGeometry:O,releaseStatesOfProgram:k,initAttributes:y,enableAttribute:x,disableUnusedAttributes:w}}function Lm(m,e,t,i){const a=i.isWebGL2;let u;function g(o){u=o}function s(o,f){m.drawArrays(u,o,f),t.update(f,u,1)}function n(o,f,r){if(r===0)return;let l,c;if(a)l=m,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",l===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}l[c](u,o,f,r),t.update(f,u,r)}this.setMode=g,this.render=s,this.renderInstances=n}function Pm(m,e,t){let i;function a(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");i=m.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function u(M){if(M==="highp"){if(m.getShaderPrecisionFormat(35633,36338).precision>0&&m.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&m.getShaderPrecisionFormat(35633,36337).precision>0&&m.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const g=typeof WebGL2RenderingContext!="undefined"&&m instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&m instanceof WebGL2ComputeRenderingContext;let s=t.precision!==void 0?t.precision:"highp";const n=u(s);n!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",n,"instead."),s=n);const o=g||e.has("WEBGL_draw_buffers"),f=t.logarithmicDepthBuffer===!0,r=m.getParameter(34930),l=m.getParameter(35660),c=m.getParameter(3379),d=m.getParameter(34076),p=m.getParameter(34921),h=m.getParameter(36347),v=m.getParameter(36348),_=m.getParameter(36349),y=l>0,x=g||e.has("OES_texture_float"),b=y&&x,w=g?m.getParameter(36183):0;return{isWebGL2:g,drawBuffers:o,getMaxAnisotropy:a,getMaxPrecision:u,precision:s,logarithmicDepthBuffer:f,maxTextures:r,maxVertexTextures:l,maxTextureSize:c,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:h,maxVaryings:v,maxFragmentUniforms:_,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:b,maxSamples:w}}function Dm(m){const e=this;let t=null,i=0,a=!1,u=!1;const g=new Zi,s=new qt,n={value:null,needsUpdate:!1};this.uniform=n,this.numPlanes=0,this.numIntersection=0,this.init=function(r,l,c){const d=r.length!==0||l||i!==0||a;return a=l,t=f(r,c,0),i=r.length,d},this.beginShadows=function(){u=!0,f(null)},this.endShadows=function(){u=!1,o()},this.setState=function(r,l,c){const d=r.clippingPlanes,p=r.clipIntersection,h=r.clipShadows,v=m.get(r);if(!a||d===null||d.length===0||u&&!h)u?f(null):o();else{const _=u?0:i,y=_*4;let x=v.clippingState||null;n.value=x,x=f(d,l,y,c);for(let b=0;b!==y;++b)x[b]=t[b];v.clippingState=x,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=_}};function o(){n.value!==t&&(n.value=t,n.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function f(r,l,c,d){const p=r!==null?r.length:0;let h=null;if(p!==0){if(h=n.value,d!==!0||h===null){const v=c+p*4,_=l.matrixWorldInverse;s.getNormalMatrix(_),(h===null||h.length<v)&&(h=new Float32Array(v));for(let y=0,x=c;y!==p;++y,x+=4)g.copy(r[y]).applyMatrix4(_,s),g.normal.toArray(h,x),h[x+3]=g.constant}n.value=h,n.needsUpdate=!0}return e.numPlanes=p,e.numIntersection=0,h}}function Rm(m){let e=new WeakMap;function t(g,s){return s===Ms?g.mapping=Hn:s===ka&&(g.mapping=Wn),g}function i(g){if(g&&g.isTexture&&g.isRenderTargetTexture===!1){const s=g.mapping;if(s===Ms||s===ka)if(e.has(g)){const n=e.get(g).texture;return t(n,g.mapping)}else{const n=g.image;if(n&&n.height>0){const o=new qf(n.height/2);return o.fromEquirectangularTexture(m,g),e.set(g,o),g.addEventListener("dispose",a),t(o.texture,g.mapping)}else return null}}return g}function a(g){const s=g.target;s.removeEventListener("dispose",a);const n=e.get(s);n!==void 0&&(e.delete(s),n.dispose())}function u(){e=new WeakMap}return{get:i,dispose:u}}class tr extends ah{constructor(e=-1,t=1,i=1,a=-1,u=.1,g=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=a,this.near=u,this.far=g,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,a,u,g){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=a,this.view.width=u,this.view.height=g,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,a=(this.top+this.bottom)/2;let u=i-e,g=i+e,s=a+t,n=a-t;if(this.view!==null&&this.view.enabled){const o=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;u+=o*this.view.offsetX,g=u+o*this.view.width,s-=f*this.view.offsetY,n=s-f*this.view.height}this.projectionMatrix.makeOrthographic(u,g,s,n,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Nn=4,Ml=[.125,.215,.35,.446,.526,.582],en=20,ya=new tr,Tl=new Te;let xa=null;const Ji=(1+Math.sqrt(5))/2,Rn=1/Ji,Cl=[new X(1,1,1),new X(-1,1,1),new X(1,1,-1),new X(-1,1,-1),new X(0,Ji,Rn),new X(0,Ji,-Rn),new X(Rn,0,Ji),new X(-Rn,0,Ji),new X(Ji,Rn,0),new X(-Ji,Rn,0)];class El{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,a=100){xa=this._renderer.getRenderTarget(),this._setSize(256);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,i,a,u),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Pl(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Ll(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(xa),e.scissorTest=!1,hs(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Hn||e.mapping===Wn?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),xa=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:rt,minFilter:rt,generateMipmaps:!1,type:xi,format:Bt,encoding:Gi,depthBuffer:!1},a=Al(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Al(e,t,i);const{_lodMax:u}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Om(u)),this._blurMaterial=Im(u,e,t)}return a}_compileMaterial(e){const t=new Mt(this._lodPlanes[0],e);this._renderer.compile(t,ya)}_sceneToCubeUV(e,t,i,a){const s=new vt(90,1,t,i),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],f=this._renderer,r=f.autoClear,l=f.toneMapping;f.getClearColor(Tl),f.toneMapping=$t,f.autoClear=!1;const c=new Bi({name:"PMREM.Background",side:Kt,depthWrite:!1,depthTest:!1}),d=new Mt(new Nr,c);let p=!1;const h=e.background;h?h.isColor&&(c.color.copy(h),e.background=null,p=!0):(c.color.copy(Tl),p=!0);for(let v=0;v<6;v++){const _=v%3;_===0?(s.up.set(0,n[v],0),s.lookAt(o[v],0,0)):_===1?(s.up.set(0,0,n[v]),s.lookAt(0,o[v],0)):(s.up.set(0,n[v],0),s.lookAt(0,0,o[v]));const y=this._cubeSize;hs(a,_*y,v>2?y:0,y,y),f.setRenderTarget(a),p&&f.render(d,s),f.render(e,s)}d.geometry.dispose(),d.material.dispose(),f.toneMapping=l,f.autoClear=r,e.background=h}_textureToCubeUV(e,t){const i=this._renderer,a=e.mapping===Hn||e.mapping===Wn;a?(this._cubemapMaterial===null&&(this._cubemapMaterial=Pl()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Ll());const u=a?this._cubemapMaterial:this._equirectMaterial,g=new Mt(this._lodPlanes[0],u),s=u.uniforms;s.envMap.value=e;const n=this._cubeSize;hs(t,0,0,3*n,2*n),i.setRenderTarget(t),i.render(g,ya)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let a=1;a<this._lodPlanes.length;a++){const u=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),g=Cl[(a-1)%Cl.length];this._blur(e,a-1,a,u,g)}t.autoClear=i}_blur(e,t,i,a,u){const g=this._pingPongRenderTarget;this._halfBlur(e,g,t,i,a,"latitudinal",u),this._halfBlur(g,e,i,i,a,"longitudinal",u)}_halfBlur(e,t,i,a,u,g,s){const n=this._renderer,o=this._blurMaterial;g!=="latitudinal"&&g!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const f=3,r=new Mt(this._lodPlanes[a],o),l=o.uniforms,c=this._sizeLods[i]-1,d=isFinite(u)?Math.PI/(2*c):2*Math.PI/(2*en-1),p=u/d,h=isFinite(u)?1+Math.floor(f*p):en;h>en&&console.warn(`sigmaRadians, ${u}, is too large and will clip, as it requested ${h} samples when the maximum is set to ${en}`);const v=[];let _=0;for(let M=0;M<en;++M){const S=M/p,C=Math.exp(-S*S/2);v.push(C),M===0?_+=C:M<h&&(_+=2*C)}for(let M=0;M<v.length;M++)v[M]=v[M]/_;l.envMap.value=e.texture,l.samples.value=h,l.weights.value=v,l.latitudinal.value=g==="latitudinal",s&&(l.poleAxis.value=s);const{_lodMax:y}=this;l.dTheta.value=d,l.mipInt.value=y-i;const x=this._sizeLods[a],b=3*x*(a>y-Nn?a-y+Nn:0),w=4*(this._cubeSize-x);hs(t,b,w,3*x,2*x),n.setRenderTarget(t),n.render(r,ya)}}function Om(m){const e=[],t=[],i=[];let a=m;const u=m-Nn+1+Ml.length;for(let g=0;g<u;g++){const s=Math.pow(2,a);t.push(s);let n=1/s;g>m-Nn?n=Ml[g-m+Nn-1]:g===0&&(n=0),i.push(n);const o=1/(s-2),f=-o,r=1+o,l=[f,f,r,f,r,r,f,f,r,r,f,r],c=6,d=6,p=3,h=2,v=1,_=new Float32Array(p*d*c),y=new Float32Array(h*d*c),x=new Float32Array(v*d*c);for(let w=0;w<c;w++){const M=w%3*2/3-1,S=w>2?0:-1,C=[M,S,0,M+2/3,S,0,M+2/3,S+1,0,M,S,0,M+2/3,S+1,0,M,S+1,0];_.set(C,p*d*w),y.set(l,h*d*w);const O=[w,w,w,w,w,w];x.set(O,v*d*w)}const b=new ut;b.setAttribute("position",new Tt(_,p)),b.setAttribute("uv",new Tt(y,h)),b.setAttribute("faceIndex",new Tt(x,v)),e.push(b),a>Nn&&a--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function Al(m,e,t){const i=new li(m,e,t);return i.texture.mapping=ks,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function hs(m,e,t,i,a){m.viewport.set(e,t,i,a),m.scissor.set(e,t,i,a)}function Im(m,e,t){const i=new Float32Array(en),a=new X(0,1,0);return new Jt({name:"SphericalGaussianBlur",defines:{n:en,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${m}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:co(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ni,depthTest:!1,depthWrite:!1})}function Ll(){return new Jt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:co(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ni,depthTest:!1,depthWrite:!1})}function Pl(){return new Jt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:co(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ni,depthTest:!1,depthWrite:!1})}function co(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Fm(m){let e=new WeakMap,t=null;function i(s){if(s&&s.isTexture){const n=s.mapping,o=n===Ms||n===ka,f=n===Hn||n===Wn;if(o||f)if(s.isRenderTargetTexture&&s.needsPMREMUpdate===!0){s.needsPMREMUpdate=!1;let r=e.get(s);return t===null&&(t=new El(m)),r=o?t.fromEquirectangular(s,r):t.fromCubemap(s,r),e.set(s,r),r.texture}else{if(e.has(s))return e.get(s).texture;{const r=s.image;if(o&&r&&r.height>0||f&&r&&a(r)){t===null&&(t=new El(m));const l=o?t.fromEquirectangular(s):t.fromCubemap(s);return e.set(s,l),s.addEventListener("dispose",u),l.texture}else return null}}}return s}function a(s){let n=0;const o=6;for(let f=0;f<o;f++)s[f]!==void 0&&n++;return n===o}function u(s){const n=s.target;n.removeEventListener("dispose",u);const o=e.get(n);o!==void 0&&(e.delete(n),o.dispose())}function g(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:g}}function km(m){const e={};function t(i){if(e[i]!==void 0)return e[i];let a;switch(i){case"WEBGL_depth_texture":a=m.getExtension("WEBGL_depth_texture")||m.getExtension("MOZ_WEBGL_depth_texture")||m.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=m.getExtension("EXT_texture_filter_anisotropic")||m.getExtension("MOZ_EXT_texture_filter_anisotropic")||m.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=m.getExtension("WEBGL_compressed_texture_s3tc")||m.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||m.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=m.getExtension("WEBGL_compressed_texture_pvrtc")||m.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=m.getExtension(i)}return e[i]=a,a}return{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const a=t(i);return a===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),a}}}function Bm(m,e,t,i){const a={},u=new WeakMap;function g(r){const l=r.target;l.index!==null&&e.remove(l.index);for(const d in l.attributes)e.remove(l.attributes[d]);l.removeEventListener("dispose",g),delete a[l.id];const c=u.get(l);c&&(e.remove(c),u.delete(l)),i.releaseStatesOfGeometry(l),l.isInstancedBufferGeometry===!0&&delete l._maxInstanceCount,t.memory.geometries--}function s(r,l){return a[l.id]===!0||(l.addEventListener("dispose",g),a[l.id]=!0,t.memory.geometries++),l}function n(r){const l=r.attributes;for(const d in l)e.update(l[d],34962);const c=r.morphAttributes;for(const d in c){const p=c[d];for(let h=0,v=p.length;h<v;h++)e.update(p[h],34962)}}function o(r){const l=[],c=r.index,d=r.attributes.position;let p=0;if(c!==null){const _=c.array;p=c.version;for(let y=0,x=_.length;y<x;y+=3){const b=_[y+0],w=_[y+1],M=_[y+2];l.push(b,w,w,M,M,b)}}else{const _=d.array;p=d.version;for(let y=0,x=_.length/3-1;y<x;y+=3){const b=y+0,w=y+1,M=y+2;l.push(b,w,w,M,M,b)}}const h=new(Jc(l)?rh:ao)(l,1);h.version=p;const v=u.get(r);v&&e.remove(v),u.set(r,h)}function f(r){const l=u.get(r);if(l){const c=r.index;c!==null&&l.version<c.version&&o(r)}else o(r);return u.get(r)}return{get:s,update:n,getWireframeAttribute:f}}function Nm(m,e,t,i){const a=i.isWebGL2;let u;function g(l){u=l}let s,n;function o(l){s=l.type,n=l.bytesPerElement}function f(l,c){m.drawElements(u,c,s,l*n),t.update(c,u,1)}function r(l,c,d){if(d===0)return;let p,h;if(a)p=m,h="drawElementsInstanced";else if(p=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",p===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[h](u,c,s,l*n,d),t.update(c,u,d)}this.setMode=g,this.setIndex=o,this.render=f,this.renderInstances=r}function zm(m){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(u,g,s){switch(t.calls++,g){case 4:t.triangles+=s*(u/3);break;case 1:t.lines+=s*(u/2);break;case 3:t.lines+=s*(u-1);break;case 2:t.lines+=s*u;break;case 0:t.points+=s*u;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",g);break}}function a(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:a,update:i}}function Um(m,e){return m[0]-e[0]}function Vm(m,e){return Math.abs(e[1])-Math.abs(m[1])}function ba(m,e){let t=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?t=127:i instanceof Int16Array?t=32767:i instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),m.divideScalar(t)}function Gm(m,e,t){const i={},a=new Float32Array(8),u=new WeakMap,g=new Ye,s=[];for(let o=0;o<8;o++)s[o]=[o,0];function n(o,f,r,l){const c=o.morphTargetInfluences;if(e.isWebGL2===!0){const p=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,h=p!==void 0?p.length:0;let v=u.get(f);if(v===void 0||v.count!==h){let G=function(){N.dispose(),u.delete(f),f.removeEventListener("dispose",G)};var d=G;v!==void 0&&v.texture.dispose();const x=f.morphAttributes.position!==void 0,b=f.morphAttributes.normal!==void 0,w=f.morphAttributes.color!==void 0,M=f.morphAttributes.position||[],S=f.morphAttributes.normal||[],C=f.morphAttributes.color||[];let O=0;x===!0&&(O=1),b===!0&&(O=2),w===!0&&(O=3);let k=f.attributes.position.count*O,Y=1;k>e.maxTextureSize&&(Y=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);const H=new Float32Array(k*Y*4*h),N=new ih(H,k,Y,h);N.type=Yt,N.needsUpdate=!0;const U=O*4;for(let j=0;j<h;j++){const q=M[j],T=S[j],P=C[j],R=k*Y*4*j;for(let L=0;L<q.count;L++){const V=L*U;x===!0&&(g.fromBufferAttribute(q,L),q.normalized===!0&&ba(g,q),H[R+V+0]=g.x,H[R+V+1]=g.y,H[R+V+2]=g.z,H[R+V+3]=0),b===!0&&(g.fromBufferAttribute(T,L),T.normalized===!0&&ba(g,T),H[R+V+4]=g.x,H[R+V+5]=g.y,H[R+V+6]=g.z,H[R+V+7]=0),w===!0&&(g.fromBufferAttribute(P,L),P.normalized===!0&&ba(g,P),H[R+V+8]=g.x,H[R+V+9]=g.y,H[R+V+10]=g.z,H[R+V+11]=P.itemSize===4?g.w:1)}}v={count:h,texture:N,size:new De(k,Y)},u.set(f,v),f.addEventListener("dispose",G)}let _=0;for(let x=0;x<c.length;x++)_+=c[x];const y=f.morphTargetsRelative?1:1-_;l.getUniforms().setValue(m,"morphTargetBaseInfluence",y),l.getUniforms().setValue(m,"morphTargetInfluences",c),l.getUniforms().setValue(m,"morphTargetsTexture",v.texture,t),l.getUniforms().setValue(m,"morphTargetsTextureSize",v.size)}else{const p=c===void 0?0:c.length;let h=i[f.id];if(h===void 0||h.length!==p){h=[];for(let b=0;b<p;b++)h[b]=[b,0];i[f.id]=h}for(let b=0;b<p;b++){const w=h[b];w[0]=b,w[1]=c[b]}h.sort(Vm);for(let b=0;b<8;b++)b<p&&h[b][1]?(s[b][0]=h[b][0],s[b][1]=h[b][1]):(s[b][0]=Number.MAX_SAFE_INTEGER,s[b][1]=0);s.sort(Um);const v=f.morphAttributes.position,_=f.morphAttributes.normal;let y=0;for(let b=0;b<8;b++){const w=s[b],M=w[0],S=w[1];M!==Number.MAX_SAFE_INTEGER&&S?(v&&f.getAttribute("morphTarget"+b)!==v[M]&&f.setAttribute("morphTarget"+b,v[M]),_&&f.getAttribute("morphNormal"+b)!==_[M]&&f.setAttribute("morphNormal"+b,_[M]),a[b]=S,y+=S):(v&&f.hasAttribute("morphTarget"+b)===!0&&f.deleteAttribute("morphTarget"+b),_&&f.hasAttribute("morphNormal"+b)===!0&&f.deleteAttribute("morphNormal"+b),a[b]=0)}const x=f.morphTargetsRelative?1:1-y;l.getUniforms().setValue(m,"morphTargetBaseInfluence",x),l.getUniforms().setValue(m,"morphTargetInfluences",a)}}return{update:n}}function Hm(m,e,t,i){let a=new WeakMap;function u(n){const o=i.render.frame,f=n.geometry,r=e.get(n,f);return a.get(r)!==o&&(e.update(r),a.set(r,o)),n.isInstancedMesh&&(n.hasEventListener("dispose",s)===!1&&n.addEventListener("dispose",s),t.update(n.instanceMatrix,34962),n.instanceColor!==null&&t.update(n.instanceColor,34962)),r}function g(){a=new WeakMap}function s(n){const o=n.target;o.removeEventListener("dispose",s),t.remove(o.instanceMatrix),o.instanceColor!==null&&t.remove(o.instanceColor)}return{update:u,dispose:g}}const ch=new at,hh=new ih,uh=new If,fh=new oh,Dl=[],Rl=[],Ol=new Float32Array(16),Il=new Float32Array(9),Fl=new Float32Array(4);function ir(m,e,t){const i=m[0];if(i<=0||i>0)return m;const a=e*t;let u=Dl[a];if(u===void 0&&(u=new Float32Array(a),Dl[a]=u),e!==0){i.toArray(u,0);for(let g=1,s=0;g!==e;++g)s+=t,m[g].toArray(u,s)}return u}function Ct(m,e){if(m.length!==e.length)return!1;for(let t=0,i=m.length;t<i;t++)if(m[t]!==e[t])return!1;return!0}function Et(m,e){for(let t=0,i=e.length;t<i;t++)m[t]=e[t]}function Bs(m,e){let t=Rl[e];t===void 0&&(t=new Int32Array(e),Rl[e]=t);for(let i=0;i!==e;++i)t[i]=m.allocateTextureUnit();return t}function Wm(m,e){const t=this.cache;t[0]!==e&&(m.uniform1f(this.addr,e),t[0]=e)}function jm(m,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(m.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ct(t,e))return;m.uniform2fv(this.addr,e),Et(t,e)}}function Xm(m,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(m.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(m.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ct(t,e))return;m.uniform3fv(this.addr,e),Et(t,e)}}function Ym(m,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(m.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ct(t,e))return;m.uniform4fv(this.addr,e),Et(t,e)}}function qm(m,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ct(t,e))return;m.uniformMatrix2fv(this.addr,!1,e),Et(t,e)}else{if(Ct(t,i))return;Fl.set(i),m.uniformMatrix2fv(this.addr,!1,Fl),Et(t,i)}}function Km(m,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ct(t,e))return;m.uniformMatrix3fv(this.addr,!1,e),Et(t,e)}else{if(Ct(t,i))return;Il.set(i),m.uniformMatrix3fv(this.addr,!1,Il),Et(t,i)}}function $m(m,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ct(t,e))return;m.uniformMatrix4fv(this.addr,!1,e),Et(t,e)}else{if(Ct(t,i))return;Ol.set(i),m.uniformMatrix4fv(this.addr,!1,Ol),Et(t,i)}}function Zm(m,e){const t=this.cache;t[0]!==e&&(m.uniform1i(this.addr,e),t[0]=e)}function Jm(m,e){const t=this.cache;Ct(t,e)||(m.uniform2iv(this.addr,e),Et(t,e))}function Qm(m,e){const t=this.cache;Ct(t,e)||(m.uniform3iv(this.addr,e),Et(t,e))}function eg(m,e){const t=this.cache;Ct(t,e)||(m.uniform4iv(this.addr,e),Et(t,e))}function tg(m,e){const t=this.cache;t[0]!==e&&(m.uniform1ui(this.addr,e),t[0]=e)}function ig(m,e){const t=this.cache;Ct(t,e)||(m.uniform2uiv(this.addr,e),Et(t,e))}function ng(m,e){const t=this.cache;Ct(t,e)||(m.uniform3uiv(this.addr,e),Et(t,e))}function rg(m,e){const t=this.cache;Ct(t,e)||(m.uniform4uiv(this.addr,e),Et(t,e))}function sg(m,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(m.uniform1i(this.addr,a),i[0]=a),t.setTexture2D(e||ch,a)}function ag(m,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(m.uniform1i(this.addr,a),i[0]=a),t.setTexture3D(e||uh,a)}function og(m,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(m.uniform1i(this.addr,a),i[0]=a),t.setTextureCube(e||fh,a)}function lg(m,e,t){const i=this.cache,a=t.allocateTextureUnit();i[0]!==a&&(m.uniform1i(this.addr,a),i[0]=a),t.setTexture2DArray(e||hh,a)}function cg(m){switch(m){case 5126:return Wm;case 35664:return jm;case 35665:return Xm;case 35666:return Ym;case 35674:return qm;case 35675:return Km;case 35676:return $m;case 5124:case 35670:return Zm;case 35667:case 35671:return Jm;case 35668:case 35672:return Qm;case 35669:case 35673:return eg;case 5125:return tg;case 36294:return ig;case 36295:return ng;case 36296:return rg;case 35678:case 36198:case 36298:case 36306:case 35682:return sg;case 35679:case 36299:case 36307:return ag;case 35680:case 36300:case 36308:case 36293:return og;case 36289:case 36303:case 36311:case 36292:return lg}}function hg(m,e){m.uniform1fv(this.addr,e)}function ug(m,e){const t=ir(e,this.size,2);m.uniform2fv(this.addr,t)}function fg(m,e){const t=ir(e,this.size,3);m.uniform3fv(this.addr,t)}function dg(m,e){const t=ir(e,this.size,4);m.uniform4fv(this.addr,t)}function pg(m,e){const t=ir(e,this.size,4);m.uniformMatrix2fv(this.addr,!1,t)}function mg(m,e){const t=ir(e,this.size,9);m.uniformMatrix3fv(this.addr,!1,t)}function gg(m,e){const t=ir(e,this.size,16);m.uniformMatrix4fv(this.addr,!1,t)}function vg(m,e){m.uniform1iv(this.addr,e)}function _g(m,e){m.uniform2iv(this.addr,e)}function yg(m,e){m.uniform3iv(this.addr,e)}function xg(m,e){m.uniform4iv(this.addr,e)}function bg(m,e){m.uniform1uiv(this.addr,e)}function wg(m,e){m.uniform2uiv(this.addr,e)}function Sg(m,e){m.uniform3uiv(this.addr,e)}function Mg(m,e){m.uniform4uiv(this.addr,e)}function Tg(m,e,t){const i=e.length,a=Bs(t,i);m.uniform1iv(this.addr,a);for(let u=0;u!==i;++u)t.setTexture2D(e[u]||ch,a[u])}function Cg(m,e,t){const i=e.length,a=Bs(t,i);m.uniform1iv(this.addr,a);for(let u=0;u!==i;++u)t.setTexture3D(e[u]||uh,a[u])}function Eg(m,e,t){const i=e.length,a=Bs(t,i);m.uniform1iv(this.addr,a);for(let u=0;u!==i;++u)t.setTextureCube(e[u]||fh,a[u])}function Ag(m,e,t){const i=e.length,a=Bs(t,i);m.uniform1iv(this.addr,a);for(let u=0;u!==i;++u)t.setTexture2DArray(e[u]||hh,a[u])}function Lg(m){switch(m){case 5126:return hg;case 35664:return ug;case 35665:return fg;case 35666:return dg;case 35674:return pg;case 35675:return mg;case 35676:return gg;case 5124:case 35670:return vg;case 35667:case 35671:return _g;case 35668:case 35672:return yg;case 35669:case 35673:return xg;case 5125:return bg;case 36294:return wg;case 36295:return Sg;case 36296:return Mg;case 35678:case 36198:case 36298:case 36306:case 35682:return Tg;case 35679:case 36299:case 36307:return Cg;case 35680:case 36300:case 36308:case 36293:return Eg;case 36289:case 36303:case 36311:case 36292:return Ag}}class Pg{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=cg(t.type)}}class Dg{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=Lg(t.type)}}class Rg{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const a=this.seq;for(let u=0,g=a.length;u!==g;++u){const s=a[u];s.setValue(e,t[s.id],i)}}}const wa=/(\w+)(\])?(\[|\.)?/g;function kl(m,e){m.seq.push(e),m.map[e.id]=e}function Og(m,e,t){const i=m.name,a=i.length;for(wa.lastIndex=0;;){const u=wa.exec(i),g=wa.lastIndex;let s=u[1];const n=u[2]==="]",o=u[3];if(n&&(s=s|0),o===void 0||o==="["&&g+2===a){kl(t,o===void 0?new Pg(s,m,e):new Dg(s,m,e));break}else{let r=t.map[s];r===void 0&&(r=new Rg(s),kl(t,r)),t=r}}}class ys{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let a=0;a<i;++a){const u=e.getActiveUniform(t,a),g=e.getUniformLocation(t,u.name);Og(u,g,this)}}setValue(e,t,i,a){const u=this.map[t];u!==void 0&&u.setValue(e,i,a)}setOptional(e,t,i){const a=t[i];a!==void 0&&this.setValue(e,i,a)}static upload(e,t,i,a){for(let u=0,g=t.length;u!==g;++u){const s=t[u],n=i[s.id];n.needsUpdate!==!1&&s.setValue(e,n.value,a)}}static seqWithValue(e,t){const i=[];for(let a=0,u=e.length;a!==u;++a){const g=e[a];g.id in t&&i.push(g)}return i}}function Bl(m,e,t){const i=m.createShader(e);return m.shaderSource(i,t),m.compileShader(i),i}let Ig=0;function Fg(m,e){const t=m.split(`
`),i=[],a=Math.max(e-6,0),u=Math.min(e+6,t.length);for(let g=a;g<u;g++){const s=g+1;i.push(`${s===e?">":" "} ${s}: ${t[g]}`)}return i.join(`
`)}function kg(m){switch(m){case Gi:return["Linear","( value )"];case ze:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",m),["Linear","( value )"]}}function Nl(m,e,t){const i=m.getShaderParameter(e,35713),a=m.getShaderInfoLog(e).trim();if(i&&a==="")return"";const u=/ERROR: 0:(\d+)/.exec(a);if(u){const g=parseInt(u[1]);return t.toUpperCase()+`

`+a+`

`+Fg(m.getShaderSource(e),g)}else return a}function Bg(m,e){const t=kg(e);return"vec4 "+m+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Ng(m,e){let t;switch(e){case Gc:t="Linear";break;case Hc:t="Reinhard";break;case Wc:t="OptimizedCineon";break;case jc:t="ACESFilmic";break;case Ku:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+m+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function zg(m){return[m.extensionDerivatives||!!m.envMapCubeUVHeight||m.bumpMap||m.tangentSpaceNormalMap||m.clearcoatNormalMap||m.flatShading||m.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(m.extensionFragDepth||m.logarithmicDepthBuffer)&&m.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",m.extensionDrawBuffers&&m.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(m.extensionShaderTextureLOD||m.envMap||m.transmission)&&m.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Sr).join(`
`)}function Ug(m){const e=[];for(const t in m){const i=m[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function Vg(m,e){const t={},i=m.getProgramParameter(e,35721);for(let a=0;a<i;a++){const u=m.getActiveAttrib(e,a),g=u.name;let s=1;u.type===35674&&(s=2),u.type===35675&&(s=3),u.type===35676&&(s=4),t[g]={type:u.type,location:m.getAttribLocation(e,g),locationSize:s}}return t}function Sr(m){return m!==""}function zl(m,e){return m.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ul(m,e){return m.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Gg=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ga(m){return m.replace(Gg,Hg)}function Hg(m,e){const t=Be[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Ga(t)}const Wg=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jg=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Vl(m){return m.replace(jg,dh).replace(Wg,Xg)}function Xg(m,e,t,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),dh(m,e,t,i)}function dh(m,e,t,i){let a="";for(let u=parseInt(e);u<parseInt(t);u++)a+=i.replace(/\[\s*i\s*\]/g,"[ "+u+" ]").replace(/UNROLLED_LOOP_INDEX/g,u);return a}function Gl(m){let e="precision "+m.precision+` float;
precision `+m.precision+" int;";return m.precision==="highp"?e+=`
#define HIGH_PRECISION`:m.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:m.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Yg(m){let e="SHADOWMAP_TYPE_BASIC";return m.shadowMapType===zc?e="SHADOWMAP_TYPE_PCF":m.shadowMapType===Cu?e="SHADOWMAP_TYPE_PCF_SOFT":m.shadowMapType===wr&&(e="SHADOWMAP_TYPE_VSM"),e}function qg(m){let e="ENVMAP_TYPE_CUBE";if(m.envMap)switch(m.envMapMode){case Hn:case Wn:e="ENVMAP_TYPE_CUBE";break;case ks:e="ENVMAP_TYPE_CUBE_UV";break}return e}function Kg(m){let e="ENVMAP_MODE_REFLECTION";if(m.envMap)switch(m.envMapMode){case Wn:e="ENVMAP_MODE_REFRACTION";break}return e}function $g(m){let e="ENVMAP_BLENDING_NONE";if(m.envMap)switch(m.combine){case Fs:e="ENVMAP_BLENDING_MULTIPLY";break;case Yu:e="ENVMAP_BLENDING_MIX";break;case qu:e="ENVMAP_BLENDING_ADD";break}return e}function Zg(m){const e=m.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Jg(m,e,t,i){const a=m.getContext(),u=t.defines;let g=t.vertexShader,s=t.fragmentShader;const n=Yg(t),o=qg(t),f=Kg(t),r=$g(t),l=Zg(t),c=t.isWebGL2?"":zg(t),d=Ug(u),p=a.createProgram();let h,v,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(h=[d].filter(Sr).join(`
`),h.length>0&&(h+=`
`),v=[c,d].filter(Sr).join(`
`),v.length>0&&(v+=`
`)):(h=[Gl(t),"#define SHADER_NAME "+t.shaderName,d,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+f:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+n:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Sr).join(`
`),v=[c,Gl(t),"#define SHADER_NAME "+t.shaderName,d,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+o:"",t.envMap?"#define "+f:"",t.envMap?"#define "+r:"",l?"#define CUBEUV_TEXEL_WIDTH "+l.texelWidth:"",l?"#define CUBEUV_TEXEL_HEIGHT "+l.texelHeight:"",l?"#define CUBEUV_MAX_MIP "+l.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+n:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==$t?"#define TONE_MAPPING":"",t.toneMapping!==$t?Be.tonemapping_pars_fragment:"",t.toneMapping!==$t?Ng("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Be.encodings_pars_fragment,Bg("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Sr).join(`
`)),g=Ga(g),g=zl(g,t),g=Ul(g,t),s=Ga(s),s=zl(s,t),s=Ul(s,t),g=Vl(g),s=Vl(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,h=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+h,v=["#define varying in",t.glslVersion===ul?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ul?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=_+h+g,x=_+v+s,b=Bl(a,35633,y),w=Bl(a,35632,x);if(a.attachShader(p,b),a.attachShader(p,w),t.index0AttributeName!==void 0?a.bindAttribLocation(p,0,t.index0AttributeName):t.morphTargets===!0&&a.bindAttribLocation(p,0,"position"),a.linkProgram(p),m.debug.checkShaderErrors){const C=a.getProgramInfoLog(p).trim(),O=a.getShaderInfoLog(b).trim(),k=a.getShaderInfoLog(w).trim();let Y=!0,H=!0;if(a.getProgramParameter(p,35714)===!1){Y=!1;const N=Nl(a,b,"vertex"),U=Nl(a,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(p,35715)+`

Program Info Log: `+C+`
`+N+`
`+U)}else C!==""?console.warn("THREE.WebGLProgram: Program Info Log:",C):(O===""||k==="")&&(H=!1);H&&(this.diagnostics={runnable:Y,programLog:C,vertexShader:{log:O,prefix:h},fragmentShader:{log:k,prefix:v}})}a.deleteShader(b),a.deleteShader(w);let M;this.getUniforms=function(){return M===void 0&&(M=new ys(a,p)),M};let S;return this.getAttributes=function(){return S===void 0&&(S=Vg(a,p)),S},this.destroy=function(){i.releaseStatesOfProgram(this),a.deleteProgram(p),this.program=void 0},this.name=t.shaderName,this.id=Ig++,this.cacheKey=e,this.usedTimes=1,this.program=p,this.vertexShader=b,this.fragmentShader=w,this}let Qg=0;class ev{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,a=this._getShaderStage(t),u=this._getShaderStage(i),g=this._getShaderCacheForMaterial(e);return g.has(a)===!1&&(g.add(a),a.usedTimes++),g.has(u)===!1&&(g.add(u),u.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(t.has(e)===!1){const i=new tv(e);t.set(e,i)}return t.get(e)}}class tv{constructor(e){this.id=Qg++,this.code=e,this.usedTimes=0}}function iv(m,e,t,i,a,u,g){const s=new nh,n=new ev,o=[],f=a.isWebGL2,r=a.logarithmicDepthBuffer,l=a.vertexTextures;let c=a.precision;const d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function p(S,C,O,k,Y){const H=k.fog,N=Y.geometry,U=S.isMeshStandardMaterial?k.environment:null,G=(S.isMeshStandardMaterial?t:e).get(S.envMap||U),j=!!G&&G.mapping===ks?G.image.height:null,q=d[S.type];S.precision!==null&&(c=a.getMaxPrecision(S.precision),c!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",c,"instead."));const T=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,P=T!==void 0?T.length:0;let R=0;N.morphAttributes.position!==void 0&&(R=1),N.morphAttributes.normal!==void 0&&(R=2),N.morphAttributes.color!==void 0&&(R=3);let L,V,I,E;if(q){const ae=ri[q];L=ae.vertexShader,V=ae.fragmentShader}else L=S.vertexShader,V=S.fragmentShader,n.update(S),I=n.getVertexShaderID(S),E=n.getFragmentShaderID(S);const F=m.getRenderTarget(),K=S.alphaTest>0,ee=S.clearcoat>0,Z=S.iridescence>0;return{isWebGL2:f,shaderID:q,shaderName:S.type,vertexShader:L,fragmentShader:V,defines:S.defines,customVertexShaderID:I,customFragmentShaderID:E,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:c,instancing:Y.isInstancedMesh===!0,instancingColor:Y.isInstancedMesh===!0&&Y.instanceColor!==null,supportsVertexTextures:l,outputEncoding:F===null?m.outputEncoding:F.isXRRenderTarget===!0?F.texture.encoding:Gi,map:!!S.map,matcap:!!S.matcap,envMap:!!G,envMapMode:G&&G.mapping,envMapCubeUVHeight:j,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===gf,tangentSpaceNormalMap:S.normalMapType===un,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===ze,clearcoat:ee,clearcoatMap:ee&&!!S.clearcoatMap,clearcoatRoughnessMap:ee&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:ee&&!!S.clearcoatNormalMap,iridescence:Z,iridescenceMap:Z&&!!S.iridescenceMap,iridescenceThicknessMap:Z&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===Un,alphaMap:!!S.alphaMap,alphaTest:K,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!N.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||S.transmission>0||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||S.sheen>0||!!S.sheenColorMap||!!S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!H,useFog:S.fog===!0,fogExp2:H&&H.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:r,skinning:Y.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:P,morphTextureStride:R,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numClippingPlanes:g.numPlanes,numClipIntersection:g.numIntersection,dithering:S.dithering,shadowMapEnabled:m.shadowMap.enabled&&O.length>0,shadowMapType:m.shadowMap.type,toneMapping:S.toneMapped?m.toneMapping:$t,physicallyCorrectLights:m.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Si,flipSided:S.side===Kt,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:f||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:f||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:f||i.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function h(S){const C=[];if(S.shaderID?C.push(S.shaderID):(C.push(S.customVertexShaderID),C.push(S.customFragmentShaderID)),S.defines!==void 0)for(const O in S.defines)C.push(O),C.push(S.defines[O]);return S.isRawShaderMaterial===!1&&(v(C,S),_(C,S),C.push(m.outputEncoding)),C.push(S.customProgramCacheKey),C.join()}function v(S,C){S.push(C.precision),S.push(C.outputEncoding),S.push(C.envMapMode),S.push(C.envMapCubeUVHeight),S.push(C.combine),S.push(C.vertexUvs),S.push(C.fogExp2),S.push(C.sizeAttenuation),S.push(C.morphTargetsCount),S.push(C.morphAttributeCount),S.push(C.numDirLights),S.push(C.numPointLights),S.push(C.numSpotLights),S.push(C.numHemiLights),S.push(C.numRectAreaLights),S.push(C.numDirLightShadows),S.push(C.numPointLightShadows),S.push(C.numSpotLightShadows),S.push(C.shadowMapType),S.push(C.toneMapping),S.push(C.numClippingPlanes),S.push(C.numClipIntersection),S.push(C.depthPacking)}function _(S,C){s.disableAll(),C.isWebGL2&&s.enable(0),C.supportsVertexTextures&&s.enable(1),C.instancing&&s.enable(2),C.instancingColor&&s.enable(3),C.map&&s.enable(4),C.matcap&&s.enable(5),C.envMap&&s.enable(6),C.lightMap&&s.enable(7),C.aoMap&&s.enable(8),C.emissiveMap&&s.enable(9),C.bumpMap&&s.enable(10),C.normalMap&&s.enable(11),C.objectSpaceNormalMap&&s.enable(12),C.tangentSpaceNormalMap&&s.enable(13),C.clearcoat&&s.enable(14),C.clearcoatMap&&s.enable(15),C.clearcoatRoughnessMap&&s.enable(16),C.clearcoatNormalMap&&s.enable(17),C.iridescence&&s.enable(18),C.iridescenceMap&&s.enable(19),C.iridescenceThicknessMap&&s.enable(20),C.displacementMap&&s.enable(21),C.specularMap&&s.enable(22),C.roughnessMap&&s.enable(23),C.metalnessMap&&s.enable(24),C.gradientMap&&s.enable(25),C.alphaMap&&s.enable(26),C.alphaTest&&s.enable(27),C.vertexColors&&s.enable(28),C.vertexAlphas&&s.enable(29),C.vertexUvs&&s.enable(30),C.vertexTangents&&s.enable(31),C.uvsVertexOnly&&s.enable(32),C.fog&&s.enable(33),S.push(s.mask),s.disableAll(),C.useFog&&s.enable(0),C.flatShading&&s.enable(1),C.logarithmicDepthBuffer&&s.enable(2),C.skinning&&s.enable(3),C.morphTargets&&s.enable(4),C.morphNormals&&s.enable(5),C.morphColors&&s.enable(6),C.premultipliedAlpha&&s.enable(7),C.shadowMapEnabled&&s.enable(8),C.physicallyCorrectLights&&s.enable(9),C.doubleSided&&s.enable(10),C.flipSided&&s.enable(11),C.useDepthPacking&&s.enable(12),C.dithering&&s.enable(13),C.specularIntensityMap&&s.enable(14),C.specularColorMap&&s.enable(15),C.transmission&&s.enable(16),C.transmissionMap&&s.enable(17),C.thicknessMap&&s.enable(18),C.sheen&&s.enable(19),C.sheenColorMap&&s.enable(20),C.sheenRoughnessMap&&s.enable(21),C.decodeVideoTexture&&s.enable(22),C.opaque&&s.enable(23),S.push(s.mask)}function y(S){const C=d[S.type];let O;if(C){const k=ri[C];O=sh.clone(k.uniforms)}else O=S.uniforms;return O}function x(S,C){let O;for(let k=0,Y=o.length;k<Y;k++){const H=o[k];if(H.cacheKey===C){O=H,++O.usedTimes;break}}return O===void 0&&(O=new Jg(m,C,S,u),o.push(O)),O}function b(S){if(--S.usedTimes===0){const C=o.indexOf(S);o[C]=o[o.length-1],o.pop(),S.destroy()}}function w(S){n.remove(S)}function M(){n.dispose()}return{getParameters:p,getProgramCacheKey:h,getUniforms:y,acquireProgram:x,releaseProgram:b,releaseShaderCache:w,programs:o,dispose:M}}function nv(){let m=new WeakMap;function e(u){let g=m.get(u);return g===void 0&&(g={},m.set(u,g)),g}function t(u){m.delete(u)}function i(u,g,s){m.get(u)[g]=s}function a(){m=new WeakMap}return{get:e,remove:t,update:i,dispose:a}}function rv(m,e){return m.groupOrder!==e.groupOrder?m.groupOrder-e.groupOrder:m.renderOrder!==e.renderOrder?m.renderOrder-e.renderOrder:m.material.id!==e.material.id?m.material.id-e.material.id:m.z!==e.z?m.z-e.z:m.id-e.id}function Hl(m,e){return m.groupOrder!==e.groupOrder?m.groupOrder-e.groupOrder:m.renderOrder!==e.renderOrder?m.renderOrder-e.renderOrder:m.z!==e.z?e.z-m.z:m.id-e.id}function Wl(){const m=[];let e=0;const t=[],i=[],a=[];function u(){e=0,t.length=0,i.length=0,a.length=0}function g(r,l,c,d,p,h){let v=m[e];return v===void 0?(v={id:r.id,object:r,geometry:l,material:c,groupOrder:d,renderOrder:r.renderOrder,z:p,group:h},m[e]=v):(v.id=r.id,v.object=r,v.geometry=l,v.material=c,v.groupOrder=d,v.renderOrder=r.renderOrder,v.z=p,v.group=h),e++,v}function s(r,l,c,d,p,h){const v=g(r,l,c,d,p,h);c.transmission>0?i.push(v):c.transparent===!0?a.push(v):t.push(v)}function n(r,l,c,d,p,h){const v=g(r,l,c,d,p,h);c.transmission>0?i.unshift(v):c.transparent===!0?a.unshift(v):t.unshift(v)}function o(r,l){t.length>1&&t.sort(r||rv),i.length>1&&i.sort(l||Hl),a.length>1&&a.sort(l||Hl)}function f(){for(let r=e,l=m.length;r<l;r++){const c=m[r];if(c.id===null)break;c.id=null,c.object=null,c.geometry=null,c.material=null,c.group=null}}return{opaque:t,transmissive:i,transparent:a,init:u,push:s,unshift:n,finish:f,sort:o}}function sv(){let m=new WeakMap;function e(i,a){let u;return m.has(i)===!1?(u=new Wl,m.set(i,[u])):a>=m.get(i).length?(u=new Wl,m.get(i).push(u)):u=m.get(i)[a],u}function t(){m=new WeakMap}return{get:e,dispose:t}}function av(){const m={};return{get:function(e){if(m[e.id]!==void 0)return m[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new X,color:new Te};break;case"SpotLight":t={position:new X,direction:new X,color:new Te,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new X,color:new Te,distance:0,decay:0};break;case"HemisphereLight":t={direction:new X,skyColor:new Te,groundColor:new Te};break;case"RectAreaLight":t={color:new Te,position:new X,halfWidth:new X,halfHeight:new X};break}return m[e.id]=t,t}}}function ov(){const m={};return{get:function(e){if(m[e.id]!==void 0)return m[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De,shadowCameraNear:1,shadowCameraFar:1e3};break}return m[e.id]=t,t}}}let lv=0;function cv(m,e){return(e.castShadow?1:0)-(m.castShadow?1:0)}function hv(m,e){const t=new av,i=ov(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let f=0;f<9;f++)a.probe.push(new X);const u=new X,g=new Le,s=new Le;function n(f,r){let l=0,c=0,d=0;for(let C=0;C<9;C++)a.probe[C].set(0,0,0);let p=0,h=0,v=0,_=0,y=0,x=0,b=0,w=0;f.sort(cv);const M=r!==!0?Math.PI:1;for(let C=0,O=f.length;C<O;C++){const k=f[C],Y=k.color,H=k.intensity,N=k.distance,U=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)l+=Y.r*H*M,c+=Y.g*H*M,d+=Y.b*H*M;else if(k.isLightProbe)for(let G=0;G<9;G++)a.probe[G].addScaledVector(k.sh.coefficients[G],H);else if(k.isDirectionalLight){const G=t.get(k);if(G.color.copy(k.color).multiplyScalar(k.intensity*M),k.castShadow){const j=k.shadow,q=i.get(k);q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,a.directionalShadow[p]=q,a.directionalShadowMap[p]=U,a.directionalShadowMatrix[p]=k.shadow.matrix,x++}a.directional[p]=G,p++}else if(k.isSpotLight){const G=t.get(k);if(G.position.setFromMatrixPosition(k.matrixWorld),G.color.copy(Y).multiplyScalar(H*M),G.distance=N,G.coneCos=Math.cos(k.angle),G.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),G.decay=k.decay,k.castShadow){const j=k.shadow,q=i.get(k);q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,a.spotShadow[v]=q,a.spotShadowMap[v]=U,a.spotShadowMatrix[v]=k.shadow.matrix,w++}a.spot[v]=G,v++}else if(k.isRectAreaLight){const G=t.get(k);G.color.copy(Y).multiplyScalar(H),G.halfWidth.set(k.width*.5,0,0),G.halfHeight.set(0,k.height*.5,0),a.rectArea[_]=G,_++}else if(k.isPointLight){const G=t.get(k);if(G.color.copy(k.color).multiplyScalar(k.intensity*M),G.distance=k.distance,G.decay=k.decay,k.castShadow){const j=k.shadow,q=i.get(k);q.shadowBias=j.bias,q.shadowNormalBias=j.normalBias,q.shadowRadius=j.radius,q.shadowMapSize=j.mapSize,q.shadowCameraNear=j.camera.near,q.shadowCameraFar=j.camera.far,a.pointShadow[h]=q,a.pointShadowMap[h]=U,a.pointShadowMatrix[h]=k.shadow.matrix,b++}a.point[h]=G,h++}else if(k.isHemisphereLight){const G=t.get(k);G.skyColor.copy(k.color).multiplyScalar(H*M),G.groundColor.copy(k.groundColor).multiplyScalar(H*M),a.hemi[y]=G,y++}}_>0&&(e.isWebGL2||m.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=we.LTC_FLOAT_1,a.rectAreaLTC2=we.LTC_FLOAT_2):m.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=we.LTC_HALF_1,a.rectAreaLTC2=we.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=l,a.ambient[1]=c,a.ambient[2]=d;const S=a.hash;(S.directionalLength!==p||S.pointLength!==h||S.spotLength!==v||S.rectAreaLength!==_||S.hemiLength!==y||S.numDirectionalShadows!==x||S.numPointShadows!==b||S.numSpotShadows!==w)&&(a.directional.length=p,a.spot.length=v,a.rectArea.length=_,a.point.length=h,a.hemi.length=y,a.directionalShadow.length=x,a.directionalShadowMap.length=x,a.pointShadow.length=b,a.pointShadowMap.length=b,a.spotShadow.length=w,a.spotShadowMap.length=w,a.directionalShadowMatrix.length=x,a.pointShadowMatrix.length=b,a.spotShadowMatrix.length=w,S.directionalLength=p,S.pointLength=h,S.spotLength=v,S.rectAreaLength=_,S.hemiLength=y,S.numDirectionalShadows=x,S.numPointShadows=b,S.numSpotShadows=w,a.version=lv++)}function o(f,r){let l=0,c=0,d=0,p=0,h=0;const v=r.matrixWorldInverse;for(let _=0,y=f.length;_<y;_++){const x=f[_];if(x.isDirectionalLight){const b=a.directional[l];b.direction.setFromMatrixPosition(x.matrixWorld),u.setFromMatrixPosition(x.target.matrixWorld),b.direction.sub(u),b.direction.transformDirection(v),l++}else if(x.isSpotLight){const b=a.spot[d];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(v),b.direction.setFromMatrixPosition(x.matrixWorld),u.setFromMatrixPosition(x.target.matrixWorld),b.direction.sub(u),b.direction.transformDirection(v),d++}else if(x.isRectAreaLight){const b=a.rectArea[p];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(v),s.identity(),g.copy(x.matrixWorld),g.premultiply(v),s.extractRotation(g),b.halfWidth.set(x.width*.5,0,0),b.halfHeight.set(0,x.height*.5,0),b.halfWidth.applyMatrix4(s),b.halfHeight.applyMatrix4(s),p++}else if(x.isPointLight){const b=a.point[c];b.position.setFromMatrixPosition(x.matrixWorld),b.position.applyMatrix4(v),c++}else if(x.isHemisphereLight){const b=a.hemi[h];b.direction.setFromMatrixPosition(x.matrixWorld),b.direction.transformDirection(v),h++}}}return{setup:n,setupView:o,state:a}}function jl(m,e){const t=new hv(m,e),i=[],a=[];function u(){i.length=0,a.length=0}function g(r){i.push(r)}function s(r){a.push(r)}function n(r){t.setup(i,r)}function o(r){t.setupView(i,r)}return{init:u,state:{lightsArray:i,shadowsArray:a,lights:t},setupLights:n,setupLightsView:o,pushLight:g,pushShadow:s}}function uv(m,e){let t=new WeakMap;function i(u,g=0){let s;return t.has(u)===!1?(s=new jl(m,e),t.set(u,[s])):g>=t.get(u).length?(s=new jl(m,e),t.get(u).push(s)):s=t.get(u)[g],s}function a(){t=new WeakMap}return{get:i,dispose:a}}class ph extends it{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=pf,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class mh extends it{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new X,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const fv=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,dv=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function pv(m,e,t){let i=new oo;const a=new De,u=new De,g=new Ye,s=new ph({depthPacking:mf}),n=new mh,o={},f=t.maxTextureSize,r={0:Kt,1:Gn,2:Si},l=new Jt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new De},radius:{value:4}},vertexShader:fv,fragmentShader:dv}),c=l.clone();c.defines.HORIZONTAL_PASS=1;const d=new ut;d.setAttribute("position",new Tt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const p=new Mt(d,l),h=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=zc,this.render=function(x,b,w){if(h.enabled===!1||h.autoUpdate===!1&&h.needsUpdate===!1||x.length===0)return;const M=m.getRenderTarget(),S=m.getActiveCubeFace(),C=m.getActiveMipmapLevel(),O=m.state;O.setBlending(Ni),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);for(let k=0,Y=x.length;k<Y;k++){const H=x[k],N=H.shadow;if(N===void 0){console.warn("THREE.WebGLShadowMap:",H,"has no shadow.");continue}if(N.autoUpdate===!1&&N.needsUpdate===!1)continue;a.copy(N.mapSize);const U=N.getFrameExtents();if(a.multiply(U),u.copy(N.mapSize),(a.x>f||a.y>f)&&(a.x>f&&(u.x=Math.floor(f/U.x),a.x=u.x*U.x,N.mapSize.x=u.x),a.y>f&&(u.y=Math.floor(f/U.y),a.y=u.y*U.y,N.mapSize.y=u.y)),N.map===null&&!N.isPointLightShadow&&this.type===wr&&(N.map=new li(a.x,a.y),N.map.texture.name=H.name+".shadowMap",N.mapPass=new li(a.x,a.y),N.camera.updateProjectionMatrix()),N.map===null){const j={minFilter:mt,magFilter:mt,format:Bt};N.map=new li(a.x,a.y,j),N.map.texture.name=H.name+".shadowMap",N.camera.updateProjectionMatrix()}m.setRenderTarget(N.map),m.clear();const G=N.getViewportCount();for(let j=0;j<G;j++){const q=N.getViewport(j);g.set(u.x*q.x,u.y*q.y,u.x*q.z,u.y*q.w),O.viewport(g),N.updateMatrices(H,j),i=N.getFrustum(),y(b,w,N.camera,H,this.type)}!N.isPointLightShadow&&this.type===wr&&v(N,w),N.needsUpdate=!1}h.needsUpdate=!1,m.setRenderTarget(M,S,C)};function v(x,b){const w=e.update(p);l.defines.VSM_SAMPLES!==x.blurSamples&&(l.defines.VSM_SAMPLES=x.blurSamples,c.defines.VSM_SAMPLES=x.blurSamples,l.needsUpdate=!0,c.needsUpdate=!0),l.uniforms.shadow_pass.value=x.map.texture,l.uniforms.resolution.value=x.mapSize,l.uniforms.radius.value=x.radius,m.setRenderTarget(x.mapPass),m.clear(),m.renderBufferDirect(b,null,w,l,p,null),c.uniforms.shadow_pass.value=x.mapPass.texture,c.uniforms.resolution.value=x.mapSize,c.uniforms.radius.value=x.radius,m.setRenderTarget(x.map),m.clear(),m.renderBufferDirect(b,null,w,c,p,null)}function _(x,b,w,M,S,C){let O=null;const k=w.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(k!==void 0?O=k:O=w.isPointLight===!0?n:s,m.localClippingEnabled&&b.clipShadows===!0&&b.clippingPlanes.length!==0||b.displacementMap&&b.displacementScale!==0||b.alphaMap&&b.alphaTest>0){const Y=O.uuid,H=b.uuid;let N=o[Y];N===void 0&&(N={},o[Y]=N);let U=N[H];U===void 0&&(U=O.clone(),N[H]=U),O=U}return O.visible=b.visible,O.wireframe=b.wireframe,C===wr?O.side=b.shadowSide!==null?b.shadowSide:b.side:O.side=b.shadowSide!==null?b.shadowSide:r[b.side],O.alphaMap=b.alphaMap,O.alphaTest=b.alphaTest,O.clipShadows=b.clipShadows,O.clippingPlanes=b.clippingPlanes,O.clipIntersection=b.clipIntersection,O.displacementMap=b.displacementMap,O.displacementScale=b.displacementScale,O.displacementBias=b.displacementBias,O.wireframeLinewidth=b.wireframeLinewidth,O.linewidth=b.linewidth,w.isPointLight===!0&&O.isMeshDistanceMaterial===!0&&(O.referencePosition.setFromMatrixPosition(w.matrixWorld),O.nearDistance=M,O.farDistance=S),O}function y(x,b,w,M,S){if(x.visible===!1)return;if(x.layers.test(b.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&S===wr)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,x.matrixWorld);const k=e.update(x),Y=x.material;if(Array.isArray(Y)){const H=k.groups;for(let N=0,U=H.length;N<U;N++){const G=H[N],j=Y[G.materialIndex];if(j&&j.visible){const q=_(x,j,M,w.near,w.far,S);m.renderBufferDirect(w,null,k,q,x,G)}}}else if(Y.visible){const H=_(x,Y,M,w.near,w.far,S);m.renderBufferDirect(w,null,k,H,x,null)}}const O=x.children;for(let k=0,Y=O.length;k<Y;k++)y(O[k],b,w,M,S)}}function mv(m,e,t){const i=t.isWebGL2;function a(){let W=!1;const ye=new Ye;let xe=null;const Pe=new Ye(0,0,0,0);return{setMask:function(Se){xe!==Se&&!W&&(m.colorMask(Se,Se,Se,Se),xe=Se)},setLocked:function(Se){W=Se},setClear:function(Se,Ae,be,Oe,qe){qe===!0&&(Se*=Oe,Ae*=Oe,be*=Oe),ye.set(Se,Ae,be,Oe),Pe.equals(ye)===!1&&(m.clearColor(Se,Ae,be,Oe),Pe.copy(ye))},reset:function(){W=!1,xe=null,Pe.set(-1,0,0,0)}}}function u(){let W=!1,ye=null,xe=null,Pe=null;return{setTest:function(Se){Se?E(2929):F(2929)},setMask:function(Se){ye!==Se&&!W&&(m.depthMask(Se),ye=Se)},setFunc:function(Se){if(xe!==Se){if(Se)switch(Se){case Uu:m.depthFunc(512);break;case Vu:m.depthFunc(519);break;case Gu:m.depthFunc(513);break;case Fa:m.depthFunc(515);break;case Hu:m.depthFunc(514);break;case Wu:m.depthFunc(518);break;case ju:m.depthFunc(516);break;case Xu:m.depthFunc(517);break;default:m.depthFunc(515)}else m.depthFunc(515);xe=Se}},setLocked:function(Se){W=Se},setClear:function(Se){Pe!==Se&&(m.clearDepth(Se),Pe=Se)},reset:function(){W=!1,ye=null,xe=null,Pe=null}}}function g(){let W=!1,ye=null,xe=null,Pe=null,Se=null,Ae=null,be=null,Oe=null,qe=null;return{setTest:function(Ke){W||(Ke?E(2960):F(2960))},setMask:function(Ke){ye!==Ke&&!W&&(m.stencilMask(Ke),ye=Ke)},setFunc:function(Ke,yt,Qt){(xe!==Ke||Pe!==yt||Se!==Qt)&&(m.stencilFunc(Ke,yt,Qt),xe=Ke,Pe=yt,Se=Qt)},setOp:function(Ke,yt,Qt){(Ae!==Ke||be!==yt||Oe!==Qt)&&(m.stencilOp(Ke,yt,Qt),Ae=Ke,be=yt,Oe=Qt)},setLocked:function(Ke){W=Ke},setClear:function(Ke){qe!==Ke&&(m.clearStencil(Ke),qe=Ke)},reset:function(){W=!1,ye=null,xe=null,Pe=null,Se=null,Ae=null,be=null,Oe=null,qe=null}}}const s=new a,n=new u,o=new g;let f={},r={},l=new WeakMap,c=[],d=null,p=!1,h=null,v=null,_=null,y=null,x=null,b=null,w=null,M=!1,S=null,C=null,O=null,k=null,Y=null;const H=m.getParameter(35661);let N=!1,U=0;const G=m.getParameter(7938);G.indexOf("WebGL")!==-1?(U=parseFloat(/^WebGL (\d)/.exec(G)[1]),N=U>=1):G.indexOf("OpenGL ES")!==-1&&(U=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),N=U>=2);let j=null,q={};const T=m.getParameter(3088),P=m.getParameter(2978),R=new Ye().fromArray(T),L=new Ye().fromArray(P);function V(W,ye,xe){const Pe=new Uint8Array(4),Se=m.createTexture();m.bindTexture(W,Se),m.texParameteri(W,10241,9728),m.texParameteri(W,10240,9728);for(let Ae=0;Ae<xe;Ae++)m.texImage2D(ye+Ae,0,6408,1,1,0,6408,5121,Pe);return Se}const I={};I[3553]=V(3553,3553,1),I[34067]=V(34067,34069,6),s.setClear(0,0,0,1),n.setClear(1),o.setClear(0),E(2929),n.setFunc(Fa),$(!1),se(Fo),E(2884),ue(Ni);function E(W){f[W]!==!0&&(m.enable(W),f[W]=!0)}function F(W){f[W]!==!1&&(m.disable(W),f[W]=!1)}function K(W,ye){return r[W]!==ye?(m.bindFramebuffer(W,ye),r[W]=ye,i&&(W===36009&&(r[36160]=ye),W===36160&&(r[36009]=ye)),!0):!1}function ee(W,ye){let xe=c,Pe=!1;if(W)if(xe=l.get(ye),xe===void 0&&(xe=[],l.set(ye,xe)),W.isWebGLMultipleRenderTargets){const Se=W.texture;if(xe.length!==Se.length||xe[0]!==36064){for(let Ae=0,be=Se.length;Ae<be;Ae++)xe[Ae]=36064+Ae;xe.length=Se.length,Pe=!0}}else xe[0]!==36064&&(xe[0]=36064,Pe=!0);else xe[0]!==1029&&(xe[0]=1029,Pe=!0);Pe&&(t.isWebGL2?m.drawBuffers(xe):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(xe))}function Z(W){return d!==W?(m.useProgram(W),d=W,!0):!1}const J={[In]:32774,[Lu]:32778,[Pu]:32779};if(i)J[zo]=32775,J[Uo]=32776;else{const W=e.get("EXT_blend_minmax");W!==null&&(J[zo]=W.MIN_EXT,J[Uo]=W.MAX_EXT)}const ae={[Du]:0,[Ru]:1,[Ou]:768,[Uc]:770,[zu]:776,[Bu]:774,[Fu]:772,[Iu]:769,[Vc]:771,[Nu]:775,[ku]:773};function ue(W,ye,xe,Pe,Se,Ae,be,Oe){if(W===Ni){p===!0&&(F(3042),p=!1);return}if(p===!1&&(E(3042),p=!0),W!==Au){if(W!==h||Oe!==M){if((v!==In||x!==In)&&(m.blendEquation(32774),v=In,x=In),Oe)switch(W){case Un:m.blendFuncSeparate(1,771,1,771);break;case ko:m.blendFunc(1,1);break;case Bo:m.blendFuncSeparate(0,769,0,1);break;case No:m.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}else switch(W){case Un:m.blendFuncSeparate(770,771,1,771);break;case ko:m.blendFunc(770,1);break;case Bo:m.blendFuncSeparate(0,769,0,1);break;case No:m.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}_=null,y=null,b=null,w=null,h=W,M=Oe}return}Se=Se||ye,Ae=Ae||xe,be=be||Pe,(ye!==v||Se!==x)&&(m.blendEquationSeparate(J[ye],J[Se]),v=ye,x=Se),(xe!==_||Pe!==y||Ae!==b||be!==w)&&(m.blendFuncSeparate(ae[xe],ae[Pe],ae[Ae],ae[be]),_=xe,y=Pe,b=Ae,w=be),h=W,M=null}function Q(W,ye){W.side===Si?F(2884):E(2884);let xe=W.side===Kt;ye&&(xe=!xe),$(xe),W.blending===Un&&W.transparent===!1?ue(Ni):ue(W.blending,W.blendEquation,W.blendSrc,W.blendDst,W.blendEquationAlpha,W.blendSrcAlpha,W.blendDstAlpha,W.premultipliedAlpha),n.setFunc(W.depthFunc),n.setTest(W.depthTest),n.setMask(W.depthWrite),s.setMask(W.colorWrite);const Pe=W.stencilWrite;o.setTest(Pe),Pe&&(o.setMask(W.stencilWriteMask),o.setFunc(W.stencilFunc,W.stencilRef,W.stencilFuncMask),o.setOp(W.stencilFail,W.stencilZFail,W.stencilZPass)),ne(W.polygonOffset,W.polygonOffsetFactor,W.polygonOffsetUnits),W.alphaToCoverage===!0?E(32926):F(32926)}function $(W){S!==W&&(W?m.frontFace(2304):m.frontFace(2305),S=W)}function se(W){W!==Mu?(E(2884),W!==C&&(W===Fo?m.cullFace(1029):W===Tu?m.cullFace(1028):m.cullFace(1032))):F(2884),C=W}function oe(W){W!==O&&(N&&m.lineWidth(W),O=W)}function ne(W,ye,xe){W?(E(32823),(k!==ye||Y!==xe)&&(m.polygonOffset(ye,xe),k=ye,Y=xe)):F(32823)}function le(W){W?E(3089):F(3089)}function fe(W){W===void 0&&(W=33984+H-1),j!==W&&(m.activeTexture(W),j=W)}function Ee(W,ye){j===null&&fe();let xe=q[j];xe===void 0&&(xe={type:void 0,texture:void 0},q[j]=xe),(xe.type!==W||xe.texture!==ye)&&(m.bindTexture(W,ye||I[W]),xe.type=W,xe.texture=ye)}function Me(){const W=q[j];W!==void 0&&W.type!==void 0&&(m.bindTexture(W.type,null),W.type=void 0,W.texture=void 0)}function A(){try{m.compressedTexImage2D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function D(){try{m.texSubImage2D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function te(){try{m.texSubImage3D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function he(){try{m.compressedTexSubImage2D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function me(){try{m.texStorage2D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function ge(){try{m.texStorage3D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function Ce(){try{m.texImage2D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function B(){try{m.texImage3D.apply(m,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function de(W){R.equals(W)===!1&&(m.scissor(W.x,W.y,W.z,W.w),R.copy(W))}function _e(W){L.equals(W)===!1&&(m.viewport(W.x,W.y,W.z,W.w),L.copy(W))}function ve(){m.disable(3042),m.disable(2884),m.disable(2929),m.disable(32823),m.disable(3089),m.disable(2960),m.disable(32926),m.blendEquation(32774),m.blendFunc(1,0),m.blendFuncSeparate(1,0,1,0),m.colorMask(!0,!0,!0,!0),m.clearColor(0,0,0,0),m.depthMask(!0),m.depthFunc(513),m.clearDepth(1),m.stencilMask(4294967295),m.stencilFunc(519,0,4294967295),m.stencilOp(7680,7680,7680),m.clearStencil(0),m.cullFace(1029),m.frontFace(2305),m.polygonOffset(0,0),m.activeTexture(33984),m.bindFramebuffer(36160,null),i===!0&&(m.bindFramebuffer(36009,null),m.bindFramebuffer(36008,null)),m.useProgram(null),m.lineWidth(1),m.scissor(0,0,m.canvas.width,m.canvas.height),m.viewport(0,0,m.canvas.width,m.canvas.height),f={},j=null,q={},r={},l=new WeakMap,c=[],d=null,p=!1,h=null,v=null,_=null,y=null,x=null,b=null,w=null,M=!1,S=null,C=null,O=null,k=null,Y=null,R.set(0,0,m.canvas.width,m.canvas.height),L.set(0,0,m.canvas.width,m.canvas.height),s.reset(),n.reset(),o.reset()}return{buffers:{color:s,depth:n,stencil:o},enable:E,disable:F,bindFramebuffer:K,drawBuffers:ee,useProgram:Z,setBlending:ue,setMaterial:Q,setFlipSided:$,setCullFace:se,setLineWidth:oe,setPolygonOffset:ne,setScissorTest:le,activeTexture:fe,bindTexture:Ee,unbindTexture:Me,compressedTexImage2D:A,texImage2D:Ce,texImage3D:B,texStorage2D:me,texStorage3D:ge,texSubImage2D:D,texSubImage3D:te,compressedTexSubImage2D:he,scissor:de,viewport:_e,reset:ve}}function gv(m,e,t,i,a,u,g){const s=a.isWebGL2,n=a.maxTextures,o=a.maxCubemapSize,f=a.maxTextureSize,r=a.maxSamples,l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=/OculusBrowser/g.test(navigator.userAgent),d=new WeakMap;let p;const h=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function _(A,D){return v?new OffscreenCanvas(A,D):Dr("canvas")}function y(A,D,te,he){let me=1;if((A.width>he||A.height>he)&&(me=he/Math.max(A.width,A.height)),me<1||D===!0)if(typeof HTMLImageElement!="undefined"&&A instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&A instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&A instanceof ImageBitmap){const ge=D?Cs:Math.floor,Ce=ge(me*A.width),B=ge(me*A.height);p===void 0&&(p=_(Ce,B));const de=te?_(Ce,B):p;return de.width=Ce,de.height=B,de.getContext("2d").drawImage(A,0,0,Ce,B),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+A.width+"x"+A.height+") to ("+Ce+"x"+B+")."),de}else return"data"in A&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+A.width+"x"+A.height+")."),A;return A}function x(A){return Va(A.width)&&Va(A.height)}function b(A){return s?!1:A.wrapS!==_t||A.wrapT!==_t||A.minFilter!==mt&&A.minFilter!==rt}function w(A,D){return A.generateMipmaps&&D&&A.minFilter!==mt&&A.minFilter!==rt}function M(A){m.generateMipmap(A)}function S(A,D,te,he,me=!1){if(s===!1)return D;if(A!==null){if(m[A]!==void 0)return m[A];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+A+"'")}let ge=D;return D===6403&&(te===5126&&(ge=33326),te===5131&&(ge=33325),te===5121&&(ge=33321)),D===33319&&(te===5126&&(ge=33328),te===5131&&(ge=33327),te===5121&&(ge=33323)),D===6408&&(te===5126&&(ge=34836),te===5131&&(ge=34842),te===5121&&(ge=he===ze&&me===!1?35907:32856),te===32819&&(ge=32854),te===32820&&(ge=32855)),(ge===33325||ge===33326||ge===33327||ge===33328||ge===34842||ge===34836)&&e.get("EXT_color_buffer_float"),ge}function C(A,D,te){return w(A,te)===!0||A.isFramebufferTexture&&A.minFilter!==mt&&A.minFilter!==rt?Math.log2(Math.max(D.width,D.height))+1:A.mipmaps!==void 0&&A.mipmaps.length>0?A.mipmaps.length:A.isCompressedTexture&&Array.isArray(A.image)?D.mipmaps.length:1}function O(A){return A===mt||A===Ba||A===Na?9728:9729}function k(A){const D=A.target;D.removeEventListener("dispose",k),H(D),D.isVideoTexture&&d.delete(D)}function Y(A){const D=A.target;D.removeEventListener("dispose",Y),U(D)}function H(A){const D=i.get(A);if(D.__webglInit===void 0)return;const te=A.source,he=h.get(te);if(he){const me=he[D.__cacheKey];me.usedTimes--,me.usedTimes===0&&N(A),Object.keys(he).length===0&&h.delete(te)}i.remove(A)}function N(A){const D=i.get(A);m.deleteTexture(D.__webglTexture);const te=A.source,he=h.get(te);delete he[D.__cacheKey],g.memory.textures--}function U(A){const D=A.texture,te=i.get(A),he=i.get(D);if(he.__webglTexture!==void 0&&(m.deleteTexture(he.__webglTexture),g.memory.textures--),A.depthTexture&&A.depthTexture.dispose(),A.isWebGLCubeRenderTarget)for(let me=0;me<6;me++)m.deleteFramebuffer(te.__webglFramebuffer[me]),te.__webglDepthbuffer&&m.deleteRenderbuffer(te.__webglDepthbuffer[me]);else{if(m.deleteFramebuffer(te.__webglFramebuffer),te.__webglDepthbuffer&&m.deleteRenderbuffer(te.__webglDepthbuffer),te.__webglMultisampledFramebuffer&&m.deleteFramebuffer(te.__webglMultisampledFramebuffer),te.__webglColorRenderbuffer)for(let me=0;me<te.__webglColorRenderbuffer.length;me++)te.__webglColorRenderbuffer[me]&&m.deleteRenderbuffer(te.__webglColorRenderbuffer[me]);te.__webglDepthRenderbuffer&&m.deleteRenderbuffer(te.__webglDepthRenderbuffer)}if(A.isWebGLMultipleRenderTargets)for(let me=0,ge=D.length;me<ge;me++){const Ce=i.get(D[me]);Ce.__webglTexture&&(m.deleteTexture(Ce.__webglTexture),g.memory.textures--),i.remove(D[me])}i.remove(D),i.remove(A)}let G=0;function j(){G=0}function q(){const A=G;return A>=n&&console.warn("THREE.WebGLTextures: Trying to use "+A+" texture units while this GPU supports only "+n),G+=1,A}function T(A){const D=[];return D.push(A.wrapS),D.push(A.wrapT),D.push(A.magFilter),D.push(A.minFilter),D.push(A.anisotropy),D.push(A.internalFormat),D.push(A.format),D.push(A.type),D.push(A.generateMipmaps),D.push(A.premultiplyAlpha),D.push(A.flipY),D.push(A.unpackAlignment),D.push(A.encoding),D.join()}function P(A,D){const te=i.get(A);if(A.isVideoTexture&&Ee(A),A.isRenderTargetTexture===!1&&A.version>0&&te.__version!==A.version){const he=A.image;if(he===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(he.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ee(te,A,D);return}}t.activeTexture(33984+D),t.bindTexture(3553,te.__webglTexture)}function R(A,D){const te=i.get(A);if(A.version>0&&te.__version!==A.version){ee(te,A,D);return}t.activeTexture(33984+D),t.bindTexture(35866,te.__webglTexture)}function L(A,D){const te=i.get(A);if(A.version>0&&te.__version!==A.version){ee(te,A,D);return}t.activeTexture(33984+D),t.bindTexture(32879,te.__webglTexture)}function V(A,D){const te=i.get(A);if(A.version>0&&te.__version!==A.version){Z(te,A,D);return}t.activeTexture(33984+D),t.bindTexture(34067,te.__webglTexture)}const I={[Vi]:10497,[_t]:33071,[Ts]:33648},E={[mt]:9728,[Ba]:9984,[Na]:9986,[rt]:9729,[Yc]:9985,[hn]:9987};function F(A,D,te){if(te?(m.texParameteri(A,10242,I[D.wrapS]),m.texParameteri(A,10243,I[D.wrapT]),(A===32879||A===35866)&&m.texParameteri(A,32882,I[D.wrapR]),m.texParameteri(A,10240,E[D.magFilter]),m.texParameteri(A,10241,E[D.minFilter])):(m.texParameteri(A,10242,33071),m.texParameteri(A,10243,33071),(A===32879||A===35866)&&m.texParameteri(A,32882,33071),(D.wrapS!==_t||D.wrapT!==_t)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),m.texParameteri(A,10240,O(D.magFilter)),m.texParameteri(A,10241,O(D.minFilter)),D.minFilter!==mt&&D.minFilter!==rt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const he=e.get("EXT_texture_filter_anisotropic");if(D.type===Yt&&e.has("OES_texture_float_linear")===!1||s===!1&&D.type===xi&&e.has("OES_texture_half_float_linear")===!1)return;(D.anisotropy>1||i.get(D).__currentAnisotropy)&&(m.texParameterf(A,he.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,a.getMaxAnisotropy())),i.get(D).__currentAnisotropy=D.anisotropy)}}function K(A,D){let te=!1;A.__webglInit===void 0&&(A.__webglInit=!0,D.addEventListener("dispose",k));const he=D.source;let me=h.get(he);me===void 0&&(me={},h.set(he,me));const ge=T(D);if(ge!==A.__cacheKey){me[ge]===void 0&&(me[ge]={texture:m.createTexture(),usedTimes:0},g.memory.textures++,te=!0),me[ge].usedTimes++;const Ce=me[A.__cacheKey];Ce!==void 0&&(me[A.__cacheKey].usedTimes--,Ce.usedTimes===0&&N(D)),A.__cacheKey=ge,A.__webglTexture=me[ge].texture}return te}function ee(A,D,te){let he=3553;D.isDataArrayTexture&&(he=35866),D.isData3DTexture&&(he=32879);const me=K(A,D),ge=D.source;if(t.activeTexture(33984+te),t.bindTexture(he,A.__webglTexture),ge.version!==ge.__currentVersion||me===!0){m.pixelStorei(37440,D.flipY),m.pixelStorei(37441,D.premultiplyAlpha),m.pixelStorei(3317,D.unpackAlignment),m.pixelStorei(37443,0);const Ce=b(D)&&x(D.image)===!1;let B=y(D.image,Ce,!1,f);B=Me(D,B);const de=x(B)||s,_e=u.convert(D.format,D.encoding);let ve=u.convert(D.type),W=S(D.internalFormat,_e,ve,D.encoding,D.isVideoTexture);F(he,D,de);let ye;const xe=D.mipmaps,Pe=s&&D.isVideoTexture!==!0,Se=ge.__currentVersion===void 0||me===!0,Ae=C(D,B,de);if(D.isDepthTexture)W=6402,s?D.type===Yt?W=36012:D.type===tn?W=33190:D.type===Vn?W=35056:W=33189:D.type===Yt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===sn&&W===6402&&D.type!==qc&&D.type!==tn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=tn,ve=u.convert(D.type)),D.format===jn&&W===6402&&(W=34041,D.type!==Vn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Vn,ve=u.convert(D.type))),Se&&(Pe?t.texStorage2D(3553,1,W,B.width,B.height):t.texImage2D(3553,0,W,B.width,B.height,0,_e,ve,null));else if(D.isDataTexture)if(xe.length>0&&de){Pe&&Se&&t.texStorage2D(3553,Ae,W,xe[0].width,xe[0].height);for(let be=0,Oe=xe.length;be<Oe;be++)ye=xe[be],Pe?t.texSubImage2D(3553,be,0,0,ye.width,ye.height,_e,ve,ye.data):t.texImage2D(3553,be,W,ye.width,ye.height,0,_e,ve,ye.data);D.generateMipmaps=!1}else Pe?(Se&&t.texStorage2D(3553,Ae,W,B.width,B.height),t.texSubImage2D(3553,0,0,0,B.width,B.height,_e,ve,B.data)):t.texImage2D(3553,0,W,B.width,B.height,0,_e,ve,B.data);else if(D.isCompressedTexture){Pe&&Se&&t.texStorage2D(3553,Ae,W,xe[0].width,xe[0].height);for(let be=0,Oe=xe.length;be<Oe;be++)ye=xe[be],D.format!==Bt?_e!==null?Pe?t.compressedTexSubImage2D(3553,be,0,0,ye.width,ye.height,_e,ye.data):t.compressedTexImage2D(3553,be,W,ye.width,ye.height,0,ye.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Pe?t.texSubImage2D(3553,be,0,0,ye.width,ye.height,_e,ve,ye.data):t.texImage2D(3553,be,W,ye.width,ye.height,0,_e,ve,ye.data)}else if(D.isDataArrayTexture)Pe?(Se&&t.texStorage3D(35866,Ae,W,B.width,B.height,B.depth),t.texSubImage3D(35866,0,0,0,0,B.width,B.height,B.depth,_e,ve,B.data)):t.texImage3D(35866,0,W,B.width,B.height,B.depth,0,_e,ve,B.data);else if(D.isData3DTexture)Pe?(Se&&t.texStorage3D(32879,Ae,W,B.width,B.height,B.depth),t.texSubImage3D(32879,0,0,0,0,B.width,B.height,B.depth,_e,ve,B.data)):t.texImage3D(32879,0,W,B.width,B.height,B.depth,0,_e,ve,B.data);else if(D.isFramebufferTexture){if(Se)if(Pe)t.texStorage2D(3553,Ae,W,B.width,B.height);else{let be=B.width,Oe=B.height;for(let qe=0;qe<Ae;qe++)t.texImage2D(3553,qe,W,be,Oe,0,_e,ve,null),be>>=1,Oe>>=1}}else if(xe.length>0&&de){Pe&&Se&&t.texStorage2D(3553,Ae,W,xe[0].width,xe[0].height);for(let be=0,Oe=xe.length;be<Oe;be++)ye=xe[be],Pe?t.texSubImage2D(3553,be,0,0,_e,ve,ye):t.texImage2D(3553,be,W,_e,ve,ye);D.generateMipmaps=!1}else Pe?(Se&&t.texStorage2D(3553,Ae,W,B.width,B.height),t.texSubImage2D(3553,0,0,0,_e,ve,B)):t.texImage2D(3553,0,W,_e,ve,B);w(D,de)&&M(he),ge.__currentVersion=ge.version,D.onUpdate&&D.onUpdate(D)}A.__version=D.version}function Z(A,D,te){if(D.image.length!==6)return;const he=K(A,D),me=D.source;if(t.activeTexture(33984+te),t.bindTexture(34067,A.__webglTexture),me.version!==me.__currentVersion||he===!0){m.pixelStorei(37440,D.flipY),m.pixelStorei(37441,D.premultiplyAlpha),m.pixelStorei(3317,D.unpackAlignment),m.pixelStorei(37443,0);const ge=D.isCompressedTexture||D.image[0].isCompressedTexture,Ce=D.image[0]&&D.image[0].isDataTexture,B=[];for(let be=0;be<6;be++)!ge&&!Ce?B[be]=y(D.image[be],!1,!0,o):B[be]=Ce?D.image[be].image:D.image[be],B[be]=Me(D,B[be]);const de=B[0],_e=x(de)||s,ve=u.convert(D.format,D.encoding),W=u.convert(D.type),ye=S(D.internalFormat,ve,W,D.encoding),xe=s&&D.isVideoTexture!==!0,Pe=me.__currentVersion===void 0||he===!0;let Se=C(D,de,_e);F(34067,D,_e);let Ae;if(ge){xe&&Pe&&t.texStorage2D(34067,Se,ye,de.width,de.height);for(let be=0;be<6;be++){Ae=B[be].mipmaps;for(let Oe=0;Oe<Ae.length;Oe++){const qe=Ae[Oe];D.format!==Bt?ve!==null?xe?t.compressedTexSubImage2D(34069+be,Oe,0,0,qe.width,qe.height,ve,qe.data):t.compressedTexImage2D(34069+be,Oe,ye,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):xe?t.texSubImage2D(34069+be,Oe,0,0,qe.width,qe.height,ve,W,qe.data):t.texImage2D(34069+be,Oe,ye,qe.width,qe.height,0,ve,W,qe.data)}}}else{Ae=D.mipmaps,xe&&Pe&&(Ae.length>0&&Se++,t.texStorage2D(34067,Se,ye,B[0].width,B[0].height));for(let be=0;be<6;be++)if(Ce){xe?t.texSubImage2D(34069+be,0,0,0,B[be].width,B[be].height,ve,W,B[be].data):t.texImage2D(34069+be,0,ye,B[be].width,B[be].height,0,ve,W,B[be].data);for(let Oe=0;Oe<Ae.length;Oe++){const Ke=Ae[Oe].image[be].image;xe?t.texSubImage2D(34069+be,Oe+1,0,0,Ke.width,Ke.height,ve,W,Ke.data):t.texImage2D(34069+be,Oe+1,ye,Ke.width,Ke.height,0,ve,W,Ke.data)}}else{xe?t.texSubImage2D(34069+be,0,0,0,ve,W,B[be]):t.texImage2D(34069+be,0,ye,ve,W,B[be]);for(let Oe=0;Oe<Ae.length;Oe++){const qe=Ae[Oe];xe?t.texSubImage2D(34069+be,Oe+1,0,0,ve,W,qe.image[be]):t.texImage2D(34069+be,Oe+1,ye,ve,W,qe.image[be])}}}w(D,_e)&&M(34067),me.__currentVersion=me.version,D.onUpdate&&D.onUpdate(D)}A.__version=D.version}function J(A,D,te,he,me){const ge=u.convert(te.format,te.encoding),Ce=u.convert(te.type),B=S(te.internalFormat,ge,Ce,te.encoding);i.get(D).__hasExternalTextures||(me===32879||me===35866?t.texImage3D(me,0,B,D.width,D.height,D.depth,0,ge,Ce,null):t.texImage2D(me,0,B,D.width,D.height,0,ge,Ce,null)),t.bindFramebuffer(36160,A),fe(D)?l.framebufferTexture2DMultisampleEXT(36160,he,me,i.get(te).__webglTexture,0,le(D)):m.framebufferTexture2D(36160,he,me,i.get(te).__webglTexture,0),t.bindFramebuffer(36160,null)}function ae(A,D,te){if(m.bindRenderbuffer(36161,A),D.depthBuffer&&!D.stencilBuffer){let he=33189;if(te||fe(D)){const me=D.depthTexture;me&&me.isDepthTexture&&(me.type===Yt?he=36012:me.type===tn&&(he=33190));const ge=le(D);fe(D)?l.renderbufferStorageMultisampleEXT(36161,ge,he,D.width,D.height):m.renderbufferStorageMultisample(36161,ge,he,D.width,D.height)}else m.renderbufferStorage(36161,he,D.width,D.height);m.framebufferRenderbuffer(36160,36096,36161,A)}else if(D.depthBuffer&&D.stencilBuffer){const he=le(D);te&&fe(D)===!1?m.renderbufferStorageMultisample(36161,he,35056,D.width,D.height):fe(D)?l.renderbufferStorageMultisampleEXT(36161,he,35056,D.width,D.height):m.renderbufferStorage(36161,34041,D.width,D.height),m.framebufferRenderbuffer(36160,33306,36161,A)}else{const he=D.isWebGLMultipleRenderTargets===!0?D.texture:[D.texture];for(let me=0;me<he.length;me++){const ge=he[me],Ce=u.convert(ge.format,ge.encoding),B=u.convert(ge.type),de=S(ge.internalFormat,Ce,B,ge.encoding),_e=le(D);te&&fe(D)===!1?m.renderbufferStorageMultisample(36161,_e,de,D.width,D.height):fe(D)?l.renderbufferStorageMultisampleEXT(36161,_e,de,D.width,D.height):m.renderbufferStorage(36161,de,D.width,D.height)}}m.bindRenderbuffer(36161,null)}function ue(A,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,A),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),P(D.depthTexture,0);const he=i.get(D.depthTexture).__webglTexture,me=le(D);if(D.depthTexture.format===sn)fe(D)?l.framebufferTexture2DMultisampleEXT(36160,36096,3553,he,0,me):m.framebufferTexture2D(36160,36096,3553,he,0);else if(D.depthTexture.format===jn)fe(D)?l.framebufferTexture2DMultisampleEXT(36160,33306,3553,he,0,me):m.framebufferTexture2D(36160,33306,3553,he,0);else throw new Error("Unknown depthTexture format")}function Q(A){const D=i.get(A),te=A.isWebGLCubeRenderTarget===!0;if(A.depthTexture&&!D.__autoAllocateDepthBuffer){if(te)throw new Error("target.depthTexture not supported in Cube render targets");ue(D.__webglFramebuffer,A)}else if(te){D.__webglDepthbuffer=[];for(let he=0;he<6;he++)t.bindFramebuffer(36160,D.__webglFramebuffer[he]),D.__webglDepthbuffer[he]=m.createRenderbuffer(),ae(D.__webglDepthbuffer[he],A,!1)}else t.bindFramebuffer(36160,D.__webglFramebuffer),D.__webglDepthbuffer=m.createRenderbuffer(),ae(D.__webglDepthbuffer,A,!1);t.bindFramebuffer(36160,null)}function $(A,D,te){const he=i.get(A);D!==void 0&&J(he.__webglFramebuffer,A,A.texture,36064,3553),te!==void 0&&Q(A)}function se(A){const D=A.texture,te=i.get(A),he=i.get(D);A.addEventListener("dispose",Y),A.isWebGLMultipleRenderTargets!==!0&&(he.__webglTexture===void 0&&(he.__webglTexture=m.createTexture()),he.__version=D.version,g.memory.textures++);const me=A.isWebGLCubeRenderTarget===!0,ge=A.isWebGLMultipleRenderTargets===!0,Ce=x(A)||s;if(me){te.__webglFramebuffer=[];for(let B=0;B<6;B++)te.__webglFramebuffer[B]=m.createFramebuffer()}else{if(te.__webglFramebuffer=m.createFramebuffer(),ge)if(a.drawBuffers){const B=A.texture;for(let de=0,_e=B.length;de<_e;de++){const ve=i.get(B[de]);ve.__webglTexture===void 0&&(ve.__webglTexture=m.createTexture(),g.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&A.samples>0&&fe(A)===!1){const B=ge?D:[D];te.__webglMultisampledFramebuffer=m.createFramebuffer(),te.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,te.__webglMultisampledFramebuffer);for(let de=0;de<B.length;de++){const _e=B[de];te.__webglColorRenderbuffer[de]=m.createRenderbuffer(),m.bindRenderbuffer(36161,te.__webglColorRenderbuffer[de]);const ve=u.convert(_e.format,_e.encoding),W=u.convert(_e.type),ye=S(_e.internalFormat,ve,W,_e.encoding),xe=le(A);m.renderbufferStorageMultisample(36161,xe,ye,A.width,A.height),m.framebufferRenderbuffer(36160,36064+de,36161,te.__webglColorRenderbuffer[de])}m.bindRenderbuffer(36161,null),A.depthBuffer&&(te.__webglDepthRenderbuffer=m.createRenderbuffer(),ae(te.__webglDepthRenderbuffer,A,!0)),t.bindFramebuffer(36160,null)}}if(me){t.bindTexture(34067,he.__webglTexture),F(34067,D,Ce);for(let B=0;B<6;B++)J(te.__webglFramebuffer[B],A,D,36064,34069+B);w(D,Ce)&&M(34067),t.unbindTexture()}else if(ge){const B=A.texture;for(let de=0,_e=B.length;de<_e;de++){const ve=B[de],W=i.get(ve);t.bindTexture(3553,W.__webglTexture),F(3553,ve,Ce),J(te.__webglFramebuffer,A,ve,36064+de,3553),w(ve,Ce)&&M(3553)}t.unbindTexture()}else{let B=3553;(A.isWebGL3DRenderTarget||A.isWebGLArrayRenderTarget)&&(s?B=A.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(B,he.__webglTexture),F(B,D,Ce),J(te.__webglFramebuffer,A,D,36064,B),w(D,Ce)&&M(B),t.unbindTexture()}A.depthBuffer&&Q(A)}function oe(A){const D=x(A)||s,te=A.isWebGLMultipleRenderTargets===!0?A.texture:[A.texture];for(let he=0,me=te.length;he<me;he++){const ge=te[he];if(w(ge,D)){const Ce=A.isWebGLCubeRenderTarget?34067:3553,B=i.get(ge).__webglTexture;t.bindTexture(Ce,B),M(Ce),t.unbindTexture()}}}function ne(A){if(s&&A.samples>0&&fe(A)===!1){const D=A.isWebGLMultipleRenderTargets?A.texture:[A.texture],te=A.width,he=A.height;let me=16384;const ge=[],Ce=A.stencilBuffer?33306:36096,B=i.get(A),de=A.isWebGLMultipleRenderTargets===!0;if(de)for(let _e=0;_e<D.length;_e++)t.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(36160,36064+_e,36161,null),t.bindFramebuffer(36160,B.__webglFramebuffer),m.framebufferTexture2D(36009,36064+_e,3553,null,0);t.bindFramebuffer(36008,B.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,B.__webglFramebuffer);for(let _e=0;_e<D.length;_e++){ge.push(36064+_e),A.depthBuffer&&ge.push(Ce);const ve=B.__ignoreDepthValues!==void 0?B.__ignoreDepthValues:!1;if(ve===!1&&(A.depthBuffer&&(me|=256),A.stencilBuffer&&(me|=1024)),de&&m.framebufferRenderbuffer(36008,36064,36161,B.__webglColorRenderbuffer[_e]),ve===!0&&(m.invalidateFramebuffer(36008,[Ce]),m.invalidateFramebuffer(36009,[Ce])),de){const W=i.get(D[_e]).__webglTexture;m.framebufferTexture2D(36009,36064,3553,W,0)}m.blitFramebuffer(0,0,te,he,0,0,te,he,me,9728),c&&m.invalidateFramebuffer(36008,ge)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),de)for(let _e=0;_e<D.length;_e++){t.bindFramebuffer(36160,B.__webglMultisampledFramebuffer),m.framebufferRenderbuffer(36160,36064+_e,36161,B.__webglColorRenderbuffer[_e]);const ve=i.get(D[_e]).__webglTexture;t.bindFramebuffer(36160,B.__webglFramebuffer),m.framebufferTexture2D(36009,36064+_e,3553,ve,0)}t.bindFramebuffer(36009,B.__webglMultisampledFramebuffer)}}function le(A){return Math.min(r,A.samples)}function fe(A){const D=i.get(A);return s&&A.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function Ee(A){const D=g.render.frame;d.get(A)!==D&&(d.set(A,D),A.update())}function Me(A,D){const te=A.encoding,he=A.format,me=A.type;return A.isCompressedTexture===!0||A.isVideoTexture===!0||A.format===Ua||te!==Gi&&(te===ze?s===!1?e.has("EXT_sRGB")===!0&&he===Bt?(A.format=Ua,A.minFilter=rt,A.generateMipmaps=!1):D=eh.sRGBToLinear(D):(he!==Bt||me!==on)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",te)),D}this.allocateTextureUnit=q,this.resetTextureUnits=j,this.setTexture2D=P,this.setTexture2DArray=R,this.setTexture3D=L,this.setTextureCube=V,this.rebindTextures=$,this.setupRenderTarget=se,this.updateRenderTargetMipmap=oe,this.updateMultisampleRenderTarget=ne,this.setupDepthRenderbuffer=Q,this.setupFrameBufferTexture=J,this.useMultisampledRTT=fe}function vv(m,e,t){const i=t.isWebGL2;function a(u,g=null){let s;if(u===on)return 5121;if(u===Qu)return 32819;if(u===ef)return 32820;if(u===$u)return 5120;if(u===Zu)return 5122;if(u===qc)return 5123;if(u===Ju)return 5124;if(u===tn)return 5125;if(u===Yt)return 5126;if(u===xi)return i?5131:(s=e.get("OES_texture_half_float"),s!==null?s.HALF_FLOAT_OES:null);if(u===tf)return 6406;if(u===Bt)return 6408;if(u===nf)return 6409;if(u===rf)return 6410;if(u===sn)return 6402;if(u===jn)return 34041;if(u===sf)return 6403;if(u===Kc)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(u===Ua)return s=e.get("EXT_sRGB"),s!==null?s.SRGB_ALPHA_EXT:null;if(u===af)return 36244;if(u===of)return 33319;if(u===lf)return 33320;if(u===cf)return 36249;if(u===Xs||u===Ys||u===qs||u===Ks)if(g===ze)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(u===Xs)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(u===Ys)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(u===qs)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(u===Ks)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(u===Xs)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(u===Ys)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(u===qs)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(u===Ks)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(u===Vo||u===Go||u===Ho||u===Wo)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(u===Vo)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(u===Go)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(u===Ho)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(u===Wo)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(u===hf)return s=e.get("WEBGL_compressed_texture_etc1"),s!==null?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(u===jo||u===Xo)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(u===jo)return g===ze?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(u===Xo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(u===Yo||u===qo||u===Ko||u===$o||u===Zo||u===Jo||u===Qo||u===el||u===tl||u===il||u===nl||u===rl||u===sl||u===al)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(u===Yo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(u===qo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(u===Ko)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(u===$o)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(u===Zo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(u===Jo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(u===Qo)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(u===el)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(u===tl)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(u===il)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(u===nl)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(u===rl)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(u===sl)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(u===al)return g===ze?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(u===ol)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(u===ol)return g===ze?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return u===Vn?i?34042:(s=e.get("WEBGL_depth_texture"),s!==null?s.UNSIGNED_INT_24_8_WEBGL:null):m[u]!==void 0?m[u]:null}return{convert:a}}class _v extends vt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class oi extends et{constructor(){super(),this.isGroup=!0,this.type="Group"}}const yv={type:"move"};class Sa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new oi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new oi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new X,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new X),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new oi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new X,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new X),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let a=null,u=null,g=null;const s=this._targetRay,n=this._grip,o=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(s!==null&&(a=t.getPose(e.targetRaySpace,i),a!==null&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(yv))),o&&e.hand){g=!0;for(const p of e.hand.values()){const h=t.getJointPose(p,i);if(o.joints[p.jointName]===void 0){const _=new oi;_.matrixAutoUpdate=!1,_.visible=!1,o.joints[p.jointName]=_,o.add(_)}const v=o.joints[p.jointName];h!==null&&(v.matrix.fromArray(h.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=h.radius),v.visible=h!==null}const f=o.joints["index-finger-tip"],r=o.joints["thumb-tip"],l=f.position.distanceTo(r.position),c=.02,d=.005;o.inputState.pinching&&l>c+d?(o.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!o.inputState.pinching&&l<=c-d&&(o.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else n!==null&&e.gripSpace&&(u=t.getPose(e.gripSpace,i),u!==null&&(n.matrix.fromArray(u.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),u.linearVelocity?(n.hasLinearVelocity=!0,n.linearVelocity.copy(u.linearVelocity)):n.hasLinearVelocity=!1,u.angularVelocity?(n.hasAngularVelocity=!0,n.angularVelocity.copy(u.angularVelocity)):n.hasAngularVelocity=!1));return s!==null&&(s.visible=a!==null),n!==null&&(n.visible=u!==null),o!==null&&(o.visible=g!==null),this}}class xv extends at{constructor(e,t,i,a,u,g,s,n,o,f){if(f=f!==void 0?f:sn,f!==sn&&f!==jn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&f===sn&&(i=tn),i===void 0&&f===jn&&(i=Vn),super(null,a,u,g,s,n,f,i,o),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=s!==void 0?s:mt,this.minFilter=n!==void 0?n:mt,this.flipY=!1,this.generateMipmaps=!1}}class bv extends fn{constructor(e,t){super();const i=this;let a=null,u=1,g=null,s="local-floor",n=null,o=null,f=null,r=null,l=null,c=null;const d=t.getContextAttributes();let p=null,h=null;const v=[],_=new Map,y=new vt;y.layers.enable(1),y.viewport=new Ye;const x=new vt;x.layers.enable(2),x.viewport=new Ye;const b=[y,x],w=new _v;w.layers.enable(1),w.layers.enable(2);let M=null,S=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(T){let P=v[T];return P===void 0&&(P=new Sa,v[T]=P),P.getTargetRaySpace()},this.getControllerGrip=function(T){let P=v[T];return P===void 0&&(P=new Sa,v[T]=P),P.getGripSpace()},this.getHand=function(T){let P=v[T];return P===void 0&&(P=new Sa,v[T]=P),P.getHandSpace()};function C(T){const P=_.get(T.inputSource);P!==void 0&&P.dispatchEvent({type:T.type,data:T.inputSource})}function O(){a.removeEventListener("select",C),a.removeEventListener("selectstart",C),a.removeEventListener("selectend",C),a.removeEventListener("squeeze",C),a.removeEventListener("squeezestart",C),a.removeEventListener("squeezeend",C),a.removeEventListener("end",O),a.removeEventListener("inputsourceschange",k),_.forEach(function(T,P){T!==void 0&&T.disconnect(P)}),_.clear(),M=null,S=null,e.setRenderTarget(p),l=null,r=null,f=null,a=null,h=null,q.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(T){u=T,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(T){s=T,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return n||g},this.setReferenceSpace=function(T){n=T},this.getBaseLayer=function(){return r!==null?r:l},this.getBinding=function(){return f},this.getFrame=function(){return c},this.getSession=function(){return a},this.setSession=async function(T){if(a=T,a!==null){if(p=e.getRenderTarget(),a.addEventListener("select",C),a.addEventListener("selectstart",C),a.addEventListener("selectend",C),a.addEventListener("squeeze",C),a.addEventListener("squeezestart",C),a.addEventListener("squeezeend",C),a.addEventListener("end",O),a.addEventListener("inputsourceschange",k),d.xrCompatible!==!0&&await t.makeXRCompatible(),a.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const P={antialias:a.renderState.layers===void 0?d.antialias:!0,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:u};l=new XRWebGLLayer(a,t,P),a.updateRenderState({baseLayer:l}),h=new li(l.framebufferWidth,l.framebufferHeight,{format:Bt,type:on,encoding:e.outputEncoding})}else{let P=null,R=null,L=null;d.depth&&(L=d.stencil?35056:33190,P=d.stencil?jn:sn,R=d.stencil?Vn:tn);const V={colorFormat:e.outputEncoding===ze?35907:32856,depthFormat:L,scaleFactor:u};f=new XRWebGLBinding(a,t),r=f.createProjectionLayer(V),a.updateRenderState({layers:[r]}),h=new li(r.textureWidth,r.textureHeight,{format:Bt,type:on,depthTexture:new xv(r.textureWidth,r.textureHeight,R,void 0,void 0,void 0,void 0,void 0,void 0,P),stencilBuffer:d.stencil,encoding:e.outputEncoding,samples:d.antialias?4:0});const I=e.properties.get(h);I.__ignoreDepthValues=r.ignoreDepthValues}h.isXRRenderTarget=!0,this.setFoveation(1),n=null,g=await a.requestReferenceSpace(s),q.setContext(a),q.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function k(T){const P=a.inputSources;for(let R=0;R<P.length;R++){const L=P[R].handedness==="right"?1:0;_.set(P[R],v[L])}for(let R=0;R<T.removed.length;R++){const L=T.removed[R],V=_.get(L);V&&(V.dispatchEvent({type:"disconnected",data:L}),_.delete(L))}for(let R=0;R<T.added.length;R++){const L=T.added[R],V=_.get(L);V&&V.dispatchEvent({type:"connected",data:L})}}const Y=new X,H=new X;function N(T,P,R){Y.setFromMatrixPosition(P.matrixWorld),H.setFromMatrixPosition(R.matrixWorld);const L=Y.distanceTo(H),V=P.projectionMatrix.elements,I=R.projectionMatrix.elements,E=V[14]/(V[10]-1),F=V[14]/(V[10]+1),K=(V[9]+1)/V[5],ee=(V[9]-1)/V[5],Z=(V[8]-1)/V[0],J=(I[8]+1)/I[0],ae=E*Z,ue=E*J,Q=L/(-Z+J),$=Q*-Z;P.matrixWorld.decompose(T.position,T.quaternion,T.scale),T.translateX($),T.translateZ(Q),T.matrixWorld.compose(T.position,T.quaternion,T.scale),T.matrixWorldInverse.copy(T.matrixWorld).invert();const se=E+Q,oe=F+Q,ne=ae-$,le=ue+(L-$),fe=K*F/oe*se,Ee=ee*F/oe*se;T.projectionMatrix.makePerspective(ne,le,fe,Ee,se,oe)}function U(T,P){P===null?T.matrixWorld.copy(T.matrix):T.matrixWorld.multiplyMatrices(P.matrixWorld,T.matrix),T.matrixWorldInverse.copy(T.matrixWorld).invert()}this.updateCamera=function(T){if(a===null)return;w.near=x.near=y.near=T.near,w.far=x.far=y.far=T.far,(M!==w.near||S!==w.far)&&(a.updateRenderState({depthNear:w.near,depthFar:w.far}),M=w.near,S=w.far);const P=T.parent,R=w.cameras;U(w,P);for(let V=0;V<R.length;V++)U(R[V],P);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),T.position.copy(w.position),T.quaternion.copy(w.quaternion),T.scale.copy(w.scale),T.matrix.copy(w.matrix),T.matrixWorld.copy(w.matrixWorld);const L=T.children;for(let V=0,I=L.length;V<I;V++)L[V].updateMatrixWorld(!0);R.length===2?N(w,y,x):w.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){if(r!==null)return r.fixedFoveation;if(l!==null)return l.fixedFoveation},this.setFoveation=function(T){r!==null&&(r.fixedFoveation=T),l!==null&&l.fixedFoveation!==void 0&&(l.fixedFoveation=T)};let G=null;function j(T,P){if(o=P.getViewerPose(n||g),c=P,o!==null){const L=o.views;l!==null&&(e.setRenderTargetFramebuffer(h,l.framebuffer),e.setRenderTarget(h));let V=!1;L.length!==w.cameras.length&&(w.cameras.length=0,V=!0);for(let I=0;I<L.length;I++){const E=L[I];let F=null;if(l!==null)F=l.getViewport(E);else{const ee=f.getViewSubImage(r,E);F=ee.viewport,I===0&&(e.setRenderTargetTextures(h,ee.colorTexture,r.ignoreDepthValues?void 0:ee.depthStencilTexture),e.setRenderTarget(h))}let K=b[I];K===void 0&&(K=new vt,K.layers.enable(I),K.viewport=new Ye,b[I]=K),K.matrix.fromArray(E.transform.matrix),K.projectionMatrix.fromArray(E.projectionMatrix),K.viewport.set(F.x,F.y,F.width,F.height),I===0&&w.matrix.copy(K.matrix),V===!0&&w.cameras.push(K)}}const R=a.inputSources;for(let L=0;L<v.length;L++){const V=R[L],I=_.get(V);I!==void 0&&I.update(V,P,n||g)}G&&G(T,P),c=null}const q=new lh;q.setAnimationLoop(j),this.setAnimationLoop=function(T){G=T},this.dispose=function(){}}}function wv(m,e){function t(p,h){p.fogColor.value.copy(h.color),h.isFog?(p.fogNear.value=h.near,p.fogFar.value=h.far):h.isFogExp2&&(p.fogDensity.value=h.density)}function i(p,h,v,_,y){h.isMeshBasicMaterial||h.isMeshLambertMaterial?a(p,h):h.isMeshToonMaterial?(a(p,h),f(p,h)):h.isMeshPhongMaterial?(a(p,h),o(p,h)):h.isMeshStandardMaterial?(a(p,h),r(p,h),h.isMeshPhysicalMaterial&&l(p,h,y)):h.isMeshMatcapMaterial?(a(p,h),c(p,h)):h.isMeshDepthMaterial?a(p,h):h.isMeshDistanceMaterial?(a(p,h),d(p,h)):h.isMeshNormalMaterial?a(p,h):h.isLineBasicMaterial?(u(p,h),h.isLineDashedMaterial&&g(p,h)):h.isPointsMaterial?s(p,h,v,_):h.isSpriteMaterial?n(p,h):h.isShadowMaterial?(p.color.value.copy(h.color),p.opacity.value=h.opacity):h.isShaderMaterial&&(h.uniformsNeedUpdate=!1)}function a(p,h){p.opacity.value=h.opacity,h.color&&p.diffuse.value.copy(h.color),h.emissive&&p.emissive.value.copy(h.emissive).multiplyScalar(h.emissiveIntensity),h.map&&(p.map.value=h.map),h.alphaMap&&(p.alphaMap.value=h.alphaMap),h.bumpMap&&(p.bumpMap.value=h.bumpMap,p.bumpScale.value=h.bumpScale,h.side===Kt&&(p.bumpScale.value*=-1)),h.displacementMap&&(p.displacementMap.value=h.displacementMap,p.displacementScale.value=h.displacementScale,p.displacementBias.value=h.displacementBias),h.emissiveMap&&(p.emissiveMap.value=h.emissiveMap),h.normalMap&&(p.normalMap.value=h.normalMap,p.normalScale.value.copy(h.normalScale),h.side===Kt&&p.normalScale.value.negate()),h.specularMap&&(p.specularMap.value=h.specularMap),h.alphaTest>0&&(p.alphaTest.value=h.alphaTest);const v=e.get(h).envMap;if(v&&(p.envMap.value=v,p.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,p.reflectivity.value=h.reflectivity,p.ior.value=h.ior,p.refractionRatio.value=h.refractionRatio),h.lightMap){p.lightMap.value=h.lightMap;const x=m.physicallyCorrectLights!==!0?Math.PI:1;p.lightMapIntensity.value=h.lightMapIntensity*x}h.aoMap&&(p.aoMap.value=h.aoMap,p.aoMapIntensity.value=h.aoMapIntensity);let _;h.map?_=h.map:h.specularMap?_=h.specularMap:h.displacementMap?_=h.displacementMap:h.normalMap?_=h.normalMap:h.bumpMap?_=h.bumpMap:h.roughnessMap?_=h.roughnessMap:h.metalnessMap?_=h.metalnessMap:h.alphaMap?_=h.alphaMap:h.emissiveMap?_=h.emissiveMap:h.clearcoatMap?_=h.clearcoatMap:h.clearcoatNormalMap?_=h.clearcoatNormalMap:h.clearcoatRoughnessMap?_=h.clearcoatRoughnessMap:h.iridescenceMap?_=h.iridescenceMap:h.iridescenceThicknessMap?_=h.iridescenceThicknessMap:h.specularIntensityMap?_=h.specularIntensityMap:h.specularColorMap?_=h.specularColorMap:h.transmissionMap?_=h.transmissionMap:h.thicknessMap?_=h.thicknessMap:h.sheenColorMap?_=h.sheenColorMap:h.sheenRoughnessMap&&(_=h.sheenRoughnessMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),p.uvTransform.value.copy(_.matrix));let y;h.aoMap?y=h.aoMap:h.lightMap&&(y=h.lightMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),p.uv2Transform.value.copy(y.matrix))}function u(p,h){p.diffuse.value.copy(h.color),p.opacity.value=h.opacity}function g(p,h){p.dashSize.value=h.dashSize,p.totalSize.value=h.dashSize+h.gapSize,p.scale.value=h.scale}function s(p,h,v,_){p.diffuse.value.copy(h.color),p.opacity.value=h.opacity,p.size.value=h.size*v,p.scale.value=_*.5,h.map&&(p.map.value=h.map),h.alphaMap&&(p.alphaMap.value=h.alphaMap),h.alphaTest>0&&(p.alphaTest.value=h.alphaTest);let y;h.map?y=h.map:h.alphaMap&&(y=h.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),p.uvTransform.value.copy(y.matrix))}function n(p,h){p.diffuse.value.copy(h.color),p.opacity.value=h.opacity,p.rotation.value=h.rotation,h.map&&(p.map.value=h.map),h.alphaMap&&(p.alphaMap.value=h.alphaMap),h.alphaTest>0&&(p.alphaTest.value=h.alphaTest);let v;h.map?v=h.map:h.alphaMap&&(v=h.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),p.uvTransform.value.copy(v.matrix))}function o(p,h){p.specular.value.copy(h.specular),p.shininess.value=Math.max(h.shininess,1e-4)}function f(p,h){h.gradientMap&&(p.gradientMap.value=h.gradientMap)}function r(p,h){p.roughness.value=h.roughness,p.metalness.value=h.metalness,h.roughnessMap&&(p.roughnessMap.value=h.roughnessMap),h.metalnessMap&&(p.metalnessMap.value=h.metalnessMap),e.get(h).envMap&&(p.envMapIntensity.value=h.envMapIntensity)}function l(p,h,v){p.ior.value=h.ior,h.sheen>0&&(p.sheenColor.value.copy(h.sheenColor).multiplyScalar(h.sheen),p.sheenRoughness.value=h.sheenRoughness,h.sheenColorMap&&(p.sheenColorMap.value=h.sheenColorMap),h.sheenRoughnessMap&&(p.sheenRoughnessMap.value=h.sheenRoughnessMap)),h.clearcoat>0&&(p.clearcoat.value=h.clearcoat,p.clearcoatRoughness.value=h.clearcoatRoughness,h.clearcoatMap&&(p.clearcoatMap.value=h.clearcoatMap),h.clearcoatRoughnessMap&&(p.clearcoatRoughnessMap.value=h.clearcoatRoughnessMap),h.clearcoatNormalMap&&(p.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),p.clearcoatNormalMap.value=h.clearcoatNormalMap,h.side===Kt&&p.clearcoatNormalScale.value.negate())),h.iridescence>0&&(p.iridescence.value=h.iridescence,p.iridescenceIOR.value=h.iridescenceIOR,p.iridescenceThicknessMinimum.value=h.iridescenceThicknessRange[0],p.iridescenceThicknessMaximum.value=h.iridescenceThicknessRange[1],h.iridescenceMap&&(p.iridescenceMap.value=h.iridescenceMap),h.iridescenceThicknessMap&&(p.iridescenceThicknessMap.value=h.iridescenceThicknessMap)),h.transmission>0&&(p.transmission.value=h.transmission,p.transmissionSamplerMap.value=v.texture,p.transmissionSamplerSize.value.set(v.width,v.height),h.transmissionMap&&(p.transmissionMap.value=h.transmissionMap),p.thickness.value=h.thickness,h.thicknessMap&&(p.thicknessMap.value=h.thicknessMap),p.attenuationDistance.value=h.attenuationDistance,p.attenuationColor.value.copy(h.attenuationColor)),p.specularIntensity.value=h.specularIntensity,p.specularColor.value.copy(h.specularColor),h.specularIntensityMap&&(p.specularIntensityMap.value=h.specularIntensityMap),h.specularColorMap&&(p.specularColorMap.value=h.specularColorMap)}function c(p,h){h.matcap&&(p.matcap.value=h.matcap)}function d(p,h){p.referencePosition.value.copy(h.referencePosition),p.nearDistance.value=h.nearDistance,p.farDistance.value=h.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:i}}function Sv(){const m=Dr("canvas");return m.style.display="block",m}function gh(m={}){this.isWebGLRenderer=!0;const e=m.canvas!==void 0?m.canvas:Sv(),t=m.context!==void 0?m.context:null,i=m.depth!==void 0?m.depth:!0,a=m.stencil!==void 0?m.stencil:!0,u=m.antialias!==void 0?m.antialias:!1,g=m.premultipliedAlpha!==void 0?m.premultipliedAlpha:!0,s=m.preserveDrawingBuffer!==void 0?m.preserveDrawingBuffer:!1,n=m.powerPreference!==void 0?m.powerPreference:"default",o=m.failIfMajorPerformanceCaveat!==void 0?m.failIfMajorPerformanceCaveat:!1;let f;t!==null?f=t.getContextAttributes().alpha:f=m.alpha!==void 0?m.alpha:!1;let r=null,l=null;const c=[],d=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Gi,this.physicallyCorrectLights=!1,this.toneMapping=$t,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const p=this;let h=!1,v=0,_=0,y=null,x=-1,b=null;const w=new Ye,M=new Ye;let S=null,C=e.width,O=e.height,k=1,Y=null,H=null;const N=new Ye(0,0,C,O),U=new Ye(0,0,C,O);let G=!1;const j=new oo;let q=!1,T=!1,P=null;const R=new Le,L=new De,V=new X,I={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function E(){return y===null?k:1}let F=t;function K(z,ie){for(let ce=0;ce<z.length;ce++){const re=z[ce],pe=e.getContext(re,ie);if(pe!==null)return pe}return null}try{const z={alpha:!0,depth:i,stencil:a,antialias:u,premultipliedAlpha:g,preserveDrawingBuffer:s,powerPreference:n,failIfMajorPerformanceCaveat:o};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${no}`),e.addEventListener("webglcontextlost",W,!1),e.addEventListener("webglcontextrestored",ye,!1),e.addEventListener("webglcontextcreationerror",xe,!1),F===null){const ie=["webgl2","webgl","experimental-webgl"];if(p.isWebGL1Renderer===!0&&ie.shift(),F=K(ie,z),F===null)throw K(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}F.getShaderPrecisionFormat===void 0&&(F.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(z){throw console.error("THREE.WebGLRenderer: "+z.message),z}let ee,Z,J,ae,ue,Q,$,se,oe,ne,le,fe,Ee,Me,A,D,te,he,me,ge,Ce,B,de;function _e(){ee=new km(F),Z=new Pm(F,ee,m),ee.init(Z),B=new vv(F,ee,Z),J=new mv(F,ee,Z),ae=new zm,ue=new nv,Q=new gv(F,ee,J,ue,Z,B,ae),$=new Rm(p),se=new Fm(p),oe=new Zf(F,Z),de=new Am(F,ee,oe,Z),ne=new Bm(F,oe,ae,de),le=new Hm(F,ne,oe,ae),me=new Gm(F,Z,Q),D=new Dm(ue),fe=new iv(p,$,se,ee,Z,de,D),Ee=new wv(p,ue),Me=new sv,A=new uv(ee,Z),he=new Em(p,$,J,le,f,g),te=new pv(p,le,Z),ge=new Lm(F,ee,ae,Z),Ce=new Nm(F,ee,ae,Z),ae.programs=fe.programs,p.capabilities=Z,p.extensions=ee,p.properties=ue,p.renderLists=Me,p.shadowMap=te,p.state=J,p.info=ae}_e();const ve=new bv(p,F);this.xr=ve,this.getContext=function(){return F},this.getContextAttributes=function(){return F.getContextAttributes()},this.forceContextLoss=function(){const z=ee.get("WEBGL_lose_context");z&&z.loseContext()},this.forceContextRestore=function(){const z=ee.get("WEBGL_lose_context");z&&z.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(z){z!==void 0&&(k=z,this.setSize(C,O,!1))},this.getSize=function(z){return z.set(C,O)},this.setSize=function(z,ie,ce){if(ve.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}C=z,O=ie,e.width=Math.floor(z*k),e.height=Math.floor(ie*k),ce!==!1&&(e.style.width=z+"px",e.style.height=ie+"px"),this.setViewport(0,0,z,ie)},this.getDrawingBufferSize=function(z){return z.set(C*k,O*k).floor()},this.setDrawingBufferSize=function(z,ie,ce){C=z,O=ie,k=ce,e.width=Math.floor(z*ce),e.height=Math.floor(ie*ce),this.setViewport(0,0,z,ie)},this.getCurrentViewport=function(z){return z.copy(w)},this.getViewport=function(z){return z.copy(N)},this.setViewport=function(z,ie,ce,re){z.isVector4?N.set(z.x,z.y,z.z,z.w):N.set(z,ie,ce,re),J.viewport(w.copy(N).multiplyScalar(k).floor())},this.getScissor=function(z){return z.copy(U)},this.setScissor=function(z,ie,ce,re){z.isVector4?U.set(z.x,z.y,z.z,z.w):U.set(z,ie,ce,re),J.scissor(M.copy(U).multiplyScalar(k).floor())},this.getScissorTest=function(){return G},this.setScissorTest=function(z){J.setScissorTest(G=z)},this.setOpaqueSort=function(z){Y=z},this.setTransparentSort=function(z){H=z},this.getClearColor=function(z){return z.copy(he.getClearColor())},this.setClearColor=function(){he.setClearColor.apply(he,arguments)},this.getClearAlpha=function(){return he.getClearAlpha()},this.setClearAlpha=function(){he.setClearAlpha.apply(he,arguments)},this.clear=function(z=!0,ie=!0,ce=!0){let re=0;z&&(re|=16384),ie&&(re|=256),ce&&(re|=1024),F.clear(re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",W,!1),e.removeEventListener("webglcontextrestored",ye,!1),e.removeEventListener("webglcontextcreationerror",xe,!1),Me.dispose(),A.dispose(),ue.dispose(),$.dispose(),se.dispose(),le.dispose(),de.dispose(),fe.dispose(),ve.dispose(),ve.removeEventListener("sessionstart",qe),ve.removeEventListener("sessionend",Ke),P&&(P.dispose(),P=null),yt.stop()};function W(z){z.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),h=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),h=!1;const z=ae.autoReset,ie=te.enabled,ce=te.autoUpdate,re=te.needsUpdate,pe=te.type;_e(),ae.autoReset=z,te.enabled=ie,te.autoUpdate=ce,te.needsUpdate=re,te.type=pe}function xe(z){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",z.statusMessage)}function Pe(z){const ie=z.target;ie.removeEventListener("dispose",Pe),Se(ie)}function Se(z){Ae(z),ue.remove(z)}function Ae(z){const ie=ue.get(z).programs;ie!==void 0&&(ie.forEach(function(ce){fe.releaseProgram(ce)}),z.isShaderMaterial&&fe.releaseShaderCache(z))}this.renderBufferDirect=function(z,ie,ce,re,pe,Re){ie===null&&(ie=I);const Ie=pe.isMesh&&pe.matrixWorld.determinant()<0,ke=_u(z,ie,ce,re,pe);J.setMaterial(re,Ie);let Fe=ce.index;const $e=ce.attributes.position;if(Fe===null){if($e===void 0||$e.count===0)return}else if(Fe.count===0)return;let Ge=1;re.wireframe===!0&&(Fe=ne.getWireframeAttribute(ce),Ge=2),de.setup(pe,re,ke,ce,Fe);let We,tt=ge;Fe!==null&&(We=oe.get(Fe),tt=Ce,tt.setIndex(We));const Yi=Fe!==null?Fe.count:$e.count,pn=ce.drawRange.start*Ge,mn=ce.drawRange.count*Ge,ei=Re!==null?Re.start*Ge:0,je=Re!==null?Re.count*Ge:1/0,gn=Math.max(pn,ei),ot=Math.min(Yi,pn+mn,ei+je)-1,ti=Math.max(0,ot-gn+1);if(ti!==0){if(pe.isMesh)re.wireframe===!0?(J.setLineWidth(re.wireframeLinewidth*E()),tt.setMode(1)):tt.setMode(4);else if(pe.isLine){let Ei=re.linewidth;Ei===void 0&&(Ei=1),J.setLineWidth(Ei*E()),pe.isLineSegments?tt.setMode(1):pe.isLineLoop?tt.setMode(2):tt.setMode(3)}else pe.isPoints?tt.setMode(0):pe.isSprite&&tt.setMode(4);if(pe.isInstancedMesh)tt.renderInstances(gn,ti,pe.count);else if(ce.isInstancedBufferGeometry){const Ei=Math.min(ce.instanceCount,ce._maxInstanceCount);tt.renderInstances(gn,ti,Ei)}else tt.render(gn,ti)}},this.compile=function(z,ie){l=A.get(z),l.init(),d.push(l),z.traverseVisible(function(ce){ce.isLight&&ce.layers.test(ie.layers)&&(l.pushLight(ce),ce.castShadow&&l.pushShadow(ce))}),l.setupLights(p.physicallyCorrectLights),z.traverse(function(ce){const re=ce.material;if(re)if(Array.isArray(re))for(let pe=0;pe<re.length;pe++){const Re=re[pe];Hs(Re,z,ce)}else Hs(re,z,ce)}),d.pop(),l=null};let be=null;function Oe(z){be&&be(z)}function qe(){yt.stop()}function Ke(){yt.start()}const yt=new lh;yt.setAnimationLoop(Oe),typeof self!="undefined"&&yt.setContext(self),this.setAnimationLoop=function(z){be=z,ve.setAnimationLoop(z),z===null?yt.stop():yt.start()},ve.addEventListener("sessionstart",qe),ve.addEventListener("sessionend",Ke),this.render=function(z,ie){if(ie!==void 0&&ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(h===!0)return;z.autoUpdate===!0&&z.updateMatrixWorld(),ie.parent===null&&ie.updateMatrixWorld(),ve.enabled===!0&&ve.isPresenting===!0&&(ve.cameraAutoUpdate===!0&&ve.updateCamera(ie),ie=ve.getCamera()),z.isScene===!0&&z.onBeforeRender(p,z,ie,y),l=A.get(z,d.length),l.init(),d.push(l),R.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),j.setFromProjectionMatrix(R),T=this.localClippingEnabled,q=D.init(this.clippingPlanes,T,ie),r=Me.get(z,c.length),r.init(),c.push(r),Qt(z,ie,0,p.sortObjects),r.finish(),p.sortObjects===!0&&r.sort(Y,H),q===!0&&D.beginShadows();const ce=l.state.shadowsArray;if(te.render(ce,z,ie),q===!0&&D.endShadows(),this.info.autoReset===!0&&this.info.reset(),he.render(r,z),l.setupLights(p.physicallyCorrectLights),ie.isArrayCamera){const re=ie.cameras;for(let pe=0,Re=re.length;pe<Re;pe++){const Ie=re[pe];Ro(r,z,Ie,Ie.viewport)}}else Ro(r,z,ie);y!==null&&(Q.updateMultisampleRenderTarget(y),Q.updateRenderTargetMipmap(y)),z.isScene===!0&&z.onAfterRender(p,z,ie),de.resetDefaultState(),x=-1,b=null,d.pop(),d.length>0?l=d[d.length-1]:l=null,c.pop(),c.length>0?r=c[c.length-1]:r=null};function Qt(z,ie,ce,re){if(z.visible===!1)return;if(z.layers.test(ie.layers)){if(z.isGroup)ce=z.renderOrder;else if(z.isLOD)z.autoUpdate===!0&&z.update(ie);else if(z.isLight)l.pushLight(z),z.castShadow&&l.pushShadow(z);else if(z.isSprite){if(!z.frustumCulled||j.intersectsSprite(z)){re&&V.setFromMatrixPosition(z.matrixWorld).applyMatrix4(R);const Ie=le.update(z),ke=z.material;ke.visible&&r.push(z,Ie,ke,ce,V.z,null)}}else if((z.isMesh||z.isLine||z.isPoints)&&(z.isSkinnedMesh&&z.skeleton.frame!==ae.render.frame&&(z.skeleton.update(),z.skeleton.frame=ae.render.frame),!z.frustumCulled||j.intersectsObject(z))){re&&V.setFromMatrixPosition(z.matrixWorld).applyMatrix4(R);const Ie=le.update(z),ke=z.material;if(Array.isArray(ke)){const Fe=Ie.groups;for(let $e=0,Ge=Fe.length;$e<Ge;$e++){const We=Fe[$e],tt=ke[We.materialIndex];tt&&tt.visible&&r.push(z,Ie,tt,ce,V.z,We)}}else ke.visible&&r.push(z,Ie,ke,ce,V.z,null)}}const Re=z.children;for(let Ie=0,ke=Re.length;Ie<ke;Ie++)Qt(Re[Ie],ie,ce,re)}function Ro(z,ie,ce,re){const pe=z.opaque,Re=z.transmissive,Ie=z.transparent;l.setupLightsView(ce),Re.length>0&&gu(pe,ie,ce),re&&J.viewport(w.copy(re)),pe.length>0&&Wr(pe,ie,ce),Re.length>0&&Wr(Re,ie,ce),Ie.length>0&&Wr(Ie,ie,ce),J.buffers.depth.setTest(!0),J.buffers.depth.setMask(!0),J.buffers.color.setMask(!0),J.setPolygonOffset(!1)}function gu(z,ie,ce){const re=Z.isWebGL2;P===null&&(P=new li(1,1,{generateMipmaps:!0,type:ee.has("EXT_color_buffer_half_float")?xi:on,minFilter:hn,samples:re&&u===!0?4:0})),p.getDrawingBufferSize(L),re?P.setSize(L.x,L.y):P.setSize(Cs(L.x),Cs(L.y));const pe=p.getRenderTarget();p.setRenderTarget(P),p.clear();const Re=p.toneMapping;p.toneMapping=$t,Wr(z,ie,ce),p.toneMapping=Re,Q.updateMultisampleRenderTarget(P),Q.updateRenderTargetMipmap(P),p.setRenderTarget(pe)}function Wr(z,ie,ce){const re=ie.isScene===!0?ie.overrideMaterial:null;for(let pe=0,Re=z.length;pe<Re;pe++){const Ie=z[pe],ke=Ie.object,Fe=Ie.geometry,$e=re===null?Ie.material:re,Ge=Ie.group;ke.layers.test(ce.layers)&&vu(ke,ie,ce,Fe,$e,Ge)}}function vu(z,ie,ce,re,pe,Re){z.onBeforeRender(p,ie,ce,re,pe,Re),z.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,z.matrixWorld),z.normalMatrix.getNormalMatrix(z.modelViewMatrix),pe.onBeforeRender(p,ie,ce,re,z,Re),pe.transparent===!0&&pe.side===Si?(pe.side=Kt,pe.needsUpdate=!0,p.renderBufferDirect(ce,ie,re,pe,z,Re),pe.side=Gn,pe.needsUpdate=!0,p.renderBufferDirect(ce,ie,re,pe,z,Re),pe.side=Si):p.renderBufferDirect(ce,ie,re,pe,z,Re),z.onAfterRender(p,ie,ce,re,pe,Re)}function Hs(z,ie,ce){ie.isScene!==!0&&(ie=I);const re=ue.get(z),pe=l.state.lights,Re=l.state.shadowsArray,Ie=pe.state.version,ke=fe.getParameters(z,pe.state,Re,ie,ce),Fe=fe.getProgramCacheKey(ke);let $e=re.programs;re.environment=z.isMeshStandardMaterial?ie.environment:null,re.fog=ie.fog,re.envMap=(z.isMeshStandardMaterial?se:$).get(z.envMap||re.environment),$e===void 0&&(z.addEventListener("dispose",Pe),$e=new Map,re.programs=$e);let Ge=$e.get(Fe);if(Ge!==void 0){if(re.currentProgram===Ge&&re.lightsStateVersion===Ie)return Oo(z,ke),Ge}else ke.uniforms=fe.getUniforms(z),z.onBuild(ce,ke,p),z.onBeforeCompile(ke,p),Ge=fe.acquireProgram(ke,Fe),$e.set(Fe,Ge),re.uniforms=ke.uniforms;const We=re.uniforms;(!z.isShaderMaterial&&!z.isRawShaderMaterial||z.clipping===!0)&&(We.clippingPlanes=D.uniform),Oo(z,ke),re.needsLights=xu(z),re.lightsStateVersion=Ie,re.needsLights&&(We.ambientLightColor.value=pe.state.ambient,We.lightProbe.value=pe.state.probe,We.directionalLights.value=pe.state.directional,We.directionalLightShadows.value=pe.state.directionalShadow,We.spotLights.value=pe.state.spot,We.spotLightShadows.value=pe.state.spotShadow,We.rectAreaLights.value=pe.state.rectArea,We.ltc_1.value=pe.state.rectAreaLTC1,We.ltc_2.value=pe.state.rectAreaLTC2,We.pointLights.value=pe.state.point,We.pointLightShadows.value=pe.state.pointShadow,We.hemisphereLights.value=pe.state.hemi,We.directionalShadowMap.value=pe.state.directionalShadowMap,We.directionalShadowMatrix.value=pe.state.directionalShadowMatrix,We.spotShadowMap.value=pe.state.spotShadowMap,We.spotShadowMatrix.value=pe.state.spotShadowMatrix,We.pointShadowMap.value=pe.state.pointShadowMap,We.pointShadowMatrix.value=pe.state.pointShadowMatrix);const tt=Ge.getUniforms(),Yi=ys.seqWithValue(tt.seq,We);return re.currentProgram=Ge,re.uniformsList=Yi,Ge}function Oo(z,ie){const ce=ue.get(z);ce.outputEncoding=ie.outputEncoding,ce.instancing=ie.instancing,ce.skinning=ie.skinning,ce.morphTargets=ie.morphTargets,ce.morphNormals=ie.morphNormals,ce.morphColors=ie.morphColors,ce.morphTargetsCount=ie.morphTargetsCount,ce.numClippingPlanes=ie.numClippingPlanes,ce.numIntersection=ie.numClipIntersection,ce.vertexAlphas=ie.vertexAlphas,ce.vertexTangents=ie.vertexTangents,ce.toneMapping=ie.toneMapping}function _u(z,ie,ce,re,pe){ie.isScene!==!0&&(ie=I),Q.resetTextureUnits();const Re=ie.fog,Ie=re.isMeshStandardMaterial?ie.environment:null,ke=y===null?p.outputEncoding:y.isXRRenderTarget===!0?y.texture.encoding:Gi,Fe=(re.isMeshStandardMaterial?se:$).get(re.envMap||Ie),$e=re.vertexColors===!0&&!!ce.attributes.color&&ce.attributes.color.itemSize===4,Ge=!!re.normalMap&&!!ce.attributes.tangent,We=!!ce.morphAttributes.position,tt=!!ce.morphAttributes.normal,Yi=!!ce.morphAttributes.color,pn=re.toneMapped?p.toneMapping:$t,mn=ce.morphAttributes.position||ce.morphAttributes.normal||ce.morphAttributes.color,ei=mn!==void 0?mn.length:0,je=ue.get(re),gn=l.state.lights;if(q===!0&&(T===!0||z!==b)){const ii=z===b&&re.id===x;D.setState(re,z,ii)}let ot=!1;re.version===je.__version?(je.needsLights&&je.lightsStateVersion!==gn.state.version||je.outputEncoding!==ke||pe.isInstancedMesh&&je.instancing===!1||!pe.isInstancedMesh&&je.instancing===!0||pe.isSkinnedMesh&&je.skinning===!1||!pe.isSkinnedMesh&&je.skinning===!0||je.envMap!==Fe||re.fog===!0&&je.fog!==Re||je.numClippingPlanes!==void 0&&(je.numClippingPlanes!==D.numPlanes||je.numIntersection!==D.numIntersection)||je.vertexAlphas!==$e||je.vertexTangents!==Ge||je.morphTargets!==We||je.morphNormals!==tt||je.morphColors!==Yi||je.toneMapping!==pn||Z.isWebGL2===!0&&je.morphTargetsCount!==ei)&&(ot=!0):(ot=!0,je.__version=re.version);let ti=je.currentProgram;ot===!0&&(ti=Hs(re,ie,pe));let Ei=!1,pr=!1,Ws=!1;const xt=ti.getUniforms(),mr=je.uniforms;if(J.useProgram(ti.program)&&(Ei=!0,pr=!0,Ws=!0),re.id!==x&&(x=re.id,pr=!0),Ei||b!==z){if(xt.setValue(F,"projectionMatrix",z.projectionMatrix),Z.logarithmicDepthBuffer&&xt.setValue(F,"logDepthBufFC",2/(Math.log(z.far+1)/Math.LN2)),b!==z&&(b=z,pr=!0,Ws=!0),re.isShaderMaterial||re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshStandardMaterial||re.envMap){const ii=xt.map.cameraPosition;ii!==void 0&&ii.setValue(F,V.setFromMatrixPosition(z.matrixWorld))}(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial)&&xt.setValue(F,"isOrthographic",z.isOrthographicCamera===!0),(re.isMeshPhongMaterial||re.isMeshToonMaterial||re.isMeshLambertMaterial||re.isMeshBasicMaterial||re.isMeshStandardMaterial||re.isShaderMaterial||re.isShadowMaterial||pe.isSkinnedMesh)&&xt.setValue(F,"viewMatrix",z.matrixWorldInverse)}if(pe.isSkinnedMesh){xt.setOptional(F,pe,"bindMatrix"),xt.setOptional(F,pe,"bindMatrixInverse");const ii=pe.skeleton;ii&&(Z.floatVertexTextures?(ii.boneTexture===null&&ii.computeBoneTexture(),xt.setValue(F,"boneTexture",ii.boneTexture,Q),xt.setValue(F,"boneTextureSize",ii.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const js=ce.morphAttributes;return(js.position!==void 0||js.normal!==void 0||js.color!==void 0&&Z.isWebGL2===!0)&&me.update(pe,ce,re,ti),(pr||je.receiveShadow!==pe.receiveShadow)&&(je.receiveShadow=pe.receiveShadow,xt.setValue(F,"receiveShadow",pe.receiveShadow)),pr&&(xt.setValue(F,"toneMappingExposure",p.toneMappingExposure),je.needsLights&&yu(mr,Ws),Re&&re.fog===!0&&Ee.refreshFogUniforms(mr,Re),Ee.refreshMaterialUniforms(mr,re,k,O,P),ys.upload(F,je.uniformsList,mr,Q)),re.isShaderMaterial&&re.uniformsNeedUpdate===!0&&(ys.upload(F,je.uniformsList,mr,Q),re.uniformsNeedUpdate=!1),re.isSpriteMaterial&&xt.setValue(F,"center",pe.center),xt.setValue(F,"modelViewMatrix",pe.modelViewMatrix),xt.setValue(F,"normalMatrix",pe.normalMatrix),xt.setValue(F,"modelMatrix",pe.matrixWorld),ti}function yu(z,ie){z.ambientLightColor.needsUpdate=ie,z.lightProbe.needsUpdate=ie,z.directionalLights.needsUpdate=ie,z.directionalLightShadows.needsUpdate=ie,z.pointLights.needsUpdate=ie,z.pointLightShadows.needsUpdate=ie,z.spotLights.needsUpdate=ie,z.spotLightShadows.needsUpdate=ie,z.rectAreaLights.needsUpdate=ie,z.hemisphereLights.needsUpdate=ie}function xu(z){return z.isMeshLambertMaterial||z.isMeshToonMaterial||z.isMeshPhongMaterial||z.isMeshStandardMaterial||z.isShadowMaterial||z.isShaderMaterial&&z.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(z,ie,ce){ue.get(z.texture).__webglTexture=ie,ue.get(z.depthTexture).__webglTexture=ce;const re=ue.get(z);re.__hasExternalTextures=!0,re.__hasExternalTextures&&(re.__autoAllocateDepthBuffer=ce===void 0,re.__autoAllocateDepthBuffer||ee.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),re.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(z,ie){const ce=ue.get(z);ce.__webglFramebuffer=ie,ce.__useDefaultFramebuffer=ie===void 0},this.setRenderTarget=function(z,ie=0,ce=0){y=z,v=ie,_=ce;let re=!0;if(z){const Fe=ue.get(z);Fe.__useDefaultFramebuffer!==void 0?(J.bindFramebuffer(36160,null),re=!1):Fe.__webglFramebuffer===void 0?Q.setupRenderTarget(z):Fe.__hasExternalTextures&&Q.rebindTextures(z,ue.get(z.texture).__webglTexture,ue.get(z.depthTexture).__webglTexture)}let pe=null,Re=!1,Ie=!1;if(z){const Fe=z.texture;(Fe.isData3DTexture||Fe.isDataArrayTexture)&&(Ie=!0);const $e=ue.get(z).__webglFramebuffer;z.isWebGLCubeRenderTarget?(pe=$e[ie],Re=!0):Z.isWebGL2&&z.samples>0&&Q.useMultisampledRTT(z)===!1?pe=ue.get(z).__webglMultisampledFramebuffer:pe=$e,w.copy(z.viewport),M.copy(z.scissor),S=z.scissorTest}else w.copy(N).multiplyScalar(k).floor(),M.copy(U).multiplyScalar(k).floor(),S=G;if(J.bindFramebuffer(36160,pe)&&Z.drawBuffers&&re&&J.drawBuffers(z,pe),J.viewport(w),J.scissor(M),J.setScissorTest(S),Re){const Fe=ue.get(z.texture);F.framebufferTexture2D(36160,36064,34069+ie,Fe.__webglTexture,ce)}else if(Ie){const Fe=ue.get(z.texture),$e=ie||0;F.framebufferTextureLayer(36160,36064,Fe.__webglTexture,ce||0,$e)}x=-1},this.readRenderTargetPixels=function(z,ie,ce,re,pe,Re,Ie){if(!(z&&z.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ke=ue.get(z).__webglFramebuffer;if(z.isWebGLCubeRenderTarget&&Ie!==void 0&&(ke=ke[Ie]),ke){J.bindFramebuffer(36160,ke);try{const Fe=z.texture,$e=Fe.format,Ge=Fe.type;if($e!==Bt&&B.convert($e)!==F.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const We=Ge===xi&&(ee.has("EXT_color_buffer_half_float")||Z.isWebGL2&&ee.has("EXT_color_buffer_float"));if(Ge!==on&&B.convert(Ge)!==F.getParameter(35738)&&!(Ge===Yt&&(Z.isWebGL2||ee.has("OES_texture_float")||ee.has("WEBGL_color_buffer_float")))&&!We){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ie>=0&&ie<=z.width-re&&ce>=0&&ce<=z.height-pe&&F.readPixels(ie,ce,re,pe,B.convert($e),B.convert(Ge),Re)}finally{const Fe=y!==null?ue.get(y).__webglFramebuffer:null;J.bindFramebuffer(36160,Fe)}}},this.copyFramebufferToTexture=function(z,ie,ce=0){const re=Math.pow(2,-ce),pe=Math.floor(ie.image.width*re),Re=Math.floor(ie.image.height*re);Q.setTexture2D(ie,0),F.copyTexSubImage2D(3553,ce,0,0,z.x,z.y,pe,Re),J.unbindTexture()},this.copyTextureToTexture=function(z,ie,ce,re=0){const pe=ie.image.width,Re=ie.image.height,Ie=B.convert(ce.format),ke=B.convert(ce.type);Q.setTexture2D(ce,0),F.pixelStorei(37440,ce.flipY),F.pixelStorei(37441,ce.premultiplyAlpha),F.pixelStorei(3317,ce.unpackAlignment),ie.isDataTexture?F.texSubImage2D(3553,re,z.x,z.y,pe,Re,Ie,ke,ie.image.data):ie.isCompressedTexture?F.compressedTexSubImage2D(3553,re,z.x,z.y,ie.mipmaps[0].width,ie.mipmaps[0].height,Ie,ie.mipmaps[0].data):F.texSubImage2D(3553,re,z.x,z.y,Ie,ke,ie.image),re===0&&ce.generateMipmaps&&F.generateMipmap(3553),J.unbindTexture()},this.copyTextureToTexture3D=function(z,ie,ce,re,pe=0){if(p.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Re=z.max.x-z.min.x+1,Ie=z.max.y-z.min.y+1,ke=z.max.z-z.min.z+1,Fe=B.convert(re.format),$e=B.convert(re.type);let Ge;if(re.isData3DTexture)Q.setTexture3D(re,0),Ge=32879;else if(re.isDataArrayTexture)Q.setTexture2DArray(re,0),Ge=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}F.pixelStorei(37440,re.flipY),F.pixelStorei(37441,re.premultiplyAlpha),F.pixelStorei(3317,re.unpackAlignment);const We=F.getParameter(3314),tt=F.getParameter(32878),Yi=F.getParameter(3316),pn=F.getParameter(3315),mn=F.getParameter(32877),ei=ce.isCompressedTexture?ce.mipmaps[0]:ce.image;F.pixelStorei(3314,ei.width),F.pixelStorei(32878,ei.height),F.pixelStorei(3316,z.min.x),F.pixelStorei(3315,z.min.y),F.pixelStorei(32877,z.min.z),ce.isDataTexture||ce.isData3DTexture?F.texSubImage3D(Ge,pe,ie.x,ie.y,ie.z,Re,Ie,ke,Fe,$e,ei.data):ce.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),F.compressedTexSubImage3D(Ge,pe,ie.x,ie.y,ie.z,Re,Ie,ke,Fe,ei.data)):F.texSubImage3D(Ge,pe,ie.x,ie.y,ie.z,Re,Ie,ke,Fe,$e,ei),F.pixelStorei(3314,We),F.pixelStorei(32878,tt),F.pixelStorei(3316,Yi),F.pixelStorei(3315,pn),F.pixelStorei(32877,mn),pe===0&&re.generateMipmaps&&F.generateMipmap(Ge),J.unbindTexture()},this.initTexture=function(z){Q.setTexture2D(z,0),J.unbindTexture()},this.resetState=function(){v=0,_=0,y=null,J.reset(),de.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Mv extends gh{}Mv.prototype.isWebGL1Renderer=!0;class Tv extends et{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}}class Cv{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=za,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Zt()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let a=0,u=this.stride;a<u;a++)this.array[e+a]=t.array[i+a];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Zt()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const bt=new X;class ho{constructor(e,t,i,a=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=a===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)bt.fromBufferAttribute(this,t),bt.applyMatrix4(e),this.setXYZ(t,bt.x,bt.y,bt.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)bt.fromBufferAttribute(this,t),bt.applyNormalMatrix(e),this.setXYZ(t,bt.x,bt.y,bt.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)bt.fromBufferAttribute(this,t),bt.transformDirection(e),this.setXYZ(t,bt.x,bt.y,bt.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=a,this}setXYZW(e,t,i,a,u){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=a,this.data.array[e+3]=u,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const a=i*this.data.stride+this.offset;for(let u=0;u<this.itemSize;u++)t.push(this.data.array[a+u])}return new Tt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ho(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const a=i*this.data.stride+this.offset;for(let u=0;u<this.itemSize;u++)t.push(this.data.array[a+u])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ev extends it{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Te(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Xl=new X,Yl=new Ye,ql=new Ye,Av=new X,Kl=new Le;class vh extends Mt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Le,this.bindMatrixInverse=new Le}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ye,t=this.geometry.attributes.skinWeight;for(let i=0,a=t.count;i<a;i++){e.fromBufferAttribute(t,i);const u=1/e.manhattanLength();u!==1/0?e.multiplyScalar(u):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,a=this.geometry;Yl.fromBufferAttribute(a.attributes.skinIndex,e),ql.fromBufferAttribute(a.attributes.skinWeight,e),Xl.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let u=0;u<4;u++){const g=ql.getComponent(u);if(g!==0){const s=Yl.getComponent(u);Kl.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(Av.copy(Xl).applyMatrix4(Kl),g)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Es extends et{constructor(){super(),this.isBone=!0,this.type="Bone"}}class _h extends at{constructor(e=null,t=1,i=1,a,u,g,s,n,o=mt,f=mt,r,l){super(null,g,s,n,o,f,a,u,r,l),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const $l=new Le,Lv=new Le;class Ns{constructor(e=[],t=[]){this.uuid=Zt(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,a=this.bones.length;i<a;i++)this.boneInverses.push(new Le)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Le;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,a=this.boneTexture;for(let u=0,g=e.length;u<g;u++){const s=e[u]?e[u].matrixWorld:Lv;$l.multiplyMatrices(s,t[u]),$l.toArray(i,u*16)}a!==null&&(a.needsUpdate=!0)}clone(){return new Ns(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Zc(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new _h(t,e,e,Bt,Yt);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const a=this.bones[t];if(a.name===e)return a}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,a=e.bones.length;i<a;i++){const u=e.bones[i];let g=t[u];g===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",u),g=new Es),this.bones.push(g),this.boneInverses.push(new Le().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let a=0,u=t.length;a<u;a++){const g=t[a];e.bones.push(g.uuid);const s=i[a];e.boneInverses.push(s.toArray())}return e}}class zi extends it{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Te(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Zl=new X,Jl=new X,Ql=new Le,Ma=new so,us=new er;class zs extends et{constructor(e=new ut,t=new zi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let a=1,u=t.count;a<u;a++)Zl.fromBufferAttribute(t,a-1),Jl.fromBufferAttribute(t,a),i[a]=i[a-1],i[a]+=Zl.distanceTo(Jl);e.setAttribute("lineDistance",new Ze(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,a=this.matrixWorld,u=e.params.Line.threshold,g=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),us.copy(i.boundingSphere),us.applyMatrix4(a),us.radius+=u,e.ray.intersectsSphere(us)===!1)return;Ql.copy(a).invert(),Ma.copy(e.ray).applyMatrix4(Ql);const s=u/((this.scale.x+this.scale.y+this.scale.z)/3),n=s*s,o=new X,f=new X,r=new X,l=new X,c=this.isLineSegments?2:1,d=i.index,h=i.attributes.position;if(d!==null){const v=Math.max(0,g.start),_=Math.min(d.count,g.start+g.count);for(let y=v,x=_-1;y<x;y+=c){const b=d.getX(y),w=d.getX(y+1);if(o.fromBufferAttribute(h,b),f.fromBufferAttribute(h,w),Ma.distanceSqToSegment(o,f,l,r)>n)continue;l.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(l);S<e.near||S>e.far||t.push({distance:S,point:r.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,g.start),_=Math.min(h.count,g.start+g.count);for(let y=v,x=_-1;y<x;y+=c){if(o.fromBufferAttribute(h,y),f.fromBufferAttribute(h,y+1),Ma.distanceSqToSegment(o,f,l,r)>n)continue;l.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(l);w<e.near||w>e.far||t.push({distance:w,point:r.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,g=a.length;u<g;u++){const s=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=u}}}}}const ec=new X,tc=new X;class Ha extends zs{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let a=0,u=t.count;a<u;a+=2)ec.fromBufferAttribute(t,a),tc.fromBufferAttribute(t,a+1),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+ec.distanceTo(tc);e.setAttribute("lineDistance",new Ze(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Pv extends zs{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class rn extends it{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Te(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const ic=new Le,Wa=new so,fs=new er,ds=new X;class xs extends et{constructor(e=new ut,t=new rn){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,a=this.matrixWorld,u=e.params.Points.threshold,g=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),fs.copy(i.boundingSphere),fs.applyMatrix4(a),fs.radius+=u,e.ray.intersectsSphere(fs)===!1)return;ic.copy(a).invert(),Wa.copy(e.ray).applyMatrix4(ic);const s=u/((this.scale.x+this.scale.y+this.scale.z)/3),n=s*s,o=i.index,r=i.attributes.position;if(o!==null){const l=Math.max(0,g.start),c=Math.min(o.count,g.start+g.count);for(let d=l,p=c;d<p;d++){const h=o.getX(d);ds.fromBufferAttribute(r,h),nc(ds,h,n,a,e,t,this)}}else{const l=Math.max(0,g.start),c=Math.min(r.count,g.start+g.count);for(let d=l,p=c;d<p;d++)ds.fromBufferAttribute(r,d),nc(ds,d,n,a,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const a=t[i[0]];if(a!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let u=0,g=a.length;u<g;u++){const s=a[u].name||String(u);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=u}}}}}function nc(m,e,t,i,a,u,g){const s=Wa.distanceSqToPoint(m);if(s<t){const n=new X;Wa.closestPointToPoint(m,n),n.applyMatrix4(i);const o=a.ray.origin.distanceTo(n);if(o<a.near||o>a.far)return;u.push({distance:o,distanceToRay:Math.sqrt(s),point:n,index:e,face:null,object:g})}}class Dv extends at{constructor(e,t,i,a,u,g,s,n,o){super(e,t,i,a,u,g,s,n,o),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Rv{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,a=this.getPoint(0),u=0;t.push(0);for(let g=1;g<=e;g++)i=this.getPoint(g/e),u+=i.distanceTo(a),t.push(u),a=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let a=0;const u=i.length;let g;t?g=t:g=e*i[u-1];let s=0,n=u-1,o;for(;s<=n;)if(a=Math.floor(s+(n-s)/2),o=i[a]-g,o<0)s=a+1;else if(o>0)n=a-1;else{n=a;break}if(a=n,i[a]===g)return a/(u-1);const f=i[a],l=i[a+1]-f,c=(g-f)/l;return(a+c)/(u-1)}getTangent(e,t){let a=e-1e-4,u=e+1e-4;a<0&&(a=0),u>1&&(u=1);const g=this.getPoint(a),s=this.getPoint(u),n=t||(g.isVector2?new De:new X);return n.copy(s).sub(g).normalize(),n}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new X,a=[],u=[],g=[],s=new X,n=new Le;for(let c=0;c<=e;c++){const d=c/e;a[c]=this.getTangentAt(d,new X)}u[0]=new X,g[0]=new X;let o=Number.MAX_VALUE;const f=Math.abs(a[0].x),r=Math.abs(a[0].y),l=Math.abs(a[0].z);f<=o&&(o=f,i.set(1,0,0)),r<=o&&(o=r,i.set(0,1,0)),l<=o&&i.set(0,0,1),s.crossVectors(a[0],i).normalize(),u[0].crossVectors(a[0],s),g[0].crossVectors(a[0],u[0]);for(let c=1;c<=e;c++){if(u[c]=u[c-1].clone(),g[c]=g[c-1].clone(),s.crossVectors(a[c-1],a[c]),s.length()>Number.EPSILON){s.normalize();const d=Math.acos(ht(a[c-1].dot(a[c]),-1,1));u[c].applyMatrix4(n.makeRotationAxis(s,d))}g[c].crossVectors(a[c],u[c])}if(t===!0){let c=Math.acos(ht(u[0].dot(u[e]),-1,1));c/=e,a[0].dot(s.crossVectors(u[0],u[e]))>0&&(c=-c);for(let d=1;d<=e;d++)u[d].applyMatrix4(n.makeRotationAxis(a[d],c*d)),g[d].crossVectors(a[d],u[d])}return{tangents:a,normals:u,binormals:g}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}new X;new X;new X;new X;new si;class Ov extends it{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Te(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Iv extends Jt{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class ln extends it{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Te(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ji extends ln{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new De(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ht(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Te(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Te(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Te(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Cr extends it{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Te(16777215),this.specular=new Te(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Fv extends it{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Te(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class kv extends it{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class yh extends it{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Fs,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class Bv extends it{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Te(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=un,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Nv extends zi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const zv={ShadowMaterial:Ov,SpriteMaterial:Ev,RawShaderMaterial:Iv,ShaderMaterial:Jt,PointsMaterial:rn,MeshPhysicalMaterial:ji,MeshStandardMaterial:ln,MeshPhongMaterial:Cr,MeshToonMaterial:Fv,MeshNormalMaterial:kv,MeshLambertMaterial:yh,MeshDepthMaterial:ph,MeshDistanceMaterial:mh,MeshBasicMaterial:Bi,MeshMatcapMaterial:Bv,LineDashedMaterial:Nv,LineBasicMaterial:zi,Material:it};it.fromType=function(m){return new zv[m]};const Qe={arraySlice:function(m,e,t){return Qe.isTypedArray(m)?new m.constructor(m.subarray(e,t!==void 0?t:m.length)):m.slice(e,t)},convertArray:function(m,e,t){return!m||!t&&m.constructor===e?m:typeof e.BYTES_PER_ELEMENT=="number"?new e(m):Array.prototype.slice.call(m)},isTypedArray:function(m){return ArrayBuffer.isView(m)&&!(m instanceof DataView)},getKeyframeOrder:function(m){function e(a,u){return m[a]-m[u]}const t=m.length,i=new Array(t);for(let a=0;a!==t;++a)i[a]=a;return i.sort(e),i},sortedArray:function(m,e,t){const i=m.length,a=new m.constructor(i);for(let u=0,g=0;g!==i;++u){const s=t[u]*e;for(let n=0;n!==e;++n)a[g++]=m[s+n]}return a},flattenJSON:function(m,e,t,i){let a=1,u=m[0];for(;u!==void 0&&u[i]===void 0;)u=m[a++];if(u===void 0)return;let g=u[i];if(g!==void 0)if(Array.isArray(g))do g=u[i],g!==void 0&&(e.push(u.time),t.push.apply(t,g)),u=m[a++];while(u!==void 0);else if(g.toArray!==void 0)do g=u[i],g!==void 0&&(e.push(u.time),g.toArray(t,t.length)),u=m[a++];while(u!==void 0);else do g=u[i],g!==void 0&&(e.push(u.time),t.push(g)),u=m[a++];while(u!==void 0)},subclip:function(m,e,t,i,a=30){const u=m.clone();u.name=e;const g=[];for(let n=0;n<u.tracks.length;++n){const o=u.tracks[n],f=o.getValueSize(),r=[],l=[];for(let c=0;c<o.times.length;++c){const d=o.times[c]*a;if(!(d<t||d>=i)){r.push(o.times[c]);for(let p=0;p<f;++p)l.push(o.values[c*f+p])}}r.length!==0&&(o.times=Qe.convertArray(r,o.times.constructor),o.values=Qe.convertArray(l,o.values.constructor),g.push(o))}u.tracks=g;let s=1/0;for(let n=0;n<u.tracks.length;++n)s>u.tracks[n].times[0]&&(s=u.tracks[n].times[0]);for(let n=0;n<u.tracks.length;++n)u.tracks[n].shift(-1*s);return u.resetDuration(),u},makeClipAdditive:function(m,e=0,t=m,i=30){i<=0&&(i=30);const a=t.tracks.length,u=e/i;for(let g=0;g<a;++g){const s=t.tracks[g],n=s.ValueTypeName;if(n==="bool"||n==="string")continue;const o=m.tracks.find(function(v){return v.name===s.name&&v.ValueTypeName===n});if(o===void 0)continue;let f=0;const r=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=r/3);let l=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const d=s.times.length-1;let p;if(u<=s.times[0]){const v=f,_=r-f;p=Qe.arraySlice(s.values,v,_)}else if(u>=s.times[d]){const v=d*r+f,_=v+r-f;p=Qe.arraySlice(s.values,v,_)}else{const v=s.createInterpolant(),_=f,y=r-f;v.evaluate(u),p=Qe.arraySlice(v.resultBuffer,_,y)}n==="quaternion"&&new St().fromArray(p).normalize().conjugate().toArray(p);const h=o.times.length;for(let v=0;v<h;++v){const _=v*c+l;if(n==="quaternion")St.multiplyQuaternionsFlat(o.values,_,p,0,o.values,_);else{const y=c-l*2;for(let x=0;x<y;++x)o.values[_+x]-=p[x]}}}return m.blendMode=ff,m}};class zr{constructor(e,t,i,a){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=a!==void 0?a:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,a=t[i],u=t[i-1];i:{e:{let g;t:{n:if(!(e<a)){for(let s=i+2;;){if(a===void 0){if(e<u)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(u=a,a=t[++i],e<a)break e}g=t.length;break t}if(!(e>=u)){const s=t[1];e<s&&(i=2,u=s);for(let n=i-2;;){if(u===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===n)break;if(a=u,u=t[--i-1],e>=u)break e}g=i,i=0;break t}break i}for(;i<g;){const s=i+g>>>1;e<t[s]?g=s:i=s+1}if(a=t[i],u=t[i-1],u===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(a===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,u,a)}return this.interpolate_(i,u,e,a)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,a=this.valueSize,u=e*a;for(let g=0;g!==a;++g)t[g]=i[u+g];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Uv extends zr{constructor(e,t,i,a){super(e,t,i,a),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ll,endingEnd:ll}}intervalChanged_(e,t,i){const a=this.parameterPositions;let u=e-2,g=e+1,s=a[u],n=a[g];if(s===void 0)switch(this.getSettings_().endingStart){case cl:u=e,s=2*t-i;break;case hl:u=a.length-2,s=t+a[u]-a[u+1];break;default:u=e,s=i}if(n===void 0)switch(this.getSettings_().endingEnd){case cl:g=e,n=2*i-t;break;case hl:g=1,n=i+a[1]-a[0];break;default:g=e-1,n=t}const o=(i-t)*.5,f=this.valueSize;this._weightPrev=o/(t-s),this._weightNext=o/(n-i),this._offsetPrev=u*f,this._offsetNext=g*f}interpolate_(e,t,i,a){const u=this.resultBuffer,g=this.sampleValues,s=this.valueSize,n=e*s,o=n-s,f=this._offsetPrev,r=this._offsetNext,l=this._weightPrev,c=this._weightNext,d=(i-t)/(a-t),p=d*d,h=p*d,v=-l*h+2*l*p-l*d,_=(1+l)*h+(-1.5-2*l)*p+(-.5+l)*d+1,y=(-1-c)*h+(1.5+c)*p+.5*d,x=c*h-c*p;for(let b=0;b!==s;++b)u[b]=v*g[f+b]+_*g[o+b]+y*g[n+b]+x*g[r+b];return u}}class Vv extends zr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e,t,i,a){const u=this.resultBuffer,g=this.sampleValues,s=this.valueSize,n=e*s,o=n-s,f=(i-t)/(a-t),r=1-f;for(let l=0;l!==s;++l)u[l]=g[o+l]*r+g[n+l]*f;return u}}class Gv extends zr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e){return this.copySampleValue_(e-1)}}class fi{constructor(e,t,i,a){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Qe.convertArray(t,this.TimeBufferType),this.values=Qe.convertArray(i,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Qe.convertArray(e.times,Array),values:Qe.convertArray(e.values,Array)};const a=e.getInterpolation();a!==e.DefaultInterpolation&&(i.interpolation=a)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Gv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Vv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Uv(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Lr:t=this.InterpolantFactoryMethodDiscrete;break;case Xn:t=this.InterpolantFactoryMethodLinear;break;case $s:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lr;case this.InterpolantFactoryMethodLinear:return Xn;case this.InterpolantFactoryMethodSmooth:return $s}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,a=t.length;i!==a;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,a=t.length;i!==a;++i)t[i]*=e}return this}trim(e,t){const i=this.times,a=i.length;let u=0,g=a-1;for(;u!==a&&i[u]<e;)++u;for(;g!==-1&&i[g]>t;)--g;if(++g,u!==0||g!==a){u>=g&&(g=Math.max(g,1),u=g-1);const s=this.getValueSize();this.times=Qe.arraySlice(i,u,g),this.values=Qe.arraySlice(this.values,u*s,g*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,a=this.values,u=i.length;u===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let g=null;for(let s=0;s!==u;s++){const n=i[s];if(typeof n=="number"&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,n),e=!1;break}if(g!==null&&g>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,n,g),e=!1;break}g=n}if(a!==void 0&&Qe.isTypedArray(a))for(let s=0,n=a.length;s!==n;++s){const o=a[s];if(isNaN(o)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,o),e=!1;break}}return e}optimize(){const e=Qe.arraySlice(this.times),t=Qe.arraySlice(this.values),i=this.getValueSize(),a=this.getInterpolation()===$s,u=e.length-1;let g=1;for(let s=1;s<u;++s){let n=!1;const o=e[s],f=e[s+1];if(o!==f&&(s!==1||o!==e[0]))if(a)n=!0;else{const r=s*i,l=r-i,c=r+i;for(let d=0;d!==i;++d){const p=t[r+d];if(p!==t[l+d]||p!==t[c+d]){n=!0;break}}}if(n){if(s!==g){e[g]=e[s];const r=s*i,l=g*i;for(let c=0;c!==i;++c)t[l+c]=t[r+c]}++g}}if(u>0){e[g]=e[u];for(let s=u*i,n=g*i,o=0;o!==i;++o)t[n+o]=t[s+o];++g}return g!==e.length?(this.times=Qe.arraySlice(e,0,g),this.values=Qe.arraySlice(t,0,g*i)):(this.times=e,this.values=t),this}clone(){const e=Qe.arraySlice(this.times,0),t=Qe.arraySlice(this.values,0),i=this.constructor,a=new i(this.name,e,t);return a.createInterpolant=this.createInterpolant,a}}fi.prototype.TimeBufferType=Float32Array;fi.prototype.ValueBufferType=Float32Array;fi.prototype.DefaultInterpolation=Xn;class nr extends fi{}nr.prototype.ValueTypeName="bool";nr.prototype.ValueBufferType=Array;nr.prototype.DefaultInterpolation=Lr;nr.prototype.InterpolantFactoryMethodLinear=void 0;nr.prototype.InterpolantFactoryMethodSmooth=void 0;class xh extends fi{}xh.prototype.ValueTypeName="color";class qn extends fi{}qn.prototype.ValueTypeName="number";class Hv extends zr{constructor(e,t,i,a){super(e,t,i,a)}interpolate_(e,t,i,a){const u=this.resultBuffer,g=this.sampleValues,s=this.valueSize,n=(i-t)/(a-t);let o=e*s;for(let f=o+s;o!==f;o+=4)St.slerpFlat(u,0,g,o-s,g,o,n);return u}}class Hi extends fi{InterpolantFactoryMethodLinear(e){return new Hv(this.times,this.values,this.getValueSize(),e)}}Hi.prototype.ValueTypeName="quaternion";Hi.prototype.DefaultInterpolation=Xn;Hi.prototype.InterpolantFactoryMethodSmooth=void 0;class rr extends fi{}rr.prototype.ValueTypeName="string";rr.prototype.ValueBufferType=Array;rr.prototype.DefaultInterpolation=Lr;rr.prototype.InterpolantFactoryMethodLinear=void 0;rr.prototype.InterpolantFactoryMethodSmooth=void 0;class Kn extends fi{}Kn.prototype.ValueTypeName="vector";class bh{constructor(e,t=-1,i,a=uf){this.name=e,this.tracks=i,this.duration=t,this.blendMode=a,this.uuid=Zt(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,a=1/(e.fps||1);for(let g=0,s=i.length;g!==s;++g)t.push(jv(i[g]).scale(a));const u=new this(e.name,e.duration,t,e.blendMode);return u.uuid=e.uuid,u}static toJSON(e){const t=[],i=e.tracks,a={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let u=0,g=i.length;u!==g;++u)t.push(fi.toJSON(i[u]));return a}static CreateFromMorphTargetSequence(e,t,i,a){const u=t.length,g=[];for(let s=0;s<u;s++){let n=[],o=[];n.push((s+u-1)%u,s,(s+1)%u),o.push(0,1,0);const f=Qe.getKeyframeOrder(n);n=Qe.sortedArray(n,1,f),o=Qe.sortedArray(o,1,f),!a&&n[0]===0&&(n.push(u),o.push(o[0])),g.push(new qn(".morphTargetInfluences["+t[s].name+"]",n,o).scale(1/i))}return new this(e,-1,g)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const a=e;i=a.geometry&&a.geometry.animations||a.animations}for(let a=0;a<i.length;a++)if(i[a].name===t)return i[a];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const a={},u=/^([\w-]*?)([\d]+)$/;for(let s=0,n=e.length;s<n;s++){const o=e[s],f=o.name.match(u);if(f&&f.length>1){const r=f[1];let l=a[r];l||(a[r]=l=[]),l.push(o)}}const g=[];for(const s in a)g.push(this.CreateFromMorphTargetSequence(s,a[s],t,i));return g}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(r,l,c,d,p){if(c.length!==0){const h=[],v=[];Qe.flattenJSON(c,h,v,d),h.length!==0&&p.push(new r(l,h,v))}},a=[],u=e.name||"default",g=e.fps||30,s=e.blendMode;let n=e.length||-1;const o=e.hierarchy||[];for(let r=0;r<o.length;r++){const l=o[r].keys;if(!(!l||l.length===0))if(l[0].morphTargets){const c={};let d;for(d=0;d<l.length;d++)if(l[d].morphTargets)for(let p=0;p<l[d].morphTargets.length;p++)c[l[d].morphTargets[p]]=-1;for(const p in c){const h=[],v=[];for(let _=0;_!==l[d].morphTargets.length;++_){const y=l[d];h.push(y.time),v.push(y.morphTarget===p?1:0)}a.push(new qn(".morphTargetInfluence["+p+"]",h,v))}n=c.length*g}else{const c=".bones["+t[r].name+"]";i(Kn,c+".position",l,"pos",a),i(Hi,c+".quaternion",l,"rot",a),i(Kn,c+".scale",l,"scl",a)}}return a.length===0?null:new this(u,n,a,s)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,a=e.length;i!==a;++i){const u=this.tracks[i];t=Math.max(t,u.times[u.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Wv(m){switch(m.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return qn;case"vector":case"vector2":case"vector3":case"vector4":return Kn;case"color":return xh;case"quaternion":return Hi;case"bool":case"boolean":return nr;case"string":return rr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+m)}function jv(m){if(m.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=Wv(m.type);if(m.times===void 0){const t=[],i=[];Qe.flattenJSON(m.keys,t,i,"value"),m.times=t,m.values=i}return e.parse!==void 0?e.parse(m):new e(m.name,m.times,m.values,m.interpolation)}const $n={enabled:!1,files:{},add:function(m,e){this.enabled!==!1&&(this.files[m]=e)},get:function(m){if(this.enabled!==!1)return this.files[m]},remove:function(m){delete this.files[m]},clear:function(){this.files={}}};class Xv{constructor(e,t,i){const a=this;let u=!1,g=0,s=0,n;const o=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(f){s++,u===!1&&a.onStart!==void 0&&a.onStart(f,g,s),u=!0},this.itemEnd=function(f){g++,a.onProgress!==void 0&&a.onProgress(f,g,s),g===s&&(u=!1,a.onLoad!==void 0&&a.onLoad())},this.itemError=function(f){a.onError!==void 0&&a.onError(f)},this.resolveURL=function(f){return n?n(f):f},this.setURLModifier=function(f){return n=f,this},this.addHandler=function(f,r){return o.push(f,r),this},this.removeHandler=function(f){const r=o.indexOf(f);return r!==-1&&o.splice(r,2),this},this.getHandler=function(f){for(let r=0,l=o.length;r<l;r+=2){const c=o[r],d=o[r+1];if(c.global&&(c.lastIndex=0),c.test(f))return d}return null}}}const Yv=new Xv;class Ci{constructor(e){this.manager=e!==void 0?e:Yv,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(a,u){i.load(e,a,t,u)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const _i={};class cn extends Ci{constructor(e){super(e)}load(e,t,i,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const u=$n.get(e);if(u!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(u),this.manager.itemEnd(e)},0),u;if(_i[e]!==void 0){_i[e].push({onLoad:t,onProgress:i,onError:a});return}_i[e]=[],_i[e].push({onLoad:t,onProgress:i,onError:a});const g=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,n=this.responseType;fetch(g).then(o=>{if(o.status===200||o.status===0){if(o.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||o.body===void 0||o.body.getReader===void 0)return o;const f=_i[e],r=o.body.getReader(),l=o.headers.get("Content-Length"),c=l?parseInt(l):0,d=c!==0;let p=0;const h=new ReadableStream({start(v){_();function _(){r.read().then(({done:y,value:x})=>{if(y)v.close();else{p+=x.byteLength;const b=new ProgressEvent("progress",{lengthComputable:d,loaded:p,total:c});for(let w=0,M=f.length;w<M;w++){const S=f[w];S.onProgress&&S.onProgress(b)}v.enqueue(x),_()}})}}});return new Response(h)}else throw Error(`fetch for "${o.url}" responded with ${o.status}: ${o.statusText}`)}).then(o=>{switch(n){case"arraybuffer":return o.arrayBuffer();case"blob":return o.blob();case"document":return o.text().then(f=>new DOMParser().parseFromString(f,s));case"json":return o.json();default:if(s===void 0)return o.text();{const r=/charset="?([^;"\s]*)"?/i.exec(s),l=r&&r[1]?r[1].toLowerCase():void 0,c=new TextDecoder(l);return o.arrayBuffer().then(d=>c.decode(d))}}}).then(o=>{$n.add(e,o);const f=_i[e];delete _i[e];for(let r=0,l=f.length;r<l;r++){const c=f[r];c.onLoad&&c.onLoad(o)}}).catch(o=>{const f=_i[e];if(f===void 0)throw this.manager.itemError(e),o;delete _i[e];for(let r=0,l=f.length;r<l;r++){const c=f[r];c.onError&&c.onError(o)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class qv extends Ci{constructor(e){super(e)}load(e,t,i,a){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const u=this,g=$n.get(e);if(g!==void 0)return u.manager.itemStart(e),setTimeout(function(){t&&t(g),u.manager.itemEnd(e)},0),g;const s=Dr("img");function n(){f(),$n.add(e,this),t&&t(this),u.manager.itemEnd(e)}function o(r){f(),a&&a(r),u.manager.itemError(e),u.manager.itemEnd(e)}function f(){s.removeEventListener("load",n,!1),s.removeEventListener("error",o,!1)}return s.addEventListener("load",n,!1),s.addEventListener("error",o,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),u.manager.itemStart(e),s.src=e,s}}class Kv extends Ci{constructor(e){super(e)}load(e,t,i,a){const u=this,g=new _h,s=new cn(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(u.withCredentials),s.load(e,function(n){const o=u.parse(n);!o||(o.image!==void 0?g.image=o.image:o.data!==void 0&&(g.image.width=o.width,g.image.height=o.height,g.image.data=o.data),g.wrapS=o.wrapS!==void 0?o.wrapS:_t,g.wrapT=o.wrapT!==void 0?o.wrapT:_t,g.magFilter=o.magFilter!==void 0?o.magFilter:rt,g.minFilter=o.minFilter!==void 0?o.minFilter:rt,g.anisotropy=o.anisotropy!==void 0?o.anisotropy:1,o.encoding!==void 0&&(g.encoding=o.encoding),o.flipY!==void 0&&(g.flipY=o.flipY),o.format!==void 0&&(g.format=o.format),o.type!==void 0&&(g.type=o.type),o.mipmaps!==void 0&&(g.mipmaps=o.mipmaps,g.minFilter=hn),o.mipmapCount===1&&(g.minFilter=rt),o.generateMipmaps!==void 0&&(g.generateMipmaps=o.generateMipmaps),g.needsUpdate=!0,t&&t(g,o))},i,a),g}}class wh extends Ci{constructor(e){super(e)}load(e,t,i,a){const u=new at,g=new qv(this.manager);return g.setCrossOrigin(this.crossOrigin),g.setPath(this.path),g.load(e,function(s){u.image=s,u.needsUpdate=!0,t!==void 0&&t(u)},i,a),u}}class Us extends et{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Te(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const rc=new Le,sc=new X,ac=new X;class uo{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new De(512,512),this.map=null,this.mapPass=null,this.matrix=new Le,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oo,this._frameExtents=new De(1,1),this._viewportCount=1,this._viewports=[new Ye(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;sc.setFromMatrixPosition(e.matrixWorld),t.position.copy(sc),ac.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ac),t.updateMatrixWorld(),rc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(rc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class $v extends uo{constructor(){super(new vt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Pr*2*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,u=e.distance||t.far;(i!==t.fov||a!==t.aspect||u!==t.far)&&(t.fov=i,t.aspect=a,t.far=u,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Sh extends Us{constructor(e,t,i=0,a=Math.PI/3,u=0,g=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(et.DefaultUp),this.updateMatrix(),this.target=new et,this.distance=i,this.angle=a,this.penumbra=u,this.decay=g,this.shadow=new $v}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const oc=new Le,yr=new X,Ta=new X;class Zv extends uo{constructor(){super(new vt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new De(4,2),this._viewportCount=6,this._viewports=[new Ye(2,1,1,1),new Ye(0,1,1,1),new Ye(3,1,1,1),new Ye(1,1,1,1),new Ye(3,0,1,1),new Ye(1,0,1,1)],this._cubeDirections=[new X(1,0,0),new X(-1,0,0),new X(0,0,1),new X(0,0,-1),new X(0,1,0),new X(0,-1,0)],this._cubeUps=[new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,1,0),new X(0,0,1),new X(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,a=this.matrix,u=e.distance||i.far;u!==i.far&&(i.far=u,i.updateProjectionMatrix()),yr.setFromMatrixPosition(e.matrixWorld),i.position.copy(yr),Ta.copy(i.position),Ta.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Ta),i.updateMatrixWorld(),a.makeTranslation(-yr.x,-yr.y,-yr.z),oc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oc)}}class ja extends Us{constructor(e,t,i=0,a=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=a,this.shadow=new Zv}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Jv extends uo{constructor(){super(new tr(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class zn extends Us{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(et.DefaultUp),this.updateMatrix(),this.target=new et,this.shadow=new Jv}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Mh extends Us{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class ci{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,a=e.length;i<a;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Qv extends Ci{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,a){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const u=this,g=$n.get(e);if(g!==void 0)return u.manager.itemStart(e),setTimeout(function(){t&&t(g),u.manager.itemEnd(e)},0),g;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then(function(n){return n.blob()}).then(function(n){return createImageBitmap(n,Object.assign(u.options,{colorSpaceConversion:"none"}))}).then(function(n){$n.add(e,n),t&&t(n),u.manager.itemEnd(e)}).catch(function(n){a&&a(n),u.manager.itemError(e),u.manager.itemEnd(e)}),u.manager.itemStart(e)}}class e0{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=lc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=lc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function lc(){return(typeof performance=="undefined"?Date:performance).now()}const fo="\\[\\]\\.:\\/",t0=new RegExp("["+fo+"]","g"),po="[^"+fo+"]",i0="[^"+fo.replace("\\.","")+"]",n0=/((?:WC+[\/:])*)/.source.replace("WC",po),r0=/(WCOD+)?/.source.replace("WCOD",i0),s0=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",po),a0=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",po),o0=new RegExp("^"+n0+r0+s0+a0+"$"),l0=["material","materials","bones"];class c0{constructor(e,t,i){const a=i||He.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,a)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,a=this._bindings[i];a!==void 0&&a.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let a=this._targetGroup.nCachedObjects_,u=i.length;a!==u;++a)i[a].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class He{constructor(e,t,i){this.path=t,this.parsedPath=i||He.parseTrackName(t),this.node=He.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new He.Composite(e,t,i):new He(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(t0,"")}static parseTrackName(e){const t=o0.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},a=i.nodeName&&i.nodeName.lastIndexOf(".");if(a!==void 0&&a!==-1){const u=i.nodeName.substring(a+1);l0.indexOf(u)!==-1&&(i.nodeName=i.nodeName.substring(0,a),i.objectName=u)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(u){for(let g=0;g<u.length;g++){const s=u[g];if(s.name===t||s.uuid===t)return s;const n=i(s.children);if(n)return n}return null},a=i(e.children);if(a)return a}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let a=0,u=i.length;a!==u;++a)e[t++]=i[a]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let a=0,u=i.length;a!==u;++a)i[a]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let a=0,u=i.length;a!==u;++a)i[a]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let a=0,u=i.length;a!==u;++a)i[a]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,a=t.propertyName;let u=t.propertyIndex;if(e||(e=He.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let o=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let f=0;f<e.length;f++)if(e[f].name===o){o=f;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(o!==void 0){if(e[o]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[o]}}const g=e[a];if(g===void 0){const o=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+o+"."+a+" but it wasn't found.",e);return}let s=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?s=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate);let n=this.BindingType.Direct;if(u!==void 0){if(a==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[u]!==void 0&&(u=e.morphTargetDictionary[u])}n=this.BindingType.ArrayElement,this.resolvedProperty=g,this.propertyIndex=u}else g.fromArray!==void 0&&g.toArray!==void 0?(n=this.BindingType.HasFromToArray,this.resolvedProperty=g):Array.isArray(g)?(n=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=a;this.getValue=this.GetterByBindingType[n],this.setValue=this.SetterByBindingTypeAndVersioning[n][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}He.Composite=c0;He.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};He.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};He.prototype.GetterByBindingType=[He.prototype._getValue_direct,He.prototype._getValue_array,He.prototype._getValue_arrayElement,He.prototype._getValue_toArray];He.prototype.SetterByBindingTypeAndVersioning=[[He.prototype._setValue_direct,He.prototype._setValue_direct_setNeedsUpdate,He.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[He.prototype._setValue_array,He.prototype._setValue_array_setNeedsUpdate,He.prototype._setValue_array_setMatrixWorldNeedsUpdate],[He.prototype._setValue_arrayElement,He.prototype._setValue_arrayElement_setNeedsUpdate,He.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[He.prototype._setValue_fromArray,He.prototype._setValue_fromArray_setNeedsUpdate,He.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class cc{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ht(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ps{static toHalfFloat(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=ht(e,-65504,65504),hc[0]=e;const t=uc[0],i=t>>23&511;return Wt[i]+((t&8388607)>>jt[i])}static fromHalfFloat(e){const t=e>>10;return uc[0]=mo[Ch[t]+(e&1023)]+sr[t],hc[0]}}const Th=new ArrayBuffer(4),hc=new Float32Array(Th),uc=new Uint32Array(Th),Wt=new Uint32Array(512),jt=new Uint32Array(512);for(let m=0;m<256;++m){const e=m-127;e<-27?(Wt[m]=0,Wt[m|256]=32768,jt[m]=24,jt[m|256]=24):e<-14?(Wt[m]=1024>>-e-14,Wt[m|256]=1024>>-e-14|32768,jt[m]=-e-1,jt[m|256]=-e-1):e<=15?(Wt[m]=e+15<<10,Wt[m|256]=e+15<<10|32768,jt[m]=13,jt[m|256]=13):e<128?(Wt[m]=31744,Wt[m|256]=64512,jt[m]=24,jt[m|256]=24):(Wt[m]=31744,Wt[m|256]=64512,jt[m]=13,jt[m|256]=13)}const mo=new Uint32Array(2048),sr=new Uint32Array(64),Ch=new Uint32Array(64);for(let m=1;m<1024;++m){let e=m<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,mo[m]=e|t}for(let m=1024;m<2048;++m)mo[m]=939524096+(m-1024<<13);for(let m=1;m<31;++m)sr[m]=m<<23;sr[31]=1199570944;sr[32]=2147483648;for(let m=33;m<63;++m)sr[m]=2147483648+(m-32<<23);sr[63]=3347054592;for(let m=1;m<64;++m)m!==32&&(Ch[m]=1024);typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:no}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=no);/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.16.1
 * @author George Michael Brower
 * @license MIT
 */class hi{constructor(e,t,i,a,u="div"){this.parent=e,this.object=t,this.property=i,this._disabled=!1,this.initialValue=this.getValue(),this.domElement=document.createElement("div"),this.domElement.classList.add("controller"),this.domElement.classList.add(a),this.$name=document.createElement("div"),this.$name.classList.add("name"),hi.nextNameID=hi.nextNameID||0,this.$name.id=`lil-gui-name-${++hi.nextNameID}`,this.$widget=document.createElement(u),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(e){return this._name=e,this.$name.innerHTML=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled?this:(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e),this)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.object[this.property]=e,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class h0 extends hi{constructor(e,t,i){super(e,t,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Xa(m){let e,t;return(e=m.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=m.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=m.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),t?"#"+t:!1}const u0={isPrimitive:!0,match:m=>typeof m=="string",fromHexString:Xa,toHexString:Xa},Rr={isPrimitive:!0,match:m=>typeof m=="number",fromHexString:m=>parseInt(m.substring(1),16),toHexString:m=>"#"+m.toString(16).padStart(6,0)},f0={isPrimitive:!1,match:Array.isArray,fromHexString(m,e,t=1){const i=Rr.fromHexString(m);e[0]=(i>>16&255)/255*t,e[1]=(i>>8&255)/255*t,e[2]=(i&255)/255*t},toHexString([m,e,t],i=1){i=255/i;const a=m*i<<16^e*i<<8^t*i<<0;return Rr.toHexString(a)}},d0={isPrimitive:!1,match:m=>Object(m)===m,fromHexString(m,e,t=1){const i=Rr.fromHexString(m);e.r=(i>>16&255)/255*t,e.g=(i>>8&255)/255*t,e.b=(i&255)/255*t},toHexString({r:m,g:e,b:t},i=1){i=255/i;const a=m*i<<16^e*i<<8^t*i<<0;return Rr.toHexString(a)}},p0=[u0,Rr,f0,d0];function m0(m){return p0.find(e=>e.match(m))}class g0 extends hi{constructor(e,t,i,a){super(e,t,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=m0(this.initialValue),this._rgbScale=a,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const u=Xa(this.$text.value);u&&this._setValueFromHexString(u)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Ca extends hi{constructor(e,t,i){super(e,t,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",a=>{a.preventDefault(),this.getValue().call(this.object)}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class v0 extends hi{constructor(e,t,i,a,u,g){super(e,t,i,"number"),this._initInput(),this.min(a),this.max(u);const s=g!==void 0;this.step(s?g:this._getImplicitStep(),s),this.updateDisplay()}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=t*100+"%"}return this._inputFocused||(this.$input.value=e),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=()=>{const v=parseFloat(this.$input.value);isNaN(v)||this.setValue(this._clamp(v))},t=v=>{const _=parseFloat(this.$input.value);isNaN(_)||(this._snapClampSetValue(_+v),this.$input.value=this.getValue())},i=v=>{v.code==="Enter"&&this.$input.blur(),v.code==="ArrowUp"&&(v.preventDefault(),t(this._step*this._arrowKeyMultiplier(v))),v.code==="ArrowDown"&&(v.preventDefault(),t(this._step*this._arrowKeyMultiplier(v)*-1))},a=v=>{this._inputFocused&&(v.preventDefault(),t(this._step*this._normalizeMouseWheel(v)))};let u=!1,g,s,n,o,f;const r=5,l=v=>{g=v.clientX,s=n=v.clientY,u=!0,o=this.getValue(),f=0,window.addEventListener("mousemove",c),window.addEventListener("mouseup",d)},c=v=>{if(u){const _=v.clientX-g,y=v.clientY-s;Math.abs(y)>r?(v.preventDefault(),this.$input.blur(),u=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(_)>r&&d()}u||(f-=(v.clientY-n)*this._step*this._arrowKeyMultiplier(v),o+f>this._max?f=this._max-o:o+f<this._min&&(f=this._min-o),this._snapClampSetValue(o+f)),n=v.clientY},d=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)},p=()=>{this._inputFocused=!0},h=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",e),this.$input.addEventListener("keydown",i),this.$input.addEventListener("wheel",a,{passive:!1}),this.$input.addEventListener("mousedown",l),this.$input.addEventListener("focus",p),this.$input.addEventListener("blur",h)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=(v,_,y,x,b)=>(v-_)/(y-_)*(b-x)+x,t=v=>{const _=this.$slider.getBoundingClientRect();let y=e(v,_.left,_.right,this._min,this._max);this._snapClampSetValue(y)},i=v=>{this._setDraggingStyle(!0),t(v.clientX),window.addEventListener("mousemove",a),window.addEventListener("mouseup",u)},a=v=>{t(v.clientX)},u=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",u)};let g=!1,s,n;const o=v=>{v.preventDefault(),this._setDraggingStyle(!0),t(v.touches[0].clientX),g=!1},f=v=>{v.touches.length>1||(this._hasScrollBar?(s=v.touches[0].clientX,n=v.touches[0].clientY,g=!0):o(v),window.addEventListener("touchmove",r),window.addEventListener("touchend",l))},r=v=>{if(g){const _=v.touches[0].clientX-s,y=v.touches[0].clientY-n;Math.abs(_)>Math.abs(y)?o(v):(window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l))}else v.preventDefault(),t(v.touches[0].clientX)},l=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",r),window.removeEventListener("touchend",l)},c=this._callOnFinishChange.bind(this),d=400;let p;const h=v=>{if(Math.abs(v.deltaX)<Math.abs(v.deltaY)&&this._hasScrollBar)return;v.preventDefault();const y=this._normalizeMouseWheel(v)*this._step;this._snapClampSetValue(this.getValue()+y),this.$input.value=this.getValue(),clearTimeout(p),p=setTimeout(c,d)};this.$slider.addEventListener("mousedown",i),this.$slider.addEventListener("touchstart",f,{passive:!1}),this.$slider.addEventListener("wheel",h,{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle(`lil-gui-${t}`,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:i}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,i=-e.wheelDelta/120,i*=this._stepExplicit?1:10),t+-i}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class _0 extends hi{constructor(e,t,i,a){super(e,t,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this._values=Array.isArray(a)?a:Object.values(a),this._names=Array.isArray(a)?a:Object.keys(a),this._names.forEach(u=>{const g=document.createElement("option");g.innerHTML=u,this.$select.appendChild(g)}),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.updateDisplay()}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.innerHTML=t===-1?e:this._names[t],this}}class y0 extends hi{constructor(e,t,i){super(e,t,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",a=>{a.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}const x0=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  background-color: var(--background-color);
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean .widget {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "\u2195";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background-color: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background-color: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background-color: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "\u25BE";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "\u25B8";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui input {
  -webkit-tap-highlight-color: transparent;
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input::-webkit-outer-spin-button,
.lil-gui input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.lil-gui input[type=number] {
  -moz-appearance: textfield;
}
.lil-gui input[type=checkbox] {
  appearance: none;
  -webkit-appearance: none;
  height: var(--checkbox-size);
  width: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "\u2713";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  -webkit-tap-highlight-color: transparent;
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: 1px solid var(--widget-color);
  text-align: center;
  line-height: calc(var(--widget-height) - 4px);
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
    border-color: var(--hover-color);
  }
  .lil-gui button:focus {
    border-color: var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function b0(m){const e=document.createElement("style");e.innerHTML=m;const t=document.querySelector("head link[rel=stylesheet], head style");t?document.head.insertBefore(e,t):document.head.appendChild(e)}let fc=!1;class go{constructor({parent:e,autoPlace:t=e===void 0,container:i,width:a,title:u="Controls",injectStyles:g=!0,touchStyles:s=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",n=>{(n.code==="Enter"||n.code==="Space")&&(n.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(u),s&&this.domElement.classList.add("allow-touch-styles"),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),!fc&&g&&(b0(x0),fc=!0),i?i.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),a&&this.domElement.style.setProperty("--width",a+"px"),this.domElement.addEventListener("keydown",n=>n.stopPropagation()),this.domElement.addEventListener("keyup",n=>n.stopPropagation())}add(e,t,i,a,u){if(Object(i)===i)return new _0(this,e,t,i);const g=e[t];switch(typeof g){case"number":return new v0(this,e,t,i,a,u);case"boolean":return new h0(this,e,t);case"string":return new y0(this,e,t);case"function":return new Ca(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,g)}addColor(e,t,i=1){return new g0(this,e,t,i)}addFolder(e){return new go({parent:this,title:e})}load(e,t=!0){return e.controllers&&this.controllers.forEach(i=>{i instanceof Ca||i._name in e.controllers&&i.load(e.controllers[i._name])}),t&&e.folders&&this.folders.forEach(i=>{i._title in e.folders&&i.load(e.folders[i._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof Ca)){if(i._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);t.controllers[i._name]=i.save()}}),e&&this.folders.forEach(i=>{if(i._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);t.folders[i._title]=i.save()}),t}open(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._closed=!e,this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const i=u=>{u.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const a=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=a+"px"})}),this}title(e){return this._title=e,this.$title.innerHTML=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(i=>i.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}class Vs{constructor(){this.callbacks={},this.callbacks.base={}}on(e,t){const i=this;return typeof e=="undefined"||e===""?(console.warn("wrong names"),!1):typeof t=="undefined"?(console.warn("wrong callback"),!1):(this.resolveNames(e).forEach(function(u){const g=i.resolveName(u);i.callbacks[g.namespace]instanceof Object||(i.callbacks[g.namespace]={}),i.callbacks[g.namespace][g.value]instanceof Array||(i.callbacks[g.namespace][g.value]=[]),i.callbacks[g.namespace][g.value].push(t)}),this)}off(e){const t=this;return typeof e=="undefined"||e===""?(console.warn("wrong name"),!1):(this.resolveNames(e).forEach(function(a){const u=t.resolveName(a);if(u.namespace!=="base"&&u.value==="")delete t.callbacks[u.namespace];else if(u.namespace==="base")for(const g in t.callbacks)t.callbacks[g]instanceof Object&&t.callbacks[g][u.value]instanceof Array&&(delete t.callbacks[g][u.value],Object.keys(t.callbacks[g]).length===0&&delete t.callbacks[g]);else t.callbacks[u.namespace]instanceof Object&&t.callbacks[u.namespace][u.value]instanceof Array&&(delete t.callbacks[u.namespace][u.value],Object.keys(t.callbacks[u.namespace]).length===0&&delete t.callbacks[u.namespace])}),this)}trigger(e,t){if(typeof e=="undefined"||e==="")return console.warn("wrong name"),!1;const i=this;let a=null;const u=t instanceof Array?t:[];let g=this.resolveNames(e);if(g=this.resolveName(g[0]),g.namespace==="base")for(const s in i.callbacks)i.callbacks[s]instanceof Object&&i.callbacks[s][g.value]instanceof Array&&i.callbacks[s][g.value].forEach(function(n){n.apply(i,u)});else if(this.callbacks[g.namespace]instanceof Object){if(g.value==="")return console.warn("wrong name"),this;i.callbacks[g.namespace][g.value].forEach(function(s){s.apply(i,u)})}return a}resolveNames(e){let t=e;return t=t.replace(/[^a-zA-Z0-9 ,/.]/g,""),t=t.replace(/[,/]+/g," "),t=t.split(" "),t}resolveName(e){const t={},i=e.split(".");return t.original=e,t.value=i[0],t.namespace="base",i.length>1&&i[1]!==""&&(t.namespace=i[1]),t}}class w0 extends Vs{constructor(){super(),this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16,this.playing=!0,this.tick=this.tick.bind(this),this.tick()}play(){this.playing=!0}pause(){this.playing=!1}tick(){this.ticker=window.requestAnimationFrame(this.tick);const e=Date.now();this.delta=e-this.current,this.elapsed+=this.playing?this.delta:0,this.current=e,this.delta>60&&(this.delta=60),this.playing&&this.trigger("tick")}stop(){window.cancelAnimationFrame(this.ticker)}}class S0 extends Vs{constructor(){super(),this.viewport={},this.$sizeViewport=document.createElement("div"),this.$sizeViewport.style.width="100vw",this.$sizeViewport.style.height="100vh",this.$sizeViewport.style.position="absolute",this.$sizeViewport.style.top=0,this.$sizeViewport.style.left=0,this.$sizeViewport.style.pointerEvents="none",this.resize=this.resize.bind(this),window.addEventListener("resize",this.resize),this.resize()}resize(){document.body.appendChild(this.$sizeViewport),this.viewport.width=this.$sizeViewport.offsetWidth,this.viewport.height=this.$sizeViewport.offsetHeight,document.body.removeChild(this.$sizeViewport),this.width=window.innerWidth,this.height=window.innerHeight,this.trigger("resize")}}var M0=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function T0(m){if(m.__esModule)return m;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(m).forEach(function(t){var i=Object.getOwnPropertyDescriptor(m,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return m[t]}})}),e}var Eh={exports:{}};(function(m,e){(function(t,i){m.exports=i()})(M0,function(){var t=function(){function i(c){return g.appendChild(c.dom),c}function a(c){for(var d=0;d<g.children.length;d++)g.children[d].style.display=d===c?"block":"none";u=c}var u=0,g=document.createElement("div");g.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",g.addEventListener("click",function(c){c.preventDefault(),a(++u%g.children.length)},!1);var s=(performance||Date).now(),n=s,o=0,f=i(new t.Panel("FPS","#0ff","#002")),r=i(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=i(new t.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:g,addPanel:i,showPanel:a,begin:function(){s=(performance||Date).now()},end:function(){o++;var c=(performance||Date).now();if(r.update(c-s,200),c>n+1e3&&(f.update(1e3*o/(c-n),100),n=c,o=0,l)){var d=performance.memory;l.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){s=this.end()},domElement:g,setMode:a}};return t.Panel=function(i,a,u){var g=1/0,s=0,n=Math.round,o=n(window.devicePixelRatio||1),f=80*o,r=48*o,l=3*o,c=2*o,d=3*o,p=15*o,h=74*o,v=30*o,_=document.createElement("canvas");_.width=f,_.height=r,_.style.cssText="width:80px;height:48px";var y=_.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=u,y.fillRect(0,0,f,r),y.fillStyle=a,y.fillText(i,l,c),y.fillRect(d,p,h,v),y.fillStyle=u,y.globalAlpha=.9,y.fillRect(d,p,h,v),{dom:_,update:function(x,b){g=Math.min(g,x),s=Math.max(s,x),y.fillStyle=u,y.globalAlpha=1,y.fillRect(0,0,f,p),y.fillStyle=a,y.fillText(n(x)+" "+i+" ("+n(g)+"-"+n(s)+")",l,c),y.drawImage(_,d+o,p,h-o,v,d,p,h-o,v),y.fillRect(d+h-o,p,o,v),y.fillStyle=u,y.globalAlpha=.9,y.fillRect(d+h-o,p,o,n((1-x/b)*v))}}},t})})(Eh);var dc=Eh.exports;class C0{constructor(e){this.instance=new dc,this.instance.showPanel(3),this.active=!1,this.max=40,this.ignoreMaxed=!0,e&&this.activate()}activate(){this.active=!0,document.body.appendChild(this.instance.dom)}deactivate(){this.active=!1,document.body.removeChild(this.instance.dom)}setRenderPanel(e){this.render={},this.render.context=e,this.render.extension=this.render.context.getExtension("EXT_disjoint_timer_query_webgl2"),this.render.panel=this.instance.addPanel(new dc.Panel("Render (ms)","#f8f","#212")),(!(typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext)||!this.render.extension)&&this.deactivate()}beforeRender(){if(!this.active)return;this.queryCreated=!1;let e=!1;if(this.render.query){e=this.render.context.getQueryParameter(this.render.query,this.render.context.QUERY_RESULT_AVAILABLE);const t=this.render.context.getParameter(this.render.extension.GPU_DISJOINT_EXT);if(e&&!t){const i=this.render.context.getQueryParameter(this.render.query,this.render.context.QUERY_RESULT),a=Math.min(i/1e3/1e3,this.max);a===this.max&&this.ignoreMaxed||this.render.panel.update(a,this.max)}}(e||!this.render.query)&&(this.queryCreated=!0,this.render.query=this.render.context.createQuery(),this.render.context.beginQuery(this.render.extension.TIME_ELAPSED_EXT,this.render.query))}afterRender(){!this.active||this.queryCreated&&this.render.context.endQuery(this.render.extension.TIME_ELAPSED_EXT)}update(){!this.active||this.instance.update()}destroy(){this.deactivate()}}class E0 extends Ci{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new R0(t)}),this.register(function(t){return new z0(t)}),this.register(function(t){return new U0(t)}),this.register(function(t){return new I0(t)}),this.register(function(t){return new F0(t)}),this.register(function(t){return new k0(t)}),this.register(function(t){return new B0(t)}),this.register(function(t){return new D0(t)}),this.register(function(t){return new N0(t)}),this.register(function(t){return new O0(t)}),this.register(function(t){return new L0(t)}),this.register(function(t){return new V0(t)})}load(e,t,i,a){const u=this;let g;this.resourcePath!==""?g=this.resourcePath:this.path!==""?g=this.path:g=ci.extractUrlBase(e),this.manager.itemStart(e);const s=function(o){a?a(o):console.error(o),u.manager.itemError(e),u.manager.itemEnd(e)},n=new cn(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){try{u.parse(o,g,function(f){t(f),u.manager.itemEnd(e)},s)}catch(f){s(f)}},i,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,a){let u;const g={},s={};if(typeof e=="string")u=e;else if(ci.decodeText(new Uint8Array(e,0,4))===Ah){try{g[Ue.KHR_BINARY_GLTF]=new G0(e)}catch(r){a&&a(r);return}u=g[Ue.KHR_BINARY_GLTF].content}else u=ci.decodeText(new Uint8Array(e));const n=JSON.parse(u);if(n.asset===void 0||n.asset.version[0]<2){a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const o=new t_(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let f=0;f<this.pluginCallbacks.length;f++){const r=this.pluginCallbacks[f](o);s[r.name]=r,g[r.name]=!0}if(n.extensionsUsed)for(let f=0;f<n.extensionsUsed.length;++f){const r=n.extensionsUsed[f],l=n.extensionsRequired||[];switch(r){case Ue.KHR_MATERIALS_UNLIT:g[r]=new P0;break;case Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:g[r]=new j0;break;case Ue.KHR_DRACO_MESH_COMPRESSION:g[r]=new H0(n,this.dracoLoader);break;case Ue.KHR_TEXTURE_TRANSFORM:g[r]=new W0;break;case Ue.KHR_MESH_QUANTIZATION:g[r]=new X0;break;default:l.indexOf(r)>=0&&s[r]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+r+'".')}}o.setExtensions(g),o.setPlugins(s),o.parse(i,a)}parseAsync(e,t){const i=this;return new Promise(function(a,u){i.parse(e,t,a,u)})}}function A0(){let m={};return{get:function(e){return m[e]},add:function(e,t){m[e]=t},remove:function(e){delete m[e]},removeAll:function(){m={}}}}const Ue={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class L0{constructor(e){this.parser=e,this.name=Ue.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,a=t.length;i<a;i++){const u=t[i];u.extensions&&u.extensions[this.name]&&u.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,u.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let a=t.cache.get(i);if(a)return a;const u=t.json,n=((u.extensions&&u.extensions[this.name]||{}).lights||[])[e];let o;const f=new Te(16777215);n.color!==void 0&&f.fromArray(n.color);const r=n.range!==void 0?n.range:0;switch(n.type){case"directional":o=new zn(f),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ja(f),o.distance=r;break;case"spot":o=new Sh(f),o.distance=r,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,o.angle=n.spot.outerConeAngle,o.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return o.position.set(0,0,0),o.decay=2,n.intensity!==void 0&&(o.intensity=n.intensity),o.name=t.createUniqueName(n.name||"light_"+e),a=Promise.resolve(o),t.cache.add(i,a),a}createNodeAttachment(e){const t=this,i=this.parser,u=i.json.nodes[e],s=(u.extensions&&u.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(n){return i._getNodeRef(t.cache,s,n)})}}class P0{constructor(){this.name=Ue.KHR_MATERIALS_UNLIT}getMaterialType(){return Bi}extendParams(e,t,i){const a=[];e.color=new Te(1,1,1),e.opacity=1;const u=t.pbrMetallicRoughness;if(u){if(Array.isArray(u.baseColorFactor)){const g=u.baseColorFactor;e.color.fromArray(g),e.opacity=g[3]}u.baseColorTexture!==void 0&&a.push(i.assignTexture(e,"map",u.baseColorTexture,ze))}return Promise.all(a)}}class D0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const a=this.parser.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=a.extensions[this.name].emissiveStrength;return u!==void 0&&(t.emissiveIntensity=u),Promise.resolve()}}class R0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[],g=a.extensions[this.name];if(g.clearcoatFactor!==void 0&&(t.clearcoat=g.clearcoatFactor),g.clearcoatTexture!==void 0&&u.push(i.assignTexture(t,"clearcoatMap",g.clearcoatTexture)),g.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=g.clearcoatRoughnessFactor),g.clearcoatRoughnessTexture!==void 0&&u.push(i.assignTexture(t,"clearcoatRoughnessMap",g.clearcoatRoughnessTexture)),g.clearcoatNormalTexture!==void 0&&(u.push(i.assignTexture(t,"clearcoatNormalMap",g.clearcoatNormalTexture)),g.clearcoatNormalTexture.scale!==void 0)){const s=g.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new De(s,s)}return Promise.all(u)}}class O0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[],g=a.extensions[this.name];return g.iridescenceFactor!==void 0&&(t.iridescence=g.iridescenceFactor),g.iridescenceTexture!==void 0&&u.push(i.assignTexture(t,"iridescenceMap",g.iridescenceTexture)),g.iridescenceIor!==void 0&&(t.iridescenceIOR=g.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),g.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=g.iridescenceThicknessMinimum),g.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=g.iridescenceThicknessMaximum),g.iridescenceThicknessTexture!==void 0&&u.push(i.assignTexture(t,"iridescenceThicknessMap",g.iridescenceThicknessTexture)),Promise.all(u)}}class I0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[];t.sheenColor=new Te(0,0,0),t.sheenRoughness=0,t.sheen=1;const g=a.extensions[this.name];return g.sheenColorFactor!==void 0&&t.sheenColor.fromArray(g.sheenColorFactor),g.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=g.sheenRoughnessFactor),g.sheenColorTexture!==void 0&&u.push(i.assignTexture(t,"sheenColorMap",g.sheenColorTexture,ze)),g.sheenRoughnessTexture!==void 0&&u.push(i.assignTexture(t,"sheenRoughnessMap",g.sheenRoughnessTexture)),Promise.all(u)}}class F0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[],g=a.extensions[this.name];return g.transmissionFactor!==void 0&&(t.transmission=g.transmissionFactor),g.transmissionTexture!==void 0&&u.push(i.assignTexture(t,"transmissionMap",g.transmissionTexture)),Promise.all(u)}}class k0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[],g=a.extensions[this.name];t.thickness=g.thicknessFactor!==void 0?g.thicknessFactor:0,g.thicknessTexture!==void 0&&u.push(i.assignTexture(t,"thicknessMap",g.thicknessTexture)),t.attenuationDistance=g.attenuationDistance||0;const s=g.attenuationColor||[1,1,1];return t.attenuationColor=new Te(s[0],s[1],s[2]),Promise.all(u)}}class B0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const a=this.parser.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=a.extensions[this.name];return t.ior=u.ior!==void 0?u.ior:1.5,Promise.resolve()}}class N0{constructor(e){this.parser=e,this.name=Ue.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:ji}extendMaterialParams(e,t){const i=this.parser,a=i.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const u=[],g=a.extensions[this.name];t.specularIntensity=g.specularFactor!==void 0?g.specularFactor:1,g.specularTexture!==void 0&&u.push(i.assignTexture(t,"specularIntensityMap",g.specularTexture));const s=g.specularColorFactor||[1,1,1];return t.specularColor=new Te(s[0],s[1],s[2]),g.specularColorTexture!==void 0&&u.push(i.assignTexture(t,"specularColorMap",g.specularColorTexture,ze)),Promise.all(u)}}class z0{constructor(e){this.parser=e,this.name=Ue.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,a=i.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const u=a.extensions[this.name],g=t.options.ktx2Loader;if(!g){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,u.source,g)}}class U0{constructor(e){this.parser=e,this.name=Ue.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,a=i.json,u=a.textures[e];if(!u.extensions||!u.extensions[t])return null;const g=u.extensions[t],s=a.images[g.source];let n=i.textureLoader;if(s.uri){const o=i.options.manager.getHandler(s.uri);o!==null&&(n=o)}return this.detectSupport().then(function(o){if(o)return i.loadTextureImage(e,g.source,n);if(a.extensionsRequired&&a.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class V0{constructor(e){this.name=Ue.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const a=i.extensions[this.name],u=this.parser.getDependency("buffer",a.buffer),g=this.parser.options.meshoptDecoder;if(!g||!g.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([u,g.ready]).then(function(s){const n=a.byteOffset||0,o=a.byteLength||0,f=a.count,r=a.byteStride,l=new ArrayBuffer(f*r),c=new Uint8Array(s[0],n,o);return g.decodeGltfBuffer(new Uint8Array(l),f,r,c,a.mode,a.filter),l})}else return null}}const Ah="glTF",xr=12,pc={JSON:1313821514,BIN:5130562};class G0{constructor(e){this.name=Ue.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,xr);if(this.header={magic:ci.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Ah)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-xr,a=new DataView(e,xr);let u=0;for(;u<i;){const g=a.getUint32(u,!0);u+=4;const s=a.getUint32(u,!0);if(u+=4,s===pc.JSON){const n=new Uint8Array(e,xr+u,g);this.content=ci.decodeText(n)}else if(s===pc.BIN){const n=xr+u;this.body=e.slice(n,n+g)}u+=g}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class H0{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ue.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,a=this.dracoLoader,u=e.extensions[this.name].bufferView,g=e.extensions[this.name].attributes,s={},n={},o={};for(const f in g){const r=qa[f]||f.toLowerCase();s[r]=g[f]}for(const f in e.attributes){const r=qa[f]||f.toLowerCase();if(g[f]!==void 0){const l=i.accessors[e.attributes[f]],c=Or[l.componentType];o[r]=c,n[r]=l.normalized===!0}}return t.getDependency("bufferView",u).then(function(f){return new Promise(function(r){a.decodeDracoFile(f,function(l){for(const c in l.attributes){const d=l.attributes[c],p=n[c];p!==void 0&&(d.normalized=p)}r(l)},s,o)})})}}class W0{constructor(){this.name=Ue.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Ya extends ln{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),g=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),s={specular:{value:new Te().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(n){for(const o in s)n.uniforms[o]=s[o];n.fragmentShader=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",g)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(n){s.specular.value=n}},specularMap:{get:function(){return s.specularMap.value},set:function(n){s.specularMap.value=n,n?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(n){s.glossiness.value=n}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(n){s.glossinessMap.value=n,n?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class j0{constructor(){this.name=Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Ya}extendParams(e,t,i){const a=t.extensions[this.name];e.color=new Te(1,1,1),e.opacity=1;const u=[];if(Array.isArray(a.diffuseFactor)){const g=a.diffuseFactor;e.color.fromArray(g),e.opacity=g[3]}if(a.diffuseTexture!==void 0&&u.push(i.assignTexture(e,"map",a.diffuseTexture,ze)),e.emissive=new Te(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new Te(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const g=a.specularGlossinessTexture;u.push(i.assignTexture(e,"glossinessMap",g)),u.push(i.assignTexture(e,"specularMap",g,ze))}return Promise.all(u)}createMaterial(e){const t=new Ya(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=un,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class X0{constructor(){this.name=Ue.KHR_MESH_QUANTIZATION}}class vo extends zr{constructor(e,t,i,a){super(e,t,i,a)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,a=this.valueSize,u=e*a*3+a;for(let g=0;g!==a;g++)t[g]=i[u+g];return t}}vo.prototype.interpolate_=function(m,e,t,i){const a=this.resultBuffer,u=this.sampleValues,g=this.valueSize,s=g*2,n=g*3,o=i-e,f=(t-e)/o,r=f*f,l=r*f,c=m*n,d=c-n,p=-2*l+3*r,h=l-r,v=1-p,_=h-r+f;for(let y=0;y!==g;y++){const x=u[d+y+g],b=u[d+y+s]*o,w=u[c+y+g],M=u[c+y]*o;a[y]=v*x+_*b+p*w+h*M}return a};const Y0=new St;class q0 extends vo{interpolate_(e,t,i,a){const u=super.interpolate_(e,t,i,a);return Y0.fromArray(u).normalize().toArray(u),u}}const yi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Or={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mc={9728:mt,9729:rt,9984:Ba,9985:Yc,9986:Na,9987:hn},gc={33071:_t,33648:Ts,10497:Vi},vc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qa={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Fi={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K0={CUBICSPLINE:void 0,LINEAR:Xn,STEP:Lr},Ea={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function $0(m){return m.DefaultMaterial===void 0&&(m.DefaultMaterial=new ln({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Gn})),m.DefaultMaterial}function br(m,e,t){for(const i in t.extensions)m[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Qi(m,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(m.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Z0(m,e,t){let i=!1,a=!1,u=!1;for(let o=0,f=e.length;o<f;o++){const r=e[o];if(r.POSITION!==void 0&&(i=!0),r.NORMAL!==void 0&&(a=!0),r.COLOR_0!==void 0&&(u=!0),i&&a&&u)break}if(!i&&!a&&!u)return Promise.resolve(m);const g=[],s=[],n=[];for(let o=0,f=e.length;o<f;o++){const r=e[o];if(i){const l=r.POSITION!==void 0?t.getDependency("accessor",r.POSITION):m.attributes.position;g.push(l)}if(a){const l=r.NORMAL!==void 0?t.getDependency("accessor",r.NORMAL):m.attributes.normal;s.push(l)}if(u){const l=r.COLOR_0!==void 0?t.getDependency("accessor",r.COLOR_0):m.attributes.color;n.push(l)}}return Promise.all([Promise.all(g),Promise.all(s),Promise.all(n)]).then(function(o){const f=o[0],r=o[1],l=o[2];return i&&(m.morphAttributes.position=f),a&&(m.morphAttributes.normal=r),u&&(m.morphAttributes.color=l),m.morphTargetsRelative=!0,m})}function J0(m,e){if(m.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)m.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(m.morphTargetInfluences.length===t.length){m.morphTargetDictionary={};for(let i=0,a=t.length;i<a;i++)m.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Q0(m){const e=m.extensions&&m.extensions[Ue.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+_c(e.attributes):t=m.indices+":"+_c(m.attributes)+":"+m.mode,t}function _c(m){let e="";const t=Object.keys(m).sort();for(let i=0,a=t.length;i<a;i++)e+=t[i]+":"+m[t[i]]+";";return e}function Ka(m){switch(m){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function e_(m){return m.search(/\.jpe?g($|\?)/i)>0||m.search(/^data\:image\/jpeg/)===0?"image/jpeg":m.search(/\.webp($|\?)/i)>0||m.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class t_{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new A0,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,u=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||i||a&&u<98?this.textureLoader=new wh(this.options.manager):this.textureLoader=new Qv(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new cn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,a=this.json,u=this.extensions;this.cache.removeAll(),this._invokeAll(function(g){return g._markDefs&&g._markDefs()}),Promise.all(this._invokeAll(function(g){return g.beforeRoot&&g.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(g){const s={scene:g[0][a.scene||0],scenes:g[0],animations:g[1],cameras:g[2],asset:a.asset,parser:i,userData:{}};br(u,s,a),Qi(s,a),Promise.all(i._invokeAll(function(n){return n.afterRoot&&n.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let a=0,u=t.length;a<u;a++){const g=t[a].joints;for(let s=0,n=g.length;s<n;s++)e[g[s]].isBone=!0}for(let a=0,u=e.length;a<u;a++){const g=e[a];g.mesh!==void 0&&(this._addNodeRef(this.meshCache,g.mesh),g.skin!==void 0&&(i[g.mesh].isSkinnedMesh=!0)),g.camera!==void 0&&this._addNodeRef(this.cameraCache,g.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const a=i.clone(),u=(g,s)=>{const n=this.associations.get(g);n!=null&&this.associations.set(s,n);for(const[o,f]of g.children.entries())u(f,s.children[o])};return u(i,a),a.name+="_instance_"+e.uses[t]++,a}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const a=e(t[i]);if(a)return a}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let a=0;a<t.length;a++){const u=e(t[a]);u&&i.push(u)}return i}getDependency(e,t){const i=e+":"+t;let a=this.cache.get(i);if(!a){switch(e){case"scene":a=this.loadScene(t);break;case"node":a=this.loadNode(t);break;case"mesh":a=this._invokeOne(function(u){return u.loadMesh&&u.loadMesh(t)});break;case"accessor":a=this.loadAccessor(t);break;case"bufferView":a=this._invokeOne(function(u){return u.loadBufferView&&u.loadBufferView(t)});break;case"buffer":a=this.loadBuffer(t);break;case"material":a=this._invokeOne(function(u){return u.loadMaterial&&u.loadMaterial(t)});break;case"texture":a=this._invokeOne(function(u){return u.loadTexture&&u.loadTexture(t)});break;case"skin":a=this.loadSkin(t);break;case"animation":a=this._invokeOne(function(u){return u.loadAnimation&&u.loadAnimation(t)});break;case"camera":a=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,a)}return a}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(a.map(function(u,g){return i.getDependency(e,g)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ue.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(u,g){i.load(ci.resolveURL(t.uri,a.path),u,void 0,function(){g(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const a=t.byteLength||0,u=t.byteOffset||0;return i.slice(u,u+a)})}loadAccessor(e){const t=this,i=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const u=[];return a.bufferView!==void 0?u.push(this.getDependency("bufferView",a.bufferView)):u.push(null),a.sparse!==void 0&&(u.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),u.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(u).then(function(g){const s=g[0],n=vc[a.type],o=Or[a.componentType],f=o.BYTES_PER_ELEMENT,r=f*n,l=a.byteOffset||0,c=a.bufferView!==void 0?i.bufferViews[a.bufferView].byteStride:void 0,d=a.normalized===!0;let p,h;if(c&&c!==r){const v=Math.floor(l/c),_="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+v+":"+a.count;let y=t.cache.get(_);y||(p=new o(s,v*c,a.count*c/f),y=new Cv(p,c/f),t.cache.add(_,y)),h=new ho(y,n,l%c/f,d)}else s===null?p=new o(a.count*n):p=new o(s,l,a.count*n),h=new Tt(p,n,d);if(a.sparse!==void 0){const v=vc.SCALAR,_=Or[a.sparse.indices.componentType],y=a.sparse.indices.byteOffset||0,x=a.sparse.values.byteOffset||0,b=new _(g[1],y,a.sparse.count*v),w=new o(g[2],x,a.sparse.count*n);s!==null&&(h=new Tt(h.array.slice(),h.itemSize,h.normalized));for(let M=0,S=b.length;M<S;M++){const C=b[M];if(h.setX(C,w[M*n]),n>=2&&h.setY(C,w[M*n+1]),n>=3&&h.setZ(C,w[M*n+2]),n>=4&&h.setW(C,w[M*n+3]),n>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return h})}loadTexture(e){const t=this.json,i=this.options,u=t.textures[e].source,g=t.images[u];let s=this.textureLoader;if(g.uri){const n=i.manager.getHandler(g.uri);n!==null&&(s=n)}return this.loadTextureImage(e,u,s)}loadTextureImage(e,t,i){const a=this,u=this.json,g=u.textures[e],s=u.images[t],n=(s.uri||s.bufferView)+":"+g.sampler;if(this.textureCache[n])return this.textureCache[n];const o=this.loadImageSource(t,i).then(function(f){f.flipY=!1,g.name&&(f.name=g.name);const l=(u.samplers||{})[g.sampler]||{};return f.magFilter=mc[l.magFilter]||rt,f.minFilter=mc[l.minFilter]||hn,f.wrapS=gc[l.wrapS]||Vi,f.wrapT=gc[l.wrapT]||Vi,a.associations.set(f,{textures:e}),f}).catch(function(){return null});return this.textureCache[n]=o,o}loadImageSource(e,t){const i=this,a=this.json,u=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(r=>r.clone());const g=a.images[e],s=self.URL||self.webkitURL;let n=g.uri||"",o=!1;if(g.bufferView!==void 0)n=i.getDependency("bufferView",g.bufferView).then(function(r){o=!0;const l=new Blob([r],{type:g.mimeType});return n=s.createObjectURL(l),n});else if(g.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const f=Promise.resolve(n).then(function(r){return new Promise(function(l,c){let d=l;t.isImageBitmapLoader===!0&&(d=function(p){const h=new at(p);h.needsUpdate=!0,l(h)}),t.load(ci.resolveURL(r,u.path),d,void 0,c)})}).then(function(r){return o===!0&&s.revokeObjectURL(n),r.userData.mimeType=g.mimeType||e_(g.uri),r}).catch(function(r){throw console.error("THREE.GLTFLoader: Couldn't load texture",n),r});return this.sourceCache[e]=f,f}assignTexture(e,t,i,a){const u=this;return this.getDependency("texture",i.index).then(function(g){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),u.extensions[Ue.KHR_TEXTURE_TRANSFORM]){const s=i.extensions!==void 0?i.extensions[Ue.KHR_TEXTURE_TRANSFORM]:void 0;if(s){const n=u.associations.get(g);g=u.extensions[Ue.KHR_TEXTURE_TRANSFORM].extendTexture(g,s),u.associations.set(g,n)}}return a!==void 0&&(g.encoding=a),e[t]=g,g})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const a=t.attributes.tangent===void 0,u=t.attributes.color!==void 0,g=t.attributes.normal===void 0;if(e.isPoints){const s="PointsMaterial:"+i.uuid;let n=this.cache.get(s);n||(n=new rn,it.prototype.copy.call(n,i),n.color.copy(i.color),n.map=i.map,n.sizeAttenuation=!1,this.cache.add(s,n)),i=n}else if(e.isLine){const s="LineBasicMaterial:"+i.uuid;let n=this.cache.get(s);n||(n=new zi,it.prototype.copy.call(n,i),n.color.copy(i.color),this.cache.add(s,n)),i=n}if(a||u||g){let s="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(s+="specular-glossiness:"),a&&(s+="derivative-tangents:"),u&&(s+="vertex-colors:"),g&&(s+="flat-shading:");let n=this.cache.get(s);n||(n=i.clone(),u&&(n.vertexColors=!0),g&&(n.flatShading=!0),a&&(n.normalScale&&(n.normalScale.y*=-1),n.clearcoatNormalScale&&(n.clearcoatNormalScale.y*=-1)),this.cache.add(s,n),this.associations.set(n,this.associations.get(i))),i=n}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return ln}loadMaterial(e){const t=this,i=this.json,a=this.extensions,u=i.materials[e];let g;const s={},n=u.extensions||{},o=[];if(n[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const r=a[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];g=r.getMaterialType(),o.push(r.extendParams(s,u,t))}else if(n[Ue.KHR_MATERIALS_UNLIT]){const r=a[Ue.KHR_MATERIALS_UNLIT];g=r.getMaterialType(),o.push(r.extendParams(s,u,t))}else{const r=u.pbrMetallicRoughness||{};if(s.color=new Te(1,1,1),s.opacity=1,Array.isArray(r.baseColorFactor)){const l=r.baseColorFactor;s.color.fromArray(l),s.opacity=l[3]}r.baseColorTexture!==void 0&&o.push(t.assignTexture(s,"map",r.baseColorTexture,ze)),s.metalness=r.metallicFactor!==void 0?r.metallicFactor:1,s.roughness=r.roughnessFactor!==void 0?r.roughnessFactor:1,r.metallicRoughnessTexture!==void 0&&(o.push(t.assignTexture(s,"metalnessMap",r.metallicRoughnessTexture)),o.push(t.assignTexture(s,"roughnessMap",r.metallicRoughnessTexture))),g=this._invokeOne(function(l){return l.getMaterialType&&l.getMaterialType(e)}),o.push(Promise.all(this._invokeAll(function(l){return l.extendMaterialParams&&l.extendMaterialParams(e,s)})))}u.doubleSided===!0&&(s.side=Si);const f=u.alphaMode||Ea.OPAQUE;if(f===Ea.BLEND?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,f===Ea.MASK&&(s.alphaTest=u.alphaCutoff!==void 0?u.alphaCutoff:.5)),u.normalTexture!==void 0&&g!==Bi&&(o.push(t.assignTexture(s,"normalMap",u.normalTexture)),s.normalScale=new De(1,1),u.normalTexture.scale!==void 0)){const r=u.normalTexture.scale;s.normalScale.set(r,r)}return u.occlusionTexture!==void 0&&g!==Bi&&(o.push(t.assignTexture(s,"aoMap",u.occlusionTexture)),u.occlusionTexture.strength!==void 0&&(s.aoMapIntensity=u.occlusionTexture.strength)),u.emissiveFactor!==void 0&&g!==Bi&&(s.emissive=new Te().fromArray(u.emissiveFactor)),u.emissiveTexture!==void 0&&g!==Bi&&o.push(t.assignTexture(s,"emissiveMap",u.emissiveTexture,ze)),Promise.all(o).then(function(){let r;return g===Ya?r=a[Ue.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):r=new g(s),u.name&&(r.name=u.name),Qi(r,u),t.associations.set(r,{materials:e}),u.extensions&&br(a,r,u),r})}createUniqueName(e){const t=He.sanitizeNodeName(e||"");let i=t;for(let a=1;this.nodeNamesUsed[i];++a)i=t+"_"+a;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,a=this.primitiveCache;function u(s){return i[Ue.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(s,t).then(function(n){return yc(n,s,t)})}const g=[];for(let s=0,n=e.length;s<n;s++){const o=e[s],f=Q0(o),r=a[f];if(r)g.push(r.promise);else{let l;o.extensions&&o.extensions[Ue.KHR_DRACO_MESH_COMPRESSION]?l=u(o):l=yc(new ut,o,t),a[f]={primitive:o,promise:l},g.push(l)}}return Promise.all(g)}loadMesh(e){const t=this,i=this.json,a=this.extensions,u=i.meshes[e],g=u.primitives,s=[];for(let n=0,o=g.length;n<o;n++){const f=g[n].material===void 0?$0(this.cache):this.getDependency("material",g[n].material);s.push(f)}return s.push(t.loadGeometries(g)),Promise.all(s).then(function(n){const o=n.slice(0,n.length-1),f=n[n.length-1],r=[];for(let c=0,d=f.length;c<d;c++){const p=f[c],h=g[c];let v;const _=o[c];if(h.mode===yi.TRIANGLES||h.mode===yi.TRIANGLE_STRIP||h.mode===yi.TRIANGLE_FAN||h.mode===void 0)v=u.isSkinnedMesh===!0?new vh(p,_):new Mt(p,_),v.isSkinnedMesh===!0&&!v.geometry.attributes.skinWeight.normalized&&v.normalizeSkinWeights(),h.mode===yi.TRIANGLE_STRIP?v.geometry=xc(v.geometry,df):h.mode===yi.TRIANGLE_FAN&&(v.geometry=xc(v.geometry,$c));else if(h.mode===yi.LINES)v=new Ha(p,_);else if(h.mode===yi.LINE_STRIP)v=new zs(p,_);else if(h.mode===yi.LINE_LOOP)v=new Pv(p,_);else if(h.mode===yi.POINTS)v=new xs(p,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);Object.keys(v.geometry.morphAttributes).length>0&&J0(v,u),v.name=t.createUniqueName(u.name||"mesh_"+e),Qi(v,u),h.extensions&&br(a,v,h),t.assignFinalMaterial(v),r.push(v)}for(let c=0,d=r.length;c<d;c++)t.associations.set(r[c],{meshes:e,primitives:c});if(r.length===1)return r[0];const l=new oi;t.associations.set(l,{meshes:e});for(let c=0,d=r.length;c<d;c++)l.add(r[c]);return l})}loadCamera(e){let t;const i=this.json.cameras[e],a=i[i.type];if(!a){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new vt(Xt.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):i.type==="orthographic"&&(t=new tr(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Qi(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(a){return i.inverseBindMatrices=a,i})}loadAnimation(e){const i=this.json.animations[e],a=[],u=[],g=[],s=[],n=[];for(let o=0,f=i.channels.length;o<f;o++){const r=i.channels[o],l=i.samplers[r.sampler],c=r.target,d=c.node!==void 0?c.node:c.id,p=i.parameters!==void 0?i.parameters[l.input]:l.input,h=i.parameters!==void 0?i.parameters[l.output]:l.output;a.push(this.getDependency("node",d)),u.push(this.getDependency("accessor",p)),g.push(this.getDependency("accessor",h)),s.push(l),n.push(c)}return Promise.all([Promise.all(a),Promise.all(u),Promise.all(g),Promise.all(s),Promise.all(n)]).then(function(o){const f=o[0],r=o[1],l=o[2],c=o[3],d=o[4],p=[];for(let v=0,_=f.length;v<_;v++){const y=f[v],x=r[v],b=l[v],w=c[v],M=d[v];if(y===void 0)continue;y.updateMatrix(),y.matrixAutoUpdate=!0;let S;switch(Fi[M.path]){case Fi.weights:S=qn;break;case Fi.rotation:S=Hi;break;case Fi.position:case Fi.scale:default:S=Kn;break}const C=y.name?y.name:y.uuid,O=w.interpolation!==void 0?K0[w.interpolation]:Xn,k=[];Fi[M.path]===Fi.weights?y.traverse(function(H){H.morphTargetInfluences&&k.push(H.name?H.name:H.uuid)}):k.push(C);let Y=b.array;if(b.normalized){const H=Ka(Y.constructor),N=new Float32Array(Y.length);for(let U=0,G=Y.length;U<G;U++)N[U]=Y[U]*H;Y=N}for(let H=0,N=k.length;H<N;H++){const U=new S(k[H]+"."+Fi[M.path],x.array,Y,O);w.interpolation==="CUBICSPLINE"&&(U.createInterpolant=function(j){const q=this instanceof Hi?q0:vo;return new q(this.times,this.values,this.getValueSize()/3,j)},U.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),p.push(U)}}const h=i.name?i.name:"animation_"+e;return new bh(h,void 0,p)})}createNodeMesh(e){const t=this.json,i=this,a=t.nodes[e];return a.mesh===void 0?null:i.getDependency("mesh",a.mesh).then(function(u){const g=i._getNodeRef(i.meshCache,a.mesh,u);return a.weights!==void 0&&g.traverse(function(s){if(!!s.isMesh)for(let n=0,o=a.weights.length;n<o;n++)s.morphTargetInfluences[n]=a.weights[n]}),g})}loadNode(e){const t=this.json,i=this.extensions,a=this,u=t.nodes[e],g=u.name?a.createUniqueName(u.name):"";return function(){const s=[],n=a._invokeOne(function(o){return o.createNodeMesh&&o.createNodeMesh(e)});return n&&s.push(n),u.camera!==void 0&&s.push(a.getDependency("camera",u.camera).then(function(o){return a._getNodeRef(a.cameraCache,u.camera,o)})),a._invokeAll(function(o){return o.createNodeAttachment&&o.createNodeAttachment(e)}).forEach(function(o){s.push(o)}),Promise.all(s)}().then(function(s){let n;if(u.isBone===!0?n=new Es:s.length>1?n=new oi:s.length===1?n=s[0]:n=new et,n!==s[0])for(let o=0,f=s.length;o<f;o++)n.add(s[o]);if(u.name&&(n.userData.name=u.name,n.name=g),Qi(n,u),u.extensions&&br(i,n,u),u.matrix!==void 0){const o=new Le;o.fromArray(u.matrix),n.applyMatrix4(o)}else u.translation!==void 0&&n.position.fromArray(u.translation),u.rotation!==void 0&&n.quaternion.fromArray(u.rotation),u.scale!==void 0&&n.scale.fromArray(u.scale);return a.associations.has(n)||a.associations.set(n,{}),a.associations.get(n).nodes=e,n})}loadScene(e){const t=this.json,i=this.extensions,a=this.json.scenes[e],u=this,g=new oi;a.name&&(g.name=u.createUniqueName(a.name)),Qi(g,a),a.extensions&&br(i,g,a);const s=a.nodes||[],n=[];for(let o=0,f=s.length;o<f;o++)n.push(Lh(s[o],g,t,u));return Promise.all(n).then(function(){const o=f=>{const r=new Map;for(const[l,c]of u.associations)(l instanceof it||l instanceof at)&&r.set(l,c);return f.traverse(l=>{const c=u.associations.get(l);c!=null&&r.set(l,c)}),r};return u.associations=o(g),g})}}function Lh(m,e,t,i){const a=t.nodes[m];return i.getDependency("node",m).then(function(u){if(a.skin===void 0)return u;let g;return i.getDependency("skin",a.skin).then(function(s){g=s;const n=[];for(let o=0,f=g.joints.length;o<f;o++)n.push(i.getDependency("node",g.joints[o]));return Promise.all(n)}).then(function(s){return u.traverse(function(n){if(!n.isMesh)return;const o=[],f=[];for(let r=0,l=s.length;r<l;r++){const c=s[r];if(c){o.push(c);const d=new Le;g.inverseBindMatrices!==void 0&&d.fromArray(g.inverseBindMatrices.array,r*16),f.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',g.joints[r])}n.bind(new Ns(o,f),n.matrixWorld)}),u})}).then(function(u){e.add(u);const g=[];if(a.children){const s=a.children;for(let n=0,o=s.length;n<o;n++){const f=s[n];g.push(Lh(f,u,t,i))}}return Promise.all(g)})}function i_(m,e,t){const i=e.attributes,a=new Qn;if(i.POSITION!==void 0){const s=t.json.accessors[i.POSITION],n=s.min,o=s.max;if(n!==void 0&&o!==void 0){if(a.set(new X(n[0],n[1],n[2]),new X(o[0],o[1],o[2])),s.normalized){const f=Ka(Or[s.componentType]);a.min.multiplyScalar(f),a.max.multiplyScalar(f)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const u=e.targets;if(u!==void 0){const s=new X,n=new X;for(let o=0,f=u.length;o<f;o++){const r=u[o];if(r.POSITION!==void 0){const l=t.json.accessors[r.POSITION],c=l.min,d=l.max;if(c!==void 0&&d!==void 0){if(n.setX(Math.max(Math.abs(c[0]),Math.abs(d[0]))),n.setY(Math.max(Math.abs(c[1]),Math.abs(d[1]))),n.setZ(Math.max(Math.abs(c[2]),Math.abs(d[2]))),l.normalized){const p=Ka(Or[l.componentType]);n.multiplyScalar(p)}s.max(n)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(s)}m.boundingBox=a;const g=new er;a.getCenter(g.center),g.radius=a.min.distanceTo(a.max)/2,m.boundingSphere=g}function yc(m,e,t){const i=e.attributes,a=[];function u(g,s){return t.getDependency("accessor",g).then(function(n){m.setAttribute(s,n)})}for(const g in i){const s=qa[g]||g.toLowerCase();s in m.attributes||a.push(u(i[g],s))}if(e.indices!==void 0&&!m.index){const g=t.getDependency("accessor",e.indices).then(function(s){m.setIndex(s)});a.push(g)}return Qi(m,e),i_(m,e,t),Promise.all(a).then(function(){return e.targets!==void 0?Z0(m,e.targets,t):m})}function xc(m,e){let t=m.getIndex();if(t===null){const g=[],s=m.getAttribute("position");if(s!==void 0){for(let n=0;n<s.count;n++)g.push(n);m.setIndex(g),t=m.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),m}const i=t.count-2,a=[];if(e===$c)for(let g=1;g<=i;g++)a.push(t.getX(0)),a.push(t.getX(g)),a.push(t.getX(g+1));else for(let g=0;g<i;g++)g%2===0?(a.push(t.getX(g)),a.push(t.getX(g+1)),a.push(t.getX(g+2))):(a.push(t.getX(g+2)),a.push(t.getX(g+1)),a.push(t.getX(g)));a.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const u=m.clone();return u.setIndex(a),u}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var bc={},$a=function(m){return URL.createObjectURL(new Blob([m],{type:"text/javascript"}))},Ph=function(m){return new Worker(m)};try{URL.revokeObjectURL($a(""))}catch{$a=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Ph=function(e){return new Worker(e,{type:"module"})}}var n_=function(m,e,t,i,a){var u=Ph(bc[e]||(bc[e]=$a(m)));return u.onerror=function(g){return a(g.error,null)},u.onmessage=function(g){return a(null,g.data)},u.postMessage(t,i),u},Ve=Uint8Array,dt=Uint16Array,Mi=Uint32Array,ar=new Ve([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),or=new Ve([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ir=new Ve([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dh=function(m,e){for(var t=new dt(31),i=0;i<31;++i)t[i]=e+=1<<m[i-1];for(var a=new Mi(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)a[u]=u-t[i]<<5|i;return[t,a]},Rh=Dh(ar,2),_o=Rh[0],As=Rh[1];_o[28]=258,As[258]=28;var Oh=Dh(or,0),Ih=Oh[0],Za=Oh[1],Fr=new dt(32768);for(var Je=0;Je<32768;++Je){var ki=(Je&43690)>>>1|(Je&21845)<<1;ki=(ki&52428)>>>2|(ki&13107)<<2,ki=(ki&61680)>>>4|(ki&3855)<<4,Fr[Je]=((ki&65280)>>>8|(ki&255)<<8)>>>1}var Nt=function(m,e,t){for(var i=m.length,a=0,u=new dt(e);a<i;++a)++u[m[a]-1];var g=new dt(e);for(a=0;a<e;++a)g[a]=g[a-1]+u[a-1]<<1;var s;if(t){s=new dt(1<<e);var n=15-e;for(a=0;a<i;++a)if(m[a])for(var o=a<<4|m[a],f=e-m[a],r=g[m[a]-1]++<<f,l=r|(1<<f)-1;r<=l;++r)s[Fr[r]>>>n]=o}else for(s=new dt(i),a=0;a<i;++a)m[a]&&(s[a]=Fr[g[m[a]-1]++]>>>15-m[a]);return s},Ti=new Ve(288);for(var Je=0;Je<144;++Je)Ti[Je]=8;for(var Je=144;Je<256;++Je)Ti[Je]=9;for(var Je=256;Je<280;++Je)Ti[Je]=7;for(var Je=280;Je<288;++Je)Ti[Je]=8;var Zn=new Ve(32);for(var Je=0;Je<32;++Je)Zn[Je]=5;var Fh=Nt(Ti,9,0),kh=Nt(Ti,9,1),Bh=Nt(Zn,5,0),Nh=Nt(Zn,5,1),bs=function(m){for(var e=m[0],t=1;t<m.length;++t)m[t]>e&&(e=m[t]);return e},Ft=function(m,e,t){var i=e/8|0;return(m[i]|m[i+1]<<8)>>(e&7)&t},ws=function(m,e){var t=e/8|0;return(m[t]|m[t+1]<<8|m[t+2]<<16)>>(e&7)},Ur=function(m){return(m/8|0)+(m&7&&1)},zt=function(m,e,t){(e==null||e<0)&&(e=0),(t==null||t>m.length)&&(t=m.length);var i=new(m instanceof dt?dt:m instanceof Mi?Mi:Ve)(t-e);return i.set(m.subarray(e,t)),i},Vr=function(m,e,t){var i=m.length;if(!i||t&&!t.l&&i<5)return e||new Ve(0);var a=!e||t,u=!t||t.i;t||(t={}),e||(e=new Ve(i*3));var g=function(F){var K=e.length;if(F>K){var ee=new Ve(Math.max(K*2,F));ee.set(e),e=ee}},s=t.f||0,n=t.p||0,o=t.b||0,f=t.l,r=t.d,l=t.m,c=t.n,d=i*8;do{if(!f){t.f=s=Ft(m,n,1);var p=Ft(m,n+1,3);if(n+=3,p)if(p==1)f=kh,r=Nh,l=9,c=5;else if(p==2){var y=Ft(m,n,31)+257,x=Ft(m,n+10,15)+4,b=y+Ft(m,n+5,31)+1;n+=14;for(var w=new Ve(b),M=new Ve(19),S=0;S<x;++S)M[Ir[S]]=Ft(m,n+S*3,7);n+=x*3;for(var C=bs(M),O=(1<<C)-1,k=Nt(M,C,1),S=0;S<b;){var Y=k[Ft(m,n,O)];n+=Y&15;var h=Y>>>4;if(h<16)w[S++]=h;else{var H=0,N=0;for(h==16?(N=3+Ft(m,n,3),n+=2,H=w[S-1]):h==17?(N=3+Ft(m,n,7),n+=3):h==18&&(N=11+Ft(m,n,127),n+=7);N--;)w[S++]=H}}var U=w.subarray(0,y),G=w.subarray(y);l=bs(U),c=bs(G),f=Nt(U,l,1),r=Nt(G,c,1)}else throw"invalid block type";else{var h=Ur(n)+4,v=m[h-4]|m[h-3]<<8,_=h+v;if(_>i){if(u)throw"unexpected EOF";break}a&&g(o+v),e.set(m.subarray(h,_),o),t.b=o+=v,t.p=n=_*8;continue}if(n>d){if(u)throw"unexpected EOF";break}}a&&g(o+131072);for(var j=(1<<l)-1,q=(1<<c)-1,T=n;;T=n){var H=f[ws(m,n)&j],P=H>>>4;if(n+=H&15,n>d){if(u)throw"unexpected EOF";break}if(!H)throw"invalid length/literal";if(P<256)e[o++]=P;else if(P==256){T=n,f=null;break}else{var R=P-254;if(P>264){var S=P-257,L=ar[S];R=Ft(m,n,(1<<L)-1)+_o[S],n+=L}var V=r[ws(m,n)&q],I=V>>>4;if(!V)throw"invalid distance";n+=V&15;var G=Ih[I];if(I>3){var L=or[I];G+=ws(m,n)&(1<<L)-1,n+=L}if(n>d){if(u)throw"unexpected EOF";break}a&&g(o+131072);for(var E=o+R;o<E;o+=4)e[o]=e[o-G],e[o+1]=e[o+1-G],e[o+2]=e[o+2-G],e[o+3]=e[o+3-G];o=E}}t.l=f,t.p=T,t.b=o,f&&(s=1,t.m=l,t.d=r,t.n=c)}while(!s);return o==e.length?e:zt(e,0,o)},ni=function(m,e,t){t<<=e&7;var i=e/8|0;m[i]|=t,m[i+1]|=t>>>8},Fn=function(m,e,t){t<<=e&7;var i=e/8|0;m[i]|=t,m[i+1]|=t>>>8,m[i+2]|=t>>>16},Ss=function(m,e){for(var t=[],i=0;i<m.length;++i)m[i]&&t.push({s:i,f:m[i]});var a=t.length,u=t.slice();if(!a)return[bi,0];if(a==1){var g=new Ve(t[0].s+1);return g[t[0].s]=1,[g,1]}t.sort(function(b,w){return b.f-w.f}),t.push({s:-1,f:25001});var s=t[0],n=t[1],o=0,f=1,r=2;for(t[0]={s:-1,f:s.f+n.f,l:s,r:n};f!=a-1;)s=t[t[o].f<t[r].f?o++:r++],n=t[o!=f&&t[o].f<t[r].f?o++:r++],t[f++]={s:-1,f:s.f+n.f,l:s,r:n};for(var l=u[0].s,i=1;i<a;++i)u[i].s>l&&(l=u[i].s);var c=new dt(l+1),d=Ls(t[f-1],c,0);if(d>e){var i=0,p=0,h=d-e,v=1<<h;for(u.sort(function(w,M){return c[M.s]-c[w.s]||w.f-M.f});i<a;++i){var _=u[i].s;if(c[_]>e)p+=v-(1<<d-c[_]),c[_]=e;else break}for(p>>>=h;p>0;){var y=u[i].s;c[y]<e?p-=1<<e-c[y]++-1:++i}for(;i>=0&&p;--i){var x=u[i].s;c[x]==e&&(--c[x],++p)}d=e}return[new Ve(c),d]},Ls=function(m,e,t){return m.s==-1?Math.max(Ls(m.l,e,t+1),Ls(m.r,e,t+1)):e[m.s]=t},Ja=function(m){for(var e=m.length;e&&!m[--e];);for(var t=new dt(++e),i=0,a=m[0],u=1,g=function(n){t[i++]=n},s=1;s<=e;++s)if(m[s]==a&&s!=e)++u;else{if(!a&&u>2){for(;u>138;u-=138)g(32754);u>2&&(g(u>10?u-11<<5|28690:u-3<<5|12305),u=0)}else if(u>3){for(g(a),--u;u>6;u-=6)g(8304);u>2&&(g(u-3<<5|8208),u=0)}for(;u--;)g(a);u=1,a=m[s]}return[t.subarray(0,i),e]},kn=function(m,e){for(var t=0,i=0;i<e.length;++i)t+=m[i]*e[i];return t},Er=function(m,e,t){var i=t.length,a=Ur(e+2);m[a]=i&255,m[a+1]=i>>>8,m[a+2]=m[a]^255,m[a+3]=m[a+1]^255;for(var u=0;u<i;++u)m[a+u+4]=t[u];return(a+4+i)*8},Qa=function(m,e,t,i,a,u,g,s,n,o,f){ni(e,f++,t),++a[256];for(var r=Ss(a,15),l=r[0],c=r[1],d=Ss(u,15),p=d[0],h=d[1],v=Ja(l),_=v[0],y=v[1],x=Ja(p),b=x[0],w=x[1],M=new dt(19),S=0;S<_.length;++S)M[_[S]&31]++;for(var S=0;S<b.length;++S)M[b[S]&31]++;for(var C=Ss(M,7),O=C[0],k=C[1],Y=19;Y>4&&!O[Ir[Y-1]];--Y);var H=o+5<<3,N=kn(a,Ti)+kn(u,Zn)+g,U=kn(a,l)+kn(u,p)+g+14+3*Y+kn(M,O)+(2*M[16]+3*M[17]+7*M[18]);if(H<=N&&H<=U)return Er(e,f,m.subarray(n,n+o));var G,j,q,T;if(ni(e,f,1+(U<N)),f+=2,U<N){G=Nt(l,c,0),j=l,q=Nt(p,h,0),T=p;var P=Nt(O,k,0);ni(e,f,y-257),ni(e,f+5,w-1),ni(e,f+10,Y-4),f+=14;for(var S=0;S<Y;++S)ni(e,f+3*S,O[Ir[S]]);f+=3*Y;for(var R=[_,b],L=0;L<2;++L)for(var V=R[L],S=0;S<V.length;++S){var I=V[S]&31;ni(e,f,P[I]),f+=O[I],I>15&&(ni(e,f,V[S]>>>5&127),f+=V[S]>>>12)}}else G=Fh,j=Ti,q=Bh,T=Zn;for(var S=0;S<s;++S)if(i[S]>255){var I=i[S]>>>18&31;Fn(e,f,G[I+257]),f+=j[I+257],I>7&&(ni(e,f,i[S]>>>23&31),f+=ar[I]);var E=i[S]&31;Fn(e,f,q[E]),f+=T[E],E>3&&(Fn(e,f,i[S]>>>5&8191),f+=or[E])}else Fn(e,f,G[i[S]]),f+=j[i[S]];return Fn(e,f,G[256]),f+j[256]},zh=new Mi([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),bi=new Ve(0),Uh=function(m,e,t,i,a,u){var g=m.length,s=new Ve(i+g+5*(1+Math.ceil(g/7e3))+a),n=s.subarray(i,s.length-a),o=0;if(!e||g<8)for(var f=0;f<=g;f+=65535){var r=f+65535;r<g?o=Er(n,o,m.subarray(f,r)):(n[f]=u,o=Er(n,o,m.subarray(f,g)))}else{for(var l=zh[e-1],c=l>>>13,d=l&8191,p=(1<<t)-1,h=new dt(32768),v=new dt(p+1),_=Math.ceil(t/3),y=2*_,x=function($){return(m[$]^m[$+1]<<_^m[$+2]<<y)&p},b=new Mi(25e3),w=new dt(288),M=new dt(32),S=0,C=0,f=0,O=0,k=0,Y=0;f<g;++f){var H=x(f),N=f&32767,U=v[H];if(h[N]=U,v[H]=N,k<=f){var G=g-f;if((S>7e3||O>24576)&&G>423){o=Qa(m,n,0,b,w,M,C,O,Y,f-Y,o),O=S=C=0,Y=f;for(var j=0;j<286;++j)w[j]=0;for(var j=0;j<30;++j)M[j]=0}var q=2,T=0,P=d,R=N-U&32767;if(G>2&&H==x(f-R))for(var L=Math.min(c,G)-1,V=Math.min(32767,f),I=Math.min(258,G);R<=V&&--P&&N!=U;){if(m[f+q]==m[f+q-R]){for(var E=0;E<I&&m[f+E]==m[f+E-R];++E);if(E>q){if(q=E,T=R,E>L)break;for(var F=Math.min(R,E-2),K=0,j=0;j<F;++j){var ee=f-R+j+32768&32767,Z=h[ee],J=ee-Z+32768&32767;J>K&&(K=J,U=ee)}}}N=U,U=h[N],R+=N-U+32768&32767}if(T){b[O++]=268435456|As[q]<<18|Za[T];var ae=As[q]&31,ue=Za[T]&31;C+=ar[ae]+or[ue],++w[257+ae],++M[ue],k=f+q,++S}else b[O++]=m[f],++w[m[f]]}}o=Qa(m,n,u,b,w,M,C,O,Y,f-Y,o),!u&&o&7&&(o=Er(n,o+1,bi))}return zt(s,0,i+Ur(o)+a)},Vh=function(){for(var m=new Mi(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;m[e]=t}return m}(),lr=function(){var m=-1;return{p:function(e){for(var t=m,i=0;i<e.length;++i)t=Vh[t&255^e[i]]^t>>>8;m=t},d:function(){return~m}}},yo=function(){var m=1,e=0;return{p:function(t){for(var i=m,a=e,u=t.length,g=0;g!=u;){for(var s=Math.min(g+2655,u);g<s;++g)a+=i+=t[g];i=(i&65535)+15*(i>>16),a=(a&65535)+15*(a>>16)}m=i,e=a},d:function(){return m%=65521,e%=65521,(m&255)<<24|m>>>8<<16|(e&255)<<8|e>>>8}}},dn=function(m,e,t,i,a){return Uh(m,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(m.length)))*1.5):12+e.mem,t,i,!a)},Gr=function(m,e){var t={};for(var i in m)t[i]=m[i];for(var i in e)t[i]=e[i];return t},wc=function(m,e,t){for(var i=m(),a=m.toString(),u=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<i.length;++g){var s=i[g],n=u[g];if(typeof s=="function"){e+=";"+n+"=";var o=s.toString();if(s.prototype)if(o.indexOf("[native code]")!=-1){var f=o.indexOf(" ",8)+1;e+=o.slice(f,o.indexOf("(",f))}else{e+=o;for(var r in s.prototype)e+=";"+n+".prototype."+r+"="+s.prototype[r].toString()}else e+=o}else t[n]=s}return[e,t]},ms=[],r_=function(m){var e=[];for(var t in m)(m[t]instanceof Ve||m[t]instanceof dt||m[t]instanceof Mi)&&e.push((m[t]=new m[t].constructor(m[t])).buffer);return e},Gh=function(m,e,t,i){var a;if(!ms[t]){for(var u="",g={},s=m.length-1,n=0;n<s;++n)a=wc(m[n],u,g),u=a[0],g=a[1];ms[t]=wc(m[s],u,g)}var o=Gr({},ms[t][1]);return n_(ms[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,o,r_(o),i)},cr=function(){return[Ve,dt,Mi,ar,or,Ir,_o,Ih,kh,Nh,Fr,Nt,bs,Ft,ws,Ur,zt,Vr,dr,Xi,xo]},hr=function(){return[Ve,dt,Mi,ar,or,Ir,As,Za,Fh,Ti,Bh,Zn,Fr,zh,bi,Nt,ni,Fn,Ss,Ls,Ja,kn,Er,Qa,Ur,zt,Uh,dn,Hr,Xi]},Hh=function(){return[bo,So,Xe,lr,Vh]},Wh=function(){return[wo,Yh]},jh=function(){return[Mo,Xe,yo]},Xh=function(){return[qh]},Xi=function(m){return postMessage(m,[m.buffer])},xo=function(m){return m&&m.size&&new Ve(m.size)},ur=function(m,e,t,i,a,u){var g=Gh(t,i,a,function(s,n){g.terminate(),u(s,n)});return g.postMessage([m,e],e.consume?[m.buffer]:[]),function(){g.terminate()}},Ut=function(m){return m.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return m.push(e.data[0],e.data[1])}},fr=function(m,e,t,i,a){var u,g=Gh(m,i,a,function(s,n){s?(g.terminate(),e.ondata.call(e,s)):(n[1]&&g.terminate(),e.ondata.call(e,s,n[0],n[1]))});g.postMessage(t),e.push=function(s,n){if(u)throw"stream finished";if(!e.ondata)throw"no stream handler";g.postMessage([s,u=n],[s.buffer])},e.terminate=function(){g.terminate()}},wt=function(m,e){return m[e]|m[e+1]<<8},st=function(m,e){return(m[e]|m[e+1]<<8|m[e+2]<<16|m[e+3]<<24)>>>0},Aa=function(m,e){return st(m,e)+st(m,e+4)*4294967296},Xe=function(m,e,t){for(;t;++e)m[e]=t,t>>>=8},bo=function(m,e){var t=e.filename;if(m[0]=31,m[1]=139,m[2]=8,m[8]=e.level<2?4:e.level==9?2:0,m[9]=3,e.mtime!=0&&Xe(m,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){m[3]=8;for(var i=0;i<=t.length;++i)m[i+10]=t.charCodeAt(i)}},wo=function(m){if(m[0]!=31||m[1]!=139||m[2]!=8)throw"invalid gzip data";var e=m[3],t=10;e&4&&(t+=m[10]|(m[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!m[t++]);return t+(e&2)},Yh=function(m){var e=m.length;return(m[e-4]|m[e-3]<<8|m[e-2]<<16|m[e-1]<<24)>>>0},So=function(m){return 10+(m.filename&&m.filename.length+1||0)},Mo=function(m,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;m[0]=120,m[1]=i<<6|(i?32-2*i:1)},qh=function(m){if((m[0]&15)!=8||m[0]>>>4>7||(m[0]<<8|m[1])%31)throw"invalid zlib data";if(m[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function To(m,e){return!e&&typeof m=="function"&&(e=m,m={}),this.ondata=e,m}var ui=function(){function m(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return m.prototype.p=function(e,t){this.ondata(dn(e,this.o,0,0,!t),t)},m.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},m}(),Kh=function(){function m(e,t){fr([hr,function(){return[Ut,ui]}],this,To.call(this,e,t),function(i){var a=new ui(i.data);onmessage=Ut(a)},6)}return m}();function $h(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[hr],function(i){return Xi(Hr(i.data[0],i.data[1]))},0,t)}function Hr(m,e){return dn(m,e||{},0,0)}var Lt=function(){function m(e){this.s={},this.p=new Ve(0),this.ondata=e}return m.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,i=new Ve(t+e.length);i.set(this.p),i.set(e,t),this.p=i},m.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,i=Vr(this.p,this.o,this.s);this.ondata(zt(i,t,this.s.b),this.d),this.o=zt(i,this.s.b-32768),this.s.b=this.o.length,this.p=zt(this.p,this.s.p/8|0),this.s.p&=7},m.prototype.push=function(e,t){this.e(e),this.c(t)},m}(),Co=function(){function m(e){this.ondata=e,fr([cr,function(){return[Ut,Lt]}],this,0,function(){var t=new Lt;onmessage=Ut(t)},7)}return m}();function Eo(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[cr],function(i){return Xi(dr(i.data[0],xo(i.data[1])))},1,t)}function dr(m,e){return Vr(m,e)}var Ps=function(){function m(e,t){this.c=lr(),this.l=0,this.v=1,ui.call(this,e,t)}return m.prototype.push=function(e,t){ui.prototype.push.call(this,e,t)},m.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var i=dn(e,this.o,this.v&&So(this.o),t&&8,!t);this.v&&(bo(i,this.o),this.v=0),t&&(Xe(i,i.length-8,this.c.d()),Xe(i,i.length-4,this.l)),this.ondata(i,t)},m}(),Sc=function(){function m(e,t){fr([hr,Hh,function(){return[Ut,ui,Ps]}],this,To.call(this,e,t),function(i){var a=new Ps(i.data);onmessage=Ut(a)},8)}return m}();function Mc(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[hr,Hh,function(){return[Ds]}],function(i){return Xi(Ds(i.data[0],i.data[1]))},2,t)}function Ds(m,e){e||(e={});var t=lr(),i=m.length;t.p(m);var a=dn(m,e,So(e),8),u=a.length;return bo(a,e),Xe(a,u-8,t.d()),Xe(a,u-4,i),a}var Rs=function(){function m(e){this.v=1,Lt.call(this,e)}return m.prototype.push=function(e,t){if(Lt.prototype.e.call(this,e),this.v){var i=this.p.length>3?wo(this.p):4;if(i>=this.p.length&&!t)return;this.p=this.p.subarray(i),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Lt.prototype.c.call(this,t)},m}(),Zh=function(){function m(e){this.ondata=e,fr([cr,Wh,function(){return[Ut,Lt,Rs]}],this,0,function(){var t=new Rs;onmessage=Ut(t)},9)}return m}();function Jh(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[cr,Wh,function(){return[Os]}],function(i){return Xi(Os(i.data[0]))},3,t)}function Os(m,e){return Vr(m.subarray(wo(m),-8),e||new Ve(Yh(m)))}var eo=function(){function m(e,t){this.c=yo(),this.v=1,ui.call(this,e,t)}return m.prototype.push=function(e,t){ui.prototype.push.call(this,e,t)},m.prototype.p=function(e,t){this.c.p(e);var i=dn(e,this.o,this.v&&2,t&&4,!t);this.v&&(Mo(i,this.o),this.v=0),t&&Xe(i,i.length-4,this.c.d()),this.ondata(i,t)},m}(),s_=function(){function m(e,t){fr([hr,jh,function(){return[Ut,ui,eo]}],this,To.call(this,e,t),function(i){var a=new eo(i.data);onmessage=Ut(a)},10)}return m}();function a_(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[hr,jh,function(){return[to]}],function(i){return Xi(to(i.data[0],i.data[1]))},4,t)}function to(m,e){e||(e={});var t=yo();t.p(m);var i=dn(m,e,2,4);return Mo(i,e),Xe(i,i.length-4,t.d()),i}var Is=function(){function m(e){this.v=1,Lt.call(this,e)}return m.prototype.push=function(e,t){if(Lt.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Lt.prototype.c.call(this,t)},m}(),Qh=function(){function m(e){this.ondata=e,fr([cr,Xh,function(){return[Ut,Lt,Is]}],this,0,function(){var t=new Is;onmessage=Ut(t)},11)}return m}();function eu(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ur(m,e,[cr,Xh,function(){return[kr]}],function(i){return Xi(kr(i.data[0],xo(i.data[1])))},5,t)}function kr(m,e){return Vr((qh(m),m.subarray(2,-4)),e)}var tu=function(){function m(e){this.G=Rs,this.I=Lt,this.Z=Is,this.ondata=e}return m.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var i=new Ve(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,u=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(u):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(u):new this.Z(u),this.s.push(this.p,t),this.p=null}}},m}(),o_=function(){function m(e){this.G=Zh,this.I=Co,this.Z=Qh,this.ondata=e}return m.prototype.push=function(e,t){tu.prototype.push.call(this,e,t)},m}();function l_(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return m[0]==31&&m[1]==139&&m[2]==8?Jh(m,e,t):(m[0]&15)!=8||m[0]>>4>7||(m[0]<<8|m[1])%31?Eo(m,e,t):eu(m,e,t)}function c_(m,e){return m[0]==31&&m[1]==139&&m[2]==8?Os(m,e):(m[0]&15)!=8||m[0]>>4>7||(m[0]<<8|m[1])%31?dr(m,e):kr(m,e)}var Ao=function(m,e,t,i){for(var a in m){var u=m[a],g=e+a;u instanceof Ve?t[g]=[u,i]:Array.isArray(u)?t[g]=[u[0],Gr(i,u[1])]:Ao(u,g+"/",t,i)}},Tc=typeof TextEncoder!="undefined"&&new TextEncoder,io=typeof TextDecoder!="undefined"&&new TextDecoder,iu=0;try{io.decode(bi,{stream:!0}),iu=1}catch{}var nu=function(m){for(var e="",t=0;;){var i=m[t++],a=(i>127)+(i>223)+(i>239);if(t+a>m.length)return[e,zt(m,t-1)];a?a==3?(i=((i&15)<<18|(m[t++]&63)<<12|(m[t++]&63)<<6|m[t++]&63)-65536,e+=String.fromCharCode(55296|i>>10,56320|i&1023)):a&1?e+=String.fromCharCode((i&31)<<6|m[t++]&63):e+=String.fromCharCode((i&15)<<12|(m[t++]&63)<<6|m[t++]&63):e+=String.fromCharCode(i)}},h_=function(){function m(e){this.ondata=e,iu?this.t=new TextDecoder:this.p=bi}return m.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var i=new Ve(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length);var a=nu(i),u=a[0],g=a[1];if(t){if(g.length)throw"invalid utf-8 data";this.p=null}else this.p=g;this.ondata(u,t)},m}(),u_=function(){function m(e){this.ondata=e}return m.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Wi(e),this.d=t||!1)},m}();function Wi(m,e){if(e){for(var t=new Ve(m.length),i=0;i<m.length;++i)t[i]=m.charCodeAt(i);return t}if(Tc)return Tc.encode(m);for(var a=m.length,u=new Ve(m.length+(m.length>>1)),g=0,s=function(f){u[g++]=f},i=0;i<a;++i){if(g+5>u.length){var n=new Ve(g+8+(a-i<<1));n.set(u),u=n}var o=m.charCodeAt(i);o<128||e?s(o):o<2048?(s(192|o>>6),s(128|o&63)):o>55295&&o<57344?(o=65536+(o&1023<<10)|m.charCodeAt(++i)&1023,s(240|o>>18),s(128|o>>12&63),s(128|o>>6&63),s(128|o&63)):(s(224|o>>12),s(128|o>>6&63),s(128|o&63))}return zt(u,0,g)}function Lo(m,e){if(e){for(var t="",i=0;i<m.length;i+=16384)t+=String.fromCharCode.apply(null,m.subarray(i,i+16384));return t}else{if(io)return io.decode(m);var a=nu(m),u=a[0],g=a[1];if(g.length)throw"invalid utf-8 data";return u}}var ru=function(m){return m==1?3:m<6?2:m==9?1:0},su=function(m,e){return e+30+wt(m,e+26)+wt(m,e+28)},au=function(m,e,t){var i=wt(m,e+28),a=Lo(m.subarray(e+46,e+46+i),!(wt(m,e+8)&2048)),u=e+46+i,g=st(m,e+20),s=t&&g==4294967295?ou(m,u):[g,st(m,e+24),st(m,e+42)],n=s[0],o=s[1],f=s[2];return[wt(m,e+10),n,o,a,u+wt(m,e+30)+wt(m,e+32),f]},ou=function(m,e){for(;wt(m,e)!=1;e+=4+wt(m,e+2));return[Aa(m,e+12),Aa(m,e+4),Aa(m,e+20)]},Ui=function(m){var e=0;if(m)for(var t in m){var i=m[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Jn=function(m,e,t,i,a,u,g,s){var n=i.length,o=t.extra,f=s&&s.length,r=Ui(o);Xe(m,e,g!=null?33639248:67324752),e+=4,g!=null&&(m[e++]=20,m[e++]=t.os),m[e]=20,e+=2,m[e++]=t.flag<<1|(u==null&&8),m[e++]=a&&8,m[e++]=t.compression&255,m[e++]=t.compression>>8;var l=new Date(t.mtime==null?Date.now():t.mtime),c=l.getFullYear()-1980;if(c<0||c>119)throw"date not in range 1980-2099";if(Xe(m,e,c<<25|l.getMonth()+1<<21|l.getDate()<<16|l.getHours()<<11|l.getMinutes()<<5|l.getSeconds()>>>1),e+=4,u!=null&&(Xe(m,e,t.crc),Xe(m,e+4,u),Xe(m,e+8,t.size)),Xe(m,e+12,n),Xe(m,e+14,r),e+=16,g!=null&&(Xe(m,e,f),Xe(m,e+6,t.attrs),Xe(m,e+10,g),e+=14),m.set(i,e),e+=n,r)for(var d in o){var p=o[d],h=p.length;Xe(m,e,+d),Xe(m,e+2,h),m.set(p,e+4),e+=4+h}return f&&(m.set(s,e),e+=f),e},Po=function(m,e,t,i,a){Xe(m,e,101010256),Xe(m,e+8,t),Xe(m,e+10,t),Xe(m,e+12,i),Xe(m,e+16,a)},Br=function(){function m(e){this.filename=e,this.c=lr(),this.size=0,this.compression=0}return m.prototype.process=function(e,t){this.ondata(null,e,t)},m.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},m}(),f_=function(){function m(e,t){var i=this;t||(t={}),Br.call(this,e),this.d=new ui(t,function(a,u){i.ondata(null,a,u)}),this.compression=8,this.flag=ru(t.level)}return m.prototype.process=function(e,t){try{this.d.push(e,t)}catch(i){this.ondata(i,null,t)}},m.prototype.push=function(e,t){Br.prototype.push.call(this,e,t)},m}(),d_=function(){function m(e,t){var i=this;t||(t={}),Br.call(this,e),this.d=new Kh(t,function(a,u,g){i.ondata(a,u,g)}),this.compression=8,this.flag=ru(t.level),this.terminate=this.d.terminate}return m.prototype.process=function(e,t){this.d.push(e,t)},m.prototype.push=function(e,t){Br.prototype.push.call(this,e,t)},m}(),p_=function(){function m(e){this.ondata=e,this.u=[],this.d=1}return m.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var i=Wi(e.filename),a=i.length,u=e.comment,g=u&&Wi(u),s=a!=e.filename.length||g&&u.length!=g.length,n=a+Ui(e.extra)+30;if(a>65535)throw"filename too long";var o=new Ve(n);Jn(o,0,e,i,s);var f=[o],r=function(){for(var h=0,v=f;h<v.length;h++){var _=v[h];t.ondata(null,_,!1)}f=[]},l=this.d;this.d=0;var c=this.u.length,d=Gr(e,{f:i,u:s,o:g,t:function(){e.terminate&&e.terminate()},r:function(){if(r(),l){var h=t.u[c+1];h?h.r():t.d=1}l=1}}),p=0;e.ondata=function(h,v,_){if(h)t.ondata(h,v,_),t.terminate();else if(p+=v.length,f.push(v),_){var y=new Ve(16);Xe(y,0,134695760),Xe(y,4,e.crc),Xe(y,8,p),Xe(y,12,e.size),f.push(y),d.c=p,d.b=n+p+16,d.crc=e.crc,d.size=e.size,l&&d.r(),l=1}else l&&r()},this.u.push(d)},m.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},m.prototype.e=function(){for(var e=0,t=0,i=0,a=0,u=this.u;a<u.length;a++){var g=u[a];i+=46+g.f.length+Ui(g.extra)+(g.o?g.o.length:0)}for(var s=new Ve(i+22),n=0,o=this.u;n<o.length;n++){var g=o[n];Jn(s,e,g,g.f,g.u,g.c,t,g.o),e+=46+g.f.length+Ui(g.extra)+(g.o?g.o.length:0),t+=g.b}Po(s,e,this.u.length,i,t),this.ondata(null,s,!0),this.d=2},m.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var i=t[e];i.t()}this.d=2},m}();function m_(m,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var i={};Ao(m,"",i,e);var a=Object.keys(i),u=a.length,g=0,s=0,n=u,o=new Array(u),f=[],r=function(){for(var p=0;p<f.length;++p)f[p]()},l=function(){var p=new Ve(s+22),h=g,v=s-g;s=0;for(var _=0;_<n;++_){var y=o[_];try{var x=y.c.length;Jn(p,s,y,y.f,y.u,x);var b=30+y.f.length+Ui(y.extra),w=s+b;p.set(y.c,w),Jn(p,g,y,y.f,y.u,x,s,y.m),g+=16+b+(y.m?y.m.length:0),s=w+x}catch(M){return t(M,null)}}Po(p,g,o.length,v,h),t(null,p)};u||l();for(var c=function(p){var h=a[p],v=i[h],_=v[0],y=v[1],x=lr(),b=_.length;x.p(_);var w=Wi(h),M=w.length,S=y.comment,C=S&&Wi(S),O=C&&C.length,k=Ui(y.extra),Y=y.level==0?0:8,H=function(N,U){if(N)r(),t(N,null);else{var G=U.length;o[p]=Gr(y,{size:b,crc:x.d(),c:U,f:w,m:C,u:M!=h.length||C&&S.length!=O,compression:Y}),g+=30+M+k+G,s+=76+2*(M+k)+(O||0)+G,--u||l()}};if(M>65535&&H("filename too long",null),!Y)H(null,_);else if(b<16e4)try{H(null,Hr(_,y))}catch(N){H(N,null)}else f.push($h(_,y,H))},d=0;d<n;++d)c(d);return r}function g_(m,e){e||(e={});var t={},i=[];Ao(m,"",t,e);var a=0,u=0;for(var g in t){var s=t[g],n=s[0],o=s[1],f=o.level==0?0:8,r=Wi(g),l=r.length,c=o.comment,d=c&&Wi(c),p=d&&d.length,h=Ui(o.extra);if(l>65535)throw"filename too long";var v=f?Hr(n,o):n,_=v.length,y=lr();y.p(n),i.push(Gr(o,{size:n.length,crc:y.d(),c:v,f:r,m:d,u:l!=g.length||d&&c.length!=p,o:a,compression:f})),a+=30+l+h+_,u+=76+2*(l+h)+(p||0)+_}for(var x=new Ve(u+22),b=a,w=u-a,M=0;M<i.length;++M){var r=i[M];Jn(x,r.o,r,r.f,r.u,r.c.length);var S=30+r.f.length+Ui(r.extra);x.set(r.c,r.o+S),Jn(x,a,r,r.f,r.u,r.c.length,r.o,r.m),a+=16+S+(r.m?r.m.length:0)}return Po(x,a,i.length,w,b),x}var lu=function(){function m(){}return m.prototype.push=function(e,t){this.ondata(null,e,t)},m.compression=0,m}(),v_=function(){function m(){var e=this;this.i=new Lt(function(t,i){e.ondata(null,t,i)})}return m.prototype.push=function(e,t){try{this.i.push(e,t)}catch(i){this.ondata(i,e,t)}},m.compression=8,m}(),__=function(){function m(e,t){var i=this;t<32e4?this.i=new Lt(function(a,u){i.ondata(null,a,u)}):(this.i=new Co(function(a,u,g){i.ondata(a,u,g)}),this.terminate=this.i.terminate)}return m.prototype.push=function(e,t){this.i.terminate&&(e=zt(e,0)),this.i.push(e,t)},m.compression=8,m}(),y_=function(){function m(e){this.onfile=e,this.k=[],this.o={0:lu},this.p=bi}return m.prototype.push=function(e,t){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),u=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(u,!this.c):this.k[0].push(u),e=e.subarray(a),e.length)return this.push(e,t)}else{var g=0,s=0,n=void 0,o=void 0;this.p.length?e.length?(o=new Ve(this.p.length+e.length),o.set(this.p),o.set(e,this.p.length)):o=this.p:o=e;for(var f=o.length,r=this.c,l=r&&this.d,c=function(){var v,_=st(o,s);if(_==67324752){g=1,n=s,d.d=null,d.c=0;var y=wt(o,s+6),x=wt(o,s+8),b=y&2048,w=y&8,M=wt(o,s+26),S=wt(o,s+28);if(f>s+30+M+S){var C=[];d.k.unshift(C),g=2;var O=st(o,s+18),k=st(o,s+22),Y=Lo(o.subarray(s+30,s+=30+M),!b);O==4294967295?(v=w?[-2]:ou(o,s),O=v[0],k=v[1]):w&&(O=-1),s+=S,d.c=O;var H,N={name:Y,compression:x,start:function(){if(!N.ondata)throw"no callback";if(!O)N.ondata(null,bi,!0);else{var U=i.o[x];if(!U)throw"unknown compression type "+x;H=O<0?new U(Y):new U(Y,O,k),H.ondata=function(T,P,R){N.ondata(T,P,R)};for(var G=0,j=C;G<j.length;G++){var q=j[G];H.push(q,!1)}i.k[0]==C&&i.c?i.d=H:H.push(bi,!0)}},terminate:function(){H&&H.terminate&&H.terminate()}};O>=0&&(N.size=O,N.originalSize=k),d.onfile(N)}return"break"}else if(r){if(_==134695760)return n=s+=12+(r==-2&&8),g=3,d.c=0,"break";if(_==33639248)return n=s-=4,g=3,d.c=0,"break"}},d=this;s<f-4;++s){var p=c();if(p==="break")break}if(this.p=bi,r<0){var h=g?o.subarray(0,n-12-(r==-2&&8)-(st(o,n-16)==134695760&&4)):o.subarray(0,s);l?l.push(h,!!g):this.k[+(g==2)].push(h)}if(g&2)return this.push(o.subarray(s),t);this.p=o.subarray(s)}if(t){if(this.c)throw"invalid zip file";this.p=null}},m.prototype.register=function(e){this.o[e.compression]=e},m}();function x_(m,e){if(typeof e!="function")throw"no callback";for(var t=[],i=function(){for(var l=0;l<t.length;++l)t[l]()},a={},u=m.length-22;st(m,u)!=101010256;--u)if(!u||m.length-u>65558){e("invalid zip file",null);return}var g=wt(m,u+8);g||e(null,{});var s=g,n=st(m,u+16),o=n==4294967295;if(o){if(u=st(m,u-12),st(m,u)!=101075792){e("invalid zip file",null);return}s=g=st(m,u+32),n=st(m,u+48)}for(var f=function(l){var c=au(m,n,o),d=c[0],p=c[1],h=c[2],v=c[3],_=c[4],y=c[5],x=su(m,y);n=_;var b=function(M,S){M?(i(),e(M,null)):(a[v]=S,--g||e(null,a))};if(!d)b(null,zt(m,x,x+p));else if(d==8){var w=m.subarray(x,x+p);if(p<32e4)try{b(null,dr(w,new Ve(h)))}catch(M){b(M,null)}else t.push(Eo(w,{size:h},b))}else b("unknown compression type "+d,null)},r=0;r<s;++r)f();return i}function b_(m){for(var e={},t=m.length-22;st(m,t)!=101010256;--t)if(!t||m.length-t>65558)throw"invalid zip file";var i=wt(m,t+8);if(!i)return{};var a=st(m,t+16),u=a==4294967295;if(u){if(t=st(m,t-12),st(m,t)!=101075792)throw"invalid zip file";i=st(m,t+32),a=st(m,t+48)}for(var g=0;g<i;++g){var s=au(m,a,u),n=s[0],o=s[1],f=s[2],r=s[3],l=s[4],c=s[5],d=su(m,c);if(a=l,!n)e[r]=zt(m,d,d+o);else if(n==8)e[r]=dr(m.subarray(d,d+o),new Ve(f));else throw"unknown compression type "+n}return e}var w_=Object.freeze(Object.defineProperty({__proto__:null,Deflate:ui,AsyncDeflate:Kh,deflate:$h,deflateSync:Hr,Inflate:Lt,AsyncInflate:Co,inflate:Eo,inflateSync:dr,Gzip:Ps,AsyncGzip:Sc,gzip:Mc,gzipSync:Ds,Gunzip:Rs,AsyncGunzip:Zh,gunzip:Jh,gunzipSync:Os,Zlib:eo,AsyncZlib:s_,zlib:a_,zlibSync:to,Unzlib:Is,AsyncUnzlib:Qh,unzlib:eu,unzlibSync:kr,compress:Mc,AsyncCompress:Sc,compressSync:Ds,Compress:Ps,Decompress:tu,AsyncDecompress:o_,decompress:l_,decompressSync:c_,DecodeUTF8:h_,EncodeUTF8:u_,strToU8:Wi,strFromU8:Lo,ZipPassThrough:Br,ZipDeflate:f_,AsyncZipDeflate:d_,Zip:p_,zip:m_,zipSync:g_,UnzipPassThrough:lu,UnzipInflate:v_,AsyncUnzipInflate:__,Unzip:y_,unzip:x_,unzipSync:b_},Symbol.toStringTag,{value:"Module"}));function cu(m,e,t){const i=t.length-m-1;if(e>=t[i])return i-1;if(e<=t[m])return m;let a=m,u=i,g=Math.floor((a+u)/2);for(;e<t[g]||e>=t[g+1];)e<t[g]?u=g:a=g,g=Math.floor((a+u)/2);return g}function S_(m,e,t,i){const a=[],u=[],g=[];a[0]=1;for(let s=1;s<=t;++s){u[s]=e-i[m+1-s],g[s]=i[m+s]-e;let n=0;for(let o=0;o<s;++o){const f=g[o+1],r=u[s-o],l=a[o]/(f+r);a[o]=n+f*l,n=r*l}a[s]=n}return a}function M_(m,e,t,i){const a=cu(m,i,e),u=S_(a,i,m,e),g=new Ye(0,0,0,0);for(let s=0;s<=m;++s){const n=t[a-m+s],o=u[s],f=n.w*o;g.x+=n.x*f,g.y+=n.y*f,g.z+=n.z*f,g.w+=n.w*o}return g}function T_(m,e,t,i,a){const u=[];for(let r=0;r<=t;++r)u[r]=0;const g=[];for(let r=0;r<=i;++r)g[r]=u.slice(0);const s=[];for(let r=0;r<=t;++r)s[r]=u.slice(0);s[0][0]=1;const n=u.slice(0),o=u.slice(0);for(let r=1;r<=t;++r){n[r]=e-a[m+1-r],o[r]=a[m+r]-e;let l=0;for(let c=0;c<r;++c){const d=o[c+1],p=n[r-c];s[r][c]=d+p;const h=s[c][r-1]/s[r][c];s[c][r]=l+d*h,l=p*h}s[r][r]=l}for(let r=0;r<=t;++r)g[0][r]=s[r][t];for(let r=0;r<=t;++r){let l=0,c=1;const d=[];for(let p=0;p<=t;++p)d[p]=u.slice(0);d[0][0]=1;for(let p=1;p<=i;++p){let h=0;const v=r-p,_=t-p;r>=p&&(d[c][0]=d[l][0]/s[_+1][v],h=d[c][0]*s[v][_]);const y=v>=-1?1:-v,x=r-1<=_?p-1:t-r;for(let w=y;w<=x;++w)d[c][w]=(d[l][w]-d[l][w-1])/s[_+1][v+w],h+=d[c][w]*s[v+w][_];r<=_&&(d[c][p]=-d[l][p-1]/s[_+1][r],h+=d[c][p]*s[r][_]),g[p][r]=h;const b=l;l=c,c=b}}let f=t;for(let r=1;r<=i;++r){for(let l=0;l<=t;++l)g[r][l]*=f;f*=t-r}return g}function C_(m,e,t,i,a){const u=a<m?a:m,g=[],s=cu(m,i,e),n=T_(s,i,m,u,e),o=[];for(let f=0;f<t.length;++f){const r=t[f].clone(),l=r.w;r.x*=l,r.y*=l,r.z*=l,o[f]=r}for(let f=0;f<=u;++f){const r=o[s-m].clone().multiplyScalar(n[f][0]);for(let l=1;l<=m;++l)r.add(o[s-m+l].clone().multiplyScalar(n[f][l]));g[f]=r}for(let f=u+1;f<=a+1;++f)g[f]=new Ye(0,0,0);return g}function E_(m,e){let t=1;for(let a=2;a<=m;++a)t*=a;let i=1;for(let a=2;a<=e;++a)i*=a;for(let a=2;a<=m-e;++a)i*=a;return t/i}function A_(m){const e=m.length,t=[],i=[];for(let u=0;u<e;++u){const g=m[u];t[u]=new X(g.x,g.y,g.z),i[u]=g.w}const a=[];for(let u=0;u<e;++u){const g=t[u].clone();for(let s=1;s<=u;++s)g.sub(a[u-s].clone().multiplyScalar(E_(u,s)*i[s]));a[u]=g.divideScalar(i[0])}return a}function L_(m,e,t,i,a){const u=C_(m,e,t,i,a);return A_(u)}class Cc extends Rv{constructor(e,t,i,a,u){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=a||0,this.endKnot=u||this.knots.length-1;for(let g=0;g<i.length;++g){const s=i[g];this.controlPoints[g]=new Ye(s.x,s.y,s.z,s.w)}}getPoint(e,t=new X){const i=t,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),u=M_(this.degree,this.knots,this.controlPoints,a);return u.w!==1&&u.divideScalar(u.w),i.set(u.x,u.y,u.z)}getTangent(e,t=new X){const i=t,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),u=L_(this.degree,this.knots,this.controlPoints,a,1);return i.copy(u[1]).normalize(),i}}let Ne,nt,At;class P_ extends Ci{constructor(e){super(e)}load(e,t,i,a){const u=this,g=u.path===""?ci.extractUrlBase(e):u.path,s=new cn(this.manager);s.setPath(u.path),s.setResponseType("arraybuffer"),s.setRequestHeader(u.requestHeader),s.setWithCredentials(u.withCredentials),s.load(e,function(n){try{t(u.parse(n,g))}catch(o){a?a(o):console.error(o),u.manager.itemError(e)}},i,a)}parse(e,t){if(k_(e))Ne=new F_().parse(e);else{const a=du(e);if(!B_(a))throw new Error("THREE.FBXLoader: Unknown format.");if(Ac(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ac(a));Ne=new I_().parse(a)}const i=new wh(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new D_(i,this.manager).parse(Ne)}}class D_{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){nt=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),a=this.parseDeformers(),u=new R_().parse(a);return this.parseScene(a,u,i),At}parseConnections(){const e=new Map;return"Connections"in Ne&&Ne.Connections.connections.forEach(function(i){const a=i[0],u=i[1],g=i[2];e.has(a)||e.set(a,{parents:[],children:[]});const s={ID:u,relationship:g};e.get(a).parents.push(s),e.has(u)||e.set(u,{parents:[],children:[]});const n={ID:a,relationship:g};e.get(u).children.push(n)}),e}parseImages(){const e={},t={};if("Video"in Ne.Objects){const i=Ne.Objects.Video;for(const a in i){const u=i[a],g=parseInt(a);if(e[g]=u.RelativeFilename||u.Filename,"Content"in u){const s=u.Content instanceof ArrayBuffer&&u.Content.byteLength>0,n=typeof u.Content=="string"&&u.Content!=="";if(s||n){const o=this.parseImage(i[a]);t[u.RelativeFilename||u.Filename]=o}}}}for(const i in e){const a=e[i];t[a]!==void 0?e[i]=t[a]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,a=i.slice(i.lastIndexOf(".")+1).toLowerCase();let u;switch(a){case"bmp":u="image/bmp";break;case"jpg":case"jpeg":u="image/jpeg";break;case"png":u="image/png";break;case"tif":u="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),u="image/tga";break;default:console.warn('FBXLoader: Image type "'+a+'" is not supported.');return}if(typeof t=="string")return"data:"+u+";base64,"+t;{const g=new Uint8Array(t);return window.URL.createObjectURL(new Blob([g],{type:u}))}}parseTextures(e){const t=new Map;if("Texture"in Ne.Objects){const i=Ne.Objects.Texture;for(const a in i){const u=this.parseTexture(i[a],e);t.set(parseInt(a),u)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const a=e.WrapModeU,u=e.WrapModeV,g=a!==void 0?a.value:0,s=u!==void 0?u.value:0;if(i.wrapS=g===0?Vi:_t,i.wrapT=s===0?Vi:_t,"Scaling"in e){const n=e.Scaling.value;i.repeat.x=n[0],i.repeat.y=n[1]}if("Translation"in e){const n=e.Translation.value;i.offset.x=n[0],i.offset.y=n[1]}return i}loadTexture(e,t){let i;const a=this.textureLoader.path,u=nt.get(e.id).children;u!==void 0&&u.length>0&&t[u[0].ID]!==void 0&&(i=t[u[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let g;const s=e.FileName.slice(-3).toLowerCase();if(s==="tga"){const n=this.manager.getHandler(".tga");n===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),g=new at):(n.setPath(this.textureLoader.path),g=n.load(i))}else s==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),g=new at):g=this.textureLoader.load(i);return this.textureLoader.setPath(a),g}parseMaterials(e){const t=new Map;if("Material"in Ne.Objects){const i=Ne.Objects.Material;for(const a in i){const u=this.parseMaterial(i[a],e);u!==null&&t.set(parseInt(a),u)}}return t}parseMaterial(e,t){const i=e.id,a=e.attrName;let u=e.ShadingModel;if(typeof u=="object"&&(u=u.value),!nt.has(i))return null;const g=this.parseParameters(e,t,i);let s;switch(u.toLowerCase()){case"phong":s=new Cr;break;case"lambert":s=new yh;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',u),s=new Cr;break}return s.setValues(g),s.name=a,s}parseParameters(e,t,i){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new Te().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(a.color=new Te().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new Te().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(a.emissive=new Te().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new Te().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new Te().fromArray(e.SpecularColor.value));const u=this;return nt.get(i).children.forEach(function(g){const s=g.relationship;switch(s){case"Bump":a.bumpMap=u.getTexture(t,g.ID);break;case"Maya|TEX_ao_map":a.aoMap=u.getTexture(t,g.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=u.getTexture(t,g.ID),a.map!==void 0&&(a.map.encoding=ze);break;case"DisplacementColor":a.displacementMap=u.getTexture(t,g.ID);break;case"EmissiveColor":a.emissiveMap=u.getTexture(t,g.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=ze);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=u.getTexture(t,g.ID);break;case"ReflectionColor":a.envMap=u.getTexture(t,g.ID),a.envMap!==void 0&&(a.envMap.mapping=Ms,a.envMap.encoding=ze);break;case"SpecularColor":a.specularMap=u.getTexture(t,g.ID),a.specularMap!==void 0&&(a.specularMap.encoding=ze);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=u.getTexture(t,g.ID),a.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",s);break}}),a}getTexture(e,t){return"LayeredTexture"in Ne.Objects&&t in Ne.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=nt.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ne.Objects){const i=Ne.Objects.Deformer;for(const a in i){const u=i[a],g=nt.get(parseInt(a));if(u.attrType==="Skin"){const s=this.parseSkeleton(g,i);s.ID=a,g.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),s.geometryID=g.parents[0].ID,e[a]=s}else if(u.attrType==="BlendShape"){const s={id:a};s.rawTargets=this.parseMorphTargets(g,i),s.id=a,g.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[a]=s}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(a){const u=t[a.ID];if(u.attrType!=="Cluster")return;const g={ID:a.ID,indices:[],weights:[],transformLink:new Le().fromArray(u.TransformLink.a)};"Indexes"in u&&(g.indices=u.Indexes.a,g.weights=u.Weights.a),i.push(g)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let a=0;a<e.children.length;a++){const u=e.children[a],g=t[u.ID],s={name:g.attrName,initialWeight:g.DeformPercent,id:g.id,fullWeights:g.FullWeights.a};if(g.attrType!=="BlendShapeChannel")return;s.geoID=nt.get(parseInt(u.ID)).children.filter(function(n){return n.relationship===void 0})[0].ID,i.push(s)}return i}parseScene(e,t,i){At=new oi;const a=this.parseModels(e.skeletons,t,i),u=Ne.Objects.Model,g=this;a.forEach(function(n){const o=u[n.ID];g.setLookAtProperties(n,o),nt.get(n.ID).parents.forEach(function(r){const l=a.get(r.ID);l!==void 0&&l.add(n)}),n.parent===null&&At.add(n)}),this.bindSkeleton(e.skeletons,t,a),this.createAmbientLight(),At.traverse(function(n){if(n.userData.transformData){n.parent&&(n.userData.transformData.parentMatrix=n.parent.matrix,n.userData.transformData.parentMatrixWorld=n.parent.matrixWorld);const o=uu(n.userData.transformData);n.applyMatrix4(o),n.updateWorldMatrix()}});const s=new O_().parse();At.children.length===1&&At.children[0].isGroup&&(At.children[0].animations=s,At=At.children[0]),At.animations=s}parseModels(e,t,i){const a=new Map,u=Ne.Objects.Model;for(const g in u){const s=parseInt(g),n=u[g],o=nt.get(s);let f=this.buildSkeleton(o,e,s,n.attrName);if(!f){switch(n.attrType){case"Camera":f=this.createCamera(o);break;case"Light":f=this.createLight(o);break;case"Mesh":f=this.createMesh(o,t,i);break;case"NurbsCurve":f=this.createCurve(o,t);break;case"LimbNode":case"Root":f=new Es;break;case"Null":default:f=new oi;break}f.name=n.attrName?He.sanitizeNodeName(n.attrName):"",f.ID=s}this.getTransformData(f,n),a.set(s,f)}return a}buildSkeleton(e,t,i,a){let u=null;return e.parents.forEach(function(g){for(const s in t){const n=t[s];n.rawBones.forEach(function(o,f){if(o.ID===g.ID){const r=u;u=new Es,u.matrixWorld.copy(o.transformLink),u.name=a?He.sanitizeNodeName(a):"",u.ID=i,n.bones[f]=u,r!==null&&u.add(r)}})}}),u}createCamera(e){let t,i;if(e.children.forEach(function(a){const u=Ne.Objects.NodeAttribute[a.ID];u!==void 0&&(i=u)}),i===void 0)t=new et;else{let a=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(a=1);let u=1;i.NearPlane!==void 0&&(u=i.NearPlane.value/1e3);let g=1e3;i.FarPlane!==void 0&&(g=i.FarPlane.value/1e3);let s=window.innerWidth,n=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(s=i.AspectWidth.value,n=i.AspectHeight.value);const o=s/n;let f=45;i.FieldOfView!==void 0&&(f=i.FieldOfView.value);const r=i.FocalLength?i.FocalLength.value:null;switch(a){case 0:t=new vt(f,o,u,g),r!==null&&t.setFocalLength(r);break;case 1:t=new tr(-s/2,s/2,n/2,-n/2,u,g);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),t=new et;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(a){const u=Ne.Objects.NodeAttribute[a.ID];u!==void 0&&(i=u)}),i===void 0)t=new et;else{let a;i.LightType===void 0?a=0:a=i.LightType.value;let u=16777215;i.Color!==void 0&&(u=new Te().fromArray(i.Color.value));let g=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(g=0);let s=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?s=0:s=i.FarAttenuationEnd.value);const n=1;switch(a){case 0:t=new ja(u,g,s,n);break;case 1:t=new zn(u,g);break;case 2:let o=Math.PI/3;i.InnerAngle!==void 0&&(o=Xt.degToRad(i.InnerAngle.value));let f=0;i.OuterAngle!==void 0&&(f=Xt.degToRad(i.OuterAngle.value),f=Math.max(f,1)),t=new Sh(u,g,s,o,f,n);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new ja(u,g);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let a,u=null,g=null;const s=[];return e.children.forEach(function(n){t.has(n.ID)&&(u=t.get(n.ID)),i.has(n.ID)&&s.push(i.get(n.ID))}),s.length>1?g=s:s.length>0?g=s[0]:(g=new Cr({color:13421772}),s.push(g)),"color"in u.attributes&&s.forEach(function(n){n.vertexColors=!0}),u.FBX_Deformer?(a=new vh(u,g),a.normalizeSkinWeights()):a=new Mt(u,g),a}createCurve(e,t){const i=e.children.reduce(function(u,g){return t.has(g.ID)&&(u=t.get(g.ID)),u},null),a=new zi({color:3342591,linewidth:1});return new zs(i,a)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=fu(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&nt.get(e.ID).children.forEach(function(a){if(a.relationship==="LookAtProperty"){const u=Ne.Objects.Model[a.ID];if("Lcl_Translation"in u){const g=u.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(g),At.add(e.target)):e.lookAt(new X().fromArray(g))}}})}bindSkeleton(e,t,i){const a=this.parsePoseNodes();for(const u in e){const g=e[u];nt.get(parseInt(g.ID)).parents.forEach(function(n){if(t.has(n.ID)){const o=n.ID;nt.get(o).parents.forEach(function(r){i.has(r.ID)&&i.get(r.ID).bind(new Ns(g.bones),a[r.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ne.Objects){const t=Ne.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const a=t[i].PoseNode;Array.isArray(a)?a.forEach(function(u){e[u.Node]=new Le().fromArray(u.Matrix.a)}):e[a.Node]=new Le().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Ne&&"AmbientColor"in Ne.GlobalSettings){const e=Ne.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],a=e[2];if(t!==0||i!==0||a!==0){const u=new Te(t,i,a);At.add(new Mh(u,1))}}}}class R_{parse(e){const t=new Map;if("Geometry"in Ne.Objects){const i=Ne.Objects.Geometry;for(const a in i){const u=nt.get(parseInt(a)),g=this.parseGeometry(u,i[a],e);t.set(parseInt(a),g)}}return t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const a=i.skeletons,u=[],g=e.parents.map(function(r){return Ne.Objects.Model[r.ID]});if(g.length===0)return;const s=e.children.reduce(function(r,l){return a[l.ID]!==void 0&&(r=a[l.ID]),r},null);e.children.forEach(function(r){i.morphTargets[r.ID]!==void 0&&u.push(i.morphTargets[r.ID])});const n=g[0],o={};"RotationOrder"in n&&(o.eulerOrder=fu(n.RotationOrder.value)),"InheritType"in n&&(o.inheritType=parseInt(n.InheritType.value)),"GeometricTranslation"in n&&(o.translation=n.GeometricTranslation.value),"GeometricRotation"in n&&(o.rotation=n.GeometricRotation.value),"GeometricScaling"in n&&(o.scale=n.GeometricScaling.value);const f=uu(o);return this.genGeometry(t,s,u,f)}genGeometry(e,t,i,a){const u=new ut;e.attrName&&(u.name=e.attrName);const g=this.parseGeoNode(e,t),s=this.genBuffers(g),n=new Ze(s.vertex,3);if(n.applyMatrix4(a),u.setAttribute("position",n),s.colors.length>0&&u.setAttribute("color",new Ze(s.colors,3)),t&&(u.setAttribute("skinIndex",new ao(s.weightsIndices,4)),u.setAttribute("skinWeight",new Ze(s.vertexWeights,4)),u.FBX_Deformer=t),s.normal.length>0){const o=new qt().getNormalMatrix(a),f=new Ze(s.normal,3);f.applyNormalMatrix(o),u.setAttribute("normal",f)}if(s.uvs.forEach(function(o,f){let r="uv"+(f+1).toString();f===0&&(r="uv"),u.setAttribute(r,new Ze(s.uvs[f],2))}),g.material&&g.material.mappingType!=="AllSame"){let o=s.materialIndex[0],f=0;if(s.materialIndex.forEach(function(r,l){r!==o&&(u.addGroup(f,l-f,o),o=r,f=l)}),u.groups.length>0){const r=u.groups[u.groups.length-1],l=r.start+r.count;l!==s.materialIndex.length&&u.addGroup(l,s.materialIndex.length-l,o)}u.groups.length===0&&u.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(u,e,i,a),u}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(a,u){a.indices.forEach(function(g,s){i.weightTable[g]===void 0&&(i.weightTable[g]=[]),i.weightTable[g].push({id:u,weight:a.weights[s]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,a=0,u=!1,g=[],s=[],n=[],o=[],f=[],r=[];const l=this;return e.vertexIndices.forEach(function(c,d){let p,h=!1;c<0&&(c=c^-1,h=!0);let v=[],_=[];if(g.push(c*3,c*3+1,c*3+2),e.color){const y=gs(d,i,c,e.color);n.push(y[0],y[1],y[2])}if(e.skeleton){if(e.weightTable[c]!==void 0&&e.weightTable[c].forEach(function(y){_.push(y.weight),v.push(y.id)}),_.length>4){u||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),u=!0);const y=[0,0,0,0],x=[0,0,0,0];_.forEach(function(b,w){let M=b,S=v[w];x.forEach(function(C,O,k){if(M>C){k[O]=M,M=C;const Y=y[O];y[O]=S,S=Y}})}),v=y,_=x}for(;_.length<4;)_.push(0),v.push(0);for(let y=0;y<4;++y)f.push(_[y]),r.push(v[y])}if(e.normal){const y=gs(d,i,c,e.normal);s.push(y[0],y[1],y[2])}e.material&&e.material.mappingType!=="AllSame"&&(p=gs(d,i,c,e.material)[0]),e.uv&&e.uv.forEach(function(y,x){const b=gs(d,i,c,y);o[x]===void 0&&(o[x]=[]),o[x].push(b[0]),o[x].push(b[1])}),a++,h&&(l.genFace(t,e,g,p,s,n,o,f,r,a),i++,a=0,g=[],s=[],n=[],o=[],f=[],r=[])}),t}genFace(e,t,i,a,u,g,s,n,o,f){for(let r=2;r<f;r++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[(r-1)*3]]),e.vertex.push(t.vertexPositions[i[(r-1)*3+1]]),e.vertex.push(t.vertexPositions[i[(r-1)*3+2]]),e.vertex.push(t.vertexPositions[i[r*3]]),e.vertex.push(t.vertexPositions[i[r*3+1]]),e.vertex.push(t.vertexPositions[i[r*3+2]]),t.skeleton&&(e.vertexWeights.push(n[0]),e.vertexWeights.push(n[1]),e.vertexWeights.push(n[2]),e.vertexWeights.push(n[3]),e.vertexWeights.push(n[(r-1)*4]),e.vertexWeights.push(n[(r-1)*4+1]),e.vertexWeights.push(n[(r-1)*4+2]),e.vertexWeights.push(n[(r-1)*4+3]),e.vertexWeights.push(n[r*4]),e.vertexWeights.push(n[r*4+1]),e.vertexWeights.push(n[r*4+2]),e.vertexWeights.push(n[r*4+3]),e.weightsIndices.push(o[0]),e.weightsIndices.push(o[1]),e.weightsIndices.push(o[2]),e.weightsIndices.push(o[3]),e.weightsIndices.push(o[(r-1)*4]),e.weightsIndices.push(o[(r-1)*4+1]),e.weightsIndices.push(o[(r-1)*4+2]),e.weightsIndices.push(o[(r-1)*4+3]),e.weightsIndices.push(o[r*4]),e.weightsIndices.push(o[r*4+1]),e.weightsIndices.push(o[r*4+2]),e.weightsIndices.push(o[r*4+3])),t.color&&(e.colors.push(g[0]),e.colors.push(g[1]),e.colors.push(g[2]),e.colors.push(g[(r-1)*3]),e.colors.push(g[(r-1)*3+1]),e.colors.push(g[(r-1)*3+2]),e.colors.push(g[r*3]),e.colors.push(g[r*3+1]),e.colors.push(g[r*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),t.normal&&(e.normal.push(u[0]),e.normal.push(u[1]),e.normal.push(u[2]),e.normal.push(u[(r-1)*3]),e.normal.push(u[(r-1)*3+1]),e.normal.push(u[(r-1)*3+2]),e.normal.push(u[r*3]),e.normal.push(u[r*3+1]),e.normal.push(u[r*3+2])),t.uv&&t.uv.forEach(function(l,c){e.uvs[c]===void 0&&(e.uvs[c]=[]),e.uvs[c].push(s[c][0]),e.uvs[c].push(s[c][1]),e.uvs[c].push(s[c][(r-1)*2]),e.uvs[c].push(s[c][(r-1)*2+1]),e.uvs[c].push(s[c][r*2]),e.uvs[c].push(s[c][r*2+1])})}addMorphTargets(e,t,i,a){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const u=this;i.forEach(function(g){g.rawTargets.forEach(function(s){const n=Ne.Objects.Geometry[s.geoID];n!==void 0&&u.genMorphGeometry(e,t,n,a,s.name)})})}genMorphGeometry(e,t,i,a,u){const g=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],s=i.Vertices!==void 0?i.Vertices.a:[],n=i.Indexes!==void 0?i.Indexes.a:[],o=e.attributes.position.count*3,f=new Float32Array(o);for(let d=0;d<n.length;d++){const p=n[d]*3;f[p]=s[d*3],f[p+1]=s[d*3+1],f[p+2]=s[d*3+2]}const r={vertexIndices:g,vertexPositions:f},l=this.genBuffers(r),c=new Ze(l.vertex,3);c.name=u||i.attrName,c.applyMatrix4(a),e.morphAttributes.position.push(c)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,a=e.Normals.a;let u=[];return i==="IndexToDirect"&&("NormalIndex"in e?u=e.NormalIndex.a:"NormalsIndex"in e&&(u=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:u,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,a=e.UV.a;let u=[];return i==="IndexToDirect"&&(u=e.UVIndex.a),{dataSize:2,buffer:a,indices:u,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,a=e.Colors.a;let u=[];return i==="IndexToDirect"&&(u=e.ColorIndex.a),{dataSize:4,buffer:a,indices:u,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const a=e.Materials.a,u=[];for(let g=0;g<a.length;++g)u.push(g);return{dataSize:1,buffer:a,indices:u,mappingType:t,referenceType:i}}parseNurbsGeometry(e){if(Cc===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new ut;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new ut;const i=t-1,a=e.KnotVector.a,u=[],g=e.Points.a;for(let r=0,l=g.length;r<l;r+=4)u.push(new Ye().fromArray(g,r));let s,n;if(e.Form==="Closed")u.push(u[0]);else if(e.Form==="Periodic"){s=i,n=a.length-1-s;for(let r=0;r<i;++r)u.push(u[r])}const f=new Cc(i,a,u,s,n).getPoints(u.length*12);return new ut().setFromPoints(f)}}class O_{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const a=t[i],u=this.addClip(a);e.push(u)}return e}parseClips(){if(Ne.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ne.Objects.AnimationCurveNode,t=new Map;for(const i in e){const a=e[i];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const u={id:a.id,attr:a.attrName,curves:{}};t.set(u.id,u)}}return t}parseAnimationCurves(e){const t=Ne.Objects.AnimationCurve;for(const i in t){const a={id:t[i].id,times:t[i].KeyTime.a.map(N_),values:t[i].KeyValueFloat.a},u=nt.get(a.id);if(u!==void 0){const g=u.parents[0].ID,s=u.parents[0].relationship;s.match(/X/)?e.get(g).curves.x=a:s.match(/Y/)?e.get(g).curves.y=a:s.match(/Z/)?e.get(g).curves.z=a:s.match(/d|DeformPercent/)&&e.has(g)&&(e.get(g).curves.morph=a)}}}parseAnimationLayers(e){const t=Ne.Objects.AnimationLayer,i=new Map;for(const a in t){const u=[],g=nt.get(parseInt(a));g!==void 0&&(g.children.forEach(function(n,o){if(e.has(n.ID)){const f=e.get(n.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(u[o]===void 0){const r=nt.get(n.ID).parents.filter(function(l){return l.relationship!==void 0})[0].ID;if(r!==void 0){const l=Ne.Objects.Model[r.toString()];if(l===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",n);return}const c={modelName:l.attrName?He.sanitizeNodeName(l.attrName):"",ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};At.traverse(function(d){d.ID===l.id&&(c.transform=d.matrix,d.userData.transformData&&(c.eulerOrder=d.userData.transformData.eulerOrder))}),c.transform||(c.transform=new Le),"PreRotation"in l&&(c.preRotation=l.PreRotation.value),"PostRotation"in l&&(c.postRotation=l.PostRotation.value),u[o]=c}}u[o]&&(u[o][f.attr]=f)}else if(f.curves.morph!==void 0){if(u[o]===void 0){const r=nt.get(n.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,l=nt.get(r).parents[0].ID,c=nt.get(l).parents[0].ID,d=nt.get(c).parents[0].ID,p=Ne.Objects.Model[d],h={modelName:p.attrName?He.sanitizeNodeName(p.attrName):"",morphName:Ne.Objects.Deformer[r].attrName};u[o]=h}u[o][f.attr]=f}}}),i.set(parseInt(a),u))}return i}parseAnimStacks(e){const t=Ne.Objects.AnimationStack,i={};for(const a in t){const u=nt.get(parseInt(a)).children;u.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const g=e.get(u[0].ID);i[a]={name:t[a].attrName,layer:g}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(a){t=t.concat(i.generateTracks(a))}),new bh(e.name,-1,t)}generateTracks(e){const t=[];let i=new X,a=new St,u=new X;if(e.transform&&e.transform.decompose(i,a,u),i=i.toArray(),a=new ai().setFromQuaternion(a,e.eulerOrder).toArray(),u=u.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");g!==void 0&&t.push(g)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const g=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);g!==void 0&&t.push(g)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const g=this.generateVectorTrack(e.modelName,e.S.curves,u,"scale");g!==void 0&&t.push(g)}if(e.DeformPercent!==void 0){const g=this.generateMorphTrack(e);g!==void 0&&t.push(g)}return t}generateVectorTrack(e,t,i,a){const u=this.getTimesForAllAxes(t),g=this.getKeyframeTrackValues(u,t,i);return new Kn(e+"."+a,u,g)}generateRotationTrack(e,t,i,a,u,g){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Xt.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Xt.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Xt.degToRad));const s=this.getTimesForAllAxes(t),n=this.getKeyframeTrackValues(s,t,i);a!==void 0&&(a=a.map(Xt.degToRad),a.push(g),a=new ai().fromArray(a),a=new St().setFromEuler(a)),u!==void 0&&(u=u.map(Xt.degToRad),u.push(g),u=new ai().fromArray(u),u=new St().setFromEuler(u).invert());const o=new St,f=new ai,r=[];for(let l=0;l<n.length;l+=3)f.set(n[l],n[l+1],n[l+2],g),o.setFromEuler(f),a!==void 0&&o.premultiply(a),u!==void 0&&o.multiply(u),o.toArray(r,l/3*4);return new Hi(e+".quaternion",s,r)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(u){return u/100}),a=At.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new qn(e.modelName+".morphTargetInfluences["+a+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,a){return i-a}),t.length>1){let i=1,a=t[0];for(let u=1;u<t.length;u++){const g=t[u];g!==a&&(t[i]=g,a=g,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const a=i,u=[];let g=-1,s=-1,n=-1;return e.forEach(function(o){if(t.x&&(g=t.x.times.indexOf(o)),t.y&&(s=t.y.times.indexOf(o)),t.z&&(n=t.z.times.indexOf(o)),g!==-1){const f=t.x.values[g];u.push(f),a[0]=f}else u.push(a[0]);if(s!==-1){const f=t.y.values[s];u.push(f),a[1]=f}else u.push(a[1]);if(n!==-1){const f=t.z.values[n];u.push(f),a[2]=f}else u.push(a[2])}),u}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],a=e.values[t]-i,u=Math.abs(a);if(u>=180){const g=u/180,s=a/g;let n=i+s;const o=e.times[t-1],r=(e.times[t]-o)/g;let l=o+r;const c=[],d=[];for(;l<e.times[t];)c.push(l),l+=r,d.push(n),n+=s;e.times=Lc(e.times,t,c),e.values=Lc(e.values,t,d)}}}}class I_{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new hu,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(a,u){const g=a.match(/^[\s\t]*;/),s=a.match(/^[\s\t]*$/);if(g||s)return;const n=a.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),o=a.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=a.match("^\\t{"+(t.currentIndent-1)+"}}");n?t.parseNodeBegin(a,n):o?t.parseNodeProperty(a,o,i[++u]):f?t.popStack():a.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=t[2].split(",").map(function(n){return n.trim().replace(/^"/,"").replace(/"$/,"")}),u={name:i},g=this.parseNodeAttr(a),s=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,u):i in s?(i==="PoseNode"?s.PoseNode.push(u):s[i].id!==void 0&&(s[i]={},s[i][s[i].id]=s[i]),g.id!==""&&(s[i][g.id]=u)):typeof g.id=="number"?(s[i]={},s[i][g.id]=u):i!=="Properties70"&&(i==="PoseNode"?s[i]=[u]:s[i]=u),typeof g.id=="number"&&(u.id=g.id),g.name!==""&&(u.attrName=g.name),g.type!==""&&(u.attrType=g.type),this.pushStack(u)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",a="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:i,type:a}}parseNodeProperty(e,t,i){let a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),u=t[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&u===","&&(u=i.replace(/"/g,"").replace(/,$/,"").trim());const g=this.getCurrentNode();if(g.name==="Properties70"){this.parseNodeSpecialProperty(e,a,u);return}if(a==="C"){const n=u.split(",").slice(1),o=parseInt(n[0]),f=parseInt(n[1]);let r=u.split(",").slice(3);r=r.map(function(l){return l.trim().replace(/^"/,"")}),a="connections",u=[o,f],U_(u,r),g[a]===void 0&&(g[a]=[])}a==="Node"&&(g.id=u),a in g&&Array.isArray(g[a])?g[a].push(u):a!=="a"?g[a]=u:g.a=u,this.setCurrentProp(g,a),a==="a"&&u.slice(-1)!==","&&(g.a=Pa(u))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Pa(t.a))}parseNodeSpecialProperty(e,t,i){const a=i.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),u=a[0],g=a[1],s=a[2],n=a[3];let o=a[4];switch(g){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":o=parseFloat(o);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":o=Pa(o);break}this.getPrevNode()[u]={type:g,type2:s,flag:n,value:o},this.setCurrentProp(this.getPrevNode(),u)}}class F_{parse(e){const t=new Ec(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const a=new hu;for(;!this.endOfContent(t);){const u=this.parseNode(t,i);u!==null&&a.add(u.name,u)}return a}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},a=t>=7500?e.getUint64():e.getUint32(),u=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const g=e.getUint8(),s=e.getString(g);if(a===0)return null;const n=[];for(let l=0;l<u;l++)n.push(this.parseProperty(e));const o=n.length>0?n[0]:"",f=n.length>1?n[1]:"",r=n.length>2?n[2]:"";for(i.singleProperty=u===1&&e.getOffset()===a;a>e.getOffset();){const l=this.parseNode(e,t);l!==null&&this.parseSubNode(s,i,l)}return i.propertyList=n,typeof o=="number"&&(i.id=o),f!==""&&(i.attrName=f),r!==""&&(i.attrType=r),s!==""&&(i.name=s),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const a=i.propertyList[0];Array.isArray(a)?(t[i.name]=i,i.a=a):t[i.name]=a}else if(e==="Connections"&&i.name==="C"){const a=[];i.propertyList.forEach(function(u,g){g!==0&&a.push(u)}),t.connections===void 0&&(t.connections=[]),t.connections.push(a)}else if(i.name==="Properties70")Object.keys(i).forEach(function(u){t[u]=i[u]});else if(e==="Properties70"&&i.name==="P"){let a=i.propertyList[0],u=i.propertyList[1];const g=i.propertyList[2],s=i.propertyList[3];let n;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),u.indexOf("Lcl ")===0&&(u=u.replace("Lcl ","Lcl_")),u==="Color"||u==="ColorRGB"||u==="Vector"||u==="Vector3D"||u.indexOf("Lcl_")===0?n=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:n=i.propertyList[4],t[a]={type:u,type2:g,flag:s,value:n}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),u=e.getUint32(),g=e.getUint32();if(u===0)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}typeof w_=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const s=kr(new Uint8Array(e.getArrayBuffer(g))),n=new Ec(s.buffer);switch(t){case"b":case"c":return n.getBooleanArray(a);case"d":return n.getFloat64Array(a);case"f":return n.getFloat32Array(a);case"i":return n.getInt32Array(a);case"l":return n.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Ec{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let a=0;a<e;a++)t[a]=this.getUint8();const i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),ci.decodeText(new Uint8Array(t))}}class hu{add(e,t){this[e]=t}}function k_(m){const e="Kaydara FBX Binary  \0";return m.byteLength>=e.length&&e===du(m,0,e.length)}function B_(m){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(a){const u=m[a-1];return m=m.slice(t+a),t++,u}for(let a=0;a<e.length;++a)if(i(1)===e[a])return!1;return!0}function Ac(m){const e=/FBXVersion: (\d+)/,t=m.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function N_(m){return m/46186158e3}const z_=[];function gs(m,e,t,i){let a;switch(i.mappingType){case"ByPolygonVertex":a=m;break;case"ByPolygon":a=e;break;case"ByVertice":a=t;break;case"AllSame":a=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(a=i.indices[a]);const u=a*i.dataSize,g=u+i.dataSize;return V_(z_,i.buffer,u,g)}const La=new ai,On=new X;function uu(m){const e=new Le,t=new Le,i=new Le,a=new Le,u=new Le,g=new Le,s=new Le,n=new Le,o=new Le,f=new Le,r=new Le,l=new Le,c=m.inheritType?m.inheritType:0;if(m.translation&&e.setPosition(On.fromArray(m.translation)),m.preRotation){const O=m.preRotation.map(Xt.degToRad);O.push(m.eulerOrder),t.makeRotationFromEuler(La.fromArray(O))}if(m.rotation){const O=m.rotation.map(Xt.degToRad);O.push(m.eulerOrder),i.makeRotationFromEuler(La.fromArray(O))}if(m.postRotation){const O=m.postRotation.map(Xt.degToRad);O.push(m.eulerOrder),a.makeRotationFromEuler(La.fromArray(O)),a.invert()}m.scale&&u.scale(On.fromArray(m.scale)),m.scalingOffset&&s.setPosition(On.fromArray(m.scalingOffset)),m.scalingPivot&&g.setPosition(On.fromArray(m.scalingPivot)),m.rotationOffset&&n.setPosition(On.fromArray(m.rotationOffset)),m.rotationPivot&&o.setPosition(On.fromArray(m.rotationPivot)),m.parentMatrixWorld&&(r.copy(m.parentMatrix),f.copy(m.parentMatrixWorld));const d=t.clone().multiply(i).multiply(a),p=new Le;p.extractRotation(f);const h=new Le;h.copyPosition(f);const v=h.clone().invert().multiply(f),_=p.clone().invert().multiply(v),y=u,x=new Le;if(c===0)x.copy(p).multiply(d).multiply(_).multiply(y);else if(c===1)x.copy(p).multiply(_).multiply(d).multiply(y);else{const k=new Le().scale(new X().setFromMatrixScale(r)).clone().invert(),Y=_.clone().multiply(k);x.copy(p).multiply(d).multiply(Y).multiply(y)}const b=o.clone().invert(),w=g.clone().invert();let M=e.clone().multiply(n).multiply(o).multiply(t).multiply(i).multiply(a).multiply(b).multiply(s).multiply(g).multiply(u).multiply(w);const S=new Le().copyPosition(M),C=f.clone().multiply(S);return l.copyPosition(C),M=l.clone().multiply(x),M.premultiply(f.invert()),M}function fu(m){m=m||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return m===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[m]}function Pa(m){return m.split(",").map(function(t){return parseFloat(t)})}function du(m,e,t){return e===void 0&&(e=0),t===void 0&&(t=m.byteLength),ci.decodeText(new Uint8Array(m,e,t))}function U_(m,e){for(let t=0,i=m.length,a=e.length;t<a;t++,i++)m[i]=e[t]}function V_(m,e,t,i){for(let a=t,u=0;a<i;a++,u++)m[u]=e[a];return m}function Lc(m,e,t){return m.slice(0,e).concat(t).concat(m.slice(e))}const Da=new WeakMap;class Pc extends Ci{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,a){const u=new cn(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,g=>{const s={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(g,s).then(t).catch(a)},i,a)}decodeDracoFile(e,t,i,a){const u={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:a||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,u).then(t)}decodeGeometry(e,t){for(const n in t.attributeTypes){const o=t.attributeTypes[n];o.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[n]=o.name)}const i=JSON.stringify(t);if(Da.has(e)){const n=Da.get(e);if(n.key===i)return n.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let a;const u=this.workerNextTaskID++,g=e.byteLength,s=this._getWorker(u,g).then(n=>(a=n,new Promise((o,f)=>{a._callbacks[u]={resolve:o,reject:f},a.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))).then(n=>this._createGeometry(n.geometry));return s.catch(()=>!0).then(()=>{a&&u&&this._releaseTask(a,u)}),Da.set(e,{key:i,promise:s}),s}_createGeometry(e){const t=new ut;e.index&&t.setIndex(new Tt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const a=e.attributes[i],u=a.name,g=a.array,s=a.itemSize;t.setAttribute(u,new Tt(g,s))}return t}_loadLibrary(e,t){const i=new cn(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((a,u)=>{i.load(e,a,void 0,u)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const a=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const u=G_.toString(),g=["/* draco decoder */",a,"","/* worker */",u.substring(u.indexOf("{")+1,u.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([g]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(u){const g=u.data;switch(g.type){case"decode":a._callbacks[g.id].resolve(g);break;case"error":a._callbacks[g.id].reject(g);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+g.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(a,u){return a._taskLoad>u._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function G_(){let m,e;onmessage=function(g){const s=g.data;switch(s.type){case"init":m=s.decoderConfig,e=new Promise(function(f){m.onModuleLoaded=function(r){f({draco:r})},DracoDecoderModule(m)});break;case"decode":const n=s.buffer,o=s.taskConfig;e.then(f=>{const r=f.draco,l=new r.Decoder,c=new r.DecoderBuffer;c.Init(new Int8Array(n),n.byteLength);try{const d=t(r,l,c,o),p=d.attributes.map(h=>h.array.buffer);d.index&&p.push(d.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:d},p)}catch(d){console.error(d),self.postMessage({type:"error",id:s.id,error:d.message})}finally{r.destroy(c),r.destroy(l)}});break}};function t(g,s,n,o){const f=o.attributeIDs,r=o.attributeTypes;let l,c;const d=s.GetEncodedGeometryType(n);if(d===g.TRIANGULAR_MESH)l=new g.Mesh,c=s.DecodeBufferToMesh(n,l);else if(d===g.POINT_CLOUD)l=new g.PointCloud,c=s.DecodeBufferToPointCloud(n,l);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!c.ok()||l.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+c.error_msg());const p={index:null,attributes:[]};for(const h in f){const v=self[r[h]];let _,y;if(o.useUniqueIDs)y=f[h],_=s.GetAttributeByUniqueId(l,y);else{if(y=s.GetAttributeId(l,g[f[h]]),y===-1)continue;_=s.GetAttribute(l,y)}p.attributes.push(a(g,s,l,h,v,_))}return d===g.TRIANGULAR_MESH&&(p.index=i(g,s,l)),g.destroy(l),p}function i(g,s,n){const f=n.num_faces()*3,r=f*4,l=g._malloc(r);s.GetTrianglesUInt32Array(n,r,l);const c=new Uint32Array(g.HEAPF32.buffer,l,f).slice();return g._free(l),{array:c,itemSize:1}}function a(g,s,n,o,f,r){const l=r.num_components(),d=n.num_points()*l,p=d*f.BYTES_PER_ELEMENT,h=u(g,f),v=g._malloc(p);s.GetAttributeDataArrayForAllPoints(n,r,h,p,v);const _=new f(g.HEAPF32.buffer,v,d).slice();return g._free(v),{name:o,array:_,itemSize:l}}function u(g,s){switch(s){case Float32Array:return g.DT_FLOAT32;case Int8Array:return g.DT_INT8;case Int16Array:return g.DT_INT16;case Int32Array:return g.DT_INT32;case Uint8Array:return g.DT_UINT8;case Uint16Array:return g.DT_UINT16;case Uint32Array:return g.DT_UINT32}}}class H_ extends Kv{constructor(e){super(e),this.type=xi}parse(e){const s=function(y,x){switch(y){case 1:console.error("THREE.RGBELoader Read Error: "+(x||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(x||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(x||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(x||""))}return-1},r=`
`,l=function(y,x,b){x=x||1024;let M=y.pos,S=-1,C=0,O="",k=String.fromCharCode.apply(null,new Uint16Array(y.subarray(M,M+128)));for(;0>(S=k.indexOf(r))&&C<x&&M<y.byteLength;)O+=k,C+=k.length,M+=128,k+=String.fromCharCode.apply(null,new Uint16Array(y.subarray(M,M+128)));return-1<S?(b!==!1&&(y.pos+=C+S+1),O+k.slice(0,S)):!1},c=function(y){const x=/^#\?(\S+)/,b=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,w=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*FORMAT=(\S+)\s*$/,S=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let O,k;if(y.pos>=y.byteLength||!(O=l(y)))return s(1,"no header found");if(!(k=O.match(x)))return s(3,"bad initial token");for(C.valid|=1,C.programtype=k[1],C.string+=O+`
`;O=l(y),O!==!1;){if(C.string+=O+`
`,O.charAt(0)==="#"){C.comments+=O+`
`;continue}if((k=O.match(b))&&(C.gamma=parseFloat(k[1])),(k=O.match(w))&&(C.exposure=parseFloat(k[1])),(k=O.match(M))&&(C.valid|=2,C.format=k[1]),(k=O.match(S))&&(C.valid|=4,C.height=parseInt(k[1],10),C.width=parseInt(k[2],10)),C.valid&2&&C.valid&4)break}return C.valid&2?C.valid&4?C:s(3,"missing image size specifier"):s(3,"missing format specifier")},d=function(y,x,b){const w=x;if(w<8||w>32767||y[0]!==2||y[1]!==2||y[2]&128)return new Uint8Array(y);if(w!==(y[2]<<8|y[3]))return s(3,"wrong scanline width");const M=new Uint8Array(4*x*b);if(!M.length)return s(4,"unable to allocate buffer space");let S=0,C=0;const O=4*w,k=new Uint8Array(4),Y=new Uint8Array(O);let H=b;for(;H>0&&C<y.byteLength;){if(C+4>y.byteLength)return s(1);if(k[0]=y[C++],k[1]=y[C++],k[2]=y[C++],k[3]=y[C++],k[0]!=2||k[1]!=2||(k[2]<<8|k[3])!=w)return s(3,"bad rgbe scanline format");let N=0,U;for(;N<O&&C<y.byteLength;){U=y[C++];const j=U>128;if(j&&(U-=128),U===0||N+U>O)return s(3,"bad scanline data");if(j){const q=y[C++];for(let T=0;T<U;T++)Y[N++]=q}else Y.set(y.subarray(C,C+U),N),N+=U,C+=U}const G=w;for(let j=0;j<G;j++){let q=0;M[S]=Y[j+q],q+=w,M[S+1]=Y[j+q],q+=w,M[S+2]=Y[j+q],q+=w,M[S+3]=Y[j+q],S+=4}H--}return M},p=function(y,x,b,w){const M=y[x+3],S=Math.pow(2,M-128)/255;b[w+0]=y[x+0]*S,b[w+1]=y[x+1]*S,b[w+2]=y[x+2]*S,b[w+3]=1},h=function(y,x,b,w){const M=y[x+3],S=Math.pow(2,M-128)/255;b[w+0]=ps.toHalfFloat(Math.min(y[x+0]*S,65504)),b[w+1]=ps.toHalfFloat(Math.min(y[x+1]*S,65504)),b[w+2]=ps.toHalfFloat(Math.min(y[x+2]*S,65504)),b[w+3]=ps.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const _=c(v);if(_!==-1){const y=_.width,x=_.height,b=d(v.subarray(v.pos),y,x);if(b!==-1){let w,M,S;switch(this.type){case Yt:S=b.length/4;const C=new Float32Array(S*4);for(let k=0;k<S;k++)p(b,k*4,C,k*4);w=C,M=Yt;break;case xi:S=b.length/4;const O=new Uint16Array(S*4);for(let k=0;k<S;k++)h(b,k*4,O,k*4);w=O,M=xi;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:y,height:x,data:w,header:_.string,gamma:_.gamma,exposure:_.exposure,type:M}}}return null}setDataType(e){return this.type=e,this}load(e,t,i,a){function u(g,s){switch(g.type){case Yt:case xi:g.encoding=Gi,g.minFilter=rt,g.magFilter=rt,g.generateMipmaps=!1,g.flipY=!0;break}t&&t(g,s)}return super.load(e,u,i,a)}}const W_=/^[og]\s*(.+)?/,j_=/^mtllib /,X_=/^usemtl /,Y_=/^usemap /,Dc=new X,Ra=new X,Rc=new X,Oc=new X,Ot=new X,vs=new Te;function q_(){const m={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,u){const g=this._finalize(!1);g&&(g.inherited||g.groupCount<=0)&&this.materials.splice(g.index,1);const s={index:this.materials.length,name:a||"",mtllib:Array.isArray(u)&&u.length>0?u[u.length-1]:"",smooth:g!==void 0?g.smooth:this.smooth,groupStart:g!==void 0?g.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(n){const o={index:typeof n=="number"?n:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return o.clone=this.clone.bind(o),o}};return this.materials.push(s),s},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const u=this.currentMaterial();if(u&&u.groupEnd===-1&&(u.groupEnd=this.geometry.vertices.length/3,u.groupCount=u.groupEnd-u.groupStart,u.inherited=!1),a&&this.materials.length>1)for(let g=this.materials.length-1;g>=0;g--)this.materials[g].groupCount<=0&&this.materials.splice(g,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),u}},i&&i.name&&typeof i.clone=="function"){const a=i.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const a=this.vertices,u=this.object.geometry.vertices;u.push(a[e+0],a[e+1],a[e+2]),u.push(a[t+0],a[t+1],a[t+2]),u.push(a[i+0],a[i+1],a[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const a=this.normals,u=this.object.geometry.normals;u.push(a[e+0],a[e+1],a[e+2]),u.push(a[t+0],a[t+1],a[t+2]),u.push(a[i+0],a[i+1],a[i+2])},addFaceNormal:function(e,t,i){const a=this.vertices,u=this.object.geometry.normals;Dc.fromArray(a,e),Ra.fromArray(a,t),Rc.fromArray(a,i),Ot.subVectors(Rc,Ra),Oc.subVectors(Dc,Ra),Ot.cross(Oc),Ot.normalize(),u.push(Ot.x,Ot.y,Ot.z),u.push(Ot.x,Ot.y,Ot.z),u.push(Ot.x,Ot.y,Ot.z)},addColor:function(e,t,i){const a=this.colors,u=this.object.geometry.colors;a[e]!==void 0&&u.push(a[e+0],a[e+1],a[e+2]),a[t]!==void 0&&u.push(a[t+0],a[t+1],a[t+2]),a[i]!==void 0&&u.push(a[i+0],a[i+1],a[i+2])},addUV:function(e,t,i){const a=this.uvs,u=this.object.geometry.uvs;u.push(a[e+0],a[e+1]),u.push(a[t+0],a[t+1]),u.push(a[i+0],a[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,a,u,g,s,n,o){const f=this.vertices.length;let r=this.parseVertexIndex(e,f),l=this.parseVertexIndex(t,f),c=this.parseVertexIndex(i,f);if(this.addVertex(r,l,c),this.addColor(r,l,c),s!==void 0&&s!==""){const d=this.normals.length;r=this.parseNormalIndex(s,d),l=this.parseNormalIndex(n,d),c=this.parseNormalIndex(o,d),this.addNormal(r,l,c)}else this.addFaceNormal(r,l,c);if(a!==void 0&&a!==""){const d=this.uvs.length;r=this.parseUVIndex(a,d),l=this.parseUVIndex(u,d),c=this.parseUVIndex(g,d),this.addUV(r,l,c),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,a=e.length;i<a;i++){const u=this.parseVertexIndex(e[i],t);this.addVertexPoint(u),this.addColor(u)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,a=this.uvs.length;for(let u=0,g=e.length;u<g;u++)this.addVertexLine(this.parseVertexIndex(e[u],i));for(let u=0,g=t.length;u<g;u++)this.addUVLine(this.parseUVIndex(t[u],a))}};return m.startObject("",!1),m}class K_ extends Ci{constructor(e){super(e),this.materials=null}load(e,t,i,a){const u=this,g=new cn(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(s){try{t(u.parse(s))}catch(n){a?a(n):console.error(n),u.manager.itemError(e)}},i,a)}setMaterials(e){return this.materials=e,this}parse(e){const t=new q_;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let a="",u="",g=0,s=[];const n=typeof"".trimLeft=="function";for(let r=0,l=i.length;r<l;r++)if(a=i[r],a=n?a.trimLeft():a.trim(),g=a.length,g!==0&&(u=a.charAt(0),u!=="#"))if(u==="v"){const c=a.split(/\s+/);switch(c[0]){case"v":t.vertices.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])),c.length>=7?(vs.setRGB(parseFloat(c[4]),parseFloat(c[5]),parseFloat(c[6])).convertSRGBToLinear(),t.colors.push(vs.r,vs.g,vs.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));break;case"vt":t.uvs.push(parseFloat(c[1]),parseFloat(c[2]));break}}else if(u==="f"){const d=a.slice(1).trim().split(/\s+/),p=[];for(let v=0,_=d.length;v<_;v++){const y=d[v];if(y.length>0){const x=y.split("/");p.push(x)}}const h=p[0];for(let v=1,_=p.length-1;v<_;v++){const y=p[v],x=p[v+1];t.addFace(h[0],y[0],x[0],h[1],y[1],x[1],h[2],y[2],x[2])}}else if(u==="l"){const c=a.substring(1).trim().split(" ");let d=[];const p=[];if(a.indexOf("/")===-1)d=c;else for(let h=0,v=c.length;h<v;h++){const _=c[h].split("/");_[0]!==""&&d.push(_[0]),_[1]!==""&&p.push(_[1])}t.addLineGeometry(d,p)}else if(u==="p"){const d=a.slice(1).trim().split(" ");t.addPointGeometry(d)}else if((s=W_.exec(a))!==null){const c=(" "+s[0].slice(1).trim()).slice(1);t.startObject(c)}else if(X_.test(a))t.object.startMaterial(a.substring(7).trim(),t.materialLibraries);else if(j_.test(a))t.materialLibraries.push(a.substring(7).trim());else if(Y_.test(a))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(s=a.split(" "),s.length>1){const d=s[1].trim().toLowerCase();t.object.smooth=d!=="0"&&d!=="off"}else t.object.smooth=!0;const c=t.object.currentMaterial();c&&(c.smooth=t.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}t.finalize();const o=new oi;if(o.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let r=0,l=t.objects.length;r<l;r++){const c=t.objects[r],d=c.geometry,p=c.materials,h=d.type==="Line",v=d.type==="Points";let _=!1;if(d.vertices.length===0)continue;const y=new ut;y.setAttribute("position",new Ze(d.vertices,3)),d.normals.length>0&&y.setAttribute("normal",new Ze(d.normals,3)),d.colors.length>0&&(_=!0,y.setAttribute("color",new Ze(d.colors,3))),d.hasUVIndices===!0&&y.setAttribute("uv",new Ze(d.uvs,2));const x=[];for(let w=0,M=p.length;w<M;w++){const S=p[w],C=S.name+"_"+S.smooth+"_"+_;let O=t.materials[C];if(this.materials!==null){if(O=this.materials.create(S.name),h&&O&&!(O instanceof zi)){const k=new zi;it.prototype.copy.call(k,O),k.color.copy(O.color),O=k}else if(v&&O&&!(O instanceof rn)){const k=new rn({size:10,sizeAttenuation:!1});it.prototype.copy.call(k,O),k.color.copy(O.color),k.map=O.map,O=k}}O===void 0&&(h?O=new zi:v?O=new rn({size:1,sizeAttenuation:!1}):O=new Cr,O.name=S.name,O.flatShading=!S.smooth,O.vertexColors=_,t.materials[C]=O),x.push(O)}let b;if(x.length>1){for(let w=0,M=p.length;w<M;w++){const S=p[w];y.addGroup(S.groupStart,S.groupCount,w)}h?b=new Ha(y,x):v?b=new xs(y,x):b=new Mt(y,x)}else h?b=new Ha(y,x[0]):v?b=new xs(y,x[0]):b=new Mt(y,x[0]);b.name=c.name,o.add(b)}else if(t.vertices.length>0){const r=new rn({size:1,sizeAttenuation:!1}),l=new ut;l.setAttribute("position",new Ze(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new Ze(t.colors,3)),r.vertexColors=!0);const c=new xs(l,r);o.add(c)}return o}}class $_ extends Vs{constructor(){super(),this.experience=new wi,this.renderer=this.experience.renderer.instance,this.setLoaders(),this.toLoad=0,this.loaded=0,this.items={}}setLoaders(){this.loaders=[],this.loaders.push({extensions:["jpg","png"],action:g=>{const s=new Image;s.crossOrigin="anonymous",s.addEventListener("load",()=>{this.fileLoadEnd(g,s)}),s.addEventListener("error",()=>{this.fileLoadEnd(g,s)}),s.src=g.source}});const e=new Pc;e.setDecoderPath("draco/"),e.setDecoderConfig({type:"js"}),this.loaders.push({extensions:["drc"],action:g=>{e.load(g.source,s=>{this.fileLoadEnd(g,s),Pc.releaseDecoderModule()})}});const t=new E0;t.setDRACOLoader(e),this.loaders.push({extensions:["glb","gltf"],action:g=>{t.load(g.source,s=>{this.fileLoadEnd(g,s)})}});const i=new K_;this.loaders.push({extensions:["obj"],action:g=>{i.load(g.source,s=>{this.fileLoadEnd(g,s)})}});const a=new P_;this.loaders.push({extensions:["fbx"],action:g=>{a.load(g.source,s=>{this.fileLoadEnd(g,s)})}});const u=new H_;this.loaders.push({extensions:["hdr"],action:g=>{u.load(g.source,s=>{this.fileLoadEnd(g,s)})}})}load(e=[]){for(const t of e){this.toLoad++;const i=t.source.match(/\.([a-z]+)$/);if(typeof i[1]!="undefined"){const a=i[1],u=this.loaders.find(g=>g.extensions.find(s=>s===a));u?u.action(t):console.warn(`Cannot found loader for ${t}`)}else console.warn(`Cannot found extension of ${t}`)}}fileLoadEnd(e,t){this.loaded++,this.items[e.name]=t,this.trigger("fileEnd",[e,t]),this.loaded===this.toLoad&&this.trigger("end")}}class Z_ extends Vs{constructor(e){super(),this.items={},this.loader=new $_({renderer:this.renderer}),this.groups={},this.groups.assets=[...e],this.groups.loaded=[],this.groups.current=null,this.loadNextGroup(),this.loader.on("fileEnd",(t,i)=>{let a=i;t.type==="texture"&&(a instanceof at||(a=new at(i)),a.needsUpdate=!0),this.items[t.name]=a,this.groups.current.loaded++,this.trigger("progress",[this.groups.current,t,a])}),this.loader.on("end",()=>{this.groups.loaded.push(this.groups.current),this.trigger("groupEnd",[this.groups.current]),this.groups.assets.length>0?this.loadNextGroup():this.trigger("end")})}loadNextGroup(){this.groups.current=this.groups.assets.shift(),this.groups.current.toLoad=this.groups.current.items.length,this.groups.current.loaded=0,this.loader.load(this.groups.current.items)}createInstancedMeshes(e,t){const i=[];for(const u of t)i.push({name:u.name,regex:u.regex,meshesGroups:[],instancedMeshes:[]});const a={};for(const u of i)a[u.name]=u.instancedMeshes;return a}destroy(){for(const e in this.items){const t=this.items[e];t instanceof at&&t.dispose()}}}const Ic={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Gs{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const J_=new tr(-1,1,1,-1,0,1),Do=new ut;Do.setAttribute("position",new Ze([-1,3,0,-1,-1,0,3,-1,0],3));Do.setAttribute("uv",new Ze([0,2,0,0,2,0],2));class Q_{constructor(e){this._mesh=new Mt(Do,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,J_)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Fc extends Gs{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Jt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=sh.clone(e.uniforms),this.material=new Jt({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Q_(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class kc extends Gs{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const a=e.getContext(),u=e.state;u.buffers.color.setMask(!1),u.buffers.depth.setMask(!1),u.buffers.color.setLocked(!0),u.buffers.depth.setLocked(!0);let g,s;this.inverse?(g=0,s=1):(g=1,s=0),u.buffers.stencil.setTest(!0),u.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),u.buffers.stencil.setFunc(a.ALWAYS,g,4294967295),u.buffers.stencil.setClear(s),u.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),u.buffers.color.setLocked(!1),u.buffers.depth.setLocked(!1),u.buffers.stencil.setLocked(!1),u.buffers.stencil.setFunc(a.EQUAL,1,4294967295),u.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),u.buffers.stencil.setLocked(!0)}}class ey extends Gs{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class ty{constructor(e,t){if(this.renderer=e,t===void 0){const i=e.getSize(new De);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new li(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Ic===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Fc===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Fc(Ic),this.clock=new e0}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let a=0,u=this.passes.length;a<u;a++){const g=this.passes[a];if(g.enabled!==!1){if(g.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),g.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),g.needsSwap){if(i){const s=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}kc!==void 0&&(g instanceof kc?i=!0:g instanceof ey&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new De);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(i,a),this.renderTarget2.setSize(i,a);for(let u=0;u<this.passes.length;u++)this.passes[u].setSize(i,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new tr(-1,1,1,-1,0,1);const pu=new ut;pu.setAttribute("position",new Ze([-1,3,0,-1,-1,0,3,-1,0],3));pu.setAttribute("uv",new Ze([0,2,0,0,2,0],2));class iy extends Gs{constructor(e,t,i,a,u){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=a,this.clearAlpha=u!==void 0?u:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Te}render(e,t,i){const a=e.autoClear;e.autoClear=!1;let u,g;this.overrideMaterial!==void 0&&(g=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),u=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,u),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=g),e.autoClear=a}}class ny{constructor(e={}){this.experience=new wi,this.config=this.experience.config,this.debug=this.experience.debug,this.stats=this.experience.stats,this.time=this.experience.time,this.sizes=this.experience.sizes,this.scene=this.experience.scene,this.camera=this.experience.camera,this.debug&&(this.debugFolder=this.debug.addFolder("renderer")),this.usePostprocess=!1,this.setInstance(),this.setPostProcess(),window.renderer=this}setInstance(){this.clearColor="#010101",this.instance=new gh({alpha:!0,antialias:!0,colorSpace:kt,toneMapped:!1,preserveDrawingBuffer:!0}),this.instance.outputColorSpace=kt,It.enabled=!0,this.instance.domElement.style.position="absolute",this.instance.domElement.style.top=0,this.instance.domElement.style.left=0,this.instance.domElement.style.width="100%",this.instance.domElement.style.height="100%",this.instance.setClearColor(this.clearColor,0),this.instance.setSize(this.config.width,this.config.height),this.instance.setPixelRatio(this.config.pixelRatio),this.instance.physicallyCorrectLights=!0,this.instance.outputEncoding=ze,this.instance.toneMapping=$t,this.instance.toneMappingExposure=1,this.context=this.instance.getContext(),this.stats&&this.stats.setRenderPanel(this.context),this.debug&&(this.debugFolder.addColor(this,"clearColor").onChange(()=>{this.instance.setClearColor(this.clearColor)}),this.debugFolder.add(this.instance,"toneMapping",{NoToneMapping:$t,LinearToneMapping:Gc,ReinhardToneMapping:Hc,CineonToneMapping:Wc,ACESFilmicToneMapping:jc}).onChange(()=>{this.scene.traverse(e=>{e instanceof Mt&&(e.material.needsUpdate=!0)})}),this.debugFolder.add(this.instance,"toneMappingExposure").min(0).max(10))}setPostProcess(){this.postProcess={},this.postProcess.renderPass=new iy(this.scene,this.camera.instance),this.renderTarget=new li(this.config.width,this.config.height,{generateMipmaps:!1,minFilter:rt,magFilter:rt,format:Kc,encoding:ze,samples:2}),this.postProcess.composer=new ty(this.instance,this.renderTarget),this.postProcess.composer.setSize(this.config.width,this.config.height),this.postProcess.composer.setPixelRatio(this.config.pixelRatio),this.postProcess.composer.addPass(this.postProcess.renderPass)}resize(){this.instance.setSize(this.config.width,this.config.height),this.instance.setPixelRatio(this.config.pixelRatio),this.postProcess.composer.setSize(this.config.width,this.config.height),this.postProcess.composer.setPixelRatio(this.config.pixelRatio)}update(){this.stats&&this.stats.beforeRender(),this.usePostprocess?this.postProcess.composer.render():this.instance.render(this.scene,this.camera.instance),this.stats&&this.stats.afterRender()}destroy(){this.instance.renderLists.dispose(),this.instance.dispose(),this.renderTarget.dispose(),this.postProcess.composer.renderTarget1.dispose(),this.postProcess.composer.renderTarget2.dispose()}takeScreenshot(e=!0){const t=function(i,a){const u=document.createElement("a");typeof u.download=="string"&&(document.body.appendChild(u),u.download=a,u.href=i,u.click(),document.body.removeChild(u))};try{let i="image/octet-stream",a="image/png",u=this.instance.domElement.toDataURL(a);if(e)return u;t(u.replace(a,i),"futkit_"+new Date().getTime()+".jpg")}catch(i){console.log(i)}}}const Bc={type:"change"},Oa={type:"start"},Nc={type:"end"};class ry extends fn{constructor(e,t){super(),t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new X,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:vn.ROTATE,MIDDLE:vn.DOLLY,RIGHT:vn.PAN},this.touches={ONE:_n.ROTATE,TWO:_n.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(B){B.addEventListener("keydown",Me),this._domElementKeyEvents=B},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(Bc),i.update(),u=a.NONE},this.update=function(){const B=new X,de=new St().setFromUnitVectors(e.up,new X(0,1,0)),_e=de.clone().invert(),ve=new X,W=new St,ye=2*Math.PI;return function(){const Pe=i.object.position;B.copy(Pe).sub(i.target),B.applyQuaternion(de),s.setFromVector3(B),i.autoRotate&&u===a.NONE&&C(M()),i.enableDamping?(s.theta+=n.theta*i.dampingFactor,s.phi+=n.phi*i.dampingFactor):(s.theta+=n.theta,s.phi+=n.phi);let Se=i.minAzimuthAngle,Ae=i.maxAzimuthAngle;return isFinite(Se)&&isFinite(Ae)&&(Se<-Math.PI?Se+=ye:Se>Math.PI&&(Se-=ye),Ae<-Math.PI?Ae+=ye:Ae>Math.PI&&(Ae-=ye),Se<=Ae?s.theta=Math.max(Se,Math.min(Ae,s.theta)):s.theta=s.theta>(Se+Ae)/2?Math.max(Se,s.theta):Math.min(Ae,s.theta)),s.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,s.phi)),s.makeSafe(),s.radius*=o,s.radius=Math.max(i.minDistance,Math.min(i.maxDistance,s.radius)),i.enableDamping===!0?i.target.addScaledVector(f,i.dampingFactor):i.target.add(f),B.setFromSpherical(s),B.applyQuaternion(_e),Pe.copy(i.target).add(B),i.object.lookAt(i.target),i.enableDamping===!0?(n.theta*=1-i.dampingFactor,n.phi*=1-i.dampingFactor,f.multiplyScalar(1-i.dampingFactor)):(n.set(0,0,0),f.set(0,0,0)),o=1,r||ve.distanceToSquared(i.object.position)>g||8*(1-W.dot(i.object.quaternion))>g?(i.dispatchEvent(Bc),ve.copy(i.object.position),W.copy(i.object.quaternion),r=!1,!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",te),i.domElement.removeEventListener("pointerdown",$),i.domElement.removeEventListener("pointercancel",ne),i.domElement.removeEventListener("wheel",Ee),i.domElement.removeEventListener("pointermove",se),i.domElement.removeEventListener("pointerup",oe),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",Me)};const i=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let u=a.NONE;const g=1e-6,s=new cc,n=new cc;let o=1;const f=new X;let r=!1;const l=new De,c=new De,d=new De,p=new De,h=new De,v=new De,_=new De,y=new De,x=new De,b=[],w={};function M(){return 2*Math.PI/60/60*i.autoRotateSpeed}function S(){return Math.pow(.95,i.zoomSpeed)}function C(B){n.theta-=B}function O(B){n.phi-=B}const k=function(){const B=new X;return function(_e,ve){B.setFromMatrixColumn(ve,0),B.multiplyScalar(-_e),f.add(B)}}(),Y=function(){const B=new X;return function(_e,ve){i.screenSpacePanning===!0?B.setFromMatrixColumn(ve,1):(B.setFromMatrixColumn(ve,0),B.crossVectors(i.object.up,B)),B.multiplyScalar(_e),f.add(B)}}(),H=function(){const B=new X;return function(_e,ve){const W=i.domElement;if(i.object.isPerspectiveCamera){const ye=i.object.position;B.copy(ye).sub(i.target);let xe=B.length();xe*=Math.tan(i.object.fov/2*Math.PI/180),k(2*_e*xe/W.clientHeight,i.object.matrix),Y(2*ve*xe/W.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(k(_e*(i.object.right-i.object.left)/i.object.zoom/W.clientWidth,i.object.matrix),Y(ve*(i.object.top-i.object.bottom)/i.object.zoom/W.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function N(B){i.object.isPerspectiveCamera?o/=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*B)),i.object.updateProjectionMatrix(),r=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function U(B){i.object.isPerspectiveCamera?o*=B:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/B)),i.object.updateProjectionMatrix(),r=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function G(B){l.set(B.clientX,B.clientY)}function j(B){_.set(B.clientX,B.clientY)}function q(B){p.set(B.clientX,B.clientY)}function T(B){c.set(B.clientX,B.clientY),d.subVectors(c,l).multiplyScalar(i.rotateSpeed);const de=i.domElement;C(2*Math.PI*d.x/de.clientHeight),O(2*Math.PI*d.y/de.clientHeight),l.copy(c),i.update()}function P(B){y.set(B.clientX,B.clientY),x.subVectors(y,_),x.y>0?N(S()):x.y<0&&U(S()),_.copy(y),i.update()}function R(B){h.set(B.clientX,B.clientY),v.subVectors(h,p).multiplyScalar(i.panSpeed),H(v.x,v.y),p.copy(h),i.update()}function L(B){B.deltaY<0?U(S()):B.deltaY>0&&N(S()),i.update()}function V(B){let de=!1;switch(B.code){case i.keys.UP:H(0,i.keyPanSpeed),de=!0;break;case i.keys.BOTTOM:H(0,-i.keyPanSpeed),de=!0;break;case i.keys.LEFT:H(i.keyPanSpeed,0),de=!0;break;case i.keys.RIGHT:H(-i.keyPanSpeed,0),de=!0;break}de&&(B.preventDefault(),i.update())}function I(){if(b.length===1)l.set(b[0].pageX,b[0].pageY);else{const B=.5*(b[0].pageX+b[1].pageX),de=.5*(b[0].pageY+b[1].pageY);l.set(B,de)}}function E(){if(b.length===1)p.set(b[0].pageX,b[0].pageY);else{const B=.5*(b[0].pageX+b[1].pageX),de=.5*(b[0].pageY+b[1].pageY);p.set(B,de)}}function F(){const B=b[0].pageX-b[1].pageX,de=b[0].pageY-b[1].pageY,_e=Math.sqrt(B*B+de*de);_.set(0,_e)}function K(){i.enableZoom&&F(),i.enablePan&&E()}function ee(){i.enableZoom&&F(),i.enableRotate&&I()}function Z(B){if(b.length==1)c.set(B.pageX,B.pageY);else{const _e=Ce(B),ve=.5*(B.pageX+_e.x),W=.5*(B.pageY+_e.y);c.set(ve,W)}d.subVectors(c,l).multiplyScalar(i.rotateSpeed);const de=i.domElement;C(2*Math.PI*d.x/de.clientHeight),O(2*Math.PI*d.y/de.clientHeight),l.copy(c)}function J(B){if(b.length===1)h.set(B.pageX,B.pageY);else{const de=Ce(B),_e=.5*(B.pageX+de.x),ve=.5*(B.pageY+de.y);h.set(_e,ve)}v.subVectors(h,p).multiplyScalar(i.panSpeed),H(v.x,v.y),p.copy(h)}function ae(B){const de=Ce(B),_e=B.pageX-de.x,ve=B.pageY-de.y,W=Math.sqrt(_e*_e+ve*ve);y.set(0,W),x.set(0,Math.pow(y.y/_.y,i.zoomSpeed)),N(x.y),_.copy(y)}function ue(B){i.enableZoom&&ae(B),i.enablePan&&J(B)}function Q(B){i.enableZoom&&ae(B),i.enableRotate&&Z(B)}function $(B){i.enabled!==!1&&(b.length===0&&(i.domElement.setPointerCapture(B.pointerId),i.domElement.addEventListener("pointermove",se),i.domElement.addEventListener("pointerup",oe)),he(B),B.pointerType==="touch"?A(B):le(B))}function se(B){i.enabled!==!1&&(B.pointerType==="touch"?D(B):fe(B))}function oe(B){me(B),b.length===0&&(i.domElement.releasePointerCapture(B.pointerId),i.domElement.removeEventListener("pointermove",se),i.domElement.removeEventListener("pointerup",oe)),i.dispatchEvent(Nc),u=a.NONE}function ne(B){me(B)}function le(B){let de;switch(B.button){case 0:de=i.mouseButtons.LEFT;break;case 1:de=i.mouseButtons.MIDDLE;break;case 2:de=i.mouseButtons.RIGHT;break;default:de=-1}switch(de){case vn.DOLLY:if(i.enableZoom===!1)return;j(B),u=a.DOLLY;break;case vn.ROTATE:if(B.ctrlKey||B.metaKey||B.shiftKey){if(i.enablePan===!1)return;q(B),u=a.PAN}else{if(i.enableRotate===!1)return;G(B),u=a.ROTATE}break;case vn.PAN:if(B.ctrlKey||B.metaKey||B.shiftKey){if(i.enableRotate===!1)return;G(B),u=a.ROTATE}else{if(i.enablePan===!1)return;q(B),u=a.PAN}break;default:u=a.NONE}u!==a.NONE&&i.dispatchEvent(Oa)}function fe(B){if(i.enabled!==!1)switch(u){case a.ROTATE:if(i.enableRotate===!1)return;T(B);break;case a.DOLLY:if(i.enableZoom===!1)return;P(B);break;case a.PAN:if(i.enablePan===!1)return;R(B);break}}function Ee(B){i.enabled===!1||i.enableZoom===!1||u!==a.NONE||(B.preventDefault(),i.dispatchEvent(Oa),L(B),i.dispatchEvent(Nc))}function Me(B){i.enabled===!1||i.enablePan===!1||V(B)}function A(B){switch(ge(B),b.length){case 1:switch(i.touches.ONE){case _n.ROTATE:if(i.enableRotate===!1)return;I(),u=a.TOUCH_ROTATE;break;case _n.PAN:if(i.enablePan===!1)return;E(),u=a.TOUCH_PAN;break;default:u=a.NONE}break;case 2:switch(i.touches.TWO){case _n.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;K(),u=a.TOUCH_DOLLY_PAN;break;case _n.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ee(),u=a.TOUCH_DOLLY_ROTATE;break;default:u=a.NONE}break;default:u=a.NONE}u!==a.NONE&&i.dispatchEvent(Oa)}function D(B){switch(ge(B),u){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;Z(B),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;J(B),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ue(B),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Q(B),i.update();break;default:u=a.NONE}}function te(B){i.enabled!==!1&&B.preventDefault()}function he(B){b.push(B)}function me(B){delete w[B.pointerId];for(let de=0;de<b.length;de++)if(b[de].pointerId==B.pointerId){b.splice(de,1);return}}function ge(B){let de=w[B.pointerId];de===void 0&&(de=new De,w[B.pointerId]=de),de.set(B.pageX,B.pageY)}function Ce(B){const de=B.pointerId===b[0].pointerId?b[1]:b[0];return w[de.pointerId]}i.domElement.addEventListener("contextmenu",te),i.domElement.addEventListener("pointerdown",$),i.domElement.addEventListener("pointercancel",ne),i.domElement.addEventListener("wheel",Ee,{passive:!1}),this.update()}}class sy{constructor(e){this.experience=new wi,this.config=this.experience.config,this.debug=this.experience.debug,this.time=this.experience.time,this.sizes=this.experience.sizes,this.targetElement=this.experience.targetElement,this.scene=this.experience.scene,this.mode="debug",this.setInstance(),this.setModes()}setInstance(){this.instance=new vt(25,this.config.width/this.config.height,.1,150),this.instance.rotation.reorder("YXZ"),this.scene.add(this.instance)}setModes(){this.modes={},this.modes.default={},this.modes.default.instance=this.instance.clone(),this.modes.default.instance.rotation.reorder("YXZ"),this.modes.debug={},this.modes.debug.instance=this.instance.clone(),this.modes.debug.instance.rotation.reorder("YXZ"),this.modes.debug.instance.position.set(0,0,10),this.modes.debug.orbitControls=new ry(this.modes.debug.instance,this.targetElement),this.modes.debug.orbitControls.enabled=this.modes.debug.active,this.modes.debug.orbitControls.screenSpacePanning=!1,this.modes.debug.orbitControls.enableZoom=!1,this.modes.debug.orbitControls.enablePan=!1,this.modes.debug.orbitControls.enableKeys=!1,this.modes.debug.orbitControls.zoomSpeed=.25,this.modes.debug.orbitControls.minPolarAngle=Math.PI*.5,this.modes.debug.orbitControls.maxPolarAngle=Math.PI*.5,this.modes.debug.orbitControls.enableDamping=!0,this.modes.debug.orbitControls.update()}resize(){this.instance.aspect=this.config.width/this.config.height,this.instance.updateProjectionMatrix(),this.modes.default.instance.aspect=this.config.width/this.config.height,this.modes.default.instance.updateProjectionMatrix(),this.modes.debug.instance.aspect=this.config.width/this.config.height,this.modes.debug.instance.updateProjectionMatrix()}update(){this.modes.debug.orbitControls.update(),this.instance.position.copy(this.modes[this.mode].instance.position),this.instance.quaternion.copy(this.modes[this.mode].instance.quaternion),this.instance.updateMatrixWorld()}destroy(){this.modes.debug.orbitControls.destroy()}}var Bn={},ay={},oy=Object.freeze(Object.defineProperty({__proto__:null,default:ay},Symbol.toStringTag,{value:"Module"})),Ia=T0(oy);(function(m){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.3.0"};if(m.fabric=e,typeof document!="undefined"&&typeof window!="undefined")document instanceof(typeof HTMLDocument!="undefined"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var t=Ia,i=new t.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=i.document,e.jsdomImplForWrapper=Ia.implForWrapper,e.nodeCanvas=Ia.Canvas,e.window=i,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document!="undefined"&&typeof window!="undefined"&&(window.fabric=e),function(){function s(c,d){if(!!this.__eventListeners[c]){var p=this.__eventListeners[c];d?p[p.indexOf(d)]=!1:e.util.array.fill(p,!1)}}function n(c,d){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var p in c)this.on(p,c[p]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(d);return this}function o(c,d){var p=function(){d.apply(this,arguments),this.off(c,p)}.bind(this);this.on(c,p)}function f(c,d){if(arguments.length===1)for(var p in c)o.call(this,p,c[p]);else o.call(this,c,d);return this}function r(c,d){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)s.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var p in c)s.call(this,p,c[p]);else s.call(this,c,d);return this}function l(c,d){if(!this.__eventListeners)return this;var p=this.__eventListeners[c];if(!p)return this;for(var h=0,v=p.length;h<v;h++)p[h]&&p[h].call(this,d||{});return this.__eventListeners[c]=p.filter(function(_){return _!==!1}),this}e.Observable={fire:l,on:n,once:f,off:r}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var s=0,n=arguments.length;s<n;s++)this._onObjectAdded(arguments[s]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(s,n,o){var f=this._objects;return o?f[n]=s:f.splice(n,0,s),this._onObjectAdded&&this._onObjectAdded(s),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var s=this._objects,n,o=!1,f=0,r=arguments.length;f<r;f++)n=s.indexOf(arguments[f]),n!==-1&&(o=!0,s.splice(n,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[f]));return this.renderOnAddRemove&&o&&this.requestRenderAll(),this},forEachObject:function(s,n){for(var o=this.getObjects(),f=0,r=o.length;f<r;f++)s.call(n,o[f],f,o);return this},getObjects:function(s){return typeof s=="undefined"?this._objects.concat():this._objects.filter(function(n){return n.type===s})},item:function(s){return this._objects[s]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(s,n){return this._objects.indexOf(s)>-1?!0:n?this._objects.some(function(o){return typeof o.contains=="function"&&o.contains(s,!0)}):!1},complexity:function(){return this._objects.reduce(function(s,n){return s+=n.complexity?n.complexity():0,s},0)}},e.CommonMethods={_setOptions:function(s){for(var n in s)this.set(n,s[n])},_initGradient:function(s,n){s&&s.colorStops&&!(s instanceof e.Gradient)&&this.set(n,new e.Gradient(s))},_initPattern:function(s,n,o){s&&s.source&&!(s instanceof e.Pattern)?this.set(n,new e.Pattern(s,o)):o&&o()},_setObject:function(s){for(var n in s)this._set(n,s[n])},set:function(s,n){return typeof s=="object"?this._setObject(s):this._set(s,n),this},_set:function(s,n){this[s]=n},toggle:function(s){var n=this.get(s);return typeof n=="boolean"&&this.set(s,!n),this},get:function(s){return this[s]}},function(s){var n=Math.sqrt,o=Math.atan2,f=Math.pow,r=Math.PI/180,l=Math.PI/2;e.util={cos:function(c){if(c===0)return 1;c<0&&(c=-c);var d=c/l;switch(d){case 1:case 3:return 0;case 2:return-1}return Math.cos(c)},sin:function(c){if(c===0)return 0;var d=c/l,p=1;switch(c<0&&(p=-1),d){case 1:return p;case 2:return 0;case 3:return-p}return Math.sin(c)},removeFromArray:function(c,d){var p=c.indexOf(d);return p!==-1&&c.splice(p,1),c},getRandomInt:function(c,d){return Math.floor(Math.random()*(d-c+1))+c},degreesToRadians:function(c){return c*r},radiansToDegrees:function(c){return c/r},rotatePoint:function(c,d,p){var h=new e.Point(c.x-d.x,c.y-d.y),v=e.util.rotateVector(h,p);return new e.Point(v.x,v.y).addEquals(d)},rotateVector:function(c,d){var p=e.util.sin(d),h=e.util.cos(d),v=c.x*h-c.y*p,_=c.x*p+c.y*h;return{x:v,y:_}},createVector:function(c,d){return new e.Point(d.x-c.x,d.y-c.y)},calcAngleBetweenVectors:function(c,d){return Math.acos((c.x*d.x+c.y*d.y)/(Math.hypot(c.x,c.y)*Math.hypot(d.x,d.y)))},getHatVector:function(c){return new e.Point(c.x,c.y).multiply(1/Math.hypot(c.x,c.y))},getBisector:function(c,d,p){var h=e.util.createVector(c,d),v=e.util.createVector(c,p),_=e.util.calcAngleBetweenVectors(h,v),y=e.util.calcAngleBetweenVectors(e.util.rotateVector(h,_),v),x=_*(y===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(h,x)),angle:_}},projectStrokeOnPoints:function(c,d,p){var h=[],v=d.strokeWidth/2,_=d.strokeUniform?new e.Point(1/d.scaleX,1/d.scaleY):new e.Point(1,1),y=function(x){var b=v/Math.hypot(x.x,x.y);return new e.Point(x.x*b*_.x,x.y*b*_.y)};return c.length<=1||c.forEach(function(x,b){var w=new e.Point(x.x,x.y),M,S;b===0?(S=c[b+1],M=p?y(e.util.createVector(S,w)).addEquals(w):c[c.length-1]):b===c.length-1?(M=c[b-1],S=p?y(e.util.createVector(M,w)).addEquals(w):c[0]):(M=c[b-1],S=c[b+1]);var C=e.util.getBisector(w,M,S),O=C.vector,k=C.angle,Y,H;if(d.strokeLineJoin==="miter"&&(Y=-v/Math.sin(k/2),H=new e.Point(O.x*Y*_.x,O.y*Y*_.y),Math.hypot(H.x,H.y)/v<=d.strokeMiterLimit)){h.push(w.add(H)),h.push(w.subtract(H));return}Y=-v*Math.SQRT2,H=new e.Point(O.x*Y*_.x,O.y*Y*_.y),h.push(w.add(H)),h.push(w.subtract(H))}),h},transformPoint:function(c,d,p){return p?new e.Point(d[0]*c.x+d[2]*c.y,d[1]*c.x+d[3]*c.y):new e.Point(d[0]*c.x+d[2]*c.y+d[4],d[1]*c.x+d[3]*c.y+d[5])},makeBoundingBoxFromPoints:function(c,d){if(d)for(var p=0;p<c.length;p++)c[p]=e.util.transformPoint(c[p],d);var h=[c[0].x,c[1].x,c[2].x,c[3].x],v=e.util.array.min(h),_=e.util.array.max(h),y=_-v,x=[c[0].y,c[1].y,c[2].y,c[3].y],b=e.util.array.min(x),w=e.util.array.max(x),M=w-b;return{left:v,top:b,width:y,height:M}},invertTransform:function(c){var d=1/(c[0]*c[3]-c[1]*c[2]),p=[d*c[3],-d*c[1],-d*c[2],d*c[0]],h=e.util.transformPoint({x:c[4],y:c[5]},p,!0);return p[4]=-h.x,p[5]=-h.y,p},toFixed:function(c,d){return parseFloat(Number(c).toFixed(d))},parseUnit:function(c,d){var p=/\D{0,2}$/.exec(c),h=parseFloat(c);switch(d||(d=e.Text.DEFAULT_SVG_FONT_SIZE),p[0]){case"mm":return h*e.DPI/25.4;case"cm":return h*e.DPI/2.54;case"in":return h*e.DPI;case"pt":return h*e.DPI/72;case"pc":return h*e.DPI/72*12;case"em":return h*d;default:return h}},falseFunction:function(){return!1},getKlass:function(c,d){return c=e.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1)),e.util.resolveNamespace(d)[c]},getSvgAttributes:function(c){var d=["instantiated_by_use","style","id","class"];switch(c){case"linearGradient":d=d.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":d=d.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":d=d.concat(["offset","stop-color","stop-opacity"]);break}return d},resolveNamespace:function(c){if(!c)return e;var d=c.split("."),p=d.length,h,v=s||e.window;for(h=0;h<p;++h)v=v[d[h]];return v},loadImage:function(c,d,p,h){if(!c){d&&d.call(p,c);return}var v=e.util.createImage(),_=function(){d&&d.call(p,v,!1),v=v.onload=v.onerror=null};v.onload=_,v.onerror=function(){e.log("Error loading "+v.src),d&&d.call(p,null,!0),v=v.onload=v.onerror=null},c.indexOf("data")!==0&&h!==void 0&&h!==null&&(v.crossOrigin=h),c.substring(0,14)==="data:image/svg"&&(v.onload=null,e.util.loadImageInDom(v,_)),v.src=c},loadImageInDom:function(c,d){var p=e.document.createElement("div");p.style.width=p.style.height="1px",p.style.left=p.style.top="-100%",p.style.position="absolute",p.appendChild(c),e.document.querySelector("body").appendChild(p),c.onload=function(){d(),p.parentNode.removeChild(p),p=null}},enlivenObjects:function(c,d,p,h){c=c||[];var v=[],_=0,y=c.length;function x(){++_===y&&d&&d(v.filter(function(b){return b}))}if(!y){d&&d(v);return}c.forEach(function(b,w){if(!b||!b.type){x();return}var M=e.util.getKlass(b.type,p);M.fromObject(b,function(S,C){C||(v[w]=S),h&&h(b,S,C),x()})})},enlivenObjectEnlivables:function(c,d,p){var h=e.Object.ENLIVEN_PROPS.filter(function(v){return!!c[v]});e.util.enlivenObjects(h.map(function(v){return c[v]}),function(v){var _={};h.forEach(function(y,x){_[y]=v[x],d&&(d[y]=v[x])}),p&&p(_)})},enlivenPatterns:function(c,d){c=c||[];function p(){++v===_&&d&&d(h)}var h=[],v=0,_=c.length;if(!_){d&&d(h);return}c.forEach(function(y,x){y&&y.source?new e.Pattern(y,function(b){h[x]=b,p()}):(h[x]=y,p())})},groupSVGElements:function(c,d,p){var h;return c&&c.length===1?(typeof p!="undefined"&&(c[0].sourcePath=p),c[0]):(d&&(d.width&&d.height?d.centerPoint={x:d.width/2,y:d.height/2}:(delete d.width,delete d.height)),h=new e.Group(c,d),typeof p!="undefined"&&(h.sourcePath=p),h)},populateWithProperties:function(c,d,p){if(p&&Array.isArray(p))for(var h=0,v=p.length;h<v;h++)p[h]in c&&(d[p[h]]=c[p[h]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(c){var d=e.util.createCanvasElement();return d.width=c.width,d.height=c.height,d.getContext("2d").drawImage(c,0,0),d},toDataURL:function(c,d,p){return c.toDataURL("image/"+d,p)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(c,d,p){return[c[0]*d[0]+c[2]*d[1],c[1]*d[0]+c[3]*d[1],c[0]*d[2]+c[2]*d[3],c[1]*d[2]+c[3]*d[3],p?0:c[0]*d[4]+c[2]*d[5]+c[4],p?0:c[1]*d[4]+c[3]*d[5]+c[5]]},qrDecompose:function(c){var d=o(c[1],c[0]),p=f(c[0],2)+f(c[1],2),h=n(p),v=(c[0]*c[3]-c[2]*c[1])/h,_=o(c[0]*c[2]+c[1]*c[3],p);return{angle:d/r,scaleX:h,scaleY:v,skewX:_/r,skewY:0,translateX:c[4],translateY:c[5]}},calcRotateMatrix:function(c){if(!c.angle)return e.iMatrix.concat();var d=e.util.degreesToRadians(c.angle),p=e.util.cos(d),h=e.util.sin(d);return[p,h,-h,p,0,0]},calcDimensionsMatrix:function(c){var d=typeof c.scaleX=="undefined"?1:c.scaleX,p=typeof c.scaleY=="undefined"?1:c.scaleY,h=[c.flipX?-d:d,0,0,c.flipY?-p:p,0,0],v=e.util.multiplyTransformMatrices,_=e.util.degreesToRadians;return c.skewX&&(h=v(h,[1,0,Math.tan(_(c.skewX)),1],!0)),c.skewY&&(h=v(h,[1,Math.tan(_(c.skewY)),0,1],!0)),h},composeMatrix:function(c){var d=[1,0,0,1,c.translateX||0,c.translateY||0],p=e.util.multiplyTransformMatrices;return c.angle&&(d=p(d,e.util.calcRotateMatrix(c))),(c.scaleX!==1||c.scaleY!==1||c.skewX||c.skewY||c.flipX||c.flipY)&&(d=p(d,e.util.calcDimensionsMatrix(c))),d},resetObjectTransform:function(c){c.scaleX=1,c.scaleY=1,c.skewX=0,c.skewY=0,c.flipX=!1,c.flipY=!1,c.rotate(0)},saveObjectTransform:function(c){return{scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,angle:c.angle,left:c.left,flipX:c.flipX,flipY:c.flipY,top:c.top}},isTransparent:function(c,d,p,h){h>0&&(d>h?d-=h:d=0,p>h?p-=h:p=0);var v=!0,_,y,x=c.getImageData(d,p,h*2||1,h*2||1),b=x.data.length;for(_=3;_<b&&(y=x.data[_],v=y<=0,v!==!1);_+=4);return x=null,v},parsePreserveAspectRatioAttribute:function(c){var d="meet",p="Mid",h="Mid",v=c.split(" "),_;return v&&v.length&&(d=v.pop(),d!=="meet"&&d!=="slice"?(_=d,d="meet"):v.length&&(_=v.pop())),p=_!=="none"?_.slice(1,4):"none",h=_!=="none"?_.slice(5,8):"none",{meetOrSlice:d,alignX:p,alignY:h}},clearFabricFontCache:function(c){c=(c||"").toLowerCase(),c?e.charWidthsCache[c]&&delete e.charWidthsCache[c]:e.charWidthsCache={}},limitDimsByArea:function(c,d){var p=Math.sqrt(d*c),h=Math.floor(d/p);return{x:Math.floor(p),y:h}},capValue:function(c,d,p){return Math.max(c,Math.min(d,p))},findScaleToFit:function(c,d){return Math.min(d.width/c.width,d.height/c.height)},findScaleToCover:function(c,d){return Math.max(d.width/c.width,d.height/c.height)},matrixToSVG:function(c){return"matrix("+c.map(function(d){return e.util.toFixed(d,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(c,d){var p=e.util.invertTransform(d),h=e.util.multiplyTransformMatrices(p,c.calcOwnMatrix());e.util.applyTransformToObject(c,h)},addTransformToObject:function(c,d){e.util.applyTransformToObject(c,e.util.multiplyTransformMatrices(d,c.calcOwnMatrix()))},applyTransformToObject:function(c,d){var p=e.util.qrDecompose(d),h=new e.Point(p.translateX,p.translateY);c.flipX=!1,c.flipY=!1,c.set("scaleX",p.scaleX),c.set("scaleY",p.scaleY),c.skewX=p.skewX,c.skewY=p.skewY,c.angle=p.angle,c.setPositionByOrigin(h,"center","center")},sizeAfterTransform:function(c,d,p){var h=c/2,v=d/2,_=[{x:-h,y:-v},{x:h,y:-v},{x:-h,y:v},{x:h,y:v}],y=e.util.calcDimensionsMatrix(p),x=e.util.makeBoundingBoxFromPoints(_,y);return{x:x.width,y:x.height}},mergeClipPaths:function(c,d){var p=c,h=d;p.inverted&&!h.inverted&&(p=d,h=c),e.util.applyTransformToObject(h,e.util.multiplyTransformMatrices(e.util.invertTransform(p.calcTransformMatrix()),h.calcTransformMatrix()));var v=p.inverted&&h.inverted;return v&&(p.inverted=h.inverted=!1),new e.Group([p],{clipPath:h,inverted:v})},hasStyleChanged:function(c,d,p){return p=p||!1,c.fill!==d.fill||c.stroke!==d.stroke||c.strokeWidth!==d.strokeWidth||c.fontSize!==d.fontSize||c.fontFamily!==d.fontFamily||c.fontWeight!==d.fontWeight||c.fontStyle!==d.fontStyle||c.textBackgroundColor!==d.textBackgroundColor||c.deltaY!==d.deltaY||p&&(c.overline!==d.overline||c.underline!==d.underline||c.linethrough!==d.linethrough)},stylesToArray:function(p,d){for(var p=e.util.object.clone(p,!0),h=d.split(`
`),v=-1,_={},y=[],x=0;x<h.length;x++){if(!p[x]){v+=h[x].length;continue}for(var b=0;b<h[x].length;b++){v++;var w=p[x][b];if(w&&Object.keys(w).length>0){var M=e.util.hasStyleChanged(_,w,!0);M?y.push({start:v,end:v+1,style:w}):y[y.length-1].end++}_=w||{}}}return y},stylesFromArray:function(c,d){if(!Array.isArray(c))return c;for(var p=d.split(`
`),h=-1,v=0,_={},y=0;y<p.length;y++)for(var x=0;x<p[y].length;x++)h++,c[v]&&c[v].start<=h&&h<c[v].end&&(_[y]=_[y]||{},_[y][x]=Object.assign({},c[v].style),h===c[v].end-1&&v++);return _}}}(m),function(){var s=Array.prototype.join,n={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},o={m:"l",M:"L"};function f(T,P,R,L,V,I,E,F,K,ee,Z){var J=e.util.cos(T),ae=e.util.sin(T),ue=e.util.cos(P),Q=e.util.sin(P),$=R*V*ue-L*I*Q+E,se=L*V*ue+R*I*Q+F,oe=ee+K*(-R*V*ae-L*I*J),ne=Z+K*(-L*V*ae+R*I*J),le=$+K*(R*V*Q+L*I*ue),fe=se+K*(L*V*Q-R*I*ue);return["C",oe,ne,le,fe,$,se]}function r(T,P,R,L,V,I,E){var F=Math.PI,K=E*F/180,ee=e.util.sin(K),Z=e.util.cos(K),J=0,ae=0;R=Math.abs(R),L=Math.abs(L);var ue=-Z*T*.5-ee*P*.5,Q=-Z*P*.5+ee*T*.5,$=R*R,se=L*L,oe=Q*Q,ne=ue*ue,le=$*se-$*oe-se*ne,fe=0;if(le<0){var Ee=Math.sqrt(1-le/($*se));R*=Ee,L*=Ee}else fe=(V===I?-1:1)*Math.sqrt(le/($*oe+se*ne));var Me=fe*R*Q/L,A=-fe*L*ue/R,D=Z*Me-ee*A+T*.5,te=ee*Me+Z*A+P*.5,he=l(1,0,(ue-Me)/R,(Q-A)/L),me=l((ue-Me)/R,(Q-A)/L,(-ue-Me)/R,(-Q-A)/L);I===0&&me>0?me-=2*F:I===1&&me<0&&(me+=2*F);for(var ge=Math.ceil(Math.abs(me/F*2)),Ce=[],B=me/ge,de=8/3*Math.sin(B/4)*Math.sin(B/4)/Math.sin(B/2),_e=he+B,ve=0;ve<ge;ve++)Ce[ve]=f(he,_e,Z,ee,R,L,D,te,de,J,ae),J=Ce[ve][5],ae=Ce[ve][6],he=_e,_e+=B;return Ce}function l(T,P,R,L){var V=Math.atan2(P,T),I=Math.atan2(L,R);return I>=V?I-V:2*Math.PI-(V-I)}function c(T,P,R,L,V,I,E,F){var K;if(e.cachesBoundsOfCurve&&(K=s.call(arguments),e.boundsOfCurveCache[K]))return e.boundsOfCurveCache[K];var ee=Math.sqrt,Z=Math.min,J=Math.max,ae=Math.abs,ue=[],Q=[[],[]],$,se,oe,ne,le,fe,Ee,Me;se=6*T-12*R+6*V,$=-3*T+9*R-9*V+3*E,oe=3*R-3*T;for(var A=0;A<2;++A){if(A>0&&(se=6*P-12*L+6*I,$=-3*P+9*L-9*I+3*F,oe=3*L-3*P),ae($)<1e-12){if(ae(se)<1e-12)continue;ne=-oe/se,0<ne&&ne<1&&ue.push(ne);continue}Ee=se*se-4*oe*$,!(Ee<0)&&(Me=ee(Ee),le=(-se+Me)/(2*$),0<le&&le<1&&ue.push(le),fe=(-se-Me)/(2*$),0<fe&&fe<1&&ue.push(fe))}for(var D,te,he=ue.length,me=he,ge;he--;)ne=ue[he],ge=1-ne,D=ge*ge*ge*T+3*ge*ge*ne*R+3*ge*ne*ne*V+ne*ne*ne*E,Q[0][he]=D,te=ge*ge*ge*P+3*ge*ge*ne*L+3*ge*ne*ne*I+ne*ne*ne*F,Q[1][he]=te;Q[0][me]=T,Q[1][me]=P,Q[0][me+1]=E,Q[1][me+1]=F;var Ce=[{x:Z.apply(null,Q[0]),y:Z.apply(null,Q[1])},{x:J.apply(null,Q[0]),y:J.apply(null,Q[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[K]=Ce),Ce}function d(T,P,R){for(var L=R[1],V=R[2],I=R[3],E=R[4],F=R[5],K=R[6],ee=R[7],Z=r(K-T,ee-P,L,V,E,F,I),J=0,ae=Z.length;J<ae;J++)Z[J][1]+=T,Z[J][2]+=P,Z[J][3]+=T,Z[J][4]+=P,Z[J][5]+=T,Z[J][6]+=P;return Z}function p(T){var P=0,R=0,L=T.length,V=0,I=0,E,F,K,ee=[],Z,J,ae;for(F=0;F<L;++F){switch(K=!1,E=T[F].slice(0),E[0]){case"l":E[0]="L",E[1]+=P,E[2]+=R;case"L":P=E[1],R=E[2];break;case"h":E[1]+=P;case"H":E[0]="L",E[2]=R,P=E[1];break;case"v":E[1]+=R;case"V":E[0]="L",R=E[1],E[1]=P,E[2]=R;break;case"m":E[0]="M",E[1]+=P,E[2]+=R;case"M":P=E[1],R=E[2],V=E[1],I=E[2];break;case"c":E[0]="C",E[1]+=P,E[2]+=R,E[3]+=P,E[4]+=R,E[5]+=P,E[6]+=R;case"C":J=E[3],ae=E[4],P=E[5],R=E[6];break;case"s":E[0]="S",E[1]+=P,E[2]+=R,E[3]+=P,E[4]+=R;case"S":Z==="C"?(J=2*P-J,ae=2*R-ae):(J=P,ae=R),P=E[3],R=E[4],E[0]="C",E[5]=E[3],E[6]=E[4],E[3]=E[1],E[4]=E[2],E[1]=J,E[2]=ae,J=E[3],ae=E[4];break;case"q":E[0]="Q",E[1]+=P,E[2]+=R,E[3]+=P,E[4]+=R;case"Q":J=E[1],ae=E[2],P=E[3],R=E[4];break;case"t":E[0]="T",E[1]+=P,E[2]+=R;case"T":Z==="Q"?(J=2*P-J,ae=2*R-ae):(J=P,ae=R),E[0]="Q",P=E[1],R=E[2],E[1]=J,E[2]=ae,E[3]=P,E[4]=R;break;case"a":E[0]="A",E[6]+=P,E[7]+=R;case"A":K=!0,ee=ee.concat(d(P,R,E)),P=E[6],R=E[7];break;case"z":case"Z":P=V,R=I;break}K||ee.push(E),Z=E[0]}return ee}function h(T,P,R,L){return Math.sqrt((R-T)*(R-T)+(L-P)*(L-P))}function v(T){return T*T*T}function _(T){return 3*T*T*(1-T)}function y(T){return 3*T*(1-T)*(1-T)}function x(T){return(1-T)*(1-T)*(1-T)}function b(T,P,R,L,V,I,E,F){return function(K){var ee=v(K),Z=_(K),J=y(K),ae=x(K);return{x:E*ee+V*Z+R*J+T*ae,y:F*ee+I*Z+L*J+P*ae}}}function w(T,P,R,L,V,I,E,F){return function(K){var ee=1-K,Z=3*ee*ee*(R-T)+6*ee*K*(V-R)+3*K*K*(E-V),J=3*ee*ee*(L-P)+6*ee*K*(I-L)+3*K*K*(F-I);return Math.atan2(J,Z)}}function M(T){return T*T}function S(T){return 2*T*(1-T)}function C(T){return(1-T)*(1-T)}function O(T,P,R,L,V,I){return function(E){var F=M(E),K=S(E),ee=C(E);return{x:V*F+R*K+T*ee,y:I*F+L*K+P*ee}}}function k(T,P,R,L,V,I){return function(E){var F=1-E,K=2*F*(R-T)+2*E*(V-R),ee=2*F*(L-P)+2*E*(I-L);return Math.atan2(ee,K)}}function Y(T,P,R){var L={x:P,y:R},V,I=0,E;for(E=1;E<=100;E+=1)V=T(E/100),I+=h(L.x,L.y,V.x,V.y),L=V;return I}function H(T,P){for(var R=0,L=0,V=T.iterator,I={x:T.x,y:T.y},E,F,K=.01,ee=T.angleFinder,Z;L<P&&K>1e-4;)E=V(R),Z=R,F=h(I.x,I.y,E.x,E.y),F+L>P?(R-=K,K/=2):(I=E,R+=K,L+=F);return E.angle=ee(Z),E}function N(T){for(var P=0,R=T.length,L,V=0,I=0,E=0,F=0,K=[],ee,Z,J,ae=0;ae<R;ae++){switch(L=T[ae],Z={x:V,y:I,command:L[0]},L[0]){case"M":Z.length=0,E=V=L[1],F=I=L[2];break;case"L":Z.length=h(V,I,L[1],L[2]),V=L[1],I=L[2];break;case"C":ee=b(V,I,L[1],L[2],L[3],L[4],L[5],L[6]),J=w(V,I,L[1],L[2],L[3],L[4],L[5],L[6]),Z.iterator=ee,Z.angleFinder=J,Z.length=Y(ee,V,I),V=L[5],I=L[6];break;case"Q":ee=O(V,I,L[1],L[2],L[3],L[4]),J=k(V,I,L[1],L[2],L[3],L[4]),Z.iterator=ee,Z.angleFinder=J,Z.length=Y(ee,V,I),V=L[3],I=L[4];break;case"Z":case"z":Z.destX=E,Z.destY=F,Z.length=h(V,I,E,F),V=E,I=F;break}P+=Z.length,K.push(Z)}return K.push({length:P,x:V,y:I}),K}function U(T,P,R){R||(R=N(T));for(var L=0;P-R[L].length>0&&L<R.length-2;)P-=R[L].length,L++;var V=R[L],I=P/V.length,E=V.command,F=T[L],K;switch(E){case"M":return{x:V.x,y:V.y,angle:0};case"Z":case"z":return K=new e.Point(V.x,V.y).lerp(new e.Point(V.destX,V.destY),I),K.angle=Math.atan2(V.destY-V.y,V.destX-V.x),K;case"L":return K=new e.Point(V.x,V.y).lerp(new e.Point(F[1],F[2]),I),K.angle=Math.atan2(F[2]-V.y,F[1]-V.x),K;case"C":return H(V,P);case"Q":return H(V,P)}}function G(T){var P=[],R=[],L,V,I=e.rePathCommand,E="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",F="("+E+")"+e.commaWsp,K="([01])"+e.commaWsp+"?",ee=F+"?"+F+"?"+F+K+K+F+"?("+E+")",Z=new RegExp(ee,"g"),J,ae,ue;if(!T||!T.match)return P;ue=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var Q=0,$,se=ue.length;Q<se;Q++){L=ue[Q],ae=L.slice(1).trim(),R.length=0;var oe=L.charAt(0);if($=[oe],oe.toLowerCase()==="a")for(var ne;ne=Z.exec(ae);)for(var le=1;le<ne.length;le++)R.push(ne[le]);else for(;J=I.exec(ae);)R.push(J[0]);for(var le=0,fe=R.length;le<fe;le++)V=parseFloat(R[le]),isNaN(V)||$.push(V);var Ee=n[oe.toLowerCase()],Me=o[oe]||oe;if($.length-1>Ee)for(var A=1,D=$.length;A<D;A+=Ee)P.push([oe].concat($.slice(A,A+Ee))),oe=Me;else P.push($)}return P}function j(T,P){var R=[],L,V=new e.Point(T[0].x,T[0].y),I=new e.Point(T[1].x,T[1].y),E=T.length,F=1,K=0,ee=E>2;for(P=P||0,ee&&(F=T[2].x<I.x?-1:T[2].x===I.x?0:1,K=T[2].y<I.y?-1:T[2].y===I.y?0:1),R.push(["M",V.x-F*P,V.y-K*P]),L=1;L<E;L++){if(!V.eq(I)){var Z=V.midPointFrom(I);R.push(["Q",V.x,V.y,Z.x,Z.y])}V=T[L],L+1<T.length&&(I=T[L+1])}return ee&&(F=V.x>T[L-2].x?1:V.x===T[L-2].x?0:-1,K=V.y>T[L-2].y?1:V.y===T[L-2].y?0:-1),R.push(["L",V.x+F*P,V.y+K*P]),R}function q(T,P,R){return R&&(P=e.util.multiplyTransformMatrices(P,[1,0,0,1,-R.x,-R.y])),T.map(function(L){for(var V=L.slice(0),I={},E=1;E<L.length-1;E+=2)I.x=L[E],I.y=L[E+1],I=e.util.transformPoint(I,P),V[E]=I.x,V[E+1]=I.y;return V})}e.util.joinPath=function(T){return T.map(function(P){return P.join(" ")}).join(" ")},e.util.parsePath=G,e.util.makePathSimpler=p,e.util.getSmoothPathFromPoints=j,e.util.getPathSegmentsInfo=N,e.util.getBoundsOfCurve=c,e.util.getPointOnPath=U,e.util.transformPath=q}(),function(){var s=Array.prototype.slice;function n(c,d){for(var p=s.call(arguments,2),h=[],v=0,_=c.length;v<_;v++)h[v]=p.length?c[v][d].apply(c[v],p):c[v][d].call(c[v]);return h}function o(c,d){return l(c,d,function(p,h){return p>=h})}function f(c,d){return l(c,d,function(p,h){return p<h})}function r(c,d){for(var p=c.length;p--;)c[p]=d;return c}function l(c,d,p){if(!(!c||c.length===0)){var h=c.length-1,v=d?c[h][d]:c[h];if(d)for(;h--;)p(c[h][d],v)&&(v=c[h][d]);else for(;h--;)p(c[h],v)&&(v=c[h]);return v}}e.util.array={fill:r,invoke:n,min:f,max:o}}(),function(){function s(o,f,r){if(r)if(!e.isLikelyNode&&f instanceof Element)o=f;else if(f instanceof Array){o=[];for(var l=0,c=f.length;l<c;l++)o[l]=s({},f[l],r)}else if(f&&typeof f=="object")for(var d in f)d==="canvas"||d==="group"?o[d]=null:f.hasOwnProperty(d)&&(o[d]=s({},f[d],r));else o=f;else for(var d in f)o[d]=f[d];return o}function n(o,f){return s({},o,f)}e.util.object={extend:s,clone:n},e.util.object.extend(e.util,e.Observable)}(),function(){function s(l){return l.replace(/-+(.)?/g,function(c,d){return d?d.toUpperCase():""})}function n(l,c){return l.charAt(0).toUpperCase()+(c?l.slice(1):l.slice(1).toLowerCase())}function o(l){return l.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function f(l){var c=0,d,p=[];for(c=0,d;c<l.length;c++)(d=r(l,c))!==!1&&p.push(d);return p}function r(l,c){var d=l.charCodeAt(c);if(isNaN(d))return"";if(d<55296||d>57343)return l.charAt(c);if(55296<=d&&d<=56319){if(l.length<=c+1)throw"High surrogate without following low surrogate";var p=l.charCodeAt(c+1);if(56320>p||p>57343)throw"High surrogate without following low surrogate";return l.charAt(c)+l.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var h=l.charCodeAt(c-1);if(55296>h||h>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:s,capitalize:n,escapeXml:o,graphemeSplit:f}}(),function(){var s=Array.prototype.slice,n=function(){},o=function(){for(var d in{toString:1})if(d==="toString")return!1;return!0}(),f=function(d,p,h){for(var v in p)v in d.prototype&&typeof d.prototype[v]=="function"&&(p[v]+"").indexOf("callSuper")>-1?d.prototype[v]=function(_){return function(){var y=this.constructor.superclass;this.constructor.superclass=h;var x=p[_].apply(this,arguments);if(this.constructor.superclass=y,_!=="initialize")return x}}(v):d.prototype[v]=p[v],o&&(p.toString!==Object.prototype.toString&&(d.prototype.toString=p.toString),p.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=p.valueOf))};function r(){}function l(d){for(var p=null,h=this;h.constructor.superclass;){var v=h.constructor.superclass.prototype[d];if(h[d]!==v){p=v;break}h=h.constructor.superclass.prototype}return p?arguments.length>1?p.apply(this,s.call(arguments,1)):p.call(this):console.log("tried to callSuper "+d+", method not found in prototype chain",this)}function c(){var d=null,p=s.call(arguments,0);typeof p[0]=="function"&&(d=p.shift());function h(){this.initialize.apply(this,arguments)}h.superclass=d,h.subclasses=[],d&&(r.prototype=d.prototype,h.prototype=new r,d.subclasses.push(h));for(var v=0,_=p.length;v<_;v++)f(h,p[v],d);return h.prototype.initialize||(h.prototype.initialize=n),h.prototype.constructor=h,h.prototype.callSuper=l,h}e.util.createClass=c}(),function(){var s=!!e.document.createElement("div").attachEvent,n=["touchstart","touchmove","touchend"];e.util.addListener=function(f,r,l,c){f&&f.addEventListener(r,l,s?!1:c)},e.util.removeListener=function(f,r,l,c){f&&f.removeEventListener(r,l,s?!1:c)};function o(f){var r=f.changedTouches;return r&&r[0]?r[0]:f}e.util.getPointer=function(f){var r=f.target,l=e.util.getScrollLeftTop(r),c=o(f);return{x:c.clientX+l.left,y:c.clientY+l.top}},e.util.isTouchEvent=function(f){return n.indexOf(f.type)>-1||f.pointerType==="touch"}}(),function(){function s(c,d){var p=c.style;if(!p)return c;if(typeof d=="string")return c.style.cssText+=";"+d,d.indexOf("opacity")>-1?l(c,d.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var h in d)if(h==="opacity")l(c,d[h]);else{var v=h==="float"||h==="cssFloat"?typeof p.styleFloat=="undefined"?"cssFloat":"styleFloat":h;p.setProperty(v,d[h])}return c}var n=e.document.createElement("div"),o=typeof n.style.opacity=="string",f=typeof n.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,l=function(c){return c};o?l=function(c,d){return c.style.opacity=d,c}:f&&(l=function(c,d){var p=c.style;return c.currentStyle&&!c.currentStyle.hasLayout&&(p.zoom=1),r.test(p.filter)?(d=d>=.9999?"":"alpha(opacity="+d*100+")",p.filter=p.filter.replace(r,d)):p.filter+=" alpha(opacity="+d*100+")",c}),e.util.setStyle=s}(),function(){var s=Array.prototype.slice;function n(x){return typeof x=="string"?e.document.getElementById(x):x}var o,f=function(x){return s.call(x,0)};try{o=f(e.document.childNodes)instanceof Array}catch{}o||(f=function(x){for(var b=new Array(x.length),w=x.length;w--;)b[w]=x[w];return b});function r(x,b){var w=e.document.createElement(x);for(var M in b)M==="class"?w.className=b[M]:M==="for"?w.htmlFor=b[M]:w.setAttribute(M,b[M]);return w}function l(x,b){x&&(" "+x.className+" ").indexOf(" "+b+" ")===-1&&(x.className+=(x.className?" ":"")+b)}function c(x,b,w){return typeof b=="string"&&(b=r(b,w)),x.parentNode&&x.parentNode.replaceChild(b,x),b.appendChild(x),b}function d(x){for(var b=0,w=0,M=e.document.documentElement,S=e.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&(x=x.parentNode||x.host,x===e.document?(b=S.scrollLeft||M.scrollLeft||0,w=S.scrollTop||M.scrollTop||0):(b+=x.scrollLeft||0,w+=x.scrollTop||0),!(x.nodeType===1&&x.style.position==="fixed")););return{left:b,top:w}}function p(x){var b,w=x&&x.ownerDocument,M={left:0,top:0},S={left:0,top:0},C,O={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!w)return S;for(var k in O)S[O[k]]+=parseInt(h(x,k),10)||0;return b=w.documentElement,typeof x.getBoundingClientRect!="undefined"&&(M=x.getBoundingClientRect()),C=d(x),{left:M.left+C.left-(b.clientLeft||0)+S.left,top:M.top+C.top-(b.clientTop||0)+S.top}}var h;e.document.defaultView&&e.document.defaultView.getComputedStyle?h=function(x,b){var w=e.document.defaultView.getComputedStyle(x,null);return w?w[b]:void 0}:h=function(x,b){var w=x.style[b];return!w&&x.currentStyle&&(w=x.currentStyle[b]),w},function(){var x=e.document.documentElement.style,b="userSelect"in x?"userSelect":"MozUserSelect"in x?"MozUserSelect":"WebkitUserSelect"in x?"WebkitUserSelect":"KhtmlUserSelect"in x?"KhtmlUserSelect":"";function w(S){return typeof S.onselectstart!="undefined"&&(S.onselectstart=e.util.falseFunction),b?S.style[b]="none":typeof S.unselectable=="string"&&(S.unselectable="on"),S}function M(S){return typeof S.onselectstart!="undefined"&&(S.onselectstart=null),b?S.style[b]="":typeof S.unselectable=="string"&&(S.unselectable=""),S}e.util.makeElementUnselectable=w,e.util.makeElementSelectable=M}();function v(x){var b=e.jsdomImplForWrapper(x);return b._canvas||b._image}function _(x){if(!!e.isLikelyNode){var b=e.jsdomImplForWrapper(x);b&&(b._image=null,b._canvas=null,b._currentSrc=null,b._attributes=null,b._classList=null)}}function y(x,b){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=b}e.util.setImageSmoothing=y,e.util.getById=n,e.util.toArray=f,e.util.addClass=l,e.util.makeElement=r,e.util.wrapElement=c,e.util.getScrollLeftTop=d,e.util.getElementOffset=p,e.util.getNodeCanvas=v,e.util.cleanUpJsdomNode=_}(),function(){function s(f,r){return f+(/\?/.test(f)?"&":"?")+r}function n(){}function o(f,r){r||(r={});var l=r.method?r.method.toUpperCase():"GET",c=r.onComplete||function(){},d=new e.window.XMLHttpRequest,p=r.body||r.parameters;return d.onreadystatechange=function(){d.readyState===4&&(c(d),d.onreadystatechange=n)},l==="GET"&&(p=null,typeof r.parameters=="string"&&(f=s(f,r.parameters))),d.open(l,f,!0),(l==="POST"||l==="PUT")&&d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.send(p),d}e.util.request=o}(),e.log=console.log,e.warn=console.warn,function(){var s=e.util.object.extend,n=e.util.object.clone,o=[];e.util.object.extend(o,{cancelAll:function(){var v=this.splice(0);return v.forEach(function(_){_.cancel()}),v},cancelByCanvas:function(v){if(!v)return[];var _=this.filter(function(y){return typeof y.target=="object"&&y.target.canvas===v});return _.forEach(function(y){y.cancel()}),_},cancelByTarget:function(v){var _=this.findAnimationsByTarget(v);return _.forEach(function(y){y.cancel()}),_},findAnimationIndex:function(v){return this.indexOf(this.findAnimation(v))},findAnimation:function(v){return this.find(function(_){return _.cancel===v})},findAnimationsByTarget:function(v){return v?this.filter(function(_){return _.target===v}):[]}});function f(){return!1}function r(v,_,y,x){return-y*Math.cos(v/x*(Math.PI/2))+y+_}function l(v){v||(v={});var _=!1,y,x=function(){var b=e.runningAnimations.indexOf(y);return b>-1&&e.runningAnimations.splice(b,1)[0]};return y=s(n(v),{cancel:function(){return _=!0,x()},currentValue:"startValue"in v?v.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(y),p(function(b){var w=b||+new Date,M=v.duration||500,S=w+M,C,O=v.onChange||f,k=v.abort||f,Y=v.onComplete||f,H=v.easing||r,N="startValue"in v?v.startValue.length>0:!1,U="startValue"in v?v.startValue:0,G="endValue"in v?v.endValue:100,j=v.byValue||(N?U.map(function(q,T){return G[T]-U[T]}):G-U);v.onStart&&v.onStart(),function q(T){C=T||+new Date;var P=C>S?M:C-w,R=P/M,L=N?U.map(function(I,E){return H(P,U[E],j[E],M)}):H(P,U,j,M),V=Math.abs(N?(L[0]-U[0])/j[0]:(L-U)/j);if(y.currentValue=N?L.slice():L,y.completionRate=V,y.durationRate=R,!_){if(k(L,V,R)){x();return}if(C>S){y.currentValue=N?G.slice():G,y.completionRate=1,y.durationRate=1,O(N?G.slice():G,1,1),Y(G,1,1),x();return}else O(L,V,R),p(q)}}(w)}),y.cancel}var c=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(v){return e.window.setTimeout(v,1e3/60)},d=e.window.cancelAnimationFrame||e.window.clearTimeout;function p(){return c.apply(e.window,arguments)}function h(){return d.apply(e.window,arguments)}e.util.animate=l,e.util.requestAnimFrame=p,e.util.cancelAnimFrame=h,e.runningAnimations=o}(),function(){function s(o,f,r){var l="rgba("+parseInt(o[0]+r*(f[0]-o[0]),10)+","+parseInt(o[1]+r*(f[1]-o[1]),10)+","+parseInt(o[2]+r*(f[2]-o[2]),10);return l+=","+(o&&f?parseFloat(o[3]+r*(f[3]-o[3])):1),l+=")",l}function n(o,f,r,l){var c=new e.Color(o).getSource(),d=new e.Color(f).getSource(),p=l.onComplete,h=l.onChange;return l=l||{},e.util.animate(e.util.object.extend(l,{duration:r||500,startValue:c,endValue:d,byValue:d,easing:function(v,_,y,x){var b=l.colorEasing?l.colorEasing(v,x):1-Math.cos(v/x*(Math.PI/2));return s(_,y,b)},onComplete:function(v,_,y){if(p)return p(s(d,d,0),_,y)},onChange:function(v,_,y){if(h){if(Array.isArray(v))return h(s(v,v,0),_,y);h(v,_,y)}}}))}e.util.animateColor=n}(),function(){function s(T,P,R,L){return T<Math.abs(P)?(T=P,L=R/4):P===0&&T===0?L=R/(2*Math.PI)*Math.asin(1):L=R/(2*Math.PI)*Math.asin(P/T),{a:T,c:P,p:R,s:L}}function n(T,P,R){return T.a*Math.pow(2,10*(P-=1))*Math.sin((P*R-T.s)*(2*Math.PI)/T.p)}function o(T,P,R,L){return R*((T=T/L-1)*T*T+1)+P}function f(T,P,R,L){return T/=L/2,T<1?R/2*T*T*T+P:R/2*((T-=2)*T*T+2)+P}function r(T,P,R,L){return R*(T/=L)*T*T*T+P}function l(T,P,R,L){return-R*((T=T/L-1)*T*T*T-1)+P}function c(T,P,R,L){return T/=L/2,T<1?R/2*T*T*T*T+P:-R/2*((T-=2)*T*T*T-2)+P}function d(T,P,R,L){return R*(T/=L)*T*T*T*T+P}function p(T,P,R,L){return R*((T=T/L-1)*T*T*T*T+1)+P}function h(T,P,R,L){return T/=L/2,T<1?R/2*T*T*T*T*T+P:R/2*((T-=2)*T*T*T*T+2)+P}function v(T,P,R,L){return-R*Math.cos(T/L*(Math.PI/2))+R+P}function _(T,P,R,L){return R*Math.sin(T/L*(Math.PI/2))+P}function y(T,P,R,L){return-R/2*(Math.cos(Math.PI*T/L)-1)+P}function x(T,P,R,L){return T===0?P:R*Math.pow(2,10*(T/L-1))+P}function b(T,P,R,L){return T===L?P+R:R*(-Math.pow(2,-10*T/L)+1)+P}function w(T,P,R,L){return T===0?P:T===L?P+R:(T/=L/2,T<1?R/2*Math.pow(2,10*(T-1))+P:R/2*(-Math.pow(2,-10*--T)+2)+P)}function M(T,P,R,L){return-R*(Math.sqrt(1-(T/=L)*T)-1)+P}function S(T,P,R,L){return R*Math.sqrt(1-(T=T/L-1)*T)+P}function C(T,P,R,L){return T/=L/2,T<1?-R/2*(Math.sqrt(1-T*T)-1)+P:R/2*(Math.sqrt(1-(T-=2)*T)+1)+P}function O(T,P,R,L){var V=1.70158,I=0,E=R;if(T===0)return P;if(T/=L,T===1)return P+R;I||(I=L*.3);var F=s(E,R,I,V);return-n(F,T,L)+P}function k(T,P,R,L){var V=1.70158,I=0,E=R;if(T===0)return P;if(T/=L,T===1)return P+R;I||(I=L*.3);var F=s(E,R,I,V);return F.a*Math.pow(2,-10*T)*Math.sin((T*L-F.s)*(2*Math.PI)/F.p)+F.c+P}function Y(T,P,R,L){var V=1.70158,I=0,E=R;if(T===0)return P;if(T/=L/2,T===2)return P+R;I||(I=L*(.3*1.5));var F=s(E,R,I,V);return T<1?-.5*n(F,T,L)+P:F.a*Math.pow(2,-10*(T-=1))*Math.sin((T*L-F.s)*(2*Math.PI)/F.p)*.5+F.c+P}function H(T,P,R,L,V){return V===void 0&&(V=1.70158),R*(T/=L)*T*((V+1)*T-V)+P}function N(T,P,R,L,V){return V===void 0&&(V=1.70158),R*((T=T/L-1)*T*((V+1)*T+V)+1)+P}function U(T,P,R,L,V){return V===void 0&&(V=1.70158),T/=L/2,T<1?R/2*(T*T*(((V*=1.525)+1)*T-V))+P:R/2*((T-=2)*T*(((V*=1.525)+1)*T+V)+2)+P}function G(T,P,R,L){return R-j(L-T,0,R,L)+P}function j(T,P,R,L){return(T/=L)<1/2.75?R*(7.5625*T*T)+P:T<2/2.75?R*(7.5625*(T-=1.5/2.75)*T+.75)+P:T<2.5/2.75?R*(7.5625*(T-=2.25/2.75)*T+.9375)+P:R*(7.5625*(T-=2.625/2.75)*T+.984375)+P}function q(T,P,R,L){return T<L/2?G(T*2,0,R,L)*.5+P:j(T*2-L,0,R,L)*.5+R*.5+P}e.util.ease={easeInQuad:function(T,P,R,L){return R*(T/=L)*T+P},easeOutQuad:function(T,P,R,L){return-R*(T/=L)*(T-2)+P},easeInOutQuad:function(T,P,R,L){return T/=L/2,T<1?R/2*T*T+P:-R/2*(--T*(T-2)-1)+P},easeInCubic:function(T,P,R,L){return R*(T/=L)*T*T+P},easeOutCubic:o,easeInOutCubic:f,easeInQuart:r,easeOutQuart:l,easeInOutQuart:c,easeInQuint:d,easeOutQuint:p,easeInOutQuint:h,easeInSine:v,easeOutSine:_,easeInOutSine:y,easeInExpo:x,easeOutExpo:b,easeInOutExpo:w,easeInCirc:M,easeOutCirc:S,easeInOutCirc:C,easeInElastic:O,easeOutElastic:k,easeInOutElastic:Y,easeInBack:H,easeOutBack:N,easeInOutBack:U,easeInBounce:G,easeOutBounce:j,easeInOutBounce:q}}(),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.util.object.clone,r=n.util.toFixed,l=n.util.parseUnit,c=n.util.multiplyTransformMatrices,d=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],p=["symbol","image","marker","pattern","view","svg"],h=["pattern","defs","symbol","metadata","clipPath","mask","desc"],v=["symbol","g","a","svg","clipPath","defs"],_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},y={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",b="clip-path";n.svgValidTagNamesRegEx=S(d),n.svgViewBoxElementsRegEx=S(p),n.svgInvalidAncestorsRegEx=S(h),n.svgValidParentsRegEx=S(v),n.cssRules={},n.gradientDefs={},n.clipPaths={};function w(I){return I in _?_[I]:I}function M(I,E,F,K){var ee=Array.isArray(E),Z;if((I==="fill"||I==="stroke")&&E==="none")E="";else{if(I==="strokeUniform")return E==="non-scaling-stroke";if(I==="strokeDashArray")E==="none"?E=null:E=E.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(I==="transformMatrix")F&&F.transformMatrix?E=c(F.transformMatrix,n.parseTransformAttribute(E)):E=n.parseTransformAttribute(E);else if(I==="visible")E=E!=="none"&&E!=="hidden",F&&F.visible===!1&&(E=!1);else if(I==="opacity")E=parseFloat(E),F&&typeof F.opacity!="undefined"&&(E*=F.opacity);else if(I==="textAnchor")E=E==="start"?"left":E==="end"?"right":"center";else if(I==="charSpacing")Z=l(E,K)/K*1e3;else if(I==="paintFirst"){var J=E.indexOf("fill"),ae=E.indexOf("stroke"),E="fill";(J>-1&&ae>-1&&ae<J||J===-1&&ae>-1)&&(E="stroke")}else{if(I==="href"||I==="xlink:href"||I==="font")return E;if(I==="imageSmoothing")return E==="optimizeQuality";Z=ee?E.map(l):l(E,K)}}return!ee&&isNaN(Z)?E:Z}function S(I){return new RegExp("^("+I.join("|")+")\\b","i")}function C(I){for(var E in y)if(!(typeof I[y[E]]=="undefined"||I[E]==="")){if(typeof I[E]=="undefined"){if(!n.Object.prototype[E])continue;I[E]=n.Object.prototype[E]}if(I[E].indexOf("url(")!==0){var F=new n.Color(I[E]);I[E]=F.setAlpha(r(F.getAlpha()*I[y[E]],2)).toRgba()}}return I}function O(I,E){var F,K=[],ee,Z,J;for(Z=0,J=E.length;Z<J;Z++)F=E[Z],ee=I.getElementsByTagName(F),K=K.concat(Array.prototype.slice.call(ee));return K}n.parseTransformAttribute=function(){function I(A,D){var te=n.util.cos(D[0]),he=n.util.sin(D[0]),me=0,ge=0;D.length===3&&(me=D[1],ge=D[2]),A[0]=te,A[1]=he,A[2]=-he,A[3]=te,A[4]=me-(te*me-he*ge),A[5]=ge-(he*me+te*ge)}function E(A,D){var te=D[0],he=D.length===2?D[1]:D[0];A[0]=te,A[3]=he}function F(A,D,te){A[te]=Math.tan(n.util.degreesToRadians(D[0]))}function K(A,D){A[4]=D[0],D.length===2&&(A[5]=D[1])}var ee=n.iMatrix,Z=n.reNum,J=n.commaWsp,ae="(?:(skewX)\\s*\\(\\s*("+Z+")\\s*\\))",ue="(?:(skewY)\\s*\\(\\s*("+Z+")\\s*\\))",Q="(?:(rotate)\\s*\\(\\s*("+Z+")(?:"+J+"("+Z+")"+J+"("+Z+"))?\\s*\\))",$="(?:(scale)\\s*\\(\\s*("+Z+")(?:"+J+"("+Z+"))?\\s*\\))",se="(?:(translate)\\s*\\(\\s*("+Z+")(?:"+J+"("+Z+"))?\\s*\\))",oe="(?:(matrix)\\s*\\(\\s*("+Z+")"+J+"("+Z+")"+J+"("+Z+")"+J+"("+Z+")"+J+"("+Z+")"+J+"("+Z+")\\s*\\))",ne="(?:"+oe+"|"+se+"|"+$+"|"+Q+"|"+ae+"|"+ue+")",le="(?:"+ne+"(?:"+J+"*"+ne+")*)",fe="^\\s*(?:"+le+"?)\\s*$",Ee=new RegExp(fe),Me=new RegExp(ne,"g");return function(A){var D=ee.concat(),te=[];if(!A||A&&!Ee.test(A))return D;A.replace(Me,function(me){var ge=new RegExp(ne).exec(me).filter(function(de){return!!de}),Ce=ge[1],B=ge.slice(2).map(parseFloat);switch(Ce){case"translate":K(D,B);break;case"rotate":B[0]=n.util.degreesToRadians(B[0]),I(D,B);break;case"scale":E(D,B);break;case"skewX":F(D,B,2);break;case"skewY":F(D,B,1);break;case"matrix":D=B;break}te.push(D.concat()),D=ee.concat()});for(var he=te[0];te.length>1;)te.shift(),he=n.util.multiplyTransformMatrices(he,te[0]);return he}}();function k(I,E){var F,K;I.replace(/;\s*$/,"").split(";").forEach(function(ee){var Z=ee.split(":");F=Z[0].trim().toLowerCase(),K=Z[1].trim(),E[F]=K})}function Y(I,E){var F,K;for(var ee in I)typeof I[ee]!="undefined"&&(F=ee.toLowerCase(),K=I[ee],E[F]=K)}function H(I,E){var F={};for(var K in n.cssRules[E])if(N(I,K.split(" ")))for(var ee in n.cssRules[E][K])F[ee]=n.cssRules[E][K][ee];return F}function N(I,E){var F,K=!0;return F=G(I,E.pop()),F&&E.length&&(K=U(I,E)),F&&K&&E.length===0}function U(I,E){for(var F,K=!0;I.parentNode&&I.parentNode.nodeType===1&&E.length;)K&&(F=E.pop()),I=I.parentNode,K=G(I,F);return E.length===0}function G(I,E){var F=I.nodeName,K=I.getAttribute("class"),ee=I.getAttribute("id"),Z,J;if(Z=new RegExp("^"+F,"i"),E=E.replace(Z,""),ee&&E.length&&(Z=new RegExp("#"+ee+"(?![a-zA-Z\\-]+)","i"),E=E.replace(Z,"")),K&&E.length)for(K=K.split(" "),J=K.length;J--;)Z=new RegExp("\\."+K[J]+"(?![a-zA-Z\\-]+)","i"),E=E.replace(Z,"");return E.length===0}function j(I,E){var F;if(I.getElementById&&(F=I.getElementById(E)),F)return F;var K,ee,Z,J=I.getElementsByTagName("*");for(ee=0,Z=J.length;ee<Z;ee++)if(K=J[ee],E===K.getAttribute("id"))return K}function q(I){for(var E=O(I,["use","svg:use"]),F=0;E.length&&F<E.length;){var K=E[F],ee=K.getAttribute("xlink:href")||K.getAttribute("href");if(ee===null)return;var Z=ee.slice(1),J=K.getAttribute("x")||0,ae=K.getAttribute("y")||0,ue=j(I,Z).cloneNode(!0),Q=(ue.getAttribute("transform")||"")+" translate("+J+", "+ae+")",$,se=E.length,oe,ne,le,fe,Ee=n.svgNS;if(P(ue),/^svg$/i.test(ue.nodeName)){var Me=ue.ownerDocument.createElementNS(Ee,"g");for(ne=0,le=ue.attributes,fe=le.length;ne<fe;ne++)oe=le.item(ne),Me.setAttributeNS(Ee,oe.nodeName,oe.nodeValue);for(;ue.firstChild;)Me.appendChild(ue.firstChild);ue=Me}for(ne=0,le=K.attributes,fe=le.length;ne<fe;ne++)oe=le.item(ne),!(oe.nodeName==="x"||oe.nodeName==="y"||oe.nodeName==="xlink:href"||oe.nodeName==="href")&&(oe.nodeName==="transform"?Q=oe.nodeValue+" "+Q:ue.setAttribute(oe.nodeName,oe.nodeValue));ue.setAttribute("transform",Q),ue.setAttribute("instantiated_by_use","1"),ue.removeAttribute("id"),$=K.parentNode,$.replaceChild(ue,K),E.length===se&&F++}}var T=new RegExp("^\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*,?\\s*("+n.reNum+"+)\\s*$");function P(I){if(!n.svgViewBoxElementsRegEx.test(I.nodeName))return{};var E=I.getAttribute("viewBox"),F=1,K=1,ee=0,Z=0,J,ae,ue,Q,$=I.getAttribute("width"),se=I.getAttribute("height"),oe=I.getAttribute("x")||0,ne=I.getAttribute("y")||0,le=I.getAttribute("preserveAspectRatio")||"",fe=!E||!(E=E.match(T)),Ee=!$||!se||$==="100%"||se==="100%",Me=fe&&Ee,A={},D="",te=0,he=0;if(A.width=0,A.height=0,A.toBeParsed=Me,fe&&(oe||ne)&&I.parentNode&&I.parentNode.nodeName!=="#document"&&(D=" translate("+l(oe)+" "+l(ne)+") ",ue=(I.getAttribute("transform")||"")+D,I.setAttribute("transform",ue),I.removeAttribute("x"),I.removeAttribute("y")),Me)return A;if(fe)return A.width=l($),A.height=l(se),A;if(ee=-parseFloat(E[1]),Z=-parseFloat(E[2]),J=parseFloat(E[3]),ae=parseFloat(E[4]),A.minX=ee,A.minY=Z,A.viewBoxWidth=J,A.viewBoxHeight=ae,Ee?(A.width=J,A.height=ae):(A.width=l($),A.height=l(se),F=A.width/J,K=A.height/ae),le=n.util.parsePreserveAspectRatioAttribute(le),le.alignX!=="none"&&(le.meetOrSlice==="meet"&&(K=F=F>K?K:F),le.meetOrSlice==="slice"&&(K=F=F>K?F:K),te=A.width-J*F,he=A.height-ae*F,le.alignX==="Mid"&&(te/=2),le.alignY==="Mid"&&(he/=2),le.alignX==="Min"&&(te=0),le.alignY==="Min"&&(he=0)),F===1&&K===1&&ee===0&&Z===0&&oe===0&&ne===0)return A;if((oe||ne)&&I.parentNode.nodeName!=="#document"&&(D=" translate("+l(oe)+" "+l(ne)+") "),ue=D+" matrix("+F+" 0 0 "+K+" "+(ee*F+te)+" "+(Z*K+he)+") ",I.nodeName==="svg"){for(Q=I.ownerDocument.createElementNS(n.svgNS,"g");I.firstChild;)Q.appendChild(I.firstChild);I.appendChild(Q)}else Q=I,Q.removeAttribute("x"),Q.removeAttribute("y"),ue=Q.getAttribute("transform")+ue;return Q.setAttribute("transform",ue),A}function R(I,E){for(;I&&(I=I.parentNode);)if(I.nodeName&&E.test(I.nodeName.replace("svg:",""))&&!I.getAttribute("instantiated_by_use"))return!0;return!1}n.parseSVGDocument=function(I,E,F,K){if(!!I){q(I);var ee=n.Object.__uid++,Z,J,ae=P(I),ue=n.util.toArray(I.getElementsByTagName("*"));if(ae.crossOrigin=K&&K.crossOrigin,ae.svgUid=ee,ue.length===0&&n.isLikelyNode){ue=I.selectNodes('//*[name(.)!="svg"]');var Q=[];for(Z=0,J=ue.length;Z<J;Z++)Q[Z]=ue[Z];ue=Q}var $=ue.filter(function(oe){return P(oe),n.svgValidTagNamesRegEx.test(oe.nodeName.replace("svg:",""))&&!R(oe,n.svgInvalidAncestorsRegEx)});if(!$||$&&!$.length){E&&E([],{});return}var se={};ue.filter(function(oe){return oe.nodeName.replace("svg:","")==="clipPath"}).forEach(function(oe){var ne=oe.getAttribute("id");se[ne]=n.util.toArray(oe.getElementsByTagName("*")).filter(function(le){return n.svgValidTagNamesRegEx.test(le.nodeName.replace("svg:",""))})}),n.gradientDefs[ee]=n.getGradientDefs(I),n.cssRules[ee]=n.getCSSRules(I),n.clipPaths[ee]=se,n.parseElements($,function(oe,ne){E&&(E(oe,ae,ne,ue),delete n.gradientDefs[ee],delete n.cssRules[ee],delete n.clipPaths[ee])},f(ae),F,K)}};function L(I,E){var F=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],K="xlink:href",ee=E.getAttribute(K).slice(1),Z=j(I,ee);if(Z&&Z.getAttribute(K)&&L(I,Z),F.forEach(function(ae){Z&&!E.hasAttribute(ae)&&Z.hasAttribute(ae)&&E.setAttribute(ae,Z.getAttribute(ae))}),!E.children.length)for(var J=Z.cloneNode(!0);J.firstChild;)E.appendChild(J.firstChild);E.removeAttribute(K)}var V=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+n.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+n.reNum+"))?\\s+(.*)");o(n,{parseFontDeclaration:function(I,E){var F=I.match(V);if(!!F){var K=F[1],ee=F[3],Z=F[4],J=F[5],ae=F[6];K&&(E.fontStyle=K),ee&&(E.fontWeight=isNaN(parseFloat(ee))?ee:parseFloat(ee)),Z&&(E.fontSize=l(Z)),ae&&(E.fontFamily=ae),J&&(E.lineHeight=J==="normal"?1:J)}},getGradientDefs:function(I){var E=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],F=O(I,E),K,ee=0,Z={};for(ee=F.length;ee--;)K=F[ee],K.getAttribute("xlink:href")&&L(I,K),Z[K.getAttribute("id")]=K;return Z},parseAttributes:function(I,E,F){if(!!I){var K,ee={},Z,J;typeof F=="undefined"&&(F=I.getAttribute("svgUid")),I.parentNode&&n.svgValidParentsRegEx.test(I.parentNode.nodeName)&&(ee=n.parseAttributes(I.parentNode,E,F));var ae=E.reduce(function(le,fe){return K=I.getAttribute(fe),K&&(le[fe]=K),le},{}),ue=o(H(I,F),n.parseStyleAttribute(I));ae=o(ae,ue),ue[b]&&I.setAttribute(b,ue[b]),Z=J=ee.fontSize||n.Text.DEFAULT_SVG_FONT_SIZE,ae[x]&&(ae[x]=Z=l(ae[x],J));var Q,$,se={};for(var oe in ae)Q=w(oe),$=M(Q,ae[oe],ee,Z),se[Q]=$;se&&se.font&&n.parseFontDeclaration(se.font,se);var ne=o(ee,se);return n.svgValidParentsRegEx.test(I.nodeName)?ne:C(ne)}},parseElements:function(I,E,F,K,ee){new n.ElementsParser(I,E,F,K,ee).parse()},parseStyleAttribute:function(I){var E={},F=I.getAttribute("style");return F&&(typeof F=="string"?k(F,E):Y(F,E)),E},parsePointsAttribute:function(I){if(!I)return null;I=I.replace(/,/g," ").trim(),I=I.split(/\s+/);var E=[],F,K;for(F=0,K=I.length;F<K;F+=2)E.push({x:parseFloat(I[F]),y:parseFloat(I[F+1])});return E},getCSSRules:function(I){var E=I.getElementsByTagName("style"),F,K,ee={},Z;for(F=0,K=E.length;F<K;F++){var J=E[F].textContent;J=J.replace(/\/\*[\s\S]*?\*\//g,""),J.trim()!==""&&(Z=J.split("}"),Z=Z.filter(function(ae){return ae.trim()}),Z.forEach(function(ae){var ue=ae.split("{"),Q={},$=ue[1].trim(),se=$.split(";").filter(function(fe){return fe.trim()});for(F=0,K=se.length;F<K;F++){var oe=se[F].split(":"),ne=oe[0].trim(),le=oe[1].trim();Q[ne]=le}ae=ue[0].trim(),ae.split(",").forEach(function(fe){fe=fe.replace(/^svg/i,"").trim(),fe!==""&&(ee[fe]?n.util.object.extend(ee[fe],Q):ee[fe]=n.util.object.clone(Q))})}))}return ee},loadSVGFromURL:function(I,E,F,K){I=I.replace(/^\n\s*/,"").trim(),new n.util.request(I,{method:"get",onComplete:ee});function ee(Z){var J=Z.responseXML;if(!J||!J.documentElement)return E&&E(null),!1;n.parseSVGDocument(J.documentElement,function(ae,ue,Q,$){E&&E(ae,ue,Q,$)},F,K)}},loadSVGFromString:function(I,E,F,K){var ee=new n.window.DOMParser,Z=ee.parseFromString(I.trim(),"text/xml");n.parseSVGDocument(Z.documentElement,function(J,ae,ue,Q){E(J,ae,ue,Q)},F,K)}})}(m),e.ElementsParser=function(s,n,o,f,r,l){this.elements=s,this.callback=n,this.options=o,this.reviver=f,this.svgUid=o&&o.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=l},function(s){s.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},s.createObjects=function(){var n=this;this.elements.forEach(function(o,f){o.setAttribute("svgUid",n.svgUid),n.createObject(o,f)})},s.findTag=function(n){return e[e.util.string.capitalize(n.tagName.replace("svg:",""))]},s.createObject=function(n,o){var f=this.findTag(n);if(f&&f.fromElement)try{f.fromElement(n,this.createCallback(o,n),this.options)}catch(r){e.log(r)}else this.checkIfDone()},s.createCallback=function(n,o){var f=this;return function(r){var l;f.resolveGradient(r,o,"fill"),f.resolveGradient(r,o,"stroke"),r instanceof e.Image&&r._originalElement&&(l=r.parsePreserveAspectRatioAttribute(o)),r._removeTransformMatrix(l),f.resolveClipPath(r,o),f.reviver&&f.reviver(o,r),f.instances[n]=r,f.checkIfDone()}},s.extractPropertyDefinition=function(n,o,f){var r=n[o],l=this.regexUrl;if(!!l.test(r)){l.lastIndex=0;var c=l.exec(r)[1];return l.lastIndex=0,e[f][this.svgUid][c]}},s.resolveGradient=function(n,o,f){var r=this.extractPropertyDefinition(n,f,"gradientDefs");if(r){var l=o.getAttribute(f+"-opacity"),c=e.Gradient.fromElement(r,n,l,this.options);n.set(f,c)}},s.createClipPathCallback=function(n,o){return function(f){f._removeTransformMatrix(),f.fillRule=f.clipRule,o.push(f)}},s.resolveClipPath=function(n,o){var f=this.extractPropertyDefinition(n,"clipPath","clipPaths"),r,l,c,d,p,h;if(f){d=[],c=e.util.invertTransform(n.calcTransformMatrix());for(var v=f[0].parentNode,_=o;_.parentNode&&_.getAttribute("clip-path")!==n.clipPath;)_=_.parentNode;_.parentNode.appendChild(v);for(var y=0;y<f.length;y++)r=f[y],l=this.findTag(r),l.fromElement(r,this.createClipPathCallback(n,d),this.options);d.length===1?f=d[0]:f=new e.Group(d),p=e.util.multiplyTransformMatrices(c,f.calcTransformMatrix()),f.clipPath&&this.resolveClipPath(f,_);var h=e.util.qrDecompose(p);f.flipX=!1,f.flipY=!1,f.set("scaleX",h.scaleX),f.set("scaleY",h.scaleY),f.angle=h.angle,f.skewX=h.skewX,f.skewY=0,f.setPositionByOrigin({x:h.translateX,y:h.translateY},"center","center"),n.clipPath=f}else delete n.clipPath},s.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(s){var n=s.fabric||(s.fabric={});if(n.Point){n.warn("fabric.Point is already defined");return}n.Point=o;function o(f,r){this.x=f,this.y=r}o.prototype={type:"point",constructor:o,add:function(f){return new o(this.x+f.x,this.y+f.y)},addEquals:function(f){return this.x+=f.x,this.y+=f.y,this},scalarAdd:function(f){return new o(this.x+f,this.y+f)},scalarAddEquals:function(f){return this.x+=f,this.y+=f,this},subtract:function(f){return new o(this.x-f.x,this.y-f.y)},subtractEquals:function(f){return this.x-=f.x,this.y-=f.y,this},scalarSubtract:function(f){return new o(this.x-f,this.y-f)},scalarSubtractEquals:function(f){return this.x-=f,this.y-=f,this},multiply:function(f){return new o(this.x*f,this.y*f)},multiplyEquals:function(f){return this.x*=f,this.y*=f,this},divide:function(f){return new o(this.x/f,this.y/f)},divideEquals:function(f){return this.x/=f,this.y/=f,this},eq:function(f){return this.x===f.x&&this.y===f.y},lt:function(f){return this.x<f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,r){return typeof r=="undefined"&&(r=.5),r=Math.max(Math.min(1,r),0),new o(this.x+(f.x-this.x)*r,this.y+(f.y-this.y)*r)},distanceFrom:function(f){var r=this.x-f.x,l=this.y-f.y;return Math.sqrt(r*r+l*l)},midPointFrom:function(f){return this.lerp(f)},min:function(f){return new o(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new o(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(f,r){return this.x=f,this.y=r,this},setX:function(f){return this.x=f,this},setY:function(f){return this.y=f,this},setFromPoint:function(f){return this.x=f.x,this.y=f.y,this},swap:function(f){var r=this.x,l=this.y;this.x=f.x,this.y=f.y,f.x=r,f.y=l},clone:function(){return new o(this.x,this.y)}}}(m),function(s){var n=s.fabric||(s.fabric={});if(n.Intersection){n.warn("fabric.Intersection is already defined");return}function o(f){this.status=f,this.points=[]}n.Intersection=o,n.Intersection.prototype={constructor:o,appendPoint:function(f){return this.points.push(f),this},appendPoints:function(f){return this.points=this.points.concat(f),this}},n.Intersection.intersectLineLine=function(f,r,l,c){var d,p=(c.x-l.x)*(f.y-l.y)-(c.y-l.y)*(f.x-l.x),h=(r.x-f.x)*(f.y-l.y)-(r.y-f.y)*(f.x-l.x),v=(c.y-l.y)*(r.x-f.x)-(c.x-l.x)*(r.y-f.y);if(v!==0){var _=p/v,y=h/v;0<=_&&_<=1&&0<=y&&y<=1?(d=new o("Intersection"),d.appendPoint(new n.Point(f.x+_*(r.x-f.x),f.y+_*(r.y-f.y)))):d=new o}else p===0||h===0?d=new o("Coincident"):d=new o("Parallel");return d},n.Intersection.intersectLinePolygon=function(f,r,l){var c=new o,d=l.length,p,h,v,_;for(_=0;_<d;_++)p=l[_],h=l[(_+1)%d],v=o.intersectLineLine(f,r,p,h),c.appendPoints(v.points);return c.points.length>0&&(c.status="Intersection"),c},n.Intersection.intersectPolygonPolygon=function(f,r){var l=new o,c=f.length,d;for(d=0;d<c;d++){var p=f[d],h=f[(d+1)%c],v=o.intersectLinePolygon(p,h,r);l.appendPoints(v.points)}return l.points.length>0&&(l.status="Intersection"),l},n.Intersection.intersectPolygonRectangle=function(f,r,l){var c=r.min(l),d=r.max(l),p=new n.Point(d.x,c.y),h=new n.Point(c.x,d.y),v=o.intersectLinePolygon(c,p,f),_=o.intersectLinePolygon(p,d,f),y=o.intersectLinePolygon(d,h,f),x=o.intersectLinePolygon(h,c,f),b=new o;return b.appendPoints(v.points),b.appendPoints(_.points),b.appendPoints(y.points),b.appendPoints(x.points),b.points.length>0&&(b.status="Intersection"),b}}(m),function(s){var n=s.fabric||(s.fabric={});if(n.Color){n.warn("fabric.Color is already defined.");return}function o(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}n.Color=o,n.Color.prototype={_tryParsingColor:function(r){var l;r in o.colorNameMap&&(r=o.colorNameMap[r]),r==="transparent"&&(l=[255,255,255,0]),l||(l=o.sourceFromHex(r)),l||(l=o.sourceFromRgb(r)),l||(l=o.sourceFromHsl(r)),l||(l=[0,0,0,1]),l&&this.setSource(l)},_rgbToHsl:function(r,l,c){r/=255,l/=255,c/=255;var d,p,h,v=n.util.array.max([r,l,c]),_=n.util.array.min([r,l,c]);if(h=(v+_)/2,v===_)d=p=0;else{var y=v-_;switch(p=h>.5?y/(2-v-_):y/(v+_),v){case r:d=(l-c)/y+(l<c?6:0);break;case l:d=(c-r)/y+2;break;case c:d=(r-l)/y+4;break}d/=6}return[Math.round(d*360),Math.round(p*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),l=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+l[0]+","+l[1]+"%,"+l[2]+"%)"},toHsla:function(){var r=this.getSource(),l=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+l[0]+","+l[1]+"%,"+l[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),l,c,d;return l=r[0].toString(16),l=l.length===1?"0"+l:l,c=r[1].toString(16),c=c.length===1?"0"+c:c,d=r[2].toString(16),d=d.length===1?"0"+d:d,l.toUpperCase()+c.toUpperCase()+d.toUpperCase()},toHexa:function(){var r=this.getSource(),l;return l=Math.round(r[3]*255),l=l.toString(16),l=l.length===1?"0"+l:l,this.toHex()+l.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var l=this.getSource();return l[3]=r,this.setSource(l),this},toGrayscale:function(){var r=this.getSource(),l=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),c=r[3];return this.setSource([l,l,l,c]),this},toBlackWhite:function(r){var l=this.getSource(),c=(l[0]*.3+l[1]*.59+l[2]*.11).toFixed(0),d=l[3];return r=r||127,c=Number(c)<Number(r)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(r){r instanceof o||(r=new o(r));var l=[],c=this.getAlpha(),d=.5,p=this.getSource(),h=r.getSource(),v;for(v=0;v<3;v++)l.push(Math.round(p[v]*(1-d)+h[v]*d));return l[3]=c,this.setSource(l),this}},n.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,n.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,n.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,n.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function f(r,l,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?r+(l-r)*6*c:c<1/2?l:c<2/3?r+(l-r)*(2/3-c)*6:r}n.Color.fromRgb=function(r){return o.fromSource(o.sourceFromRgb(r))},n.Color.sourceFromRgb=function(r){var l=r.match(o.reRGBa);if(l){var c=parseInt(l[1],10)/(/%$/.test(l[1])?100:1)*(/%$/.test(l[1])?255:1),d=parseInt(l[2],10)/(/%$/.test(l[2])?100:1)*(/%$/.test(l[2])?255:1),p=parseInt(l[3],10)/(/%$/.test(l[3])?100:1)*(/%$/.test(l[3])?255:1);return[parseInt(c,10),parseInt(d,10),parseInt(p,10),l[4]?parseFloat(l[4]):1]}},n.Color.fromRgba=o.fromRgb,n.Color.fromHsl=function(r){return o.fromSource(o.sourceFromHsl(r))},n.Color.sourceFromHsl=function(r){var l=r.match(o.reHSLa);if(!!l){var c=(parseFloat(l[1])%360+360)%360/360,d=parseFloat(l[2])/(/%$/.test(l[2])?100:1),p=parseFloat(l[3])/(/%$/.test(l[3])?100:1),h,v,_;if(d===0)h=v=_=p;else{var y=p<=.5?p*(d+1):p+d-p*d,x=p*2-y;h=f(x,y,c+1/3),v=f(x,y,c),_=f(x,y,c-1/3)}return[Math.round(h*255),Math.round(v*255),Math.round(_*255),l[4]?parseFloat(l[4]):1]}},n.Color.fromHsla=o.fromHsl,n.Color.fromHex=function(r){return o.fromSource(o.sourceFromHex(r))},n.Color.sourceFromHex=function(r){if(r.match(o.reHex)){var l=r.slice(r.indexOf("#")+1),c=l.length===3||l.length===4,d=l.length===8||l.length===4,p=c?l.charAt(0)+l.charAt(0):l.substring(0,2),h=c?l.charAt(1)+l.charAt(1):l.substring(2,4),v=c?l.charAt(2)+l.charAt(2):l.substring(4,6),_=d?c?l.charAt(3)+l.charAt(3):l.substring(6,8):"FF";return[parseInt(p,16),parseInt(h,16),parseInt(v,16),parseFloat((parseInt(_,16)/255).toFixed(2))]}},n.Color.fromSource=function(r){var l=new o;return l.setSource(r),l}}(m),function(s){var n=s.fabric||(s.fabric={}),o=["e","se","s","sw","w","nw","n","ne","e"],f=["ns","nesw","ew","nwse"],r={},l="left",c="top",d="right",p="bottom",h="center",v={top:p,bottom:c,left:d,right:l,center:h},_=n.util.radiansToDegrees,y=Math.sign||function(Q){return(Q>0)-(Q<0)||+Q};function x(Q,$){var se=Q.angle+_(Math.atan2($.y,$.x))+360;return Math.round(se%360/45)}function b(Q,$){var se=$.transform.target,oe=se.canvas,ne=n.util.object.clone($);ne.target=se,oe&&oe.fire("object:"+Q,ne),se.fire(Q,$)}function w(Q,$){var se=$.canvas,oe=se.uniScaleKey,ne=Q[oe];return se.uniformScaling&&!ne||!se.uniformScaling&&ne}function M(Q){return Q.originX===h&&Q.originY===h}function S(Q,$,se){var oe=Q.lockScalingX,ne=Q.lockScalingY;return!!(oe&&ne||!$&&(oe||ne)&&se||oe&&$==="x"||ne&&$==="y")}function C(Q,$,se){var oe="not-allowed",ne=w(Q,se),le="";if($.x!==0&&$.y===0?le="x":$.x===0&&$.y!==0&&(le="y"),S(se,le,ne))return oe;var fe=x(se,$);return o[fe]+"-resize"}function O(Q,$,se){var oe="not-allowed";if($.x!==0&&se.lockSkewingY||$.y!==0&&se.lockSkewingX)return oe;var ne=x(se,$)%4;return f[ne]+"-resize"}function k(Q,$,se){return Q[se.canvas.altActionKey]?r.skewCursorStyleHandler(Q,$,se):r.scaleCursorStyleHandler(Q,$,se)}function Y(Q,$,se){var oe=Q[se.canvas.altActionKey];if($.x===0)return oe?"skewX":"scaleY";if($.y===0)return oe?"skewY":"scaleX"}function H(Q,$,se){return se.lockRotation?"not-allowed":$.cursorStyle}function N(Q,$,se,oe){return{e:Q,transform:$,pointer:{x:se,y:oe}}}function U(Q){return function($,se,oe,ne){var le=se.target,fe=le.getCenterPoint(),Ee=le.translateToOriginPoint(fe,se.originX,se.originY),Me=Q($,se,oe,ne);return le.setPositionByOrigin(Ee,se.originX,se.originY),Me}}function G(Q,$){return function(se,oe,ne,le){var fe=$(se,oe,ne,le);return fe&&b(Q,N(se,oe,ne,le)),fe}}function j(Q,$,se,oe,ne){var le=Q.target,fe=le.controls[Q.corner],Ee=le.canvas.getZoom(),Me=le.padding/Ee,A=le.toLocalPoint(new n.Point(oe,ne),$,se);return A.x>=Me&&(A.x-=Me),A.x<=-Me&&(A.x+=Me),A.y>=Me&&(A.y-=Me),A.y<=Me&&(A.y+=Me),A.x-=fe.offsetX,A.y-=fe.offsetY,A}function q(Q){return Q.flipX!==Q.flipY}function T(Q,$,se,oe,ne){if(Q[$]!==0){var le=Q._getTransformedDimensions()[oe],fe=ne/le*Q[se];Q.set(se,fe)}}function P(Q,$,se,oe){var ne=$.target,le=ne._getTransformedDimensions(0,ne.skewY),fe=j($,$.originX,$.originY,se,oe),Ee=Math.abs(fe.x*2)-le.x,Me=ne.skewX,A;Ee<2?A=0:(A=_(Math.atan2(Ee/ne.scaleX,le.y/ne.scaleY)),$.originX===l&&$.originY===p&&(A=-A),$.originX===d&&$.originY===c&&(A=-A),q(ne)&&(A=-A));var D=Me!==A;if(D){var te=ne._getTransformedDimensions().y;ne.set("skewX",A),T(ne,"skewY","scaleY","y",te)}return D}function R(Q,$,se,oe){var ne=$.target,le=ne._getTransformedDimensions(ne.skewX,0),fe=j($,$.originX,$.originY,se,oe),Ee=Math.abs(fe.y*2)-le.y,Me=ne.skewY,A;Ee<2?A=0:(A=_(Math.atan2(Ee/ne.scaleY,le.x/ne.scaleX)),$.originX===l&&$.originY===p&&(A=-A),$.originX===d&&$.originY===c&&(A=-A),q(ne)&&(A=-A));var D=Me!==A;if(D){var te=ne._getTransformedDimensions().x;ne.set("skewY",A),T(ne,"skewX","scaleX","x",te)}return D}function L(Q,$,se,oe){var ne=$.target,le=ne.skewX,fe,Ee=$.originY;if(ne.lockSkewingX)return!1;if(le===0){var Me=j($,h,h,se,oe);Me.x>0?fe=l:fe=d}else le>0&&(fe=Ee===c?l:d),le<0&&(fe=Ee===c?d:l),q(ne)&&(fe=fe===l?d:l);$.originX=fe;var A=G("skewing",U(P));return A(Q,$,se,oe)}function V(Q,$,se,oe){var ne=$.target,le=ne.skewY,fe,Ee=$.originX;if(ne.lockSkewingY)return!1;if(le===0){var Me=j($,h,h,se,oe);Me.y>0?fe=c:fe=p}else le>0&&(fe=Ee===l?c:p),le<0&&(fe=Ee===l?p:c),q(ne)&&(fe=fe===c?p:c);$.originY=fe;var A=G("skewing",U(R));return A(Q,$,se,oe)}function I(Q,$,se,oe){var ne=$,le=ne.target,fe=le.translateToOriginPoint(le.getCenterPoint(),ne.originX,ne.originY);if(le.lockRotation)return!1;var Ee=Math.atan2(ne.ey-fe.y,ne.ex-fe.x),Me=Math.atan2(oe-fe.y,se-fe.x),A=_(Me-Ee+ne.theta),D=!0;if(le.snapAngle>0){var te=le.snapAngle,he=le.snapThreshold||te,me=Math.ceil(A/te)*te,ge=Math.floor(A/te)*te;Math.abs(A-ge)<he?A=ge:Math.abs(A-me)<he&&(A=me)}return A<0&&(A=360+A),A%=360,D=le.angle!==A,le.angle=A,D}function E(Q,$,se,oe,ne){ne=ne||{};var le=$.target,fe=le.lockScalingX,Ee=le.lockScalingY,Me=ne.by,A,D,te,he,me=w(Q,le),ge=S(le,Me,me),Ce,B,de=$.gestureScale;if(ge)return!1;if(de)D=$.scaleX*de,te=$.scaleY*de;else{if(A=j($,$.originX,$.originY,se,oe),Ce=Me!=="y"?y(A.x):1,B=Me!=="x"?y(A.y):1,$.signX||($.signX=Ce),$.signY||($.signY=B),le.lockScalingFlip&&($.signX!==Ce||$.signY!==B))return!1;if(he=le._getTransformedDimensions(),me&&!Me){var _e=Math.abs(A.x)+Math.abs(A.y),ve=$.original,W=Math.abs(he.x*ve.scaleX/le.scaleX)+Math.abs(he.y*ve.scaleY/le.scaleY),ye=_e/W;D=ve.scaleX*ye,te=ve.scaleY*ye}else D=Math.abs(A.x*le.scaleX/he.x),te=Math.abs(A.y*le.scaleY/he.y);M($)&&(D*=2,te*=2),$.signX!==Ce&&Me!=="y"&&($.originX=v[$.originX],D*=-1,$.signX=Ce),$.signY!==B&&Me!=="x"&&($.originY=v[$.originY],te*=-1,$.signY=B)}var xe=le.scaleX,Pe=le.scaleY;return Me?(Me==="x"&&le.set("scaleX",D),Me==="y"&&le.set("scaleY",te)):(!fe&&le.set("scaleX",D),!Ee&&le.set("scaleY",te)),xe!==le.scaleX||Pe!==le.scaleY}function F(Q,$,se,oe){return E(Q,$,se,oe)}function K(Q,$,se,oe){return E(Q,$,se,oe,{by:"x"})}function ee(Q,$,se,oe){return E(Q,$,se,oe,{by:"y"})}function Z(Q,$,se,oe){return Q[$.target.canvas.altActionKey]?r.skewHandlerX(Q,$,se,oe):r.scalingY(Q,$,se,oe)}function J(Q,$,se,oe){return Q[$.target.canvas.altActionKey]?r.skewHandlerY(Q,$,se,oe):r.scalingX(Q,$,se,oe)}function ae(Q,$,se,oe){var ne=$.target,le=j($,$.originX,$.originY,se,oe),fe=ne.strokeWidth/(ne.strokeUniform?ne.scaleX:1),Ee=M($)?2:1,Me=ne.width,A=Math.abs(le.x*Ee/ne.scaleX)-fe;return ne.set("width",Math.max(A,0)),Me!==A}function ue(Q,$,se,oe){var ne=$.target,le=se-$.offsetX,fe=oe-$.offsetY,Ee=!ne.get("lockMovementX")&&ne.left!==le,Me=!ne.get("lockMovementY")&&ne.top!==fe;return Ee&&ne.set("left",le),Me&&ne.set("top",fe),(Ee||Me)&&b("moving",N(Q,$,se,oe)),Ee||Me}r.scaleCursorStyleHandler=C,r.skewCursorStyleHandler=O,r.scaleSkewCursorStyleHandler=k,r.rotationWithSnapping=G("rotating",U(I)),r.scalingEqually=G("scaling",U(F)),r.scalingX=G("scaling",U(K)),r.scalingY=G("scaling",U(ee)),r.scalingYOrSkewingX=Z,r.scalingXOrSkewingY=J,r.changeWidth=G("resizing",U(ae)),r.skewHandlerX=L,r.skewHandlerY=V,r.dragHandler=ue,r.scaleOrSkewActionName=Y,r.rotationStyleHandler=H,r.fireEvent=b,r.wrapWithFixedAnchor=U,r.wrapWithFireEvent=G,r.getLocalPoint=j,n.controlsUtils=r}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.degreesToRadians,f=n.controlsUtils;function r(c,d,p,h,v){h=h||{};var _=this.sizeX||h.cornerSize||v.cornerSize,y=this.sizeY||h.cornerSize||v.cornerSize,x=typeof h.transparentCorners!="undefined"?h.transparentCorners:v.transparentCorners,b=x?"stroke":"fill",w=!x&&(h.cornerStrokeColor||v.cornerStrokeColor),M=d,S=p,C;c.save(),c.fillStyle=h.cornerColor||v.cornerColor,c.strokeStyle=h.cornerStrokeColor||v.cornerStrokeColor,_>y?(C=_,c.scale(1,y/_),S=p*_/y):y>_?(C=y,c.scale(_/y,1),M=d*y/_):C=_,c.lineWidth=1,c.beginPath(),c.arc(M,S,C/2,0,2*Math.PI,!1),c[b](),w&&c.stroke(),c.restore()}function l(c,d,p,h,v){h=h||{};var _=this.sizeX||h.cornerSize||v.cornerSize,y=this.sizeY||h.cornerSize||v.cornerSize,x=typeof h.transparentCorners!="undefined"?h.transparentCorners:v.transparentCorners,b=x?"stroke":"fill",w=!x&&(h.cornerStrokeColor||v.cornerStrokeColor),M=_/2,S=y/2;c.save(),c.fillStyle=h.cornerColor||v.cornerColor,c.strokeStyle=h.cornerStrokeColor||v.cornerStrokeColor,c.lineWidth=1,c.translate(d,p),c.rotate(o(v.angle)),c[b+"Rect"](-M,-S,_,y),w&&c.strokeRect(-M,-S,_,y),c.restore()}f.renderCircleControl=r,f.renderSquareControl=l}(m),function(s){var n=s.fabric||(s.fabric={});function o(f){for(var r in f)this[r]=f[r]}n.Control=o,n.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(f,r){return r.cursorStyle},getActionName:function(f,r){return r.actionName},getVisibility:function(f,r){var l=f._controlsVisibility;return l&&typeof l[r]!="undefined"?l[r]:this.visible},setVisibility:function(f){this.visible=f},positionHandler:function(f,r){var l=n.util.transformPoint({x:this.x*f.x+this.offsetX,y:this.y*f.y+this.offsetY},r);return l},calcCornerCoords:function(f,r,l,c,d){var p,h,v,_,y=d?this.touchSizeX:this.sizeX,x=d?this.touchSizeY:this.sizeY;if(y&&x&&y!==x){var b=Math.atan2(x,y),w=Math.sqrt(y*y+x*x)/2,M=b-n.util.degreesToRadians(f),S=Math.PI/2-b-n.util.degreesToRadians(f);p=w*n.util.cos(M),h=w*n.util.sin(M),v=w*n.util.cos(S),_=w*n.util.sin(S)}else{var C=y&&x?y:r;w=C*.7071067812;var M=n.util.degreesToRadians(45-f);p=v=w*n.util.cos(M),h=_=w*n.util.sin(M)}return{tl:{x:l-_,y:c-v},tr:{x:l+p,y:c-h},bl:{x:l-p,y:c+h},br:{x:l+_,y:c+v}}},render:function(f,r,l,c,d){switch(c=c||{},c.cornerStyle||d.cornerStyle){case"circle":n.controlsUtils.renderCircleControl.call(this,f,r,l,c,d);break;default:n.controlsUtils.renderSquareControl.call(this,f,r,l,c,d)}}}}(m),function(){function s(l,c){var d=l.getAttribute("style"),p=l.getAttribute("offset")||0,h,v,_,y;if(p=parseFloat(p)/(/%$/.test(p)?100:1),p=p<0?0:p>1?1:p,d){var x=d.split(/\s*;\s*/);for(x[x.length-1]===""&&x.pop(),y=x.length;y--;){var b=x[y].split(/\s*:\s*/),w=b[0].trim(),M=b[1].trim();w==="stop-color"?h=M:w==="stop-opacity"&&(_=M)}}return h||(h=l.getAttribute("stop-color")||"rgb(0,0,0)"),_||(_=l.getAttribute("stop-opacity")),h=new e.Color(h),v=h.getAlpha(),_=isNaN(parseFloat(_))?1:parseFloat(_),_*=v*c,{offset:p,color:h.toRgb(),opacity:_}}function n(l){return{x1:l.getAttribute("x1")||0,y1:l.getAttribute("y1")||0,x2:l.getAttribute("x2")||"100%",y2:l.getAttribute("y2")||0}}function o(l){return{x1:l.getAttribute("fx")||l.getAttribute("cx")||"50%",y1:l.getAttribute("fy")||l.getAttribute("cy")||"50%",r1:0,x2:l.getAttribute("cx")||"50%",y2:l.getAttribute("cy")||"50%",r2:l.getAttribute("r")||"50%"}}var f=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var c,d=this;Object.keys(l).forEach(function(p){d[p]=l[p]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,c={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(c.r1=l.coords.r1||0,c.r2=l.coords.r2||0),this.coords=c,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var c in l){var d=new e.Color(l[c]);this.colorStops.push({offset:parseFloat(c),color:d.toRgb(),opacity:d.getAlpha()})}return this},toObject:function(l){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,c,l),c},toSVG:function(l,v){var d=f(this.coords,!0),p,h,v=v||{},_,y,x=f(this.colorStops,!0),b=d.r1>d.r2,w=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),M=-this.offsetX,S=-this.offsetY,C=!!v.additionalTransform,O=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(U,G){return U.offset-G.offset}),O==="objectBoundingBox"?(M/=l.width,S/=l.height):(M+=l.width/2,S+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(M-=l.pathOffset.x,S-=l.pathOffset.y),w[4]-=M,w[5]-=S,y='id="SVGID_'+this.id+'" gradientUnits="'+O+'"',y+=' gradientTransform="'+(C?v.additionalTransform+" ":"")+e.util.matrixToSVG(w)+'" ',this.type==="linear"?_=["<linearGradient ",y,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`">
`]:this.type==="radial"&&(_=["<radialGradient ",y,' cx="',b?d.x1:d.x2,'" cy="',b?d.y1:d.y2,'" r="',b?d.r1:d.r2,'" fx="',b?d.x2:d.x1,'" fy="',b?d.y2:d.y1,`">
`]),this.type==="radial"){if(b)for(x=x.concat(),x.reverse(),p=0,h=x.length;p<h;p++)x[p].offset=1-x[p].offset;var k=Math.min(d.r1,d.r2);if(k>0){var Y=Math.max(d.r1,d.r2),H=k/Y;for(p=0,h=x.length;p<h;p++)x[p].offset+=H*(1-x[p].offset)}}for(p=0,h=x.length;p<h;p++){var N=x[p];_.push("<stop ",'offset="',N.offset*100+"%",'" style="stop-color:',N.color,typeof N.opacity!="undefined"?";stop-opacity: "+N.opacity:";",`"/>
`)}return _.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),_.join("")},toLive:function(l){var c,d=e.util.object.clone(this.coords),p,h;if(!!this.type){for(this.type==="linear"?c=l.createLinearGradient(d.x1,d.y1,d.x2,d.y2):this.type==="radial"&&(c=l.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2)),p=0,h=this.colorStops.length;p<h;p++){var v=this.colorStops[p].color,_=this.colorStops[p].opacity,y=this.colorStops[p].offset;typeof _!="undefined"&&(v=new e.Color(v).setAlpha(_).toRgba()),c.addColorStop(y,v)}return c}}}),e.util.object.extend(e.Gradient,{fromElement:function(l,c,d,p){var h=parseFloat(d)/(/%$/.test(d)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var v=l.getElementsByTagName("stop"),_,y=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=l.getAttribute("gradientTransform")||"",b=[],w,M,S=0,C=0,O;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(_="linear",w=n(l)):(_="radial",w=o(l)),M=v.length;M--;)b.push(s(v[M],h));O=e.parseTransformAttribute(x),r(c,w,p,y),y==="pixels"&&(S=-c.left,C=-c.top);var k=new e.Gradient({id:l.getAttribute("id"),type:_,coords:w,colorStops:b,gradientUnits:y,gradientTransform:O,offsetX:S,offsetY:C});return k}});function r(l,c,d,p){var h,v;Object.keys(c).forEach(function(_){h=c[_],h==="Infinity"?v=1:h==="-Infinity"?v=0:(v=parseFloat(c[_],10),typeof h=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(h)&&(v*=.01,p==="pixels"&&((_==="x1"||_==="x2"||_==="r2")&&(v*=d.viewBoxWidth||d.width),(_==="y1"||_==="y2")&&(v*=d.viewBoxHeight||d.height)))),c[_]=v})}}(),function(){var s=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(n,o){if(n||(n={}),this.id=e.Object.__uid++,this.setOptions(n),!n.source||n.source&&typeof n.source!="string"){o&&o(this);return}else{var f=this;this.source=e.util.createImage(),e.util.loadImage(n.source,function(r,l){f.source=r,o&&o(f,l)},null,this.crossOrigin)}},toObject:function(n){var o=e.Object.NUM_FRACTION_DIGITS,f,r;return typeof this.source.src=="string"?f=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(f=this.source.toDataURL()),r={type:"pattern",source:f,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:s(this.offsetX,o),offsetY:s(this.offsetY,o),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,r,n),r},toSVG:function(n){var o=typeof this.source=="function"?this.source():this.source,f=o.width/n.width,r=o.height/n.height,l=this.offsetX/n.width,c=this.offsetY/n.height,d="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,c&&(r+=Math.abs(c))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(f=1,l&&(f+=Math.abs(l))),o.src?d=o.src:o.toDataURL&&(d=o.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+l+'" y="'+c+'" width="'+f+'" height="'+r+`">
<image x="0" y="0" width="`+o.width+'" height="'+o.height+'" xlink:href="'+d+`"></image>
</pattern>
`},setOptions:function(n){for(var o in n)this[o]=n[o]},toLive:function(n){var o=this.source;return!o||typeof o.src!="undefined"&&(!o.complete||o.naturalWidth===0||o.naturalHeight===0)?"":n.createPattern(o,this.repeat)}})}(),function(s){var n=s.fabric||(s.fabric={}),o=n.util.toFixed;if(n.Shadow){n.warn("fabric.Shadow is already defined.");return}n.Shadow=n.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(f){typeof f=="string"&&(f=this._parseShadow(f));for(var r in f)this[r]=f[r];this.id=n.Object.__uid++},_parseShadow:function(f){var r=f.trim(),l=n.Shadow.reOffsetsAndBlur.exec(r)||[],c=r.replace(n.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseFloat(l[1],10)||0,offsetY:parseFloat(l[2],10)||0,blur:parseFloat(l[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var r=40,l=40,c=n.Object.NUM_FRACTION_DIGITS,d=n.util.rotateVector({x:this.offsetX,y:this.offsetY},n.util.degreesToRadians(-f.angle)),p=20,h=new n.Color(this.color);return f.width&&f.height&&(r=o((Math.abs(d.x)+this.blur)/f.width,c)*100+p,l=o((Math.abs(d.y)+this.blur)/f.height,c)*100+p),f.flipX&&(d.x*=-1),f.flipY&&(d.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+l+'%" height="'+(100+2*l)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+o(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+o(d.x,c)+'" dy="'+o(d.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+h.toRgb()+'" flood-opacity="'+h.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var f={},r=n.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(l){this[l]!==r[l]&&(f[l]=this[l])},this),f}}),n.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(m),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var s=e.util.object.extend,n=e.util.getElementOffset,o=e.util.removeFromArray,f=e.util.toFixed,r=e.util.transformPoint,l=e.util.invertTransform,c=e.util.getNodeCanvas,d=e.util.createCanvasElement,p=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(h,v){v||(v={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(h,v)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(h,v){var _=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(h),this._initOptions(v),this.interactive||this._initRetinaScaling(),v.overlayImage&&this.setOverlayImage(v.overlayImage,_),v.backgroundImage&&this.setBackgroundImage(v.backgroundImage,_),v.backgroundColor&&this.setBackgroundColor(v.backgroundColor,_),v.overlayColor&&this.setOverlayColor(v.overlayColor,_),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(!!this._isRetinaScaling()){var h=e.devicePixelRatio;this.__initRetinaScaling(h,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(h,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(h,v,_){v.setAttribute("width",this.width*h),v.setAttribute("height",this.height*h),_.scale(h,h)},calcOffset:function(){return this._offset=n(this.lowerCanvasEl),this},setOverlayImage:function(h,v,_){return this.__setBgOverlayImage("overlayImage",h,v,_)},setBackgroundImage:function(h,v,_){return this.__setBgOverlayImage("backgroundImage",h,v,_)},setOverlayColor:function(h,v){return this.__setBgOverlayColor("overlayColor",h,v)},setBackgroundColor:function(h,v){return this.__setBgOverlayColor("backgroundColor",h,v)},__setBgOverlayImage:function(h,v,_,y){return typeof v=="string"?e.util.loadImage(v,function(x,b){if(x){var w=new e.Image(x,y);this[h]=w,w.canvas=this}_&&_(x,b)},this,y&&y.crossOrigin):(y&&v.setOptions(y),this[h]=v,v&&(v.canvas=this),_&&_(v,!1)),this},__setBgOverlayColor:function(h,v,_){return this[h]=v,this._initGradient(v,h),this._initPattern(v,h,_),this},_createCanvasElement:function(){var h=d();if(!h||(h.style||(h.style={}),typeof h.getContext=="undefined"))throw p;return h},_initOptions:function(h){var v=this.lowerCanvasEl;this._setOptions(h),this.width=this.width||parseInt(v.width,10)||0,this.height=this.height||parseInt(v.height,10)||0,this.lowerCanvasEl.style&&(v.width=this.width,v.height=this.height,v.style.width=this.width+"px",v.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(h){h&&h.getContext?this.lowerCanvasEl=h:this.lowerCanvasEl=e.util.getById(h)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(h,v){return this.setDimensions({width:h},v)},setHeight:function(h,v){return this.setDimensions({height:h},v)},setDimensions:function(h,v){var _;v=v||{};for(var y in h)_=h[y],v.cssOnly||(this._setBackstoreDimension(y,h[y]),_+="px",this.hasLostContext=!0),v.backstoreOnly||this._setCssDimension(y,_);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),v.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(h,v){return this.lowerCanvasEl[h]=v,this.upperCanvasEl&&(this.upperCanvasEl[h]=v),this.cacheCanvasEl&&(this.cacheCanvasEl[h]=v),this[h]=v,this},_setCssDimension:function(h,v){return this.lowerCanvasEl.style[h]=v,this.upperCanvasEl&&(this.upperCanvasEl.style[h]=v),this.wrapperEl&&(this.wrapperEl.style[h]=v),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(h){var v=this._activeObject,_=this.backgroundImage,y=this.overlayImage,x,b,w;for(this.viewportTransform=h,b=0,w=this._objects.length;b<w;b++)x=this._objects[b],x.group||x.setCoords(!0);return v&&v.setCoords(),_&&_.setCoords(!0),y&&y.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(h,v){var _=h,y=this.viewportTransform.slice(0);h=r(h,l(this.viewportTransform)),y[0]=v,y[3]=v;var x=r(h,y);return y[4]+=_.x-x.x,y[5]+=_.y-x.y,this.setViewportTransform(y)},setZoom:function(h){return this.zoomToPoint(new e.Point(0,0),h),this},absolutePan:function(h){var v=this.viewportTransform.slice(0);return v[4]=-h.x,v[5]=-h.y,this.setViewportTransform(v)},relativePan:function(h){return this.absolutePan(new e.Point(-h.x-this.viewportTransform[4],-h.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(h){this.stateful&&h.setupState(),h._set("canvas",this),h.setCoords(),this.fire("object:added",{target:h}),h.fire("added")},_onObjectRemoved:function(h){this.fire("object:removed",{target:h}),h.fire("removed"),delete h.canvas},clearContext:function(h){return h.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var h=this.contextContainer;return this.renderCanvas(h,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var h={},v=this.width,_=this.height,y=l(this.viewportTransform);return h.tl=r({x:0,y:0},y),h.br=r({x:v,y:_},y),h.tr=new e.Point(h.br.x,h.tl.y),h.bl=new e.Point(h.tl.x,h.br.y),this.vptCoords=h,h},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(h,v){var _=this.viewportTransform,y=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(h),e.util.setImageSmoothing(h,this.imageSmoothingEnabled),this.fire("before:render",{ctx:h}),this._renderBackground(h),h.save(),h.transform(_[0],_[1],_[2],_[3],_[4],_[5]),this._renderObjects(h,v),h.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(h),y&&(y.canvas=this,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(h)),this._renderOverlay(h),this.controlsAboveOverlay&&this.interactive&&this.drawControls(h),this.fire("after:render",{ctx:h})},drawClipPathOnCanvas:function(h){var v=this.viewportTransform,_=this.clipPath;h.save(),h.transform(v[0],v[1],v[2],v[3],v[4],v[5]),h.globalCompositeOperation="destination-in",_.transform(h),h.scale(1/_.zoomX,1/_.zoomY),h.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),h.restore()},_renderObjects:function(h,v){var _,y;for(_=0,y=v.length;_<y;++_)v[_]&&v[_].render(h)},_renderBackgroundOrOverlay:function(h,v){var _=this[v+"Color"],y=this[v+"Image"],x=this.viewportTransform,b=this[v+"Vpt"];if(!(!_&&!y)){if(_){h.save(),h.beginPath(),h.moveTo(0,0),h.lineTo(this.width,0),h.lineTo(this.width,this.height),h.lineTo(0,this.height),h.closePath(),h.fillStyle=_.toLive?_.toLive(h,this):_,b&&h.transform(x[0],x[1],x[2],x[3],x[4],x[5]),h.transform(1,0,0,1,_.offsetX||0,_.offsetY||0);var w=_.gradientTransform||_.patternTransform;w&&h.transform(w[0],w[1],w[2],w[3],w[4],w[5]),h.fill(),h.restore()}y&&(h.save(),b&&h.transform(x[0],x[1],x[2],x[3],x[4],x[5]),y.render(h),h.restore())}},_renderBackground:function(h){this._renderBackgroundOrOverlay(h,"background")},_renderOverlay:function(h){this._renderBackgroundOrOverlay(h,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(h){return this._centerObject(h,new e.Point(this.getCenterPoint().x,h.getCenterPoint().y))},centerObjectV:function(h){return this._centerObject(h,new e.Point(h.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(h){var v=this.getCenterPoint();return this._centerObject(h,v)},viewportCenterObject:function(h){var v=this.getVpCenter();return this._centerObject(h,v)},viewportCenterObjectH:function(h){var v=this.getVpCenter();return this._centerObject(h,new e.Point(v.x,h.getCenterPoint().y)),this},viewportCenterObjectV:function(h){var v=this.getVpCenter();return this._centerObject(h,new e.Point(h.getCenterPoint().x,v.y))},getVpCenter:function(){var h=this.getCenterPoint(),v=l(this.viewportTransform);return r(h,v)},_centerObject:function(h,v){return h.setPositionByOrigin(v,"center","center"),h.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(h){return this.toDatalessObject(h)},toObject:function(h){return this._toObjectMethod("toObject",h)},toDatalessObject:function(h){return this._toObjectMethod("toDatalessObject",h)},_toObjectMethod:function(h,v){var _=this.clipPath,y={version:e.version,objects:this._toObjects(h,v)};return _&&!_.excludeFromExport&&(y.clipPath=this._toObject(this.clipPath,h,v)),s(y,this.__serializeBgOverlay(h,v)),e.util.populateWithProperties(this,y,v),y},_toObjects:function(h,v){return this._objects.filter(function(_){return!_.excludeFromExport}).map(function(_){return this._toObject(_,h,v)},this)},_toObject:function(h,v,_){var y;this.includeDefaultValues||(y=h.includeDefaultValues,h.includeDefaultValues=!1);var x=h[v](_);return this.includeDefaultValues||(h.includeDefaultValues=y),x},__serializeBgOverlay:function(h,v){var _={},y=this.backgroundImage,x=this.overlayImage,b=this.backgroundColor,w=this.overlayColor;return b&&b.toObject?b.excludeFromExport||(_.background=b.toObject(v)):b&&(_.background=b),w&&w.toObject?w.excludeFromExport||(_.overlay=w.toObject(v)):w&&(_.overlay=w),y&&!y.excludeFromExport&&(_.backgroundImage=this._toObject(y,h,v)),x&&!x.excludeFromExport&&(_.overlayImage=this._toObject(x,h,v)),_},svgViewportTransformation:!0,toSVG:function(h,v){h||(h={}),h.reviver=v;var _=[];return this._setSVGPreamble(_,h),this._setSVGHeader(_,h),this.clipPath&&_.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(_,"background"),this._setSVGBgOverlayImage(_,"backgroundImage",v),this._setSVGObjects(_,v),this.clipPath&&_.push(`</g>
`),this._setSVGBgOverlayColor(_,"overlay"),this._setSVGBgOverlayImage(_,"overlayImage",v),_.push("</svg>"),_.join("")},_setSVGPreamble:function(h,v){v.suppressPreamble||h.push('<?xml version="1.0" encoding="',v.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(h,v){var _=v.width||this.width,y=v.height||this.height,x,b='viewBox="0 0 '+this.width+" "+this.height+'" ',w=e.Object.NUM_FRACTION_DIGITS;v.viewBox?b='viewBox="'+v.viewBox.x+" "+v.viewBox.y+" "+v.viewBox.width+" "+v.viewBox.height+'" ':this.svgViewportTransformation&&(x=this.viewportTransform,b='viewBox="'+f(-x[4]/x[0],w)+" "+f(-x[5]/x[3],w)+" "+f(this.width/x[0],w)+" "+f(this.height/x[3],w)+'" '),h.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',_,'" ','height="',y,'" ',b,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(v),`</defs>
`)},createSVGClipPathMarkup:function(h){var v=this.clipPath;return v?(v.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+v.clipPathId+`" >
`+this.clipPath.toClipPathSVG(h.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var h=this,v=["background","overlay"].map(function(_){var y=h[_+"Color"];if(y&&y.toLive){var x=h[_+"Vpt"],b=h.viewportTransform,w={width:h.width/(x?b[0]:1),height:h.height/(x?b[3]:1)};return y.toSVG(w,{additionalTransform:x?e.util.matrixToSVG(b):""})}});return v.join("")},createSVGFontFacesMarkup:function(){var h="",v={},_,y,x,b,w,M,S,C,O,k=e.fontPaths,Y=[];for(this._objects.forEach(function N(U){Y.push(U),U._objects&&U._objects.forEach(N)}),C=0,O=Y.length;C<O;C++)if(_=Y[C],y=_.fontFamily,!(_.type.indexOf("text")===-1||v[y]||!k[y])&&(v[y]=!0,!!_.styles)){x=_.styles;for(w in x){b=x[w];for(S in b)M=b[S],y=M.fontFamily,!v[y]&&k[y]&&(v[y]=!0)}}for(var H in v)h+=[`		@font-face {
`,"			font-family: '",H,`';
`,"			src: url('",k[H],`');
`,`		}
`].join("");return h&&(h=['	<style type="text/css">',`<![CDATA[
`,h,"]]>",`</style>
`].join("")),h},_setSVGObjects:function(h,v){var _,y,x,b=this._objects;for(y=0,x=b.length;y<x;y++)_=b[y],!_.excludeFromExport&&this._setSVGObject(h,_,v)},_setSVGObject:function(h,v,_){h.push(v.toSVG(_))},_setSVGBgOverlayImage:function(h,v,_){this[v]&&!this[v].excludeFromExport&&this[v].toSVG&&h.push(this[v].toSVG(_))},_setSVGBgOverlayColor:function(h,v){var _=this[v+"Color"],y=this.viewportTransform,x=this.width,b=this.height;if(!!_)if(_.toLive){var w=_.repeat,M=e.util.invertTransform(y),S=this[v+"Vpt"],C=S?e.util.matrixToSVG(M):"";h.push('<rect transform="'+C+" translate(",x/2,",",b/2,')"',' x="',_.offsetX-x/2,'" y="',_.offsetY-b/2,'" ','width="',w==="repeat-y"||w==="no-repeat"?_.source.width:x,'" height="',w==="repeat-x"||w==="no-repeat"?_.source.height:b,'" fill="url(#SVGID_'+_.id+')"',`></rect>
`)}else h.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',_,'"',`></rect>
`)},sendToBack:function(h){if(!h)return this;var v=this._activeObject,_,y,x;if(h===v&&h.type==="activeSelection")for(x=v._objects,_=x.length;_--;)y=x[_],o(this._objects,y),this._objects.unshift(y);else o(this._objects,h),this._objects.unshift(h);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(h){if(!h)return this;var v=this._activeObject,_,y,x;if(h===v&&h.type==="activeSelection")for(x=v._objects,_=0;_<x.length;_++)y=x[_],o(this._objects,y),this._objects.push(y);else o(this._objects,h),this._objects.push(h);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(h,v){if(!h)return this;var _=this._activeObject,y,x,b,w,M,S=0;if(h===_&&h.type==="activeSelection")for(M=_._objects,y=0;y<M.length;y++)x=M[y],b=this._objects.indexOf(x),b>0+S&&(w=b-1,o(this._objects,x),this._objects.splice(w,0,x)),S++;else b=this._objects.indexOf(h),b!==0&&(w=this._findNewLowerIndex(h,b,v),o(this._objects,h),this._objects.splice(w,0,h));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(h,v,_){var y,x;if(_)for(y=v,x=v-1;x>=0;--x){var b=h.intersectsWithObject(this._objects[x])||h.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(h);if(b){y=x;break}}else y=v-1;return y},bringForward:function(h,v){if(!h)return this;var _=this._activeObject,y,x,b,w,M,S=0;if(h===_&&h.type==="activeSelection")for(M=_._objects,y=M.length;y--;)x=M[y],b=this._objects.indexOf(x),b<this._objects.length-1-S&&(w=b+1,o(this._objects,x),this._objects.splice(w,0,x)),S++;else b=this._objects.indexOf(h),b!==this._objects.length-1&&(w=this._findNewUpperIndex(h,b,v),o(this._objects,h),this._objects.splice(w,0,h));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(h,v,_){var y,x,b;if(_)for(y=v,x=v+1,b=this._objects.length;x<b;++x){var w=h.intersectsWithObject(this._objects[x])||h.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(h);if(w){y=x;break}}else y=v+1;return y},moveTo:function(h,v){return o(this._objects,h),this._objects.splice(v,0,h),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(h){h.dispose&&h.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),s(e.StaticCanvas.prototype,e.Observable),s(e.StaticCanvas.prototype,e.Collection),s(e.StaticCanvas.prototype,e.DataURLExporter),s(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(h){var v=d();if(!v||!v.getContext)return null;var _=v.getContext("2d");if(!_)return null;switch(h){case"setLineDash":return typeof _.setLineDash!="undefined";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var h=c(this.lowerCanvasEl);return h&&h.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(h){var v=c(this.lowerCanvasEl);return v&&v.createJPEGStream(h)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(s){s.strokeStyle=this.color,s.lineWidth=this.width,s.lineCap=this.strokeLineCap,s.miterLimit=this.strokeMiterLimit,s.lineJoin=this.strokeLineJoin,s.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(s){var n=this.canvas.viewportTransform;s.save(),s.transform(n[0],n[1],n[2],n[3],n[4],n[5])},_setShadow:function(){if(!!this.shadow){var s=this.canvas,n=this.shadow,o=s.contextTop,f=s.getZoom();s&&s._isRetinaScaling()&&(f*=e.devicePixelRatio),o.shadowColor=n.color,o.shadowBlur=n.blur*f,o.shadowOffsetX=n.offsetX*f,o.shadowOffsetY=n.offsetY*f}},needsFullRender:function(){var s=new e.Color(this.color);return s.getAlpha()<1||!!this.shadow},_resetShadow:function(){var s=this.canvas.contextTop;s.shadowColor="",s.shadowBlur=s.shadowOffsetX=s.shadowOffsetY=0},_isOutSideCanvas:function(s){return s.x<0||s.x>this.canvas.getWidth()||s.y<0||s.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(s){this.canvas=s,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(s,n,o){var f=n.midPointFrom(o);return s.quadraticCurveTo(n.x,n.y,f.x,f.y),f},onMouseDown:function(s,n){!this.canvas._isMainEvent(n.e)||(this.drawStraightLine=n.e[this.straightLineKey],this._prepareForDrawing(s),this._captureDrawingPath(s),this._render())},onMouseMove:function(s,n){if(!!this.canvas._isMainEvent(n.e)&&(this.drawStraightLine=n.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s))&&this._captureDrawingPath(s)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var o=this._points,f=o.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,o[f-2],o[f-1],!0),r.stroke(),r.restore()}},onMouseUp:function(s){return this.canvas._isMainEvent(s.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(s){var n=new e.Point(s.x,s.y);this._reset(),this._addPoint(n),this.canvas.contextTop.moveTo(n.x,n.y)},_addPoint:function(s){return this._points.length>1&&s.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(s),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(s){var n=new e.Point(s.x,s.y);return this._addPoint(n)},_render:function(s){var n,o,f=this._points[0],r=this._points[1];if(s=s||this.canvas.contextTop,this._saveAndTransform(s),s.beginPath(),this._points.length===2&&f.x===r.x&&f.y===r.y){var l=this.width/1e3;f=new e.Point(f.x,f.y),r=new e.Point(r.x,r.y),f.x-=l,r.x+=l}for(s.moveTo(f.x,f.y),n=1,o=this._points.length;n<o;n++)this._drawSegment(s,f,r),f=this._points[n],r=this._points[n+1];s.lineTo(f.x,f.y),s.stroke(),s.restore()},convertPointsToSVGPath:function(s){var n=this.width/1e3;return e.util.getSmoothPathFromPoints(s,n)},_isEmptySVGPath:function(s){var n=e.util.joinPath(s);return n==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(s){var n=new e.Path(s,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,n.shadow=new e.Shadow(this.shadow)),n},decimatePoints:function(s,n){if(s.length<=2)return s;var o=this.canvas.getZoom(),f=Math.pow(n/o,2),r,l=s.length-1,c=s[0],d=[c],p;for(r=1;r<l-1;r++)p=Math.pow(c.x-s[r].x,2)+Math.pow(c.y-s[r].y,2),p>=f&&(c=s[r],d.push(c));return d.push(s[l]),d},_finalizeAndAddPath:function(){var s=this.canvas.contextTop;s.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var n=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(n)){this.canvas.requestRenderAll();return}var o=this.createPath(n);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:o}),this.canvas.add(o),this.canvas.requestRenderAll(),o.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:o})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(s){this.canvas=s,this.points=[]},drawDot:function(s){var n=this.addPoint(s),o=this.canvas.contextTop;this._saveAndTransform(o),this.dot(o,n),o.restore()},dot:function(s,n){s.fillStyle=n.fill,s.beginPath(),s.arc(n.x,n.y,n.radius,0,Math.PI*2,!1),s.closePath(),s.fill()},onMouseDown:function(s){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(s)},_render:function(){var s=this.canvas.contextTop,n,o,f=this.points;for(this._saveAndTransform(s),n=0,o=f.length;n<o;n++)this.dot(s,f[n]);s.restore()},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(s),this._render()):this.drawDot(s))},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,n,o;this.canvas.renderOnAddRemove=!1;var f=[];for(n=0,o=this.points.length;n<o;n++){var r=this.points[n],l=new e.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(l.shadow=new e.Shadow(this.shadow)),f.push(l)}var c=new e.Group(f);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.requestRenderAll()},addPoint:function(s){var n=new e.Point(s.x,s.y),o=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return n.radius=o,n.fill=f,this.points.push(n),n}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(s){this.canvas=s,this.sprayChunks=[]},onMouseDown:function(s){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(s),this.render(this.sprayChunkPoints)},onMouseMove:function(s){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(s)||(this.addSprayChunk(s),this.render(this.sprayChunkPoints))},onMouseUp:function(){var s=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var n=[],o=0,f=this.sprayChunks.length;o<f;o++)for(var r=this.sprayChunks[o],l=0,c=r.length;l<c;l++){var d=new e.Rect({width:r[l].width,height:r[l].width,left:r[l].x+1,top:r[l].y+1,originX:"center",originY:"center",fill:this.color});n.push(d)}this.optimizeOverlapping&&(n=this._getOptimizedRects(n));var p=new e.Group(n);this.shadow&&p.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:p}),this.canvas.add(p),this.canvas.fire("path:created",{path:p}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=s,this.canvas.requestRenderAll()},_getOptimizedRects:function(s){var n={},o,f,r;for(f=0,r=s.length;f<r;f++)o=s[f].left+""+s[f].top,n[o]||(n[o]=s[f]);var l=[];for(o in n)l.push(n[o]);return l},render:function(s){var n=this.canvas.contextTop,o,f;for(n.fillStyle=this.color,this._saveAndTransform(n),o=0,f=s.length;o<f;o++){var r=s[o];typeof r.opacity!="undefined"&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var s=this.canvas.contextTop,n,o;for(s.fillStyle=this.color,this._saveAndTransform(s),n=0,o=this.sprayChunks.length;n<o;n++)this.render(this.sprayChunks[n]);s.restore()},addSprayChunk:function(s){this.sprayChunkPoints=[];var n,o,f,r=this.width/2,l;for(l=0;l<this.density;l++){n=e.util.getRandomInt(s.x-r,s.x+r),o=e.util.getRandomInt(s.y-r,s.y+r),this.dotWidthVariance?f=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):f=this.dotWidth;var c=new e.Point(n,o);c.width=f,this.randomOpacity&&(c.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var s=20,n=5,o=e.util.createCanvasElement(),f=o.getContext("2d");return o.width=o.height=s+n,f.fillStyle=this.color,f.beginPath(),f.arc(s/2,s/2,s/2,0,Math.PI*2,!1),f.closePath(),f.fill(),o},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(s){return s.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(s){this.callSuper("_setBrushStyles",s),s.strokeStyle=this.getPattern(s)},createPath:function(s){var n=this.callSuper("createPath",s),o=n._getLeftTopCoords().scalarAdd(n.strokeWidth/2);return n.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-o.x,offsetY:-o.y}),n}}),function(){var s=e.util.getPointer,n=e.util.degreesToRadians,o=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(r,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),l,c,d;if(r.length>0&&!this.preserveObjectStacking){c=[],d=[];for(var p=0,h=this._objects.length;p<h;p++)l=this._objects[p],r.indexOf(l)===-1?c.push(l):d.push(l);r.length>1&&(this._activeObject._objects=d),c.push.apply(c,d)}else c=this._objects;return c},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,l){var c=r.calcTransformMatrix(),d=e.util.invertTransform(c),p=this.restorePointerVpt(l);return e.util.transformPoint(p,d)},isTargetTransparent:function(r,l,c){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var d=this._normalizePointer(r,{x:l,y:c}),p=Math.max(r.cacheTranslationX+d.x*r.zoomX,0),h=Math.max(r.cacheTranslationY+d.y*r.zoomY,0),x=e.util.isTransparent(r._cacheContext,Math.round(p),Math.round(h),this.targetFindTolerance);return x}var v=this.contextCache,_=r.selectionBackgroundColor,y=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(v),v.save(),v.transform(y[0],y[1],y[2],y[3],y[4],y[5]),r.render(v),v.restore(),r.selectionBackgroundColor=_;var x=e.util.isTransparent(v,l,c,this.targetFindTolerance);return x},_isSelectionKeyPressed:function(r){var l=!1;return Array.isArray(this.selectionKey)?l=!!this.selectionKey.find(function(c){return r[c]===!0}):l=r[this.selectionKey],l},_shouldClearSelection:function(r,l){var c=this.getActiveObjects(),d=this._activeObject;return!l||l&&d&&c.length>1&&c.indexOf(l)===-1&&d!==l&&!this._isSelectionKeyPressed(r)||l&&!l.evented||l&&!l.selectable&&d&&d!==l},_shouldCenterTransform:function(r,l,c){if(!!r){var d;return l==="scale"||l==="scaleX"||l==="scaleY"||l==="resizing"?d=this.centeredScaling||r.centeredScaling:l==="rotate"&&(d=this.centeredRotation||r.centeredRotation),d?!c:c}},_getOriginFromCorner:function(r,l){var c={x:r.originX,y:r.originY};return l==="ml"||l==="tl"||l==="bl"?c.x="right":(l==="mr"||l==="tr"||l==="br")&&(c.x="left"),l==="tl"||l==="mt"||l==="tr"?c.y="bottom":(l==="bl"||l==="mb"||l==="br")&&(c.y="top"),c},_getActionFromCorner:function(r,l,c,d){if(!l||!r)return"drag";var p=d.controls[l];return p.getActionName(c,p,d)},_setupCurrentTransform:function(r,l,c){if(!!l){var d=this.getPointer(r),p=l.__corner,h=l.controls[p],v=c&&p?h.getActionHandler(r,l,h):e.controlsUtils.dragHandler,_=this._getActionFromCorner(c,p,r,l),y=this._getOriginFromCorner(l,p),x=r[this.centeredKey],b={target:l,action:_,actionHandler:v,corner:p,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:d.x-l.left,offsetY:d.y-l.top,originX:y.x,originY:y.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,theta:n(l.angle),width:l.width*l.scaleX,shiftKey:r.shiftKey,altKey:x,original:e.util.saveObjectTransform(l)};this._shouldCenterTransform(l,_,x)&&(b.originX="center",b.originY="center"),b.original.originX=y.x,b.original.originY=y.y,this._currentTransform=b,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var l=this._groupSelector,c=new e.Point(l.ex,l.ey),d=e.util.transformPoint(c,this.viewportTransform),p=new e.Point(l.ex+l.left,l.ey+l.top),h=e.util.transformPoint(p,this.viewportTransform),v=Math.min(d.x,h.x),_=Math.min(d.y,h.y),y=Math.max(d.x,h.x),x=Math.max(d.y,h.y),b=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(v,_,y-v,x-_)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,v+=b,_+=b,y-=b,x-=b,e.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(v,_,y-v,x-_))},findTarget:function(r,l){if(!this.skipTargetFind){var c=!0,d=this.getPointer(r,c),p=this._activeObject,h=this.getActiveObjects(),v,_,y=o(r),x=h.length>1&&!l||h.length===1;if(this.targets=[],x&&p._findTargetCorner(d,y)||h.length>1&&!l&&p===this._searchPossibleTargets([p],d))return p;if(h.length===1&&p===this._searchPossibleTargets([p],d))if(this.preserveObjectStacking)v=p,_=this.targets,this.targets=[];else return p;var b=this._searchPossibleTargets(this._objects,d);return r[this.altSelectionKey]&&b&&v&&b!==v&&(b=v,this.targets=_),b}},_checkTarget:function(r,l,c){if(l&&l.visible&&l.evented&&l.containsPoint(r))if((this.perPixelTargetFind||l.perPixelTargetFind)&&!l.isEditing){var d=this.isTargetTransparent(l,c.x,c.y);if(!d)return!0}else return!0},_searchPossibleTargets:function(r,l){for(var c,d=r.length,p;d--;){var h=r[d],v=h.group?this._normalizePointer(h.group,l):l;if(this._checkTarget(v,h,l)){c=r[d],c.subTargetCheck&&c instanceof e.Group&&(p=this._searchPossibleTargets(c._objects,l),p&&this.targets.push(p));break}}return c},restorePointerVpt:function(r){return e.util.transformPoint(r,e.util.invertTransform(this.viewportTransform))},getPointer:function(r,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var c=s(r),d=this.upperCanvasEl,p=d.getBoundingClientRect(),h=p.width||0,v=p.height||0,_;(!h||!v)&&("top"in p&&"bottom"in p&&(v=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(h=Math.abs(p.right-p.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,l||(c=this.restorePointerVpt(c));var y=this.getRetinaScaling();return y!==1&&(c.x/=y,c.y/=y),h===0||v===0?_={width:1,height:1}:_={width:d.width/h,height:d.height/v},{x:c.x*_.width,y:c.y*_.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),e.util.addClass(c,"upper-canvas "+r),this.wrapperEl.appendChild(c),this._copyCanvasStyle(l,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var l=this.width||r.width,c=this.height||r.height;e.util.setStyle(r,{position:"absolute",width:l+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=l,r.height=c,e.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,l){l.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,l){var c=!1,d=this.getActiveObjects(),p=[],h=[];r.forEach(function(v){d.indexOf(v)===-1&&(c=!0,v.fire("deselected",{e:l,target:v}),h.push(v))}),d.forEach(function(v){r.indexOf(v)===-1&&(c=!0,v.fire("selected",{e:l,target:v}),p.push(v))}),r.length>0&&d.length>0?c&&this.fire("selection:updated",{e:l,selected:p,deselected:h}):d.length>0?this.fire("selection:created",{e:l,selected:p}):r.length>0&&this.fire("selection:cleared",{e:l,deselected:h})},setActiveObject:function(r,l){var c=this.getActiveObjects();return this._setActiveObject(r,l),this._fireSelectionEvents(c,l),this},_setActiveObject:function(r,l){return this._activeObject===r||!this._discardActiveObject(l,r)||r.onSelect({e:l})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,l){var c=this._activeObject;if(c){if(c.onDeselect({e:r,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var l=this.getActiveObjects(),c=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:c,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(l,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(l){e.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var l=this._activeObject;l&&l._renderControls(r)},_toObject:function(r,l,c){var d=this._realizeGroupTransformOnObject(r),p=this.callSuper("_toObject",r,l,c);return this._unwindGroupTransformOnObject(r,d),p},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var l=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return l.forEach(function(d){c[d]=r[d]}),e.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),c}else return null},_unwindGroupTransformOnObject:function(r,l){l&&r.set(l)},_setSVGObject:function(r,l,c){var d=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",r,l,c),this._unwindGroupTransformOnObject(l,d)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var f in e.StaticCanvas)f!=="prototype"&&(e.Canvas[f]=e.StaticCanvas[f])}(),function(){var s=e.util.addListener,n=e.util.removeListener,o=3,f=2,r=1,l={passive:!1};function c(d,p){return d.button&&d.button===p-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(s,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(d,p){var h=this.upperCanvasEl,v=this._getEventPrefix();d(e.window,"resize",this._onResize),d(h,v+"down",this._onMouseDown),d(h,v+"move",this._onMouseMove,l),d(h,v+"out",this._onMouseOut),d(h,v+"enter",this._onMouseEnter),d(h,"wheel",this._onMouseWheel),d(h,"contextmenu",this._onContextMenu),d(h,"dblclick",this._onDoubleClick),d(h,"dragover",this._onDragOver),d(h,"dragenter",this._onDragEnter),d(h,"dragleave",this._onDragLeave),d(h,"drop",this._onDrop),this.enablePointerEvents||d(h,"touchstart",this._onTouchStart,l),typeof eventjs!="undefined"&&p in eventjs&&(eventjs[p](h,"gesture",this._onGesture),eventjs[p](h,"drag",this._onDrag),eventjs[p](h,"orientation",this._onOrientationChange),eventjs[p](h,"shake",this._onShake),eventjs[p](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(n,"remove");var d=this._getEventPrefix();n(e.document,d+"up",this._onMouseUp),n(e.document,"touchend",this._onTouchEnd,l),n(e.document,d+"move",this._onMouseMove,l),n(e.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(d,p){this.__onTransformGesture&&this.__onTransformGesture(d,p)},_onDrag:function(d,p){this.__onDrag&&this.__onDrag(d,p)},_onMouseWheel:function(d){this.__onMouseWheel(d)},_onMouseOut:function(d){var p=this._hoveredTarget;this.fire("mouse:out",{target:p,e:d}),this._hoveredTarget=null,p&&p.fire("mouseout",{e:d});var h=this;this._hoveredTargets.forEach(function(v){h.fire("mouse:out",{target:p,e:d}),v&&p.fire("mouseout",{e:d})}),this._hoveredTargets=[]},_onMouseEnter:function(d){!this._currentTransform&&!this.findTarget(d)&&(this.fire("mouse:over",{target:null,e:d}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(d,p){this.__onOrientationChange&&this.__onOrientationChange(d,p)},_onShake:function(d,p){this.__onShake&&this.__onShake(d,p)},_onLongPress:function(d,p){this.__onLongPress&&this.__onLongPress(d,p)},_onDragOver:function(d){d.preventDefault();var p=this._simpleEventHandler("dragover",d);this._fireEnterLeaveEvents(p,d)},_onDrop:function(d){return this._simpleEventHandler("drop:before",d),this._simpleEventHandler("drop",d)},_onContextMenu:function(d){return this.stopContextMenu&&(d.stopPropagation(),d.preventDefault()),!1},_onDoubleClick:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"dblclick"),this._resetTransformEventData(d)},getPointerId:function(d){var p=d.changedTouches;return p?p[0]&&p[0].identifier:this.enablePointerEvents?d.pointerId:-1},_isMainEvent:function(d){return d.isPrimary===!0?!0:d.isPrimary===!1?!1:d.type==="touchend"&&d.touches.length===0?!0:d.changedTouches?d.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(d){d.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(d)),this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,h=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,l),s(e.document,"touchmove",this._onMouseMove,l),n(p,h+"down",this._onMouseDown)},_onMouseDown:function(d){this.__onMouseDown(d),this._resetTransformEventData();var p=this.upperCanvasEl,h=this._getEventPrefix();n(p,h+"move",this._onMouseMove,l),s(e.document,h+"up",this._onMouseUp),s(e.document,h+"move",this._onMouseMove,l)},_onTouchEnd:function(d){if(!(d.touches.length>0)){this.__onMouseUp(d),this._resetTransformEventData(),this.mainTouchId=null;var p=this._getEventPrefix();n(e.document,"touchend",this._onTouchEnd,l),n(e.document,"touchmove",this._onMouseMove,l);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){s(h.upperCanvasEl,p+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(d){this.__onMouseUp(d),this._resetTransformEventData();var p=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(d)&&(n(e.document,h+"up",this._onMouseUp),n(e.document,h+"move",this._onMouseMove,l),s(p,h+"move",this._onMouseMove,l))},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault(),this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(d){var p=this._activeObject;return!!p!=!!d||p&&d&&p!==d?!0:(p&&p.isEditing,!1)},__onMouseUp:function(d){var p,h=this._currentTransform,v=this._groupSelector,_=!1,y=!v||v.left===0&&v.top===0;if(this._cacheTransformEventData(d),p=this._target,this._handleEvent(d,"up:before"),c(d,o)){this.fireRightClick&&this._handleEvent(d,"up",o,y);return}if(c(d,f)){this.fireMiddleClick&&this._handleEvent(d,"up",f,y),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(d);return}if(!!this._isMainEvent(d)){if(h&&(this._finalizeCurrentTransform(d),_=h.actionPerformed),!y){var x=p===this._activeObject;this._maybeGroupObjects(d),_||(_=this._shouldRender(p)||!x&&p===this._activeObject)}var b,w;if(p){if(b=p._findTargetCorner(this.getPointer(d,!0),e.util.isTouchEvent(d)),p.selectable&&p!==this._activeObject&&p.activeOn==="up")this.setActiveObject(p,d),_=!0;else{var M=p.controls[b],S=M&&M.getMouseUpHandler(d,p,M);S&&(w=this.getPointer(d),S(d,h,w.x,w.y))}p.isMoving=!1}if(h&&(h.target!==p||h.corner!==b)){var C=h.target&&h.target.controls[h.corner],O=C&&C.getMouseUpHandler(d,p,M);w=w||this.getPointer(d),O&&O(d,h,w.x,w.y)}this._setCursorFromEvent(d,p),this._handleEvent(d,"up",r,y),this._groupSelector=null,this._currentTransform=null,p&&(p.__corner=0),_?this.requestRenderAll():y||this.renderTop()}},_simpleEventHandler:function(d,p){var h=this.findTarget(p),v=this.targets,_={e:p,target:h,subTargets:v};if(this.fire(d,_),h&&h.fire(d,_),!v)return h;for(var y=0;y<v.length;y++)v[y].fire(d,_);return h},_handleEvent:function(d,p,h,v){var _=this._target,y=this.targets||[],x={e:d,target:_,subTargets:y,button:h||r,isClick:v||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};p==="up"&&(x.currentTarget=this.findTarget(d),x.currentSubTargets=this.targets),this.fire("mouse:"+p,x),_&&_.fire("mouse"+p,x);for(var b=0;b<y.length;b++)y[b].fire("mouse"+p,x)},_finalizeCurrentTransform:function(d){var p=this._currentTransform,h=p.target,v={e:d,target:h,transform:p,action:p.action};h._scaling&&(h._scaling=!1),h.setCoords(),(p.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",v)},_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(d).requestRenderAll();var p=this.getPointer(d);this.freeDrawingBrush.onMouseDown(p,{e:d,pointer:p}),this._handleEvent(d,"down")},_onMouseMoveInDrawingMode:function(d){if(this._isCurrentlyDrawing){var p=this.getPointer(d);this.freeDrawingBrush.onMouseMove(p,{e:d,pointer:p})}this.setCursor(this.freeDrawingCursor),this._handleEvent(d,"move")},_onMouseUpInDrawingMode:function(d){var p=this.getPointer(d);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:d,pointer:p}),this._handleEvent(d,"up")},__onMouseDown:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"down:before");var p=this._target;if(c(d,o)){this.fireRightClick&&this._handleEvent(d,"down",o);return}if(c(d,f)){this.fireMiddleClick&&this._handleEvent(d,"down",f);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(d);return}if(!!this._isMainEvent(d)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var v=this._shouldRender(p),_=this._shouldGroup(d,p);if(this._shouldClearSelection(d,p)?this.discardActiveObject(d):_&&(this._handleGrouping(d,p),p=this._activeObject),this.selection&&(!p||!p.selectable&&!p.isEditing&&p!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),p){var y=p===this._activeObject;p.selectable&&p.activeOn==="down"&&this.setActiveObject(p,d);var x=p._findTargetCorner(this.getPointer(d,!0),e.util.isTouchEvent(d));if(p.__corner=x,p===this._activeObject&&(x||!_)){this._setupCurrentTransform(d,p,y);var b=p.controls[x],h=this.getPointer(d),w=b&&b.getMouseDownHandler(d,p,b);w&&w(d,this._currentTransform,h.x,h.y)}}this._handleEvent(d,"down"),(v||_)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(d){this._resetTransformEventData(),this._pointer=this.getPointer(d,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(d)||null},_beforeTransform:function(d){var p=this._currentTransform;this.stateful&&p.target.saveState(),this.fire("before:transform",{e:d,transform:p})},__onMouseMove:function(d){this._handleEvent(d,"move:before"),this._cacheTransformEventData(d);var p,h;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(d);return}if(!!this._isMainEvent(d)){var v=this._groupSelector;v?(h=this._absolutePointer,v.left=h.x-v.ex,v.top=h.y-v.ey,this.renderTop()):this._currentTransform?this._transformObject(d):(p=this.findTarget(d)||null,this._setCursorFromEvent(d,p),this._fireOverOutEvents(p,d)),this._handleEvent(d,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(d,p){var h=this._hoveredTarget,v=this._hoveredTargets,_=this.targets,y=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var x=0;x<y;x++)this.fireSyntheticInOutEvents(_[x],p,{oldTarget:v[x],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(d,p){var h=this._draggedoverTarget,v=this._hoveredTargets,_=this.targets,y=Math.max(v.length,_.length);this.fireSyntheticInOutEvents(d,p,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var x=0;x<y;x++)this.fireSyntheticInOutEvents(_[x],p,{oldTarget:v[x],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=d},fireSyntheticInOutEvents:function(d,p,h){var v,_,y=h.oldTarget,x,b,w=y!==d,M=h.canvasEvtIn,S=h.canvasEvtOut;w&&(v={e:p,target:d,previousTarget:y},_={e:p,target:y,nextTarget:d}),b=d&&w,x=y&&w,x&&(S&&this.fire(S,_),y.fire(h.evtOut,_)),b&&(M&&this.fire(M,v),d.fire(h.evtIn,v))},__onMouseWheel:function(d){this._cacheTransformEventData(d),this._handleEvent(d,"wheel"),this._resetTransformEventData()},_transformObject:function(d){var p=this.getPointer(d),h=this._currentTransform;h.reset=!1,h.shiftKey=d.shiftKey,h.altKey=d[this.centeredKey],this._performTransformAction(d,h,p),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(d,p,h){var v=h.x,_=h.y,y=p.action,x=!1,b=p.actionHandler;b&&(x=b(d,p,v,_)),y==="drag"&&x&&(p.target.isMoving=!0,this.setCursor(p.target.moveCursor||this.moveCursor)),p.actionPerformed=p.actionPerformed||x},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(d,p){if(!p)return this.setCursor(this.defaultCursor),!1;var h=p.hoverCursor||this.hoverCursor,v=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,_=(!v||!v.contains(p))&&p._findTargetCorner(this.getPointer(d,!0));_?this.setCursor(this.getCornerCursor(_,p,d)):(p.subTargetCheck&&this.targets.concat().reverse().map(function(y){h=y.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(d,p,h){var v=p.controls[d];return v.cursorStyleHandler(h,v,p)}})}(),function(){var s=Math.min,n=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(o,f){var r=this._activeObject;return r&&this._isSelectionKeyPressed(o)&&f&&f.selectable&&this.selection&&(r!==f||r.type==="activeSelection")&&!f.onSelect({e:o})},_handleGrouping:function(o,f){var r=this._activeObject;r.__corner||f===r&&(f=this.findTarget(o,!0),!f||!f.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(f,o):this._createActiveSelection(f,o))},_updateActiveSelection:function(o,f){var r=this._activeObject,l=r._objects.slice(0);r.contains(o)?(r.removeWithUpdate(o),this._hoveredTarget=o,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),f)):(r.addWithUpdate(o),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(l,f)},_createActiveSelection:function(o,f){var r=this.getActiveObjects(),l=this._createGroup(o);this._hoveredTarget=l,this._setActiveObject(l,f),this._fireSelectionEvents(r,f)},_createGroup:function(o){var f=this._objects,r=f.indexOf(this._activeObject)<f.indexOf(o),l=r?[this._activeObject,o]:[o,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(o){var f=this._collectObjects(o),r;f.length===1?this.setActiveObject(f[0],o):f.length>1&&(r=new e.ActiveSelection(f.reverse(),{canvas:this}),this.setActiveObject(r,o))},_collectObjects:function(o){for(var f=[],r,l=this._groupSelector.ex,c=this._groupSelector.ey,d=l+this._groupSelector.left,p=c+this._groupSelector.top,h=new e.Point(s(l,d),s(c,p)),v=new e.Point(n(l,d),n(c,p)),_=!this.selectionFullyContained,y=l===d&&c===p,x=this._objects.length;x--&&(r=this._objects[x],!(!(!r||!r.selectable||!r.visible)&&(_&&r.intersectsWithRect(h,v,!0)||r.isContainedWithinRect(h,v,!0)||_&&r.containsPoint(h,null,!0)||_&&r.containsPoint(v,null,!0))&&(f.push(r),y))););return f.length>1&&(f=f.filter(function(b){return!b.onSelect({e:o})})),f},_maybeGroupObjects:function(o){this.selection&&this._groupSelector&&this._groupSelectedObjects(o),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(s){s||(s={});var n=s.format||"png",o=s.quality||1,f=(s.multiplier||1)*(s.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(f,s);return e.util.toDataURL(r,n,o)},toCanvasElement:function(s,n){s=s||1,n=n||{};var o=(n.width||this.width)*s,f=(n.height||this.height)*s,r=this.getZoom(),l=this.width,c=this.height,d=r*s,p=this.viewportTransform,h=(p[4]-(n.left||0))*s,v=(p[5]-(n.top||0))*s,_=this.interactive,y=[d,0,0,d,h,v],x=this.enableRetinaScaling,b=e.util.createCanvasElement(),w=this.contextTop;return b.width=o,b.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=y,this.width=o,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(b.getContext("2d"),this._objects),this.viewportTransform=p,this.width=l,this.height=c,this.calcViewportBoundaries(),this.interactive=_,this.enableRetinaScaling=x,this.contextTop=w,b}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(s,n,o){if(!!s){var f=typeof s=="string"?JSON.parse(s):e.util.object.clone(s),r=this,l=f.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete f.clipPath,this._enlivenObjects(f.objects,function(d){r.clear(),r._setBgOverlay(f,function(){l?r._enlivenObjects([l],function(p){r.clipPath=p[0],r.__setupCanvas.call(r,f,d,c,n)}):r.__setupCanvas.call(r,f,d,c,n)})},o),this}},__setupCanvas:function(s,n,o,f){var r=this;n.forEach(function(l,c){r.insertAt(l,c)}),this.renderOnAddRemove=o,delete s.objects,delete s.backgroundImage,delete s.overlayImage,delete s.background,delete s.overlay,this._setOptions(s),this.renderAll(),f&&f()},_setBgOverlay:function(s,n){var o={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!s.backgroundImage&&!s.overlayImage&&!s.background&&!s.overlay){n&&n();return}var f=function(){o.backgroundImage&&o.overlayImage&&o.backgroundColor&&o.overlayColor&&n&&n()};this.__setBgOverlay("backgroundImage",s.backgroundImage,o,f),this.__setBgOverlay("overlayImage",s.overlayImage,o,f),this.__setBgOverlay("backgroundColor",s.background,o,f),this.__setBgOverlay("overlayColor",s.overlay,o,f)},__setBgOverlay:function(s,n,o,f){var r=this;if(!n){o[s]=!0,f&&f();return}s==="backgroundImage"||s==="overlayImage"?e.util.enlivenObjects([n],function(l){r[s]=l[0],o[s]=!0,f&&f()}):this["set"+e.util.string.capitalize(s,!0)](n,function(){o[s]=!0,f&&f()})},_enlivenObjects:function(s,n,o){if(!s||s.length===0){n&&n([]);return}e.util.enlivenObjects(s,function(f){n&&n(f)},null,o)},_toDataURL:function(s,n){this.clone(function(o){n(o.toDataURL(s))})},_toDataURLWithMultiplier:function(s,n,o){this.clone(function(f){o(f.toDataURLWithMultiplier(s,n))})},clone:function(s,n){var o=JSON.stringify(this.toJSON(n));this.cloneWithoutData(function(f){f.loadFromJSON(o,function(){s&&s(f)})})},cloneWithoutData:function(s){var n=e.util.createCanvasElement();n.width=this.width,n.height=this.height;var o=new e.Canvas(n);this.backgroundImage?(o.setBackgroundImage(this.backgroundImage.src,function(){o.renderAll(),s&&s(o)}),o.backgroundImageOpacity=this.backgroundImageOpacity,o.backgroundImageStretch=this.backgroundImageStretch):s&&s(o)}}),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.util.object.clone,r=n.util.toFixed,l=n.util.string.capitalize,c=n.util.degreesToRadians,d=!n.isLikelyNode,p=2;n.Object||(n.Object=n.util.createClass(n.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:d,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(h){h&&this.setOptions(h)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=n.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(h){var v=n.perfLimitSizeTotal,_=h.width,y=h.height,x=n.maxCacheSideLimit,b=n.minCacheSideLimit;if(_<=x&&y<=x&&_*y<=v)return _<b&&(h.width=b),y<b&&(h.height=b),h;var w=_/y,M=n.util.limitDimsByArea(w,v),S=n.util.capValue,C=S(b,M.x,x),O=S(b,M.y,x);return _>C&&(h.zoomX/=_/C,h.width=C,h.capped=!0),y>O&&(h.zoomY/=y/O,h.height=O,h.capped=!0),h},_getCacheCanvasDimensions:function(){var h=this.getTotalObjectScaling(),v=this._getTransformedDimensions(0,0),_=v.x*h.scaleX/this.scaleX,y=v.y*h.scaleY/this.scaleY;return{width:_+p,height:y+p,zoomX:h.scaleX,zoomY:h.scaleY,x:_,y}},_updateCacheCanvas:function(){var h=this.canvas;if(this.noScaleCache&&h&&h._currentTransform){var v=h._currentTransform.target,_=h._currentTransform.action;if(this===v&&_.slice&&_.slice(0,5)==="scale")return!1}var y=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),b=n.minCacheSideLimit,w=x.width,M=x.height,S,C,O=x.zoomX,k=x.zoomY,Y=w!==this.cacheWidth||M!==this.cacheHeight,H=this.zoomX!==O||this.zoomY!==k,N=Y||H,U=0,G=0,j=!1;if(Y){var q=this._cacheCanvas.width,T=this._cacheCanvas.height,P=w>q||M>T,R=(w<q*.9||M<T*.9)&&q>b&&T>b;j=P||R,P&&!x.capped&&(w>b||M>b)&&(U=w*.1,G=M*.1)}return this instanceof n.Text&&this.path&&(N=!0,j=!0,U+=this.getHeightOfLine(0)*this.zoomX,G+=this.getHeightOfLine(0)*this.zoomY),N?(j?(y.width=Math.ceil(w+U),y.height=Math.ceil(M+G)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,y.width,y.height)),S=x.x/2,C=x.y/2,this.cacheTranslationX=Math.round(y.width/2-S)+S,this.cacheTranslationY=Math.round(y.height/2-C)+C,this.cacheWidth=w,this.cacheHeight=M,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(O,k),this.zoomX=O,this.zoomY=k,!0):!1},setOptions:function(h){this._setOptions(h),this._initGradient(h.fill,"fill"),this._initGradient(h.stroke,"stroke"),this._initPattern(h.fill,"fill"),this._initPattern(h.stroke,"stroke")},transform:function(h){var v=this.group&&!this.group._transformDone||this.group&&this.canvas&&h===this.canvas.contextTop,_=this.calcTransformMatrix(!v);h.transform(_[0],_[1],_[2],_[3],_[4],_[5])},toObject:function(h){var v=n.Object.NUM_FRACTION_DIGITS,_={type:this.type,version:n.version,originX:this.originX,originY:this.originY,left:r(this.left,v),top:r(this.top,v),width:r(this.width,v),height:r(this.height,v),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,v),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,v),scaleX:r(this.scaleX,v),scaleY:r(this.scaleY,v),angle:r(this.angle,v),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,v),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,v),skewY:r(this.skewY,v)};return this.clipPath&&!this.clipPath.excludeFromExport&&(_.clipPath=this.clipPath.toObject(h),_.clipPath.inverted=this.clipPath.inverted,_.clipPath.absolutePositioned=this.clipPath.absolutePositioned),n.util.populateWithProperties(this,_,h),this.includeDefaultValues||(_=this._removeDefaultValues(_)),_},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(h){var v=n.util.getKlass(h.type).prototype,_=v.stateProperties;return _.forEach(function(y){y==="left"||y==="top"||(h[y]===v[y]&&delete h[y],Array.isArray(h[y])&&Array.isArray(v[y])&&h[y].length===0&&v[y].length===0&&delete h[y])}),h},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var h=n.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(h.scaleX),scaleY:Math.abs(h.scaleY)}},getTotalObjectScaling:function(){var h=this.getObjectScaling(),v=h.scaleX,_=h.scaleY;if(this.canvas){var y=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();v*=y*x,_*=y*x}return{scaleX:v,scaleY:_}},getObjectOpacity:function(){var h=this.opacity;return this.group&&(h*=this.group.getObjectOpacity()),h},_set:function(h,v){var _=h==="scaleX"||h==="scaleY",y=this[h]!==v,x=!1;return _&&(v=this._constrainScale(v)),h==="scaleX"&&v<0?(this.flipX=!this.flipX,v*=-1):h==="scaleY"&&v<0?(this.flipY=!this.flipY,v*=-1):h==="shadow"&&v&&!(v instanceof n.Shadow)?v=new n.Shadow(v):h==="dirty"&&this.group&&this.group.set("dirty",v),this[h]=v,y&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(h)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(h)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:n.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(h){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(h.save(),this._setupCompositeOperation(h),this.drawSelectionBackground(h),this.transform(h),this._setOpacity(h),this._setShadow(h,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(h)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(h),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),h.restore())},renderCache:function(h){h=h||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,h.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(h,v){if(h.save(),v.inverted?h.globalCompositeOperation="destination-out":h.globalCompositeOperation="destination-in",v.absolutePositioned){var _=n.util.invertTransform(this.calcTransformMatrix());h.transform(_[0],_[1],_[2],_[3],_[4],_[5])}v.transform(h),h.scale(1/v.zoomX,1/v.zoomY),h.drawImage(v._cacheCanvas,-v.cacheTranslationX,-v.cacheTranslationY),h.restore()},drawObject:function(h,v){var _=this.fill,y=this.stroke;v?(this.fill="black",this.stroke="",this._setClippingProperties(h)):this._renderBackground(h),this._render(h),this._drawClipPath(h,this.clipPath),this.fill=_,this.stroke=y},_drawClipPath:function(h,v){!v||(v.canvas=this.canvas,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCache(h,v))},drawCacheOnCanvas:function(h){h.scale(1/this.zoomX,1/this.zoomY),h.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(h){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!h&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!h){var v=this.cacheWidth/this.zoomX,_=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-v/2,-_/2,v,_)}return!0}return!1},_renderBackground:function(h){if(!!this.backgroundColor){var v=this._getNonTransformedDimensions();h.fillStyle=this.backgroundColor,h.fillRect(-v.x/2,-v.y/2,v.x,v.y),this._removeShadow(h)}},_setOpacity:function(h){this.group&&!this.group._transformDone?h.globalAlpha=this.getObjectOpacity():h.globalAlpha*=this.opacity},_setStrokeStyles:function(h,v){var _=v.stroke;_&&(h.lineWidth=v.strokeWidth,h.lineCap=v.strokeLineCap,h.lineDashOffset=v.strokeDashOffset,h.lineJoin=v.strokeLineJoin,h.miterLimit=v.strokeMiterLimit,_.toLive?_.gradientUnits==="percentage"||_.gradientTransform||_.patternTransform?this._applyPatternForTransformedGradient(h,_):(h.strokeStyle=_.toLive(h,this),this._applyPatternGradientTransform(h,_)):h.strokeStyle=v.stroke)},_setFillStyles:function(h,v){var _=v.fill;_&&(_.toLive?(h.fillStyle=_.toLive(h,this),this._applyPatternGradientTransform(h,v.fill)):h.fillStyle=_)},_setClippingProperties:function(h){h.globalAlpha=1,h.strokeStyle="transparent",h.fillStyle="#000000"},_setLineDash:function(h,v){!v||v.length===0||(1&v.length&&v.push.apply(v,v),h.setLineDash(v))},_renderControls:function(h,v){var _=this.getViewportTransform(),y=this.calcTransformMatrix(),x,b,w;v=v||{},b=typeof v.hasBorders!="undefined"?v.hasBorders:this.hasBorders,w=typeof v.hasControls!="undefined"?v.hasControls:this.hasControls,y=n.util.multiplyTransformMatrices(_,y),x=n.util.qrDecompose(y),h.save(),h.translate(x.translateX,x.translateY),h.lineWidth=1*this.borderScaleFactor,this.group||(h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(x.angle-=180),h.rotate(c(this.group?x.angle:this.angle)),v.forActiveSelection||this.group?b&&this.drawBordersInGroup(h,x,v):b&&this.drawBorders(h,v),w&&this.drawControls(h,v),h.restore()},_setShadow:function(h){if(!!this.shadow){var v=this.shadow,_=this.canvas,y,x=_&&_.viewportTransform[0]||1,b=_&&_.viewportTransform[3]||1;v.nonScaling?y={scaleX:1,scaleY:1}:y=this.getObjectScaling(),_&&_._isRetinaScaling()&&(x*=n.devicePixelRatio,b*=n.devicePixelRatio),h.shadowColor=v.color,h.shadowBlur=v.blur*n.browserShadowBlurConstant*(x+b)*(y.scaleX+y.scaleY)/4,h.shadowOffsetX=v.offsetX*x*y.scaleX,h.shadowOffsetY=v.offsetY*b*y.scaleY}},_removeShadow:function(h){!this.shadow||(h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0)},_applyPatternGradientTransform:function(h,v){if(!v||!v.toLive)return{offsetX:0,offsetY:0};var _=v.gradientTransform||v.patternTransform,y=-this.width/2+v.offsetX||0,x=-this.height/2+v.offsetY||0;return v.gradientUnits==="percentage"?h.transform(this.width,0,0,this.height,y,x):h.transform(1,0,0,1,y,x),_&&h.transform(_[0],_[1],_[2],_[3],_[4],_[5]),{offsetX:y,offsetY:x}},_renderPaintInOrder:function(h){this.paintFirst==="stroke"?(this._renderStroke(h),this._renderFill(h)):(this._renderFill(h),this._renderStroke(h))},_render:function(){},_renderFill:function(h){!this.fill||(h.save(),this._setFillStyles(h,this),this.fillRule==="evenodd"?h.fill("evenodd"):h.fill(),h.restore())},_renderStroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(h),h.save(),this.strokeUniform&&this.group){var v=this.getObjectScaling();h.scale(1/v.scaleX,1/v.scaleY)}else this.strokeUniform&&h.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(h,this.strokeDashArray),this._setStrokeStyles(h,this),h.stroke(),h.restore()}},_applyPatternForTransformedGradient:function(h,v){var _=this._limitCacheSize(this._getCacheCanvasDimensions()),y=n.util.createCanvasElement(),x,b=this.canvas.getRetinaScaling(),w=_.x/this.scaleX/b,M=_.y/this.scaleY/b;y.width=w,y.height=M,x=y.getContext("2d"),x.beginPath(),x.moveTo(0,0),x.lineTo(w,0),x.lineTo(w,M),x.lineTo(0,M),x.closePath(),x.translate(w/2,M/2),x.scale(_.zoomX/this.scaleX/b,_.zoomY/this.scaleY/b),this._applyPatternGradientTransform(x,v),x.fillStyle=v.toLive(h),x.fill(),h.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),h.scale(b*this.scaleX/_.zoomX,b*this.scaleY/_.zoomY),h.strokeStyle=x.createPattern(y,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var h=n.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",h.scaleX),this.set("scaleY",h.scaleY),this.angle=h.angle,this.skewX=h.skewX,this.skewY=0}},_removeTransformMatrix:function(h){var v=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),v=n.util.transformPoint(v,this.transformMatrix)),this.transformMatrix=null,h&&(this.scaleX*=h.scaleX,this.scaleY*=h.scaleY,this.cropX=h.cropX,this.cropY=h.cropY,v.x+=h.offsetLeft,v.y+=h.offsetTop,this.width=h.width,this.height=h.height),this.setPositionByOrigin(v,"center","center")},clone:function(h,v){var _=this.toObject(v);this.constructor.fromObject?this.constructor.fromObject(_,h):n.Object._fromObject("Object",_,h)},cloneAsImage:function(h,v){var _=this.toCanvasElement(v);return h&&h(new n.Image(_)),this},toCanvasElement:function(h){h||(h={});var v=n.util,_=v.saveObjectTransform(this),y=this.group,x=this.shadow,b=Math.abs,w=(h.multiplier||1)*(h.enableRetinaScaling?n.devicePixelRatio:1);delete this.group,h.withoutTransform&&v.resetObjectTransform(this),h.withoutShadow&&(this.shadow=null);var M=n.util.createCanvasElement(),S=this.getBoundingRect(!0,!0),C=this.shadow,O,k={x:0,y:0},Y,H,N;C&&(Y=C.blur,C.nonScaling?O={scaleX:1,scaleY:1}:O=this.getObjectScaling(),k.x=2*Math.round(b(C.offsetX)+Y)*b(O.scaleX),k.y=2*Math.round(b(C.offsetY)+Y)*b(O.scaleY)),H=S.width+k.x,N=S.height+k.y,M.width=Math.ceil(H),M.height=Math.ceil(N);var U=new n.StaticCanvas(M,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});h.format==="jpeg"&&(U.backgroundColor="#fff"),this.setPositionByOrigin(new n.Point(U.width/2,U.height/2),"center","center");var G=this.canvas;U.add(this);var j=U.toCanvasElement(w||1,h);return this.shadow=x,this.set("canvas",G),y&&(this.group=y),this.set(_).setCoords(),U._objects=[],U.dispose(),U=null,j},toDataURL:function(h){return h||(h={}),n.util.toDataURL(this.toCanvasElement(h),h.format||"png",h.quality||1)},isType:function(h){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===h},complexity:function(){return 1},toJSON:function(h){return this.toObject(h)},rotate:function(h){var v=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return v&&this._setOriginToCenter(),this.set("angle",h),v&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(h,v){v=v||this.canvas.getPointer(h);var _=new n.Point(v.x,v.y),y=this._getLeftTopCoords();return this.angle&&(_=n.util.rotatePoint(_,y,c(-this.angle))),{x:_.x-y.x,y:_.y-y.y}},_setupCompositeOperation:function(h){this.globalCompositeOperation&&(h.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){n.runningAnimations&&n.runningAnimations.cancelByTarget(this)}}),n.util.createAccessors&&n.util.createAccessors(n.Object),o(n.Object.prototype,n.Observable),n.Object.NUM_FRACTION_DIGITS=2,n.Object.ENLIVEN_PROPS=["clipPath"],n.Object._fromObject=function(h,v,_,y){var x=n[h];v=f(v,!0),n.util.enlivenPatterns([v.fill,v.stroke],function(b){typeof b[0]!="undefined"&&(v.fill=b[0]),typeof b[1]!="undefined"&&(v.stroke=b[1]),n.util.enlivenObjectEnlivables(v,v,function(){var w=y?new x(v[y],v):new x(v);_&&_(w)})})},n.Object.__uid=0)}(m),function(){var s=e.util.degreesToRadians,n={left:-.5,center:0,right:.5},o={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(f,r,l,c,d){var p=f.x,h=f.y,v,_,y;return typeof r=="string"?r=n[r]:r-=.5,typeof c=="string"?c=n[c]:c-=.5,v=c-r,typeof l=="string"?l=o[l]:l-=.5,typeof d=="string"?d=o[d]:d-=.5,_=d-l,(v||_)&&(y=this._getTransformedDimensions(),p=f.x+v*y.x,h=f.y+_*y.y),new e.Point(p,h)},translateToCenterPoint:function(f,r,l){var c=this.translateToGivenOrigin(f,r,l,"center","center");return this.angle?e.util.rotatePoint(c,f,s(this.angle)):c},translateToOriginPoint:function(f,r,l){var c=this.translateToGivenOrigin(f,"center","center",r,l);return this.angle?e.util.rotatePoint(c,f,s(this.angle)):c},getCenterPoint:function(){var f=new e.Point(this.left,this.top);return this.translateToCenterPoint(f,this.originX,this.originY)},getPointByOrigin:function(f,r){var l=this.getCenterPoint();return this.translateToOriginPoint(l,f,r)},toLocalPoint:function(f,r,l){var c=this.getCenterPoint(),d,p;return typeof r!="undefined"&&typeof l!="undefined"?d=this.translateToGivenOrigin(c,"center","center",r,l):d=new e.Point(this.left,this.top),p=new e.Point(f.x,f.y),this.angle&&(p=e.util.rotatePoint(p,c,-s(this.angle))),p.subtractEquals(d)},setPositionByOrigin:function(f,r,l){var c=this.translateToCenterPoint(f,r,l),d=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",d.x),this.set("top",d.y)},adjustPosition:function(f){var r=s(this.angle),l=this.getScaledWidth(),c=e.util.cos(r)*l,d=e.util.sin(r)*l,p,h;typeof this.originX=="string"?p=n[this.originX]:p=this.originX-.5,typeof f=="string"?h=n[f]:h=f-.5,this.left+=c*(h-p),this.top+=d*(h-p),this.setCoords(),this.originX=f},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var f=this.getCenterPoint();this.originX="center",this.originY="center",this.left=f.x,this.top=f.y},_resetOrigin:function(){var f=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=f.x,this.top=f.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function s(l){return[new e.Point(l.tl.x,l.tl.y),new e.Point(l.tr.x,l.tr.y),new e.Point(l.br.x,l.br.y),new e.Point(l.bl.x,l.bl.y)]}var n=e.util,o=n.degreesToRadians,f=n.multiplyTransformMatrices,r=n.transformPoint;n.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(l,c){return c?l?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),l?this.aCoords:this.lineCoords)},getCoords:function(l,c){return s(this._getCoords(l,c))},intersectsWithRect:function(l,c,d,p){var h=this.getCoords(d,p),v=e.Intersection.intersectPolygonRectangle(h,l,c);return v.status==="Intersection"},intersectsWithObject:function(l,c,d){var p=e.Intersection.intersectPolygonPolygon(this.getCoords(c,d),l.getCoords(c,d));return p.status==="Intersection"||l.isContainedWithinObject(this,c,d)||this.isContainedWithinObject(l,c,d)},isContainedWithinObject:function(l,c,d){for(var p=this.getCoords(c,d),h=c?l.aCoords:l.lineCoords,v=0,_=l._getImageLines(h);v<4;v++)if(!l.containsPoint(p[v],_))return!1;return!0},isContainedWithinRect:function(l,c,d,p){var h=this.getBoundingRect(d,p);return h.left>=l.x&&h.left+h.width<=c.x&&h.top>=l.y&&h.top+h.height<=c.y},containsPoint:function(l,v,d,p){var h=this._getCoords(d,p),v=v||this._getImageLines(h),_=this._findCrossPoints(l,v);return _!==0&&_%2===1},isOnScreen:function(l){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br,p=this.getCoords(!0,l);return p.some(function(h){return h.x<=d.x&&h.x>=c.x&&h.y<=d.y&&h.y>=c.y})||this.intersectsWithRect(c,d,!0,l)?!0:this._containsCenterOfCanvas(c,d,l)},_containsCenterOfCanvas:function(l,c,d){var p={x:(l.x+c.x)/2,y:(l.y+c.y)/2};return!!this.containsPoint(p,null,!0,d)},isPartiallyOnScreen:function(l){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,d=this.canvas.vptCoords.br;if(this.intersectsWithRect(c,d,!0,l))return!0;var p=this.getCoords(!0,l).every(function(h){return(h.x>=d.x||h.x<=c.x)&&(h.y>=d.y||h.y<=c.y)});return p&&this._containsCenterOfCanvas(c,d,l)},_getImageLines:function(l){var c={topline:{o:l.tl,d:l.tr},rightline:{o:l.tr,d:l.br},bottomline:{o:l.br,d:l.bl},leftline:{o:l.bl,d:l.tl}};return c},_findCrossPoints:function(l,c){var d,p,h,v,_,y=0,x;for(var b in c)if(x=c[b],!(x.o.y<l.y&&x.d.y<l.y)&&!(x.o.y>=l.y&&x.d.y>=l.y)&&(x.o.x===x.d.x&&x.o.x>=l.x?_=x.o.x:(d=0,p=(x.d.y-x.o.y)/(x.d.x-x.o.x),h=l.y-d*l.x,v=x.o.y-p*x.o.x,_=-(h-v)/(d-p)),_>=l.x&&(y+=1),y===2))break;return y},getBoundingRect:function(l,c){var d=this.getCoords(l,c);return n.makeBoundingBoxFromPoints(d)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(l){return Math.abs(l)<this.minScaleLimit?l<0?-this.minScaleLimit:this.minScaleLimit:l===0?1e-4:l},scale:function(l){return this._set("scaleX",l),this._set("scaleY",l),this.setCoords()},scaleToWidth:function(l,c){var d=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(l/this.width/d)},scaleToHeight:function(l,c){var d=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(l/this.height/d)},calcLineCoords:function(){var l=this.getViewportTransform(),c=this.padding,d=o(this.angle),p=n.cos(d),h=n.sin(d),v=p*c,_=h*c,y=v+_,x=v-_,b=this.calcACoords(),w={tl:r(b.tl,l),tr:r(b.tr,l),bl:r(b.bl,l),br:r(b.br,l)};return c&&(w.tl.x-=x,w.tl.y-=y,w.tr.x+=y,w.tr.y-=x,w.bl.x-=y,w.bl.y+=x,w.br.x+=x,w.br.y+=y),w},calcOCoords:function(){var l=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),d=this.getViewportTransform(),p=f(d,c),h=f(p,l),h=f(h,[1/d[0],0,0,1/d[3],0,0]),v=this._calculateCurrentDimensions(),_={};return this.forEachControl(function(y,x,b){_[x]=y.positionHandler(v,h,b)}),_},calcACoords:function(){var l=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),d=f(c,l),p=this._getTransformedDimensions(),h=p.x/2,v=p.y/2;return{tl:r({x:-h,y:-v},d),tr:r({x:h,y:-v},d),bl:r({x:-h,y:v},d),br:r({x:h,y:v},d)}},setCoords:function(l){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),l?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return n.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var l=this.getCenterPoint();return[1,0,0,1,l.x,l.y]},transformMatrixKey:function(l){var c="_",d="";return!l&&this.group&&(d=this.group.transformMatrixKey(l)+c),d+this.top+c+this.left+c+this.scaleX+c+this.scaleY+c+this.skewX+c+this.skewY+c+this.angle+c+this.originX+c+this.originY+c+this.width+c+this.height+c+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(l){var c=this.calcOwnMatrix();if(l||!this.group)return c;var d=this.transformMatrixKey(l),p=this.matrixCache||(this.matrixCache={});return p.key===d?p.value:(this.group&&(c=f(this.group.calcTransformMatrix(!1),c)),p.key=d,p.value=c,c)},calcOwnMatrix:function(){var l=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===l)return c.value;var d=this._calcTranslateMatrix(),p={angle:this.angle,translateX:d[4],translateY:d[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return c.key=l,c.value=n.composeMatrix(p),c.value},_getNonTransformedDimensions:function(){var l=this.strokeWidth,c=this.width+l,d=this.height+l;return{x:c,y:d}},_getTransformedDimensions:function(l,c){typeof l=="undefined"&&(l=this.skewX),typeof c=="undefined"&&(c=this.skewY);var d,p,h,v=l===0&&c===0;if(this.strokeUniform?(p=this.width,h=this.height):(d=this._getNonTransformedDimensions(),p=d.x,h=d.y),v)return this._finalizeDimensions(p*this.scaleX,h*this.scaleY);var _=n.sizeAfterTransform(p,h,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:l,skewY:c});return this._finalizeDimensions(_.x,_.y)},_finalizeDimensions:function(l,c){return this.strokeUniform?{x:l+this.strokeWidth,y:c+this.strokeWidth}:{x:l,y:c}},_calculateCurrentDimensions:function(){var l=this.getViewportTransform(),c=this._getTransformedDimensions(),d=r(c,l,!0);return d.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(s){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,s):this.canvas&&this.canvas.sendBackwards(this,s),this},bringForward:function(s){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,s):this.canvas&&this.canvas.bringForward(this,s),this},moveTo:function(s){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,s):this.canvas&&this.canvas.moveTo(this,s),this}}),function(){function s(o,f){if(f){if(f.toLive)return o+": url(#SVGID_"+f.id+"); ";var r=new e.Color(f),l=o+": "+r.toRgb()+"; ",c=r.getAlpha();return c!==1&&(l+=o+"-opacity: "+c.toString()+"; "),l}else return o+": none; "}var n=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(o){var f=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",l=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",d=this.strokeLineCap?this.strokeLineCap:"butt",p=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",v=typeof this.opacity!="undefined"?this.opacity:"1",_=this.visible?"":" visibility: hidden;",y=o?"":this.getSvgFilter(),x=s("fill",this.fill),b=s("stroke",this.stroke);return[b,"stroke-width: ",r,"; ","stroke-dasharray: ",l,"; ","stroke-linecap: ",d,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",p,"; ","stroke-miterlimit: ",h,"; ",x,"fill-rule: ",f,"; ","opacity: ",v,";",y,_].join("")},getSvgSpanStyles:function(o,f){var r="; ",c=o.fontFamily?"font-family: "+(o.fontFamily.indexOf("'")===-1&&o.fontFamily.indexOf('"')===-1?"'"+o.fontFamily+"'":o.fontFamily)+r:"",l=o.strokeWidth?"stroke-width: "+o.strokeWidth+r:"",c=c,d=o.fontSize?"font-size: "+o.fontSize+"px"+r:"",p=o.fontStyle?"font-style: "+o.fontStyle+r:"",h=o.fontWeight?"font-weight: "+o.fontWeight+r:"",v=o.fill?s("fill",o.fill):"",_=o.stroke?s("stroke",o.stroke):"",y=this.getSvgTextDecoration(o),x=o.deltaY?"baseline-shift: "+-o.deltaY+"; ":"";return y&&(y="text-decoration: "+y+r),[_,l,c,d,p,h,y,v,x,f?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(o){return["overline","underline","line-through"].filter(function(f){return o[f.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(o,f){var r=o?this.calcTransformMatrix():this.calcOwnMatrix(),l='transform="'+e.util.matrixToSVG(r);return l+(f||"")+'" '},_setSVGBg:function(o){if(this.backgroundColor){var f=e.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',n(-this.width/2,f),'" y="',n(-this.height/2,f),'" width="',n(this.width,f),'" height="',n(this.height,f),`"></rect>
`)}},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(o),{reviver:o})},toClipPathSVG:function(o){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(o),{reviver:o})},_createBaseClipPathSVGMarkup:function(o,f){f=f||{};var r=f.reviver,l=f.additionalTransform||"",c=[this.getSvgTransform(!0,l),this.getSvgCommons()].join(""),d=o.indexOf("COMMON_PARTS");return o[d]=c,r?r(o.join("")):o.join("")},_createBaseSVGMarkup:function(o,f){f=f||{};var r=f.noStyle,l=f.reviver,c=r?"":'style="'+this.getSvgStyles()+'" ',d=f.withShadow?'style="'+this.getSvgFilter()+'" ':"",p=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",v=p&&p.absolutePositioned,_=this.stroke,y=this.fill,x=this.shadow,b,w=[],M,S=o.indexOf("COMMON_PARTS"),C=f.additionalTransform;return p&&(p.clipPathId="CLIPPATH_"+e.Object.__uid++,M='<clipPath id="'+p.clipPathId+`" >
`+p.toClipPathSVG(l)+`</clipPath>
`),v&&w.push("<g ",d,this.getSvgCommons(),` >
`),w.push("<g ",this.getSvgTransform(!1),v?"":d+this.getSvgCommons(),` >
`),b=[c,h,r?"":this.addPaintOrder()," ",C?'transform="'+C+'" ':""].join(""),o[S]=b,y&&y.toLive&&w.push(y.toSVG(this)),_&&_.toLive&&w.push(_.toSVG(this)),x&&w.push(x.toSVG(this)),p&&w.push(M),w.push(o.join("")),w.push(`</g>
`),v&&w.push(`</g>
`),l?l(w.join("")):w.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var s=e.util.object.extend,n="stateProperties";function o(r,l,c){var d={},p=!0;c.forEach(function(h){d[h]=r[h]}),s(r[l],d,p)}function f(r,l,c){if(r===l)return!0;if(Array.isArray(r)){if(!Array.isArray(l)||r.length!==l.length)return!1;for(var d=0,p=r.length;d<p;d++)if(!f(r[d],l[d]))return!1;return!0}else if(r&&typeof r=="object"){var h=Object.keys(r),v;if(!l||typeof l!="object"||!c&&h.length!==Object.keys(l).length)return!1;for(var d=0,p=h.length;d<p;d++)if(v=h[d],!(v==="canvas"||v==="group")&&!f(r[v],l[v]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(r){r=r||n;var l="_"+r;return Object.keys(this[l]).length<this[r].length?!0:!f(this[l],this,!0)},saveState:function(r){var l=r&&r.propertySet||n,c="_"+l;return this[c]?(o(this,c,this[l]),r&&r.stateProperties&&o(this,c,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var l=r.propertySet||n;return r.propertySet=l,this["_"+l]={},this.saveState(r),this}})}(),function(){var s=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(n,o){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f=n.x,r=n.y,l,c,d=Object.keys(this.oCoords),p=d.length-1,h;for(this.__corner=0;p>=0;p--)if(h=d[p],!!this.isControlVisible(h)&&(c=this._getImageLines(o?this.oCoords[h].touchCorner:this.oCoords[h].corner),l=this._findCrossPoints({x:f,y:r},c),l!==0&&l%2===1))return this.__corner=h,h;return!1},forEachControl:function(n){for(var o in this.controls)n(this.controls[o],o,this)},_setCornerCoords:function(){var n=this.oCoords;for(var o in n){var f=this.controls[o];n[o].corner=f.calcCornerCoords(this.angle,this.cornerSize,n[o].x,n[o].y,!1),n[o].touchCorner=f.calcCornerCoords(this.angle,this.touchCornerSize,n[o].x,n[o].y,!0)}},drawSelectionBackground:function(n){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;n.save();var o=this.getCenterPoint(),f=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return n.translate(o.x,o.y),n.scale(1/r[0],1/r[3]),n.rotate(s(this.angle)),n.fillStyle=this.selectionBackgroundColor,n.fillRect(-f.x/2,-f.y/2,f.x,f.y),n.restore(),this},drawBorders:function(n,o){o=o||{};var f=this._calculateCurrentDimensions(),r=this.borderScaleFactor,l=f.x+r,c=f.y+r,d=typeof o.hasControls!="undefined"?o.hasControls:this.hasControls,p=!1;return n.save(),n.strokeStyle=o.borderColor||this.borderColor,this._setLineDash(n,o.borderDashArray||this.borderDashArray),n.strokeRect(-l/2,-c/2,l,c),d&&(n.beginPath(),this.forEachControl(function(h,v,_){h.withConnection&&h.getVisibility(_,v)&&(p=!0,n.moveTo(h.x*l,h.y*c),n.lineTo(h.x*l+h.offsetX,h.y*c+h.offsetY))}),p&&n.stroke()),n.restore(),this},drawBordersInGroup:function(n,o,f){f=f||{};var r=e.util.sizeAfterTransform(this.width,this.height,o),l=this.strokeWidth,c=this.strokeUniform,d=this.borderScaleFactor,p=r.x+l*(c?this.canvas.getZoom():o.scaleX)+d,h=r.y+l*(c?this.canvas.getZoom():o.scaleY)+d;return n.save(),this._setLineDash(n,f.borderDashArray||this.borderDashArray),n.strokeStyle=f.borderColor||this.borderColor,n.strokeRect(-p/2,-h/2,p,h),n.restore(),this},drawControls:function(n,o){o=o||{},n.save();var f=this.canvas.getRetinaScaling(),r,l;return n.setTransform(f,0,0,f,0,0),n.strokeStyle=n.fillStyle=o.cornerColor||this.cornerColor,this.transparentCorners||(n.strokeStyle=o.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(n,o.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(c,d,p){l=p.oCoords[d],c.getVisibility(p,d)&&(r&&(l=e.util.transformPoint(l,r)),c.render(n,l.x,l.y,o,p))}),n.restore(),this},isControlVisible:function(n){return this.controls[n]&&this.controls[n].getVisibility(this,n)},setControlVisible:function(n,o){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[n]=o,this},setControlsVisibility:function(n){n||(n={});for(var o in n)this.setControlVisible(o,n[o]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(s,n){n=n||{};var o=function(){},f=n.onComplete||o,r=n.onChange||o,l=this;return e.util.animate({target:this,startValue:s.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){s.set("left",c),l.requestRenderAll(),r()},onComplete:function(){s.setCoords(),f()}})},fxCenterObjectV:function(s,n){n=n||{};var o=function(){},f=n.onComplete||o,r=n.onChange||o,l=this;return e.util.animate({target:this,startValue:s.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){s.set("top",c),l.requestRenderAll(),r()},onComplete:function(){s.setCoords(),f()}})},fxRemove:function(s,n){n=n||{};var o=function(){},f=n.onComplete||o,r=n.onChange||o,l=this;return e.util.animate({target:this,startValue:s.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){s.set("opacity",c),l.requestRenderAll(),r()},onComplete:function(){l.remove(s),f()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var s=[],n,o,f=[];for(n in arguments[0])s.push(n);for(var r=0,l=s.length;r<l;r++)n=s[r],o=r!==l-1,f.push(this._animate(n,arguments[0][n],arguments[1],o));return f}else return this._animate.apply(this,arguments)},_animate:function(s,n,o,f){var r=this,l;n=n.toString(),o?o=e.util.object.clone(o):o={},~s.indexOf(".")&&(l=s.split("."));var c=r.colorProperties.indexOf(s)>-1||l&&r.colorProperties.indexOf(l[1])>-1,d=l?this.get(l[0])[l[1]]:this.get(s);"from"in o||(o.from=d),c||(~n.indexOf("=")?n=d+parseFloat(n.replace("=","")):n=parseFloat(n));var p={target:this,startValue:o.from,endValue:n,byValue:o.by,easing:o.easing,duration:o.duration,abort:o.abort&&function(h,v,_){return o.abort.call(r,h,v,_)},onChange:function(h,v,_){l?r[l[0]][l[1]]=h:r.set(s,h),!f&&o.onChange&&o.onChange(h,v,_)},onComplete:function(h,v,_){f||(r.setCoords(),o.onComplete&&o.onComplete(h,v,_))}};return c?e.util.animateColor(p.startValue,p.endValue,p.duration,p):e.util.animate(p)}}),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(n.Line){n.warn("fabric.Line is already defined");return}n.Line=n.util.createClass(n.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:n.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,d){c||(c=[0,0,0,0]),this.callSuper("initialize",d),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(d)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,d){return this.callSuper("_set",c,d),typeof r[c]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:l({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:l({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var d=this.calcLinePoints();c.moveTo(d.x1,d.y1),c.lineTo(d.x2,d.y2),c.lineWidth=this.strokeWidth;var p=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=p},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return o(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,p=c*this.width*.5,h=d*this.height*.5,v=c*this.width*-.5,_=d*this.height*-.5;return{x1:p,x2:v,y1:h,y2:_}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),n.Line.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),n.Line.fromElement=function(c,d,p){p=p||{};var h=n.parseAttributes(c,n.Line.ATTRIBUTE_NAMES),v=[h.x1||0,h.y1||0,h.x2||0,h.y2||0];d(new n.Line(v,o(h,p)))},n.Line.fromObject=function(c,d){function p(v){delete v.points,d&&d(v)}var h=f(c,!0);h.points=[c.x1,c.y1,c.x2,c.y2],n.Object._fromObject("Line",h,p,"points")};function l(c,d){var p=c.origin,h=c.axis1,v=c.axis2,_=c.dimension,y=d.nearest,x=d.center,b=d.farthest;return function(){switch(this.get(p)){case y:return Math.min(this.get(h),this.get(v));case x:return Math.min(this.get(h),this.get(v))+.5*this.get(_);case b:return Math.max(this.get(h),this.get(v))}}}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.degreesToRadians;if(n.Circle){n.warn("fabric.Circle is already defined.");return}n.Circle=n.util.createClass(n.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:n.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,l){return this.callSuper("_set",r,l),r==="radius"&&this.setRadius(l),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,l=0,c=0,d=(this.endAngle-this.startAngle)%360;if(d===0)r=["<circle ","COMMON_PARTS",'cx="'+l+'" cy="'+c+'" ','r="',this.radius,`" />
`];else{var p=o(this.startAngle),h=o(this.endAngle),v=this.radius,_=n.util.cos(p)*v,y=n.util.sin(p)*v,x=n.util.cos(h)*v,b=n.util.sin(h)*v,w=d>180?"1":"0";r=['<path d="M '+_+" "+y," A "+v+" "+v," 0 ",+w+" 1"," "+x+" "+b,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,o(this.startAngle),o(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),n.Circle.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),n.Circle.fromElement=function(r,l){var c=n.parseAttributes(r,n.Circle.ATTRIBUTE_NAMES);if(!f(c))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,l(new n.Circle(c))};function f(r){return"radius"in r&&r.radius>=0}n.Circle.fromObject=function(r,l){n.Object._fromObject("Circle",r,l)}}(m),function(s){var n=s.fabric||(s.fabric={});if(n.Triangle){n.warn("fabric.Triangle is already defined");return}n.Triangle=n.util.createClass(n.Object,{type:"triangle",width:100,height:100,_render:function(o){var f=this.width/2,r=this.height/2;o.beginPath(),o.moveTo(-f,r),o.lineTo(0,-r),o.lineTo(f,r),o.closePath(),this._renderPaintInOrder(o)},_toSVG:function(){var o=this.width/2,f=this.height/2,r=[-o+" "+f,"0 "+-f,o+" "+f].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),n.Triangle.fromObject=function(o,f){return n.Object._fromObject("Triangle",o,f)}}(m),function(s){var n=s.fabric||(s.fabric={}),o=Math.PI*2;if(n.Ellipse){n.warn("fabric.Ellipse is already defined.");return}n.Ellipse=n.util.createClass(n.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this.set("rx",f&&f.rx||0),this.set("ry",f&&f.ry||0)},_set:function(f,r){switch(this.callSuper("_set",f,r),f){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,o,!1),f.restore(),this._renderPaintInOrder(f)}}),n.Ellipse.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),n.Ellipse.fromElement=function(f,r){var l=n.parseAttributes(f,n.Ellipse.ATTRIBUTE_NAMES);l.left=(l.left||0)-l.rx,l.top=(l.top||0)-l.ry,r(new n.Ellipse(l))},n.Ellipse.fromObject=function(f,r){n.Object._fromObject("Ellipse",f,r)}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend;if(n.Rect){n.warn("fabric.Rect is already defined");return}n.Rect=n.util.createClass(n.Object,{stateProperties:n.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:n.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(f){var r=this.rx?Math.min(this.rx,this.width/2):0,l=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,d=this.height,p=-this.width/2,h=-this.height/2,v=r!==0||l!==0,_=1-.5522847498;f.beginPath(),f.moveTo(p+r,h),f.lineTo(p+c-r,h),v&&f.bezierCurveTo(p+c-_*r,h,p+c,h+_*l,p+c,h+l),f.lineTo(p+c,h+d-l),v&&f.bezierCurveTo(p+c,h+d-_*l,p+c-_*r,h+d,p+c-r,h+d),f.lineTo(p+r,h+d),v&&f.bezierCurveTo(p+_*r,h+d,p,h+d-_*l,p,h+d-l),f.lineTo(p,h+l),v&&f.bezierCurveTo(p,h+_*l,p+_*r,h,p+r,h),f.closePath(),this._renderPaintInOrder(f)},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){var f=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',f,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),n.Rect.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),n.Rect.fromElement=function(f,r,l){if(!f)return r(null);l=l||{};var c=n.parseAttributes(f,n.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var d=new n.Rect(o(l?n.util.object.clone(l):{},c));d.visible=d.visible&&d.width>0&&d.height>0,r(d)},n.Rect.fromObject=function(f,r){return n.Object._fromObject("Rect",f,r)}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.util.array.min,r=n.util.array.max,l=n.util.toFixed,c=n.util.projectStrokeOnPoints;if(n.Polyline){n.warn("fabric.Polyline is already defined");return}n.Polyline=n.util.createClass(n.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:n.Object.prototype.cacheProperties.concat("points"),initialize:function(d,p){p=p||{},this.points=d||[],this.callSuper("initialize",p),this._setPositionDimensions(p)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(d){var p=this._calcDimensions(d),h,v=this.exactBoundingBox?this.strokeWidth:0;this.width=p.width-v,this.height=p.height-v,d.fromSVG||(h=this.translateToGivenOrigin({x:p.left-this.strokeWidth/2+v/2,y:p.top-this.strokeWidth/2+v/2},"left","top",this.originX,this.originY)),typeof d.left=="undefined"&&(this.left=d.fromSVG?p.left:h.x),typeof d.top=="undefined"&&(this.top=d.fromSVG?p.top:h.y),this.pathOffset={x:p.left+this.width/2+v/2,y:p.top+this.height/2+v/2}},_calcDimensions:function(){var d=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,p=f(d,"x")||0,h=f(d,"y")||0,v=r(d,"x")||0,_=r(d,"y")||0,y=v-p,x=_-h;return{left:p,top:h,width:y,height:x}},toObject:function(d){return o(this.callSuper("toObject",d),{points:this.points.concat()})},_toSVG:function(){for(var d=[],p=this.pathOffset.x,h=this.pathOffset.y,v=n.Object.NUM_FRACTION_DIGITS,_=0,y=this.points.length;_<y;_++)d.push(l(this.points[_].x-p,v),",",l(this.points[_].y-h,v)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',d.join(""),`" />
`]},commonRender:function(d){var p,h=this.points.length,v=this.pathOffset.x,_=this.pathOffset.y;if(!h||isNaN(this.points[h-1].y))return!1;d.beginPath(),d.moveTo(this.points[0].x-v,this.points[0].y-_);for(var y=0;y<h;y++)p=this.points[y],d.lineTo(p.x-v,p.y-_);return!0},_render:function(d){!this.commonRender(d)||this._renderPaintInOrder(d)},complexity:function(){return this.get("points").length}}),n.Polyline.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polyline.fromElementGenerator=function(d){return function(p,h,v){if(!p)return h(null);v||(v={});var _=n.parsePointsAttribute(p.getAttribute("points")),y=n.parseAttributes(p,n[d].ATTRIBUTE_NAMES);y.fromSVG=!0,h(new n[d](_,o(y,v)))}},n.Polyline.fromElement=n.Polyline.fromElementGenerator("Polyline"),n.Polyline.fromObject=function(d,p){return n.Object._fromObject("Polyline",d,p,"points")}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.projectStrokeOnPoints;if(n.Polygon){n.warn("fabric.Polygon is already defined");return}n.Polygon=n.util.createClass(n.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return o(this.points,this)},_render:function(f){!this.commonRender(f)||(f.closePath(),this._renderPaintInOrder(f))}}),n.Polygon.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(),n.Polygon.fromElement=n.Polyline.fromElementGenerator("Polygon"),n.Polygon.fromObject=function(f,r){n.Object._fromObject("Polygon",f,r,"points")}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.array.min,f=n.util.array.max,r=n.util.object.extend,l=n.util.object.clone,c=n.util.toFixed;if(n.Path){n.warn("fabric.Path is already defined");return}n.Path=n.util.createClass(n.Object,{type:"path",path:null,cacheProperties:n.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:n.Object.prototype.stateProperties.concat("path"),initialize:function(d,p){p=l(p||{}),delete p.path,this.callSuper("initialize",p),this._setPath(d||[],p)},_setPath:function(d,p){this.path=n.util.makePathSimpler(Array.isArray(d)?d:n.util.parsePath(d)),n.Polyline.prototype._setPositionDimensions.call(this,p||{})},_renderPathCommands:function(d){var p,h=0,v=0,_=0,y=0,x=0,b=0,w=-this.pathOffset.x,M=-this.pathOffset.y;d.beginPath();for(var S=0,C=this.path.length;S<C;++S)switch(p=this.path[S],p[0]){case"L":_=p[1],y=p[2],d.lineTo(_+w,y+M);break;case"M":_=p[1],y=p[2],h=_,v=y,d.moveTo(_+w,y+M);break;case"C":_=p[5],y=p[6],x=p[3],b=p[4],d.bezierCurveTo(p[1]+w,p[2]+M,x+w,b+M,_+w,y+M);break;case"Q":d.quadraticCurveTo(p[1]+w,p[2]+M,p[3]+w,p[4]+M),_=p[3],y=p[4],x=p[1],b=p[2];break;case"z":case"Z":_=h,y=v,d.closePath();break}},_render:function(d){this._renderPathCommands(d),this._renderPaintInOrder(d)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){return r(this.callSuper("toObject",d),{path:this.path.map(function(p){return p.slice()})})},toDatalessObject:function(d){var p=this.toObject(["sourcePath"].concat(d));return p.sourcePath&&delete p.path,p},_toSVG:function(){var d=n.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',d,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var d=n.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,d)+", "+c(-this.pathOffset.y,d)+")"},toClipPathSVG:function(d){var p=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},toSVG:function(d){var p=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,additionalTransform:p})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var d=[],p=[],h,v=0,_=0,y=0,x=0,b,w=0,M=this.path.length;w<M;++w){switch(h=this.path[w],h[0]){case"L":y=h[1],x=h[2],b=[];break;case"M":y=h[1],x=h[2],v=y,_=x,b=[];break;case"C":b=n.util.getBoundsOfCurve(y,x,h[1],h[2],h[3],h[4],h[5],h[6]),y=h[5],x=h[6];break;case"Q":b=n.util.getBoundsOfCurve(y,x,h[1],h[2],h[1],h[2],h[3],h[4]),y=h[3],x=h[4];break;case"z":case"Z":y=v,x=_;break}b.forEach(function(N){d.push(N.x),p.push(N.y)}),d.push(y),p.push(x)}var S=o(d)||0,C=o(p)||0,O=f(d)||0,k=f(p)||0,Y=O-S,H=k-C;return{left:S,top:C,width:Y,height:H}}}),n.Path.fromObject=function(d,p){if(typeof d.sourcePath=="string"){var h=d.sourcePath;n.loadSVGFromURL(h,function(v){var _=v[0];_.setOptions(d),d.clipPath?n.util.enlivenObjects([d.clipPath],function(y){_.clipPath=y[0],p&&p(_)}):p&&p(_)})}else n.Object._fromObject("Path",d,p,"path")},n.Path.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat(["d"]),n.Path.fromElement=function(d,p,h){var v=n.parseAttributes(d,n.Path.ATTRIBUTE_NAMES);v.fromSVG=!0,p(new n.Path(v.d,r(v,h)))}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.array.min,f=n.util.array.max;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,l,c){l=l||{},this._objects=[],c&&this.callSuper("initialize",l),this._objects=r||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;if(c)this._updateObjectsACoords();else{var p=l&&l.centerPoint;l.originX!==void 0&&(this.originX=l.originX),l.originY!==void 0&&(this.originY=l.originY),p||this._calcBounds(),this._updateObjectsCoords(p),delete l.centerPoint,this.callSuper("initialize",l)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,l=this._objects.length;l--;)this._objects[l].setCoords(r)},_updateObjectsCoords:function(l){for(var l=l||this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],l)},_updateObjectCoords:function(r,l){var c=r.left,d=r.top,p=!0;r.set({left:c-l.x,top:d-l.y}),r.group=this,r.setCoords(p)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var l=!!this.group;return this._restoreObjectsState(),n.util.resetObjectTransform(this),r&&(l&&n.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,l?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,l){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(r,l);if(r==="canvas")for(;c--;)this._objects[c]._set(r,l);n.Object.prototype._set.call(this,r,l)},toObject:function(r){var l=this.includeDefaultValues,c=this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){var h=p.includeDefaultValues;p.includeDefaultValues=l;var v=p.toObject(r);return p.includeDefaultValues=h,v}),d=n.Object.prototype.toObject.call(this,r);return d.objects=c,d},toDatalessObject:function(r){var l,c=this.sourcePath;if(c)l=c;else{var d=this.includeDefaultValues;l=this._objects.map(function(h){var v=h.includeDefaultValues;h.includeDefaultValues=d;var _=h.toDatalessObject(r);return h.includeDefaultValues=v,_})}var p=n.Object.prototype.toDatalessObject.call(this,r);return p.objects=l,p},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=n.Object.prototype.shouldCache.call(this);if(r){for(var l=0,c=this._objects.length;l<c;l++)if(this._objects[l].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(n.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,l=this._objects.length;r<l;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var l=0,c=this._objects.length;l<c;l++)this._objects[l].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var l=0,c=this._objects.length;l<c;l++)if(this._objects[l].isCacheDirty(!0)){if(this._cacheCanvas){var d=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-d/2,-p/2,d,p)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(l){n.util.addTransformToObject(l,r),delete l.group,l.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(!!this.canvas){var r=this._objects,l=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var d=new n.ActiveSelection([]);return d.set(c),d.type="activeSelection",l.remove(this),r.forEach(function(p){p.group=d,p.dirty=!0,l.add(p)}),d.canvas=l,d._objects=r,l._activeObject=d,d.setCoords(),d}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(l){l.setCoords(r)}),this},_calcBounds:function(r){for(var l=[],c=[],d,p,h,v=["tr","br","bl","tl"],_=0,y=this._objects.length,x,b=v.length;_<y;++_){for(d=this._objects[_],h=d.calcACoords(),x=0;x<b;x++)p=v[x],l.push(h[p].x),c.push(h[p].y);d.aCoords=h}this._getBounds(l,c,r)},_getBounds:function(r,l,c){var d=new n.Point(o(r),o(l)),p=new n.Point(f(r),f(l)),h=d.y||0,v=d.x||0,_=p.x-d.x||0,y=p.y-d.y||0;this.width=_,this.height=y,c||this.setPositionByOrigin({x:v,y:h},"left","top")},_toSVG:function(r){for(var l=["<g ","COMMON_PARTS",` >
`],c=0,d=this._objects.length;c<d;c++)l.push("		",this._objects[c].toSVG(r));return l.push(`</g>
`),l},getSvgStyles:function(){var r=typeof this.opacity!="undefined"&&this.opacity!==1?"opacity: "+this.opacity+";":"",l=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),l].join("")},toClipPathSVG:function(r){for(var l=[],c=0,d=this._objects.length;c<d;c++)l.push("	",this._objects[c].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(l,{reviver:r})}}),n.Group.fromObject=function(r,l){var c=r.objects,d=n.util.object.clone(r,!0);if(delete d.objects,typeof c=="string"){n.loadSVGFromURL(c,function(p){var h=n.util.groupSVGElements(p,r,c),v=d.clipPath;delete d.clipPath,h.set(d),v?n.util.enlivenObjects([v],function(_){h.clipPath=_[0],l&&l(h)}):l&&l(h)});return}n.util.enlivenObjects(c,function(p){n.util.enlivenObjectEnlivables(r,d,function(){l&&l(new n.Group(p,d,!0))})})})}(m),function(s){var n=s.fabric||(s.fabric={});n.ActiveSelection||(n.ActiveSelection=n.util.createClass(n.Group,{type:"activeSelection",initialize:function(o,f){f=f||{},this._objects=o||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;f.originX&&(this.originX=f.originX),f.originY&&(this.originY=f.originY),this._calcBounds(),this._updateObjectsCoords(),n.Object.prototype.initialize.call(this,f),this.setCoords()},toGroup:function(){var o=this._objects.concat();this._objects=[];var f=n.Object.prototype.toObject.call(this),r=new n.Group([]);if(delete f.type,r.set(f),o.forEach(function(c){c.canvas.remove(c),c.group=r}),r._objects=o,!this.canvas)return r;var l=this.canvas;return l.add(r),l._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(o,f,r){o.save(),o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",o,f),r=r||{},typeof r.hasControls=="undefined"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var l=0,c=this._objects.length;l<c;l++)this._objects[l]._renderControls(o,r);o.restore()}}),n.ActiveSelection.fromObject=function(o,f){n.util.enlivenObjects(o.objects,function(r){delete o.objects,f&&f(new n.ActiveSelection(r,o,!0))})})}(m),function(s){var n=e.util.object.extend;if(s.fabric||(s.fabric={}),s.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(o,f){f||(f={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",f),this._initElement(o,f)},getElement:function(){return this._element||{}},setElement:function(o,f){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=o,this._originalElement=o,this._initConfig(f),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(o){var f=e.filterBackend;f&&f.evictCachesForKey&&f.evictCachesForKey(o)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(o){e.util.cleanUpJsdomNode(this[o]),this[o]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var o=this.getElement();return{width:o.naturalWidth||o.width,height:o.naturalHeight||o.height}},_stroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){var f=this.width/2,r=this.height/2;o.beginPath(),o.moveTo(-f,-r),o.lineTo(f,-r),o.lineTo(f,r),o.lineTo(-f,r),o.lineTo(-f,-r),o.closePath()}},toObject:function(o){var f=[];this.filters.forEach(function(l){l&&f.push(l.toObject())});var r=n(this.callSuper("toObject",["cropX","cropY"].concat(o)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var o=[],f=[],r,l=this._element,c=-this.width/2,d=-this.height/2,p="",h="";if(!l)return[];if(this.hasCrop()){var v=e.Object.__uid++;o.push('<clipPath id="imageCrop_'+v+`">
`,'	<rect x="'+c+'" y="'+d+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),p=' clip-path="url(#imageCrop_'+v+')" '}if(this.imageSmoothing||(h='" image-rendering="optimizeSpeed'),f.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',d-this.cropY,'" width="',l.width||l.naturalWidth,'" height="',l.height||l.height,h,'"',p,`></image>
`),this.stroke||this.strokeDashArray){var _=this.fill;this.fill=null,r=["	<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=_}return this.paintFirst!=="fill"?o=o.concat(r,f):o=o.concat(f,r),o},getSrc:function(o){var f=o?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src"):f.src:this.src||""},setSrc:function(o,f,r){return e.util.loadImage(o,function(l,c){this.setElement(l,r),this._setWidthHeight(),f&&f(this,c)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var o=this.resizeFilter,f=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),l=r.scaleX,c=r.scaleY,d=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!o||l>f&&c>f){this._element=d,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=l,this._lastScaleY=c;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var p=e.util.createCanvasElement(),h=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,v=d.width,_=d.height;p.width=v,p.height=_,this._element=p,this._lastScaleX=o.scaleX=l,this._lastScaleY=o.scaleY=c,e.filterBackend.applyFilters([o],d,v,_,this._element,h),this._filterScalingX=p.width/this._originalElement.width,this._filterScalingY=p.height/this._originalElement.height},applyFilters:function(o){if(o=o||this.filters||[],o=o.filter(function(d){return d&&!d.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),o.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var f=this._originalElement,r=f.naturalWidth||f.width,l=f.naturalHeight||f.height;if(this._element===this._originalElement){var c=e.util.createCanvasElement();c.width=r,c.height=l,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,l),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(o,this._originalElement,r,l,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(o){e.util.setImageSmoothing(o,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(o),this._renderPaintInOrder(o)},drawCacheOnCanvas:function(o){e.util.setImageSmoothing(o,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,o)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(o){var f=this._element;if(!!f){var r=this._filterScalingX,l=this._filterScalingY,c=this.width,d=this.height,p=Math.min,h=Math.max,v=h(this.cropX,0),_=h(this.cropY,0),y=f.naturalWidth||f.width,x=f.naturalHeight||f.height,b=v*r,w=_*l,M=p(c*r,y-b),S=p(d*l,x-w),C=-c/2,O=-d/2,k=p(c,y/r-v),Y=p(d,x/l-_);f&&o.drawImage(f,b,w,M,S,C,O,k,Y)}},_needsResize:function(){var o=this.getTotalObjectScaling();return o.scaleX!==this._lastScaleX||o.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(o,f){this.setElement(e.util.getById(o),f),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(o){o||(o={}),this.setOptions(o),this._setWidthHeight(o)},_initFilters:function(o,f){o&&o.length?e.util.enlivenObjects(o,function(r){f&&f(r)},"fabric.Image.filters"):f&&f()},_setWidthHeight:function(o){o||(o={});var f=this.getElement();this.width=o.width||f.naturalWidth||f.width||0,this.height=o.height||f.naturalHeight||f.height||0},parsePreserveAspectRatioAttribute:function(){var o=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),f=this._element.width,r=this._element.height,l=1,c=1,d=0,p=0,h=0,v=0,_,y=this.width,x=this.height,b={width:y,height:x};return o&&(o.alignX!=="none"||o.alignY!=="none")?(o.meetOrSlice==="meet"&&(l=c=e.util.findScaleToFit(this._element,b),_=(y-f*l)/2,o.alignX==="Min"&&(d=-_),o.alignX==="Max"&&(d=_),_=(x-r*c)/2,o.alignY==="Min"&&(p=-_),o.alignY==="Max"&&(p=_)),o.meetOrSlice==="slice"&&(l=c=e.util.findScaleToCover(this._element,b),_=f-y/l,o.alignX==="Mid"&&(h=_/2),o.alignX==="Max"&&(h=_),_=r-x/c,o.alignY==="Mid"&&(v=_/2),o.alignY==="Max"&&(v=_),f=y/l,r=x/c)):(l=y/f,c=x/r),{width:f,height:r,scaleX:l,scaleY:c,offsetLeft:d,offsetTop:p,cropX:h,cropY:v}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(o,f){var r=e.util.object.clone(o);e.util.loadImage(r.src,function(l,c){if(c){f&&f(null,!0);return}e.Image.prototype._initFilters.call(r,r.filters,function(d){r.filters=d||[],e.Image.prototype._initFilters.call(r,[r.resizeFilter],function(p){r.resizeFilter=p[0],e.util.enlivenObjectEnlivables(r,r,function(){var h=new e.Image(l,r);f(h,!1)})})})},null,r.crossOrigin)},e.Image.fromURL=function(o,f,r){e.util.loadImage(o,function(l,c){f&&f(new e.Image(l,r),c)},null,r&&r.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(o,f,r){var l=e.parseAttributes(o,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(l["xlink:href"],f,n(r?e.util.object.clone(r):{},l))}}(m),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var s=this.angle%360;return s>0?Math.round((s-1)/90)*90:Math.round(s/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(s){s=s||{};var n=function(){},o=s.onComplete||n,f=s.onChange||n,r=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){r.rotate(l),f()},onComplete:function(){r.setCoords(),o()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(s){return s.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(s){return s.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function s(o,f){var r="precision "+f+` float;
void main(){}`,l=o.createShader(o.FRAGMENT_SHADER);return o.shaderSource(l,r),o.compileShader(l),!!o.getShaderParameter(l,o.COMPILE_STATUS)}e.isWebglSupported=function(o){if(e.isLikelyNode)return!1;o=o||e.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas"),r=f.getContext("webgl")||f.getContext("experimental-webgl"),l=!1;if(r){e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),l=e.maxTextureSize>=o;for(var c=["highp","mediump","lowp"],d=0;d<3;d++)if(s(r,c[d])){e.webGlPrecision=c[d];break}}return this.isSupported=l,l},e.WebglFilterBackend=n;function n(o){o&&o.tileSize&&(this.tileSize=o.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}n.prototype={tileSize:2048,resources:{},setupGLContext:function(o,f){this.dispose(),this.createWebGLCanvas(o,f),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(o,f)},chooseFastestCopyGLTo2DMethod:function(o,f){var r=typeof window.performance!="undefined",l;try{new ImageData(1,1),l=!0}catch{l=!1}var c=typeof ArrayBuffer!="undefined",d=typeof Uint8ClampedArray!="undefined";if(!!(r&&l&&c&&d)){var p=e.util.createCanvasElement(),h=new ArrayBuffer(o*f*4);if(e.forceGLPutImageData){this.imageBuffer=h,this.copyGLTo2D=g;return}var v={imageBuffer:h,destinationWidth:o,destinationHeight:f,targetCanvas:p},_,y,x;p.width=o,p.height=f,_=window.performance.now(),u.call(v,this.gl,v),y=window.performance.now()-_,_=window.performance.now(),g.call(v,this.gl,v),x=window.performance.now()-_,y>x?(this.imageBuffer=h,this.copyGLTo2D=g):this.copyGLTo2D=u}},createWebGLCanvas:function(o,f){var r=e.util.createCanvasElement();r.width=o,r.height=f;var l={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=r.getContext("webgl",l);c||(c=r.getContext("experimental-webgl",l)),c&&(c.clearColor(0,0,0,0),this.canvas=r,this.gl=c)},applyFilters:function(o,f,r,l,c,d){var p=this.gl,h;d&&(h=this.getCachedTexture(d,f));var v={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:r,sourceHeight:l,destinationWidth:r,destinationHeight:l,context:p,sourceTexture:this.createTexture(p,r,l,!h&&f),targetTexture:this.createTexture(p,r,l),originalTexture:h||this.createTexture(p,r,l,!h&&f),passes:o.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},_=p.createFramebuffer();return p.bindFramebuffer(p.FRAMEBUFFER,_),o.forEach(function(y){y&&y.applyTo(v)}),a(v),this.copyGLTo2D(p,v),p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(v.sourceTexture),p.deleteTexture(v.targetTexture),p.deleteFramebuffer(_),c.getContext("2d").setTransform(1,0,0,1,0,0),v},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(o,f,r,l,c){var d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,c||o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,c||o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),l?o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,l):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,f,r,0,o.RGBA,o.UNSIGNED_BYTE,null),d},getCachedTexture:function(o,f){if(this.textureCache[o])return this.textureCache[o];var r=this.createTexture(this.gl,f.width,f.height,f);return this.textureCache[o]=r,r},evictCachesForKey:function(o){this.textureCache[o]&&(this.gl.deleteTexture(this.textureCache[o]),delete this.textureCache[o])},copyGLTo2D:u,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var o=this.gl,f={renderer:"",vendor:""};if(!o)return f;var r=o.getExtension("WEBGL_debug_renderer_info");if(r){var l=o.getParameter(r.UNMASKED_RENDERER_WEBGL),c=o.getParameter(r.UNMASKED_VENDOR_WEBGL);l&&(f.renderer=l.toLowerCase()),c&&(f.vendor=c.toLowerCase())}return this.gpuInfo=f,f}}}();function a(s){var n=s.targetCanvas,o=n.width,f=n.height,r=s.destinationWidth,l=s.destinationHeight;(o!==r||f!==l)&&(n.width=r,n.height=l)}function u(s,n){var o=s.canvas,f=n.targetCanvas,r=f.getContext("2d");r.translate(0,f.height),r.scale(1,-1);var l=o.height-f.height;r.drawImage(o,0,l,f.width,f.height,0,0,f.width,f.height)}function g(s,n){var o=n.targetCanvas,f=o.getContext("2d"),r=n.destinationWidth,l=n.destinationHeight,c=r*l*4,d=new Uint8Array(this.imageBuffer,0,c),p=new Uint8ClampedArray(this.imageBuffer,0,c);s.readPixels(0,0,r,l,s.RGBA,s.UNSIGNED_BYTE,d);var h=new ImageData(p,r,l);f.putImageData(h,0,0)}(function(){var s=function(){};e.Canvas2dFilterBackend=n;function n(){}n.prototype={evictCachesForKey:s,dispose:s,clearWebGLCaches:s,resources:{},applyFilters:function(o,f,r,l,c){var d=c.getContext("2d");d.drawImage(f,0,0,r,l);var p=d.getImageData(0,0,r,l),h=d.getImageData(0,0,r,l),v={sourceWidth:r,sourceHeight:l,imageData:p,originalEl:f,originalImageData:h,canvasEl:c,ctx:d,filterBackend:this};return o.forEach(function(_){_.applyTo(v)}),(v.imageData.width!==r||v.imageData.height!==l)&&(c.width=v.imageData.width,c.height=v.imageData.height),d.putImageData(v.imageData,0,0),v}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(s){s&&this.setOptions(s)},setOptions:function(s){for(var n in s)this[n]=s[n]},createProgram:function(s,n,o){n=n||this.fragmentSource,o=o||this.vertexSource,e.webGlPrecision!=="highp"&&(n=n.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var f=s.createShader(s.VERTEX_SHADER);if(s.shaderSource(f,o),s.compileShader(f),!s.getShaderParameter(f,s.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+s.getShaderInfoLog(f));var r=s.createShader(s.FRAGMENT_SHADER);if(s.shaderSource(r,n),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+s.getShaderInfoLog(r));var l=s.createProgram();if(s.attachShader(l,f),s.attachShader(l,r),s.linkProgram(l),!s.getProgramParameter(l,s.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+s.getProgramInfoLog(l));var c=this.getAttributeLocations(s,l),d=this.getUniformLocations(s,l)||{};return d.uStepW=s.getUniformLocation(l,"uStepW"),d.uStepH=s.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:c,uniformLocations:d}},getAttributeLocations:function(s,n){return{aPosition:s.getAttribLocation(n,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(s,n,o){var f=n.aPosition,r=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,r),s.enableVertexAttribArray(f),s.vertexAttribPointer(f,2,s.FLOAT,!1,0,0),s.bufferData(s.ARRAY_BUFFER,o,s.STATIC_DRAW)},_setupFrameBuffer:function(s){var n=s.context,o,f;s.passes>1?(o=s.destinationWidth,f=s.destinationHeight,(s.sourceWidth!==o||s.sourceHeight!==f)&&(n.deleteTexture(s.targetTexture),s.targetTexture=s.filterBackend.createTexture(n,o,f)),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s.targetTexture,0)):(n.bindFramebuffer(n.FRAMEBUFFER,null),n.finish())},_swapTextures:function(s){s.passes--,s.pass++;var n=s.targetTexture;s.targetTexture=s.sourceTexture,s.sourceTexture=n},isNeutralState:function(){var s=this.mainParameter,n=e.Image.filters[this.type].prototype;if(s)if(Array.isArray(n[s])){for(var o=n[s].length;o--;)if(this[s][o]!==n[s][o])return!1;return!0}else return n[s]===this[s];else return!1},applyTo:function(s){s.webgl?(this._setupFrameBuffer(s),this.applyToWebGL(s),this._swapTextures(s)):this.applyTo2d(s)},retrieveShader:function(s){return s.programCache.hasOwnProperty(this.type)||(s.programCache[this.type]=this.createProgram(s.context)),s.programCache[this.type]},applyToWebGL:function(s){var n=s.context,o=this.retrieveShader(s);s.pass===0&&s.originalTexture?n.bindTexture(n.TEXTURE_2D,s.originalTexture):n.bindTexture(n.TEXTURE_2D,s.sourceTexture),n.useProgram(o.program),this.sendAttributeData(n,o.attributeLocations,s.aPosition),n.uniform1f(o.uniformLocations.uStepW,1/s.sourceWidth),n.uniform1f(o.uniformLocations.uStepH,1/s.sourceHeight),this.sendUniformData(n,o.uniformLocations),n.viewport(0,0,s.destinationWidth,s.destinationHeight),n.drawArrays(n.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(s,n,o){s.activeTexture(o),s.bindTexture(s.TEXTURE_2D,n),s.activeTexture(s.TEXTURE0)},unbindAdditionalTexture:function(s,n){s.activeTexture(n),s.bindTexture(s.TEXTURE_2D,null),s.activeTexture(s.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(s){this[this.mainParameter]=s},sendUniformData:function(){},createHelpLayer:function(s){if(!s.helpLayer){var n=document.createElement("canvas");n.width=s.sourceWidth,n.height=s.sourceHeight,s.helpLayer=n}},toObject:function(){var s={type:this.type},n=this.mainParameter;return n&&(s[n]=this[n]),s},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(s,n){var o=new e.Image.filters[s.type](s);return n&&n(o),o},function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.ColorMatrix=f(o.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var l=r.imageData,c=l.data,d=c.length,p=this.matrix,h,v,_,y,x,b=this.colorsOnly;for(x=0;x<d;x+=4)h=c[x],v=c[x+1],_=c[x+2],b?(c[x]=h*p[0]+v*p[1]+_*p[2]+p[4]*255,c[x+1]=h*p[5]+v*p[6]+_*p[7]+p[9]*255,c[x+2]=h*p[10]+v*p[11]+_*p[12]+p[14]*255):(y=c[x+3],c[x]=h*p[0]+v*p[1]+_*p[2]+y*p[3]+p[4]*255,c[x+1]=h*p[5]+v*p[6]+_*p[7]+y*p[8]+p[9]*255,c[x+2]=h*p[10]+v*p[11]+_*p[12]+y*p[13]+p[14]*255,c[x+3]=h*p[15]+v*p[16]+_*p[17]+y*p[18]+p[19]*255)},getUniformLocations:function(r,l){return{uColorMatrix:r.getUniformLocation(l,"uColorMatrix"),uConstants:r.getUniformLocation(l,"uConstants")}},sendUniformData:function(r,l){var c=this.matrix,d=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],p=[c[4],c[9],c[14],c[19]];r.uniformMatrix4fv(l.uColorMatrix,!1,d),r.uniform4fv(l.uConstants,p)}}),n.Image.filters.ColorMatrix.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Brightness=f(o.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var l=r.imageData,c=l.data,d,p=c.length,h=Math.round(this.brightness*255);for(d=0;d<p;d+=4)c[d]=c[d]+h,c[d+1]=c[d+1]+h,c[d+2]=c[d+2]+h}},getUniformLocations:function(r,l){return{uBrightness:r.getUniformLocation(l,"uBrightness")}},sendUniformData:function(r,l){r.uniform1f(l.uBrightness,this.brightness)}}),n.Image.filters.Brightness.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.Image.filters,r=n.util.createClass;f.Convolute=r(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(l){var c=Math.sqrt(this.matrix.length),d=this.type+"_"+c+"_"+(this.opaque?1:0),p=this.fragmentSource[d];return l.programCache.hasOwnProperty(d)||(l.programCache[d]=this.createProgram(l.context,p)),l.programCache[d]},applyTo2d:function(l){var c=l.imageData,d=c.data,p=this.matrix,h=Math.round(Math.sqrt(p.length)),v=Math.floor(h/2),_=c.width,y=c.height,x=l.ctx.createImageData(_,y),b=x.data,w=this.opaque?1:0,M,S,C,O,k,Y,H,N,U,G,j,q,T;for(j=0;j<y;j++)for(G=0;G<_;G++){for(k=(j*_+G)*4,M=0,S=0,C=0,O=0,T=0;T<h;T++)for(q=0;q<h;q++)H=j+T-v,Y=G+q-v,!(H<0||H>=y||Y<0||Y>=_)&&(N=(H*_+Y)*4,U=p[T*h+q],M+=d[N]*U,S+=d[N+1]*U,C+=d[N+2]*U,w||(O+=d[N+3]*U));b[k]=M,b[k+1]=S,b[k+2]=C,w?b[k+3]=d[k+3]:b[k+3]=O}l.imageData=x},getUniformLocations:function(l,c){return{uMatrix:l.getUniformLocation(c,"uMatrix"),uOpaque:l.getUniformLocation(c,"uOpaque"),uHalfSize:l.getUniformLocation(c,"uHalfSize"),uSize:l.getUniformLocation(c,"uSize")}},sendUniformData:function(l,c){l.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return o(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),n.Image.filters.Convolute.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Grayscale=f(o.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var l=r.imageData,c=l.data,d,p=c.length,h,v=this.mode;for(d=0;d<p;d+=4)v==="average"?h=(c[d]+c[d+1]+c[d+2])/3:v==="lightness"?h=(Math.min(c[d],c[d+1],c[d+2])+Math.max(c[d],c[d+1],c[d+2]))/2:v==="luminosity"&&(h=.21*c[d]+.72*c[d+1]+.07*c[d+2]),c[d]=h,c[d+1]=h,c[d+2]=h},retrieveShader:function(r){var l=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(l)){var c=this.fragmentSource[this.mode];r.programCache[l]=this.createProgram(r.context,c)}return r.programCache[l]},getUniformLocations:function(r,l){return{uMode:r.getUniformLocation(l,"uMode")}},sendUniformData:function(r,l){var c=1;r.uniform1i(l.uMode,c)},isNeutralState:function(){return!1}}),n.Image.filters.Grayscale.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Invert=f(o.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var l=r.imageData,c=l.data,d,p=c.length;for(d=0;d<p;d+=4)c[d]=255-c[d],c[d+1]=255-c[d+1],c[d+2]=255-c[d+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,l){return{uInvert:r.getUniformLocation(l,"uInvert")}},sendUniformData:function(r,l){r.uniform1i(l.uInvert,this.invert)}}),n.Image.filters.Invert.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.Image.filters,r=n.util.createClass;f.Noise=r(f.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(l){if(this.noise!==0){var c=l.imageData,d=c.data,p,h=d.length,v=this.noise,_;for(p=0,h=d.length;p<h;p+=4)_=(.5-Math.random())*v,d[p]+=_,d[p+1]+=_,d[p+2]+=_}},getUniformLocations:function(l,c){return{uNoise:l.getUniformLocation(c,"uNoise"),uSeed:l.getUniformLocation(c,"uSeed")}},sendUniformData:function(l,c){l.uniform1f(c.uNoise,this.noise/255),l.uniform1f(c.uSeed,Math.random())},toObject:function(){return o(this.callSuper("toObject"),{noise:this.noise})}}),n.Image.filters.Noise.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Pixelate=f(o.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var l=r.imageData,c=l.data,d=l.height,p=l.width,h,v,_,y,x,b,w,M,S,C,O;for(v=0;v<d;v+=this.blocksize)for(_=0;_<p;_+=this.blocksize)for(h=v*4*p+_*4,y=c[h],x=c[h+1],b=c[h+2],w=c[h+3],C=Math.min(v+this.blocksize,d),O=Math.min(_+this.blocksize,p),M=v;M<C;M++)for(S=_;S<O;S++)h=M*4*p+S*4,c[h]=y,c[h+1]=x,c[h+2]=b,c[h+3]=w},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,l){return{uBlocksize:r.getUniformLocation(l,"uBlocksize"),uStepW:r.getUniformLocation(l,"uStepW"),uStepH:r.getUniformLocation(l,"uStepH")}},sendUniformData:function(r,l){r.uniform1f(l.uBlocksize,this.blocksize)}}),n.Image.filters.Pixelate.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.extend,f=n.Image.filters,r=n.util.createClass;f.RemoveColor=r(f.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(l){var c=l.imageData,d=c.data,p,h=this.distance*255,v,_,y,x=new n.Color(this.color).getSource(),b=[x[0]-h,x[1]-h,x[2]-h],w=[x[0]+h,x[1]+h,x[2]+h];for(p=0;p<d.length;p+=4)v=d[p],_=d[p+1],y=d[p+2],v>b[0]&&_>b[1]&&y>b[2]&&v<w[0]&&_<w[1]&&y<w[2]&&(d[p+3]=0)},getUniformLocations:function(l,c){return{uLow:l.getUniformLocation(c,"uLow"),uHigh:l.getUniformLocation(c,"uHigh")}},sendUniformData:function(l,c){var d=new n.Color(this.color).getSource(),p=parseFloat(this.distance),h=[0+d[0]/255-p,0+d[1]/255-p,0+d[2]/255-p,1],v=[d[0]/255+p,d[1]/255+p,d[2]/255+p,1];l.uniform4fv(c.uLow,h),l.uniform4fv(c.uHigh,v)},toObject:function(){return o(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),n.Image.filters.RemoveColor.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var l in r)o[l]=f(o.ColorMatrix,{type:l,matrix:r[l],mainParameter:!1,colorsOnly:!0}),n.Image.filters[l].fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric,o=n.Image.filters,f=n.util.createClass;o.BlendColor=f(o.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var l=this.type+"_"+this.mode,c;return r.programCache.hasOwnProperty(l)||(c=this.buildSource(this.mode),r.programCache[l]=this.createProgram(r.context,c)),r.programCache[l]},applyTo2d:function(r){var l=r.imageData,c=l.data,d=c.length,p,h,v,_,y,x,b,w=1-this.alpha;b=new n.Color(this.color).getSource(),p=b[0]*this.alpha,h=b[1]*this.alpha,v=b[2]*this.alpha;for(var M=0;M<d;M+=4)switch(_=c[M],y=c[M+1],x=c[M+2],this.mode){case"multiply":c[M]=_*p/255,c[M+1]=y*h/255,c[M+2]=x*v/255;break;case"screen":c[M]=255-(255-_)*(255-p)/255,c[M+1]=255-(255-y)*(255-h)/255,c[M+2]=255-(255-x)*(255-v)/255;break;case"add":c[M]=_+p,c[M+1]=y+h,c[M+2]=x+v;break;case"diff":case"difference":c[M]=Math.abs(_-p),c[M+1]=Math.abs(y-h),c[M+2]=Math.abs(x-v);break;case"subtract":c[M]=_-p,c[M+1]=y-h,c[M+2]=x-v;break;case"darken":c[M]=Math.min(_,p),c[M+1]=Math.min(y,h),c[M+2]=Math.min(x,v);break;case"lighten":c[M]=Math.max(_,p),c[M+1]=Math.max(y,h),c[M+2]=Math.max(x,v);break;case"overlay":c[M]=p<128?2*_*p/255:255-2*(255-_)*(255-p)/255,c[M+1]=h<128?2*y*h/255:255-2*(255-y)*(255-h)/255,c[M+2]=v<128?2*x*v/255:255-2*(255-x)*(255-v)/255;break;case"exclusion":c[M]=p+_-2*p*_/255,c[M+1]=h+y-2*h*y/255,c[M+2]=v+x-2*v*x/255;break;case"tint":c[M]=p+_*w,c[M+1]=h+y*w,c[M+2]=v+x*w}},getUniformLocations:function(r,l){return{uColor:r.getUniformLocation(l,"uColor")}},sendUniformData:function(r,l){var c=new n.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,r.uniform4fv(l.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendColor.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric,o=n.Image.filters,f=n.util.createClass;o.BlendImage=f(o.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var l=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(l)||(r.programCache[l]=this.createProgram(r.context,c)),r.programCache[l]},applyToWebGL:function(r){var l=r.context,c=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(l,c,l.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(l,l.TEXTURE1)},createTexture:function(r,l){return r.getCachedTexture(l.cacheKey,l._element)},calculateMatrix:function(){var r=this.image,l=r._element.width,c=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/l,-r.top/c,1]},applyTo2d:function(r){var l=r.imageData,c=r.filterBackend.resources,d=l.data,p=d.length,h=l.width,v=l.height,_,y,x,b,w,M,S,C,O,k,Y=this.image,H;c.blendImage||(c.blendImage=n.util.createCanvasElement()),O=c.blendImage,k=O.getContext("2d"),O.width!==h||O.height!==v?(O.width=h,O.height=v):k.clearRect(0,0,h,v),k.setTransform(Y.scaleX,0,0,Y.scaleY,Y.left,Y.top),k.drawImage(Y._element,0,0,h,v),H=k.getImageData(0,0,h,v).data;for(var N=0;N<p;N+=4)switch(w=d[N],M=d[N+1],S=d[N+2],C=d[N+3],_=H[N],y=H[N+1],x=H[N+2],b=H[N+3],this.mode){case"multiply":d[N]=w*_/255,d[N+1]=M*y/255,d[N+2]=S*x/255,d[N+3]=C*b/255;break;case"mask":d[N+3]=b;break}},getUniformLocations:function(r,l){return{uTransformMatrix:r.getUniformLocation(l,"uTransformMatrix"),uImage:r.getUniformLocation(l,"uImage")}},sendUniformData:function(r,l){var c=this.calculateMatrix();r.uniform1i(l.uImage,1),r.uniformMatrix3fv(l.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),n.Image.filters.BlendImage.fromObject=function(r,l){n.Image.fromObject(r.image,function(c){var d=n.util.object.clone(r);d.image=c,l(new n.Image.filters.BlendImage(d))})}}(m),function(s){var n=s.fabric||(s.fabric={}),o=Math.pow,f=Math.floor,r=Math.sqrt,l=Math.abs,c=Math.round,d=Math.sin,p=Math.ceil,h=n.Image.filters,v=n.util.createClass;h.Resize=v(h.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(_,y){return{uDelta:_.getUniformLocation(y,"uDelta"),uTaps:_.getUniformLocation(y,"uTaps")}},sendUniformData:function(_,y){_.uniform2fv(y.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),_.uniform1fv(y.uTaps,this.taps)},retrieveShader:function(_){var y=this.getFilterWindow(),x=this.type+"_"+y;if(!_.programCache.hasOwnProperty(x)){var b=this.generateShader(y);_.programCache[x]=this.createProgram(_.context,b)}return _.programCache[x]},getFilterWindow:function(){var _=this.tempScale;return Math.ceil(this.lanczosLobes/_)},getTaps:function(){for(var _=this.lanczosCreate(this.lanczosLobes),y=this.tempScale,x=this.getFilterWindow(),b=new Array(x),w=1;w<=x;w++)b[w-1]=_(w*y);return b},generateShader:function(b){for(var y=new Array(b),x=this.fragmentSourceTOP,b,w=1;w<=b;w++)y[w-1]=w+".0 * uDelta";return x+="uniform float uTaps["+b+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,y.forEach(function(M,S){x+="  color += texture2D(uTexture, vTexCoord + "+M+") * uTaps["+S+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+M+") * uTaps["+S+`];
`,x+="  sum += 2.0 * uTaps["+S+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}",x},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(_){_.webgl?(_.passes++,this.width=_.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=_.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),_.destinationWidth=this.dW,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceWidth=_.destinationWidth,this.height=_.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),_.destinationHeight=this.dH,this._setupFrameBuffer(_),this.applyToWebGL(_),this._swapTextures(_),_.sourceHeight=_.destinationHeight):this.applyTo2d(_)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(_){return function(y){if(y>=_||y<=-_)return 0;if(y<11920929e-14&&y>-11920929e-14)return 1;y*=Math.PI;var x=y/_;return d(y)/y*d(x)/x}},applyTo2d:function(_){var y=_.imageData,x=this.scaleX,b=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/b;var w=y.width,M=y.height,S=c(w*x),C=c(M*b),O;this.resizeType==="sliceHack"?O=this.sliceByTwo(_,w,M,S,C):this.resizeType==="hermite"?O=this.hermiteFastResize(_,w,M,S,C):this.resizeType==="bilinear"?O=this.bilinearFiltering(_,w,M,S,C):this.resizeType==="lanczos"&&(O=this.lanczosResize(_,w,M,S,C)),_.imageData=O},sliceByTwo:function(_,y,x,b,w){var M=_.imageData,S=.5,C=!1,O=!1,k=y*S,Y=x*S,H=n.filterBackend.resources,N,U,G=0,j=0,q=y,T=0;for(H.sliceByTwo||(H.sliceByTwo=document.createElement("canvas")),N=H.sliceByTwo,(N.width<y*1.5||N.height<x)&&(N.width=y*1.5,N.height=x),U=N.getContext("2d"),U.clearRect(0,0,y*1.5,x),U.putImageData(M,0,0),b=f(b),w=f(w);!C||!O;)y=k,x=Y,b<f(k*S)?k=f(k*S):(k=b,C=!0),w<f(Y*S)?Y=f(Y*S):(Y=w,O=!0),U.drawImage(N,G,j,y,x,q,T,k,Y),G=q,j=T,T+=Y;return U.getImageData(G,j,b,w)},lanczosResize:function(_,y,x,b,w){function M(R){var L,V,I,E,F,K,ee,Z,J,ae,ue;for(T.x=(R+.5)*Y,P.x=f(T.x),L=0;L<w;L++){for(T.y=(L+.5)*H,P.y=f(T.y),F=0,K=0,ee=0,Z=0,J=0,V=P.x-G;V<=P.x+G;V++)if(!(V<0||V>=y)){ae=f(1e3*l(V-T.x)),q[ae]||(q[ae]={});for(var Q=P.y-j;Q<=P.y+j;Q++)Q<0||Q>=x||(ue=f(1e3*l(Q-T.y)),q[ae][ue]||(q[ae][ue]=k(r(o(ae*N,2)+o(ue*U,2))/1e3)),I=q[ae][ue],I>0&&(E=(Q*y+V)*4,F+=I,K+=I*S[E],ee+=I*S[E+1],Z+=I*S[E+2],J+=I*S[E+3]))}E=(L*b+R)*4,O[E]=K/F,O[E+1]=ee/F,O[E+2]=Z/F,O[E+3]=J/F}return++R<b?M(R):C}var S=_.imageData.data,C=_.ctx.createImageData(b,w),O=C.data,k=this.lanczosCreate(this.lanczosLobes),Y=this.rcpScaleX,H=this.rcpScaleY,N=2/this.rcpScaleX,U=2/this.rcpScaleY,G=p(Y*this.lanczosLobes/2),j=p(H*this.lanczosLobes/2),q={},T={},P={};return M(0)},bilinearFiltering:function(_,y,x,b,w){var M,S,C,O,k,Y,H,N,U,G,j,q,T=0,P,R=this.rcpScaleX,L=this.rcpScaleY,V=4*(y-1),I=_.imageData,E=I.data,F=_.ctx.createImageData(b,w),K=F.data;for(H=0;H<w;H++)for(N=0;N<b;N++)for(k=f(R*N),Y=f(L*H),U=R*N-k,G=L*H-Y,P=4*(Y*y+k),j=0;j<4;j++)M=E[P+j],S=E[P+4+j],C=E[P+V+j],O=E[P+V+4+j],q=M*(1-U)*(1-G)+S*U*(1-G)+C*G*(1-U)+O*U*G,K[T++]=q;return F},hermiteFastResize:function(_,y,x,b,w){for(var M=this.rcpScaleX,S=this.rcpScaleY,C=p(M/2),O=p(S/2),k=_.imageData,Y=k.data,H=_.ctx.createImageData(b,w),N=H.data,U=0;U<w;U++)for(var G=0;G<b;G++){for(var j=(G+U*b)*4,q=0,T=0,P=0,R=0,L=0,V=0,I=0,E=(U+.5)*S,F=f(U*S);F<(U+1)*S;F++)for(var K=l(E-(F+.5))/O,ee=(G+.5)*M,Z=K*K,J=f(G*M);J<(G+1)*M;J++){var ae=l(ee-(J+.5))/C,ue=r(Z+ae*ae);ue>1&&ue<-1||(q=2*ue*ue*ue-3*ue*ue+1,q>0&&(ae=4*(J+F*y),I+=q*Y[ae+3],P+=q,Y[ae+3]<255&&(q=q*Y[ae+3]/250),R+=q*Y[ae],L+=q*Y[ae+1],V+=q*Y[ae+2],T+=q))}N[j]=R/T,N[j+1]=L/T,N[j+2]=V/T,N[j+3]=I/P}return H},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),n.Image.filters.Resize.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Contrast=f(o.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var l=r.imageData,c,p,d=l.data,p=d.length,h=Math.floor(this.contrast*255),v=259*(h+255)/(255*(259-h));for(c=0;c<p;c+=4)d[c]=v*(d[c]-128)+128,d[c+1]=v*(d[c+1]-128)+128,d[c+2]=v*(d[c+2]-128)+128}},getUniformLocations:function(r,l){return{uContrast:r.getUniformLocation(l,"uContrast")}},sendUniformData:function(r,l){r.uniform1f(l.uContrast,this.contrast)}}),n.Image.filters.Contrast.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Saturation=f(o.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var l=r.imageData,c=l.data,d=c.length,p=-this.saturation,h,v;for(h=0;h<d;h+=4)v=Math.max(c[h],c[h+1],c[h+2]),c[h]+=v!==c[h]?(v-c[h])*p:0,c[h+1]+=v!==c[h+1]?(v-c[h+1])*p:0,c[h+2]+=v!==c[h+2]?(v-c[h+2])*p:0}},getUniformLocations:function(r,l){return{uSaturation:r.getUniformLocation(l,"uSaturation")}},sendUniformData:function(r,l){r.uniform1f(l.uSaturation,-this.saturation)}}),n.Image.filters.Saturation.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Vibrance=f(o.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var l=r.imageData,c=l.data,d=c.length,p=-this.vibrance,h,v,_,y;for(h=0;h<d;h+=4)v=Math.max(c[h],c[h+1],c[h+2]),_=(c[h]+c[h+1]+c[h+2])/3,y=Math.abs(v-_)*2/255*p,c[h]+=v!==c[h]?(v-c[h])*y:0,c[h+1]+=v!==c[h+1]?(v-c[h+1])*y:0,c[h+2]+=v!==c[h+2]?(v-c[h+2])*y:0}},getUniformLocations:function(r,l){return{uVibrance:r.getUniformLocation(l,"uVibrance")}},sendUniformData:function(r,l){r.uniform1f(l.uVibrance,-this.vibrance)}}),n.Image.filters.Vibrance.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Blur=f(o.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var l=r.filterBackend.resources,c,d,p=r.imageData.width,h=r.imageData.height;l.blurLayer1||(l.blurLayer1=n.util.createCanvasElement(),l.blurLayer2=n.util.createCanvasElement()),c=l.blurLayer1,d=l.blurLayer2,(c.width!==p||c.height!==h)&&(d.width=c.width=p,d.height=c.height=h);var v=c.getContext("2d"),_=d.getContext("2d"),y=15,x,b,w,M,S=this.blur*.06*.5;for(v.putImageData(r.imageData,0,0),_.clearRect(0,0,p,h),M=-y;M<=y;M++)x=(Math.random()-.5)/4,b=M/y,w=S*b*p+x,_.globalAlpha=1-Math.abs(b),_.drawImage(c,w,x),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);for(M=-y;M<=y;M++)x=(Math.random()-.5)/4,b=M/y,w=S*b*h+x,_.globalAlpha=1-Math.abs(b),_.drawImage(c,x,w),v.drawImage(d,0,0),_.globalAlpha=1,_.clearRect(0,0,d.width,d.height);r.ctx.drawImage(c,0,0);var C=r.ctx.getImageData(0,0,c.width,c.height);return v.globalAlpha=1,v.clearRect(0,0,c.width,c.height),C},getUniformLocations:function(r,l){return{delta:r.getUniformLocation(l,"uDelta")}},sendUniformData:function(r,l){var c=this.chooseRightDelta();r.uniform2fv(l.delta,c)},chooseRightDelta:function(){var r=1,l=[0,0],c;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),c=r*this.blur*.12,this.horizontal?l[0]=c:l[1]=c,l}}),o.Blur.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Gamma=f(o.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],o.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var l=r.imageData,c=l.data,d=this.gamma,p=c.length,h=1/d[0],v=1/d[1],_=1/d[2],y;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),y=0,p=256;y<p;y++)this.rVals[y]=Math.pow(y/255,h)*255,this.gVals[y]=Math.pow(y/255,v)*255,this.bVals[y]=Math.pow(y/255,_)*255;for(y=0,p=c.length;y<p;y+=4)c[y]=this.rVals[c[y]],c[y+1]=this.gVals[c[y+1]],c[y+2]=this.bVals[c[y+2]]},getUniformLocations:function(r,l){return{uGamma:r.getUniformLocation(l,"uGamma")}},sendUniformData:function(r,l){r.uniform3fv(l.uGamma,this.gamma)}}),n.Image.filters.Gamma.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.Composed=f(o.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(l){l.applyTo(r)})},toObject:function(){return n.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),n.Image.filters.Composed.fromObject=function(r,l){var c=r.subFilters||[],d=c.map(function(h){return new n.Image.filters[h.type](h)}),p=new n.Image.filters.Composed({subFilters:d});return l&&l(p),p}}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.Image.filters,f=n.util.createClass;o.HueRotation=f(o.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,l=n.util.cos(r),c=n.util.sin(r),d=1/3,p=Math.sqrt(d)*c,h=1-l;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=l+h/3,this.matrix[1]=d*h-p,this.matrix[2]=d*h+p,this.matrix[5]=d*h+p,this.matrix[6]=l+d*h,this.matrix[7]=d*h-p,this.matrix[10]=d*h-p,this.matrix[11]=d*h+p,this.matrix[12]=l+d*h},isNeutralState:function(r){return this.calculateMatrix(),o.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),o.BaseFilter.prototype.applyTo.call(this,r)}}),n.Image.filters.HueRotation.fromObject=n.Image.filters.BaseFilter.fromObject}(m),function(s){var n=s.fabric||(s.fabric={}),o=n.util.object.clone;if(n.Text){n.warn("fabric.Text is already defined");return}var f="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");n.Text=n.util.createClass(n.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:n.Object.prototype.stateProperties.concat(f),cacheProperties:n.Object.prototype.cacheProperties.concat(f),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,l){this.styles=l?l.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",l),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=n.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return n._measuringContext||(n._measuringContext=this.canvas&&this.canvas.contextCache||n.util.createCanvasElement().getContext("2d")),n._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,l,c,d,p,h,v,_=0,y=this._textLines.length;_<y;_++)if(!(this.textAlign!=="justify"&&(_===y-1||this.isEndOfWrapping(_)))&&(d=0,p=this._textLines[_],l=this.getLineWidth(_),l<this.width&&(v=this.textLines[_].match(this._reSpacesAndTabs)))){c=v.length,r=(this.width-l)/c;for(var x=0,b=p.length;x<=b;x++)h=this.__charBounds[_][x],this._reSpaceAndTab.test(p[x])?(h.width+=r,h.kernedWidth+=r,h.left+=d,d+=r):h.left+=d}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),l=this.fontSize;return r.width+=l*r.zoomX,r.height+=l*r.zoomY,r},_render:function(r){var l=this.path;l&&!l.isNotVisible()&&l._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,l,c){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(l,c)},calcTextWidth:function(){for(var r=this.getLineWidth(0),l=1,c=this._textLines.length;l<c;l++){var d=this.getLineWidth(l);d>r&&(r=d)}return r},_renderTextLine:function(r,l,c,d,p,h){this._renderChars(r,l,c,d,p,h)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var l,c,d=r.fillStyle,p,h,v=this._getLeftOffset(),_=this._getTopOffset(),y=0,x=0,b,w,M=this.path,S,C=0,O=this._textLines.length;C<O;C++){if(l=this.getHeightOfLine(C),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",C)){_+=l;continue}p=this._textLines[C],c=this._getLineLeftOffset(C),x=0,y=0,h=this.getValueOfPropertyAt(C,0,"textBackgroundColor");for(var k=0,Y=p.length;k<Y;k++)b=this.__charBounds[C][k],w=this.getValueOfPropertyAt(C,k,"textBackgroundColor"),M?(r.save(),r.translate(b.renderLeft,b.renderTop),r.rotate(b.angle),r.fillStyle=w,w&&r.fillRect(-b.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),b.width,l/this.lineHeight),r.restore()):w!==h?(S=v+c+y,this.direction==="rtl"&&(S=this.width-S-x),r.fillStyle=h,h&&r.fillRect(S,_,x,l/this.lineHeight),y=b.left,x=b.width,h=w):x+=b.kernedWidth;w&&!M&&(S=v+c+y,this.direction==="rtl"&&(S=this.width-S-x),r.fillStyle=w,r.fillRect(S,_,x,l/this.lineHeight)),_+=l}r.fillStyle=d,this._removeShadow(r)}},getFontCache:function(r){var l=r.fontFamily.toLowerCase();n.charWidthsCache[l]||(n.charWidthsCache[l]={});var c=n.charWidthsCache[l],d=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return c[d]||(c[d]={}),c[d]},_measureChar:function(r,l,c,d){var p=this.getFontCache(l),h=this._getFontDeclaration(l),v=this._getFontDeclaration(d),_=c+r,y=h===v,x,b,w,M=l.fontSize/this.CACHE_FONT_SIZE,S;if(c&&p[c]!==void 0&&(w=p[c]),p[r]!==void 0&&(S=x=p[r]),y&&p[_]!==void 0&&(b=p[_],S=b-w),x===void 0||w===void 0||b===void 0){var C=this.getMeasuringContext();this._setTextStyles(C,l,!0)}return x===void 0&&(S=x=C.measureText(r).width,p[r]=x),w===void 0&&y&&c&&(w=C.measureText(c).width,p[c]=w),y&&b===void 0&&(b=C.measureText(_).width,p[_]=b,S=b-w),{width:x*M,kernedWidth:S*M}},getHeightOfChar:function(r,l){return this.getValueOfPropertyAt(r,l,"fontSize")},measureLine:function(r){var l=this._measureLine(r);return this.charSpacing!==0&&(l.width-=this._getWidthOfCharSpacing()),l.width<0&&(l.width=0),l},_measureLine:function(r){var l=0,c,d,p=this._textLines[r],h,v,_=0,y=new Array(p.length),x=0,b,w,M=this.path,S=this.pathSide==="right";for(this.__charBounds[r]=y,c=0;c<p.length;c++)d=p[c],v=this._getGraphemeBox(d,r,c,h),y[c]=v,l+=v.kernedWidth,h=d;if(y[c]={left:v?v.left+v.width:0,width:0,kernedWidth:0,height:this.fontSize},M){switch(w=M.segmentsInfo[M.segmentsInfo.length-1].length,b=n.util.getPointOnPath(M.path,0,M.segmentsInfo),b.x+=M.pathOffset.x,b.y+=M.pathOffset.y,this.textAlign){case"left":x=S?w-l:0;break;case"center":x=(w-l)/2;break;case"right":x=S?0:w-l;break}for(x+=this.pathStartOffset*(S?-1:1),c=S?p.length-1:0;S?c>=0:c<p.length;S?c--:c++)v=y[c],x>w?x%=w:x<0&&(x+=w),this._setGraphemeOnPath(x,v,b),x+=v.kernedWidth}return{width:l,numOfSpaces:_}},_setGraphemeOnPath:function(r,l,c){var d=r+l.kernedWidth/2,p=this.path,h=n.util.getPointOnPath(p.path,d,p.segmentsInfo);l.renderLeft=h.x-c.x,l.renderTop=h.y-c.y,l.angle=h.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,l,c,d,p){var h=this.getCompleteStyleDeclaration(l,c),v=d?this.getCompleteStyleDeclaration(l,c-1):{},_=this._measureChar(r,h,d,v),y=_.kernedWidth,x=_.width,b;this.charSpacing!==0&&(b=this._getWidthOfCharSpacing(),x+=b,y+=b);var w={width:x,left:0,height:h.fontSize,kernedWidth:y,deltaY:h.deltaY};if(c>0&&!p){var M=this.__charBounds[l][c-1];w.left=M.left+M.width+_.kernedWidth-_.width}return w},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var l=this._textLines[r],c=this.getHeightOfChar(r,0),d=1,p=l.length;d<p;d++)c=Math.max(this.getHeightOfChar(r,d),c);return this.__lineHeights[r]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,l=0,c=0,d=this._textLines.length;c<d;c++)r=this.getHeightOfLine(c),l+=c===d-1?r/this.lineHeight:r;return l},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,l){r.save();for(var c=0,d=this._getLeftOffset(),p=this._getTopOffset(),h=0,v=this._textLines.length;h<v;h++){var _=this.getHeightOfLine(h),y=_/this.lineHeight,x=this._getLineLeftOffset(h);this._renderTextLine(l,r,this._textLines[h],d+x,p+c+y,h),c+=_}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,l,c,d,p,h){var v=this.getHeightOfLine(h),_=this.textAlign.indexOf("justify")!==-1,y,x,b="",w,M=0,S,C=this.path,O=!_&&this.charSpacing===0&&this.isEmptyStyles(h)&&!C,k=this.direction==="ltr",Y=this.direction==="ltr"?1:-1,H,N=l.canvas.getAttribute("dir");if(l.save(),N!==this.direction&&(l.canvas.setAttribute("dir",k?"ltr":"rtl"),l.direction=k?"ltr":"rtl",l.textAlign=k?"left":"right"),p-=v*this._fontSizeFraction/this.lineHeight,O){this._renderChar(r,l,h,0,c.join(""),d,p,v),l.restore();return}for(var U=0,G=c.length-1;U<=G;U++)S=U===G||this.charSpacing||C,b+=c[U],w=this.__charBounds[h][U],M===0?(d+=Y*(w.kernedWidth-w.width),M+=w.width):M+=w.kernedWidth,_&&!S&&this._reSpaceAndTab.test(c[U])&&(S=!0),S||(y=y||this.getCompleteStyleDeclaration(h,U),x=this.getCompleteStyleDeclaration(h,U+1),S=n.util.hasStyleChanged(y,x,!1)),S&&(C?(l.save(),l.translate(w.renderLeft,w.renderTop),l.rotate(w.angle),this._renderChar(r,l,h,U,b,-M/2,0,v),l.restore()):(H=d,this._renderChar(r,l,h,U,b,H,p,v)),b="",y=x,d+=Y*M,M=0);l.restore()},_applyPatternGradientTransformText:function(r){var l=n.util.createCanvasElement(),c,d=this.width+this.strokeWidth,p=this.height+this.strokeWidth;return l.width=d,l.height=p,c=l.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.lineTo(d,0),c.lineTo(d,p),c.lineTo(0,p),c.closePath(),c.translate(d/2,p/2),c.fillStyle=r.toLive(c),this._applyPatternGradientTransform(c,r),c.fill(),c.createPattern(l,"no-repeat")},handleFiller:function(r,l,c){var d,p;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(d=-this.width/2,p=-this.height/2,r.translate(d,p),r[l]=this._applyPatternGradientTransformText(c),{offsetX:d,offsetY:p}):(r[l]=c.toLive(r,this),this._applyPatternGradientTransform(r,c)):(r[l]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,l){return r.lineWidth=l.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",l.stroke)},_setFillStyles:function(r,l){return this.handleFiller(r,"fillStyle",l.fill)},_renderChar:function(r,l,c,d,p,h,v){var _=this._getStyleDeclaration(c,d),y=this.getCompleteStyleDeclaration(c,d),x=r==="fillText"&&y.fill,b=r==="strokeText"&&y.stroke&&y.strokeWidth,w,M;!b&&!x||(l.save(),x&&(w=this._setFillStyles(l,y)),b&&(M=this._setStrokeStyles(l,y)),l.font=this._getFontDeclaration(y),_&&_.textBackgroundColor&&this._removeShadow(l),_&&_.deltaY&&(v+=_.deltaY),x&&l.fillText(p,h-w.offsetX,v-w.offsetY),b&&l.strokeText(p,h-M.offsetX,v-M.offsetY),l.restore())},setSuperscript:function(r,l){return this._setScript(r,l,this.superscript)},setSubscript:function(r,l){return this._setScript(r,l,this.subscript)},_setScript:function(r,l,c){var d=this.get2DCursorLocation(r,!0),p=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize"),h=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"deltaY"),v={fontSize:p*c.size,deltaY:h+p*c.baseline};return this.setSelectionStyles(v,r,l),this},_getLineLeftOffset:function(r){var l=this.getLineWidth(r),c=this.width-l,d=this.textAlign,p=this.direction,v,h=0,v=this.isEndOfWrapping(r);return d==="justify"||d==="justify-center"&&!v||d==="justify-right"&&!v||d==="justify-left"&&!v?0:(d==="center"&&(h=c/2),d==="right"&&(h=c),d==="justify-center"&&(h=c/2),d==="justify-right"&&(h=c),p==="rtl"&&(h-=c),h)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var l=this.measureLine(r),c=l.width;return this.__lineWidths[r]=c,c},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,l,c){var d=this._getStyleDeclaration(r,l);return d&&typeof d[c]!="undefined"?d[c]:this[c]},_renderTextDecoration:function(r,l){if(!(!this[l]&&!this.styleHas(l))){for(var c,d,p,h,v,_,y,x,b=this._getLeftOffset(),w=this._getTopOffset(),M,S,C,O,k,Y,H,N,U=this.path,G=this._getWidthOfCharSpacing(),j=this.offsets[l],q=0,T=this._textLines.length;q<T;q++){if(c=this.getHeightOfLine(q),!this[l]&&!this.styleHas(l,q)){w+=c;continue}y=this._textLines[q],Y=c/this.lineHeight,h=this._getLineLeftOffset(q),S=0,C=0,x=this.getValueOfPropertyAt(q,0,l),N=this.getValueOfPropertyAt(q,0,"fill"),M=w+Y*(1-this._fontSizeFraction),d=this.getHeightOfChar(q,0),v=this.getValueOfPropertyAt(q,0,"deltaY");for(var P=0,R=y.length;P<R;P++)if(O=this.__charBounds[q][P],k=this.getValueOfPropertyAt(q,P,l),H=this.getValueOfPropertyAt(q,P,"fill"),p=this.getHeightOfChar(q,P),_=this.getValueOfPropertyAt(q,P,"deltaY"),U&&k&&H)r.save(),r.fillStyle=N,r.translate(O.renderLeft,O.renderTop),r.rotate(O.angle),r.fillRect(-O.kernedWidth/2,j*p+_,O.kernedWidth,this.fontSize/15),r.restore();else if((k!==x||H!==N||p!==d||_!==v)&&C>0){var L=b+h+S;this.direction==="rtl"&&(L=this.width-L-C),x&&N&&(r.fillStyle=N,r.fillRect(L,M+j*d+v,C,this.fontSize/15)),S=O.left,C=O.width,x=k,N=H,d=p,v=_}else C+=O.kernedWidth;var L=b+h+S;this.direction==="rtl"&&(L=this.width-L-C),r.fillStyle=H,k&&H&&r.fillRect(L,M+j*d+v,C-G,this.fontSize/15),w+=c}this._removeShadow(r)}},_getFontDeclaration:function(r,l){var c=r||this,d=this.fontFamily,p=n.Text.genericFonts.indexOf(d.toLowerCase())>-1,h=d===void 0||d.indexOf("'")>-1||d.indexOf(",")>-1||d.indexOf('"')>-1||p?c.fontFamily:'"'+c.fontFamily+'"';return[n.isLikelyNode?c.fontWeight:c.fontStyle,n.isLikelyNode?c.fontStyle:c.fontWeight,l?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",h].join(" ")},render:function(r){!this.visible||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r))},_splitTextIntoLines:function(r){for(var l=r.split(this._reNewline),c=new Array(l.length),d=[`
`],p=[],h=0;h<l.length;h++)c[h]=n.util.string.graphemeSplit(l[h]),p=p.concat(c[h],d);return p.pop(),{_unwrappedLines:c,lines:l,graphemeText:p,graphemeLines:c}},toObject:function(r){var l=f.concat(r),c=this.callSuper("toObject",l);return c.styles=n.util.stylesToArray(this.styles,this.text),c.path&&(c.path=this.path.toObject()),c},set:function(r,l){this.callSuper("set",r,l);var c=!1,d=!1;if(typeof r=="object")for(var p in r)p==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(p)!==-1,d=d||p==="path";else c=this._dimensionAffectingProps.indexOf(r)!==-1,d=r==="path";return d&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),n.Text.ATTRIBUTE_NAMES=n.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),n.Text.DEFAULT_SVG_FONT_SIZE=16,n.Text.fromElement=function(r,l,c){if(!r)return l(null);var d=n.parseAttributes(r,n.Text.ATTRIBUTE_NAMES),p=d.textAnchor||"left";if(c=n.util.object.extend(c?o(c):{},d),c.top=c.top||0,c.left=c.left||0,d.textDecoration){var h=d.textDecoration;h.indexOf("underline")!==-1&&(c.underline=!0),h.indexOf("overline")!==-1&&(c.overline=!0),h.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in d&&(c.left+=d.dx),"dy"in d&&(c.top+=d.dy),"fontSize"in c||(c.fontSize=n.Text.DEFAULT_SVG_FONT_SIZE);var v="";"textContent"in r?v=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(v=r.firstChild.data),v=v.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var _=c.strokeWidth;c.strokeWidth=0;var y=new n.Text(v,c),x=y.getScaledHeight()/y.height,b=(y.height+y.strokeWidth)*y.lineHeight-y.height,w=b*x,M=y.getScaledHeight()+w,S=0;p==="center"&&(S=y.getScaledWidth()/2),p==="right"&&(S=y.getScaledWidth()),y.set({left:y.left-S,top:y.top-(M-y.fontSize*(.07+y._fontSizeFraction))/y.lineHeight,strokeWidth:typeof _!="undefined"?_:1}),l(y)},n.Text.fromObject=function(r,l){var c=o(r),d=r.path;return delete c.path,n.Object._fromObject("Text",c,function(p){p.styles=n.util.stylesFromArray(r.styles,r.text),d?n.Object._fromObject("Path",d,function(h){p.set("path",h),l(p)},"path"):l(p)},"text")},n.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],n.util.createAccessors&&n.util.createAccessors(n.Text)}(m),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(s){if(!this.styles||typeof s!="undefined"&&!this.styles[s])return!0;var n=typeof s=="undefined"?this.styles:{line:this.styles[s]};for(var o in n)for(var f in n[o])for(var r in n[o][f])return!1;return!0},styleHas:function(s,n){if(!this.styles||!s||s===""||typeof n!="undefined"&&!this.styles[n])return!1;var o=typeof n=="undefined"?this.styles:{0:this.styles[n]};for(var f in o)for(var r in o[f])if(typeof o[f][r][s]!="undefined")return!0;return!1},cleanStyle:function(s){if(!this.styles||!s||s==="")return!1;var n=this.styles,o=0,f,r,l=!0,c=0,d;for(var p in n){f=0;for(var h in n[p]){var d=n[p][h],v=d.hasOwnProperty(s);o++,v?(r?d[s]!==r&&(l=!1):r=d[s],d[s]===this[s]&&delete d[s]):l=!1,Object.keys(d).length!==0?f++:delete n[p][h]}f===0&&delete n[p]}for(var _=0;_<this._textLines.length;_++)c+=this._textLines[_].length;l&&o===c&&(this[s]=r,this.removeStyle(s))},removeStyle:function(s){if(!(!this.styles||!s||s==="")){var n=this.styles,o,f,r;for(f in n){o=n[f];for(r in o)delete o[r][s],Object.keys(o[r]).length===0&&delete o[r];Object.keys(o).length===0&&delete n[f]}}},_extendStyles:function(s,n){var o=this.get2DCursorLocation(s);this._getLineStyle(o.lineIndex)||this._setLineStyle(o.lineIndex),this._getStyleDeclaration(o.lineIndex,o.charIndex)||this._setStyleDeclaration(o.lineIndex,o.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(o.lineIndex,o.charIndex),n)},get2DCursorLocation:function(s,n){typeof s=="undefined"&&(s=this.selectionStart);for(var o=n?this._unwrappedTextLines:this._textLines,f=o.length,r=0;r<f;r++){if(s<=o[r].length)return{lineIndex:r,charIndex:s};s-=o[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:o[r-1].length<s?o[r-1].length:s}},getSelectionStyles:function(s,n,o){typeof s=="undefined"&&(s=this.selectionStart||0),typeof n=="undefined"&&(n=this.selectionEnd||s);for(var f=[],r=s;r<n;r++)f.push(this.getStyleAtPosition(r,o));return f},getStyleAtPosition:function(s,n){var o=this.get2DCursorLocation(s),f=n?this.getCompleteStyleDeclaration(o.lineIndex,o.charIndex):this._getStyleDeclaration(o.lineIndex,o.charIndex);return f||{}},setSelectionStyles:function(s,n,o){typeof n=="undefined"&&(n=this.selectionStart||0),typeof o=="undefined"&&(o=this.selectionEnd||n);for(var f=n;f<o;f++)this._extendStyles(f,s);return this._forceClearCache=!0,this},_getStyleDeclaration:function(s,n){var o=this.styles&&this.styles[s];return o?o[n]:null},getCompleteStyleDeclaration:function(s,n){for(var o=this._getStyleDeclaration(s,n)||{},f={},r,l=0;l<this._styleProperties.length;l++)r=this._styleProperties[l],f[r]=typeof o[r]=="undefined"?this[r]:o[r];return f},_setStyleDeclaration:function(s,n,o){this.styles[s][n]=o},_deleteStyleDeclaration:function(s,n){delete this.styles[s][n]},_getLineStyle:function(s){return!!this.styles[s]},_setLineStyle:function(s){this.styles[s]={}},_deleteLineStyle:function(s){delete this.styles[s]}})}(),function(){function s(n){n.textDecoration&&(n.textDecoration.indexOf("underline")>-1&&(n.underline=!0),n.textDecoration.indexOf("line-through")>-1&&(n.linethrough=!0),n.textDecoration.indexOf("overline")>-1&&(n.overline=!0),delete n.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(n,o){this.callSuper("initialize",n,o),this.initBehavior()},setSelectionStart:function(n){n=Math.max(n,0),this._updateAndFire("selectionStart",n)},setSelectionEnd:function(n){n=Math.min(n,this.text.length),this._updateAndFire("selectionEnd",n)},_updateAndFire:function(n,o){this[n]!==o&&(this._fireSelectionChanged(),this[n]=o),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(n){this.clearContextTop(),this.callSuper("render",n),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(n){this.callSuper("_render",n)},clearContextTop:function(n){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var o=this.canvas.contextTop,f=this.canvas.viewportTransform;o.save(),o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this.transform(o),this._clearTextArea(o),n||o.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var n=this._getCursorBoundaries(),o=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(n,o):this.renderSelection(n,o),o.restore()}},_clearTextArea:function(n){var o=this.width+4,f=this.height+4;n.clearRect(-o/2,-f/2,o,f)},_getCursorBoundaries:function(n){typeof n=="undefined"&&(n=this.selectionStart);var o=this._getLeftOffset(),f=this._getTopOffset(),r=this._getCursorBoundariesOffsets(n);return{left:o,top:f,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(n){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var o,f,r,l=0,c=0,d,p=this.get2DCursorLocation(n);r=p.charIndex,f=p.lineIndex;for(var h=0;h<f;h++)l+=this.getHeightOfLine(h);o=this._getLineLeftOffset(f);var v=this.__charBounds[f][r];return v&&(c=v.left),this.charSpacing!==0&&r===this._textLines[f].length&&(c-=this._getWidthOfCharSpacing()),d={top:l,left:o+(c>0?c:0)},this.direction==="rtl"&&(d.left*=-1),this.cursorOffsetCache=d,this.cursorOffsetCache},renderCursor:function(n,o){var f=this.get2DCursorLocation(),r=f.lineIndex,l=f.charIndex>0?f.charIndex-1:0,c=this.getValueOfPropertyAt(r,l,"fontSize"),d=this.scaleX*this.canvas.getZoom(),p=this.cursorWidth/d,h=n.topOffset,v=this.getValueOfPropertyAt(r,l,"deltaY");h+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(n,o),o.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,l,"fill"),o.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,o.fillRect(n.left+n.leftOffset-p/2,h+n.top+v,p,c)},renderSelection:function(n,o){for(var f=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,l=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(f),d=this.get2DCursorLocation(r),p=c.lineIndex,h=d.lineIndex,v=c.charIndex<0?0:c.charIndex,_=d.charIndex<0?0:d.charIndex,y=p;y<=h;y++){var x=this._getLineLeftOffset(y)||0,b=this.getHeightOfLine(y),w=0,M=0,S=0;if(y===p&&(M=this.__charBounds[p][v].left),y>=p&&y<h)S=l&&!this.isEndOfWrapping(y)?this.width:this.getLineWidth(y)||5;else if(y===h)if(_===0)S=this.__charBounds[h][_].left;else{var C=this._getWidthOfCharSpacing();S=this.__charBounds[h][_-1].left+this.__charBounds[h][_-1].width-C}w=b,(this.lineHeight<1||y===h&&this.lineHeight>1)&&(b/=this.lineHeight);var O=n.left+x+M,k=S-M,Y=b,H=0;this.inCompositionMode?(o.fillStyle=this.compositionColor||"black",Y=1,H=b):o.fillStyle=this.selectionColor,this.direction==="rtl"&&(O=this.width-O-k),o.fillRect(O,n.top+n.topOffset+H,k,Y),n.topOffset+=w}},getCurrentCharFontSize:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fontSize")},getCurrentCharColor:function(){var n=this._getCurrentCharIndex();return this.getValueOfPropertyAt(n.l,n.c,"fill")},_getCurrentCharIndex:function(){var n=this.get2DCursorLocation(this.selectionStart,!0),o=n.charIndex>0?n.charIndex-1:0;return{l:n.lineIndex,c:o}}}),e.IText.fromObject=function(n,o){var f=e.util.stylesFromArray(n.styles,n.text),r=Object.assign({},n,{styles:f});if(s(r),r.styles)for(var l in r.styles)for(var c in r.styles[l])s(r.styles[l][c]);e.Object._fromObject("IText",r,o,"text")}}(),function(){var s=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var n=this;this.on("added",function(){var o=n.canvas;o&&(o._hasITextHandlers||(o._hasITextHandlers=!0,n._initCanvasHandlers(o)),o._iTextInstances=o._iTextInstances||[],o._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){var o=n.canvas;o&&(o._iTextInstances=o._iTextInstances||[],e.util.removeFromArray(o._iTextInstances,n),o._iTextInstances.length===0&&(o._hasITextHandlers=!1,n._removeCanvasHandlers(o)))})},_initCanvasHandlers:function(n){n._mouseUpITextHandler=function(){n._iTextInstances&&n._iTextInstances.forEach(function(o){o.__isMousedown=!1})},n.on("mouse:up",n._mouseUpITextHandler)},_removeCanvasHandlers:function(n){n.off("mouse:up",n._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,o,f,r){var l;return l={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",o,{duration:f,onComplete:function(){l.isAborted||n[r]()},onChange:function(){n.canvas&&n.selectionStart===n.selectionEnd&&n.renderCursorOrSelection()},abort:function(){return l.isAborted}}),l},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var o=this,f=n?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){o._tick()},f)},abortCursorAnimation:function(){var n=this._currentTickState||this._currentTickCompleteState,o=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,n&&o&&o.clearContext(o.contextTop||o.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(n){var o=0,f=n-1;if(this._reSpace.test(this._text[f]))for(;this._reSpace.test(this._text[f]);)o++,f--;for(;/\S/.test(this._text[f])&&f>-1;)o++,f--;return n-o},findWordBoundaryRight:function(n){var o=0,f=n;if(this._reSpace.test(this._text[f]))for(;this._reSpace.test(this._text[f]);)o++,f++;for(;/\S/.test(this._text[f])&&f<this._text.length;)o++,f++;return n+o},findLineBoundaryLeft:function(n){for(var o=0,f=n-1;!/\n/.test(this._text[f])&&f>-1;)o++,f--;return n-o},findLineBoundaryRight:function(n){for(var o=0,f=n;!/\n/.test(this._text[f])&&f<this._text.length;)o++,f++;return n+o},searchWordBoundary:function(n,o){for(var f=this._text,r=this._reSpace.test(f[n])?n-1:n,l=f[r],c=e.reNonWord;!c.test(l)&&r>0&&r<f.length;)r+=o,l=f[r];return c.test(l)&&(r+=o===1?0:1),r},selectWord:function(n){n=n||this.selectionStart;var o=this.searchWordBoundary(n,-1),f=this.searchWordBoundary(n,1);this.selectionStart=o,this.selectionEnd=f,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(n){n=n||this.selectionStart;var o=this.findLineBoundaryLeft(n),f=this.findLineBoundaryRight(n);return this.selectionStart=o,this.selectionEnd=f,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(n){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(n),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(o){o.selected=!1,o.isEditing&&o.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(n){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var o=this.getSelectionStartFromPointer(n.e),f=this.selectionStart,r=this.selectionEnd;(o!==this.__selectionStartOnMouseDown||f===r)&&(f===o||r===o)||(o>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=o):(this.selectionStart=o,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==f||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(n,o,f){var r=f.slice(0,n),l=e.util.string.graphemeSplit(r).length;if(n===o)return{selectionStart:l,selectionEnd:l};var c=f.slice(n,o),d=e.util.string.graphemeSplit(c).length;return{selectionStart:l,selectionEnd:l+d}},fromGraphemeToStringSelection:function(n,o,f){var r=f.slice(0,n),l=r.join("").length;if(n===o)return{selectionStart:l,selectionEnd:l};var c=f.slice(n,o),d=c.join("").length;return{selectionStart:l,selectionEnd:l+d}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var n=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=n.selectionStart,this.hiddenTextarea.selectionEnd=n.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(!!this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var n=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=n.selectionEnd,this.inCompositionMode||(this.selectionStart=n.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var n=this._calcTextareaPosition();this.hiddenTextarea.style.left=n.left,this.hiddenTextarea.style.top=n.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var n=this.inCompositionMode?this.compositionStart:this.selectionStart,o=this._getCursorBoundaries(n),f=this.get2DCursorLocation(n),r=f.lineIndex,l=f.charIndex,c=this.getValueOfPropertyAt(r,l,"fontSize")*this.lineHeight,d=o.leftOffset,p=this.calcTransformMatrix(),h={x:o.left+d,y:o.top+o.topOffset+c},v=this.canvas.getRetinaScaling(),_=this.canvas.upperCanvasEl,y=_.width/v,x=_.height/v,b=y-c,w=x-c,M=_.clientWidth/y,S=_.clientHeight/x;return h=e.util.transformPoint(h,p),h=e.util.transformPoint(h,this.canvas.viewportTransform),h.x*=M,h.y*=S,h.x<0&&(h.x=0),h.x>b&&(h.x=b),h.y<0&&(h.y=0),h.y>w&&(h.y=w),h.x+=this.canvas._offset.left,h.y+=this.canvas._offset.top,{left:h.x+"px",top:h.y+"px",fontSize:c+"px",charHeight:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){!this._savedProps||(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var n=this._textBeforeEdit!==this.text,o=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,o&&(o.blur&&o.blur(),o.parentNode&&o.parentNode.removeChild(o)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),n&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),n&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},removeStyleFromTo:function(n,o){var f=this.get2DCursorLocation(n,!0),r=this.get2DCursorLocation(o,!0),l=f.lineIndex,c=f.charIndex,d=r.lineIndex,p=r.charIndex,h,v;if(l!==d){if(this.styles[l])for(h=c;h<this._unwrappedTextLines[l].length;h++)delete this.styles[l][h];if(this.styles[d])for(h=p;h<this._unwrappedTextLines[d].length;h++)v=this.styles[d][h],v&&(this.styles[l]||(this.styles[l]={}),this.styles[l][c+h-p]=v);for(h=l+1;h<=d;h++)delete this.styles[h];this.shiftLineStyles(d,l-d)}else if(this.styles[l]){v=this.styles[l];var _=p-c,y,x;for(h=c;h<p;h++)delete v[h];for(x in this.styles[l])y=parseInt(x,10),y>=p&&(v[y-_]=v[x],delete v[x])}},shiftLineStyles:function(n,o){var f=s(this.styles);for(var r in this.styles){var l=parseInt(r,10);l>n&&(this.styles[l+o]=f[l],f[l-o]||delete this.styles[l])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(n,o,f,r){var l,c={},d=!1,p=this._unwrappedTextLines[n].length===o;f||(f=1),this.shiftLineStyles(n,f),this.styles[n]&&(l=this.styles[n][o===0?o:o-1]);for(var h in this.styles[n]){var v=parseInt(h,10);v>=o&&(d=!0,c[v-o]=this.styles[n][h],p&&o===0||delete this.styles[n][h])}var _=!1;for(d&&!p&&(this.styles[n+f]=c,_=!0),_&&f--;f>0;)r&&r[f-1]?this.styles[n+f]={0:s(r[f-1])}:l?this.styles[n+f]={0:s(l)}:delete this.styles[n+f],f--;this._forceClearCache=!0},insertCharStyleObject:function(n,o,f,r){this.styles||(this.styles={});var l=this.styles[n],c=l?s(l):{};f||(f=1);for(var d in c){var p=parseInt(d,10);p>=o&&(l[p+f]=c[p],c[p-f]||delete l[p])}if(this._forceClearCache=!0,r){for(;f--;)!Object.keys(r[f]).length||(this.styles[n]||(this.styles[n]={}),this.styles[n][o+f]=s(r[f]));return}if(!!l)for(var h=l[o?o-1:1];h&&f--;)this.styles[n][o+f]=s(h)},insertNewStyleBlock:function(n,o,f){for(var r=this.get2DCursorLocation(o,!0),l=[0],c=0,d=0;d<n.length;d++)n[d]===`
`?(c++,l[c]=0):l[c]++;l[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,l[0],f),f=f&&f.slice(l[0]+1)),c&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+l[0],c);for(var d=1;d<c;d++)l[d]>0?this.insertCharStyleObject(r.lineIndex+d,0,l[d],f):f&&this.styles[r.lineIndex+d]&&f[0]&&(this.styles[r.lineIndex+d][0]=f[0]),f=f&&f.slice(l[d]+1);l[d]>0&&this.insertCharStyleObject(r.lineIndex+d,0,l[d],f)},setSelectionStartEndWithShift:function(n,o,f){f<=n?(o===n?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=n),this.selectionStart=f):f>n&&f<o?this._selectionDirection==="right"?this.selectionEnd=f:this.selectionStart=f:(o===n?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=o),this.selectionEnd=f)},setSelectionInBoundaries:function(){var n=this.text.length;this.selectionStart>n?this.selectionStart=n:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>n?this.selectionEnd=n:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(s){if(!!this.canvas){this.__newClickTime=+new Date;var n=s.pointer;this.isTripleClick(n)&&(this.fire("tripleclick",s),this._stopEvent(s.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=n,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(s){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===s.x&&this.__lastPointer.y===s.y},_stopEvent:function(s){s.preventDefault&&s.preventDefault(),s.stopPropagation&&s.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(s){!this.isEditing||this.selectWord(this.getSelectionStartFromPointer(s.e))},tripleClickHandler:function(s){!this.isEditing||this.selectLine(this.getSelectionStartFromPointer(s.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(s.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(s){!this.canvas||!this.editable||s.e.button&&s.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(s){if(this.__isMousedown=!1,!(!this.editable||this.group||s.transform&&s.transform.actionPerformed||s.e.button&&s.e.button!==1)){if(this.canvas){var n=this.canvas._activeObject;if(n&&n!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(s.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(s){var n=this.getSelectionStartFromPointer(s),o=this.selectionStart,f=this.selectionEnd;s.shiftKey?this.setSelectionStartEndWithShift(o,f,n):(this.selectionStart=n,this.selectionEnd=n),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(s){for(var n=this.getLocalPointer(s),o=0,f=0,r=0,l=0,c=0,d,p,h=0,v=this._textLines.length;h<v&&r<=n.y;h++)r+=this.getHeightOfLine(h)*this.scaleY,c=h,h>0&&(l+=this._textLines[h-1].length+this.missingNewlineOffset(h-1));d=this._getLineLeftOffset(c),f=d*this.scaleX,p=this._textLines[c],this.direction==="rtl"&&(n.x=this.width*this.scaleX-n.x+f);for(var _=0,y=p.length;_<y&&(o=f,f+=this.__charBounds[c][_].kernedWidth*this.scaleX,f<=n.x);_++)l++;return this._getNewSelectionStartFromOffset(n,o,f,l,y)},_getNewSelectionStartFromOffset:function(s,n,o,f,r){var l=s.x-n,c=o-s.x,d=c>l||c<0?0:1,p=f+d;return this.flipX&&(p=r-p),p>this._text.length&&(p=this._text.length),p}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var s=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+s.top+"; left: "+s.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+s.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(s){if(!!this.isEditing){var n=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(s.keyCode in n)this[n[s.keyCode]](s);else if(s.keyCode in this.ctrlKeysMapDown&&(s.ctrlKey||s.metaKey))this[this.ctrlKeysMapDown[s.keyCode]](s);else return;s.stopImmediatePropagation(),s.preventDefault(),s.keyCode>=33&&s.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(s){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(s.keyCode in this.ctrlKeysMapUp&&(s.ctrlKey||s.metaKey))this[this.ctrlKeysMapUp[s.keyCode]](s);else return;s.stopImmediatePropagation(),s.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(s){var n=this.fromPaste;if(this.fromPaste=!1,s&&s.stopPropagation(),!!this.isEditing){var o=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,r=o.length,l,c,d=r-f,p=this.selectionStart,h=this.selectionEnd,v=p!==h,_,y,x;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var b=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),w=p>b.selectionStart;v?(l=this._text.slice(p,h),d+=h-p):r<f&&(w?l=this._text.slice(h+d,h):l=this._text.slice(p,p-d)),c=o.slice(b.selectionEnd-d,b.selectionEnd),l&&l.length&&(c.length&&(_=this.getSelectionStyles(p,p+1,!1),_=c.map(function(){return _[0]})),v?(y=p,x=h):w?(y=h-l.length,x=h):(y=h,x=h+l.length),this.removeStyleFromTo(y,x)),c.length&&(n&&c.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(_=e.copiedTextStyle),this.insertNewStyleBlock(c,p,_)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(s){this.compositionStart=s.target.selectionStart,this.compositionEnd=s.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(s){return s&&s.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(s,n){var o=this._getLineLeftOffset(s),f;return n>0&&(f=this.__charBounds[s][n-1],o+=f.left+f.width),o},getDownCursorOffset:function(s,n){var o=this._getSelectionForOffset(s,n),f=this.get2DCursorLocation(o),r=f.lineIndex;if(r===this._textLines.length-1||s.metaKey||s.keyCode===34)return this._text.length-o;var l=f.charIndex,c=this._getWidthBeforeCursor(r,l),d=this._getIndexOnLine(r+1,c),p=this._textLines[r].slice(l);return p.length+d+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(s,n){return s.shiftKey&&this.selectionStart!==this.selectionEnd&&n?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(s,n){var o=this._getSelectionForOffset(s,n),f=this.get2DCursorLocation(o),r=f.lineIndex;if(r===0||s.metaKey||s.keyCode===33)return-o;var l=f.charIndex,c=this._getWidthBeforeCursor(r,l),d=this._getIndexOnLine(r-1,c),p=this._textLines[r].slice(0,l),h=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+d-p.length+(1-h)},_getIndexOnLine:function(s,n){for(var o=this._textLines[s],f=this._getLineLeftOffset(s),r=f,l=0,c,d,p=0,h=o.length;p<h;p++)if(c=this.__charBounds[s][p].width,r+=c,r>n){d=!0;var v=r-c,_=r,y=Math.abs(v-n),x=Math.abs(_-n);l=x<y?p:p-1;break}return d||(l=o.length-1),l},moveCursorDown:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",s)},moveCursorUp:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",s)},_moveCursorUpOrDown:function(s,n){var o="get"+s+"CursorOffset",f=this[o](n,this._selectionDirection==="right");n.shiftKey?this.moveCursorWithShift(f):this.moveCursorWithoutShift(f),f!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(s){var n=this._selectionDirection==="left"?this.selectionStart+s:this.selectionEnd+s;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,n),s!==0},moveCursorWithoutShift:function(s){return s<0?(this.selectionStart+=s,this.selectionEnd=this.selectionStart):(this.selectionEnd+=s,this.selectionStart=this.selectionEnd),s!==0},moveCursorLeft:function(s){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",s)},_move:function(s,n,o){var f;if(s.altKey)f=this["findWordBoundary"+o](this[n]);else if(s.metaKey||s.keyCode===35||s.keyCode===36)f=this["findLineBoundary"+o](this[n]);else return this[n]+=o==="Left"?-1:1,!0;if(typeof f!="undefined"&&this[n]!==f)return this[n]=f,!0},_moveLeft:function(s,n){return this._move(s,n,"Left")},_moveRight:function(s,n){return this._move(s,n,"Right")},moveCursorLeftWithoutShift:function(s){var n=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(n=this._moveLeft(s,"selectionStart")),this.selectionEnd=this.selectionStart,n},moveCursorLeftWithShift:function(s){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(s,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(s,"selectionStart")},moveCursorRight:function(s){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",s)},_moveCursorLeftOrRight:function(s,n){var o="moveCursor"+s+"With";this._currentCursorOpacity=1,n.shiftKey?o+="Shift":o+="outShift",this[o](n)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(s){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(s,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(s,"selectionEnd")},moveCursorRightWithoutShift:function(s){var n=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(n=this._moveRight(s,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,n},removeChars:function(s,n){typeof n=="undefined"&&(n=s+1),this.removeStyleFromTo(s,n),this._text.splice(s,n-s),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(s,n,o,f){typeof f=="undefined"&&(f=o),f>o&&this.removeStyleFromTo(o,f);var r=e.util.string.graphemeSplit(s);this.insertNewStyleBlock(r,o,n),this._text=[].concat(this._text.slice(0,o),r,this._text.slice(f)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var s=e.util.toFixed,n=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var o=this._getSVGLeftTopOffsets(),f=this._getSVGTextAndBg(o.textTop,o.textLeft);return this._wrapSVGTextAndBg(f)},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(o){var f=!0,r=this.getSvgTextDecoration(this);return[o.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",r?'text-decoration="'+r+'" ':"",'style="',this.getSvgStyles(f),'"',this.addPaintOrder()," >",o.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(o,f){var r=[],l=[],c=o,d;this._setSVGBg(l);for(var p=0,h=this._textLines.length;p<h;p++)d=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(l,p,f+d,c),this._setSVGTextLineText(r,p,f+d,c),c+=this.getHeightOfLine(p);return{textSpans:r,textBgRects:l}},_createTextCharSpan:function(o,f,r,l){var c=o!==o.trim()||o.match(n),d=this.getSvgSpanStyles(f,c),p=d?'style="'+d+'"':"",h=f.deltaY,v="",_=e.Object.NUM_FRACTION_DIGITS;return h&&(v=' dy="'+s(h,_)+'" '),['<tspan x="',s(r,_),'" y="',s(l,_),'" ',v,p,">",e.util.string.escapeXml(o),"</tspan>"].join("")},_setSVGTextLineText:function(o,f,r,l){var c=this.getHeightOfLine(f),d=this.textAlign.indexOf("justify")!==-1,p,h,v="",_,y,x=0,b=this._textLines[f],w;l+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var M=0,S=b.length-1;M<=S;M++)w=M===S||this.charSpacing,v+=b[M],_=this.__charBounds[f][M],x===0?(r+=_.kernedWidth-_.width,x+=_.width):x+=_.kernedWidth,d&&!w&&this._reSpaceAndTab.test(b[M])&&(w=!0),w||(p=p||this.getCompleteStyleDeclaration(f,M),h=this.getCompleteStyleDeclaration(f,M+1),w=e.util.hasStyleChanged(p,h,!0)),w&&(y=this._getStyleDeclaration(f,M)||{},o.push(this._createTextCharSpan(v,y,r,l)),v="",p=h,r+=x,x=0)},_pushTextBgRect:function(o,f,r,l,c,d){var p=e.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(f),' x="',s(r,p),'" y="',s(l,p),'" width="',s(c,p),'" height="',s(d,p),`"></rect>
`)},_setSVGTextLineBg:function(o,f,r,l){for(var c=this._textLines[f],d=this.getHeightOfLine(f)/this.lineHeight,p=0,h=0,v,_,y=this.getValueOfPropertyAt(f,0,"textBackgroundColor"),x=0,b=c.length;x<b;x++)v=this.__charBounds[f][x],_=this.getValueOfPropertyAt(f,x,"textBackgroundColor"),_!==y?(y&&this._pushTextBgRect(o,y,r+h,l,p,d),h=v.left,p=v.width,y=_):p+=v.kernedWidth;_&&this._pushTextBgRect(o,_,r+h,l,p,d)},_getFillAttributes:function(o){var f=o&&typeof o=="string"?new e.Color(o):"";return!f||!f.getSource()||f.getAlpha()===1?'fill="'+o+'"':'opacity="'+f.getAlpha()+'" fill="'+f.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(o){for(var f=0,r=0,l=0;l<o;l++)f+=this.getHeightOfLine(l);return r=this.getHeightOfLine(l),{lineTop:f,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(o){var f=e.Object.prototype.getSvgStyles.call(this,o);return f+" white-space: pre;"}})}(),function(s){var n=s.fabric||(s.fabric={});n.Textbox=n.util.createClass(n.IText,n.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:n.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(o){for(var f=0,r=0,l=0,c={},d=0;d<o.graphemeLines.length;d++)o.graphemeText[l]===`
`&&d>0?(r=0,l++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(o.graphemeText[l])&&d>0&&(r++,l++),c[d]={line:f,offset:r},l+=o.graphemeLines[d].length,r+=o.graphemeLines[d].length;return c},styleHas:function(o,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[f];r&&(f=r.line)}return n.Text.prototype.styleHas.call(this,o,f)},isEmptyStyles:function(o){if(!this.styles)return!0;var f=0,r=o+1,l,c,d=!1,p=this._styleMap[o],h=this._styleMap[o+1];p&&(o=p.line,f=p.offset),h&&(r=h.line,d=r===o,l=h.offset),c=typeof o=="undefined"?this.styles:{line:this.styles[o]};for(var v in c)for(var _ in c[v])if(_>=f&&(!d||_<l))for(var y in c[v][_])return!1;return!0},_getStyleDeclaration:function(o,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[o];if(!r)return null;o=r.line,f=r.offset+f}return this.callSuper("_getStyleDeclaration",o,f)},_setStyleDeclaration:function(o,f,r){var l=this._styleMap[o];o=l.line,f=l.offset+f,this.styles[o][f]=r},_deleteStyleDeclaration:function(o,f){var r=this._styleMap[o];o=r.line,f=r.offset+f,delete this.styles[o][f]},_getLineStyle:function(o){var f=this._styleMap[o];return!!this.styles[f.line]},_setLineStyle:function(o){var f=this._styleMap[o];this.styles[f.line]={}},_wrapText:function(o,f){var r=[],l;for(this.isWrapping=!0,l=0;l<o.length;l++)r=r.concat(this._wrapLine(o[l],l,f));return this.isWrapping=!1,r},_measureWord:function(o,f,r){var l=0,c,d=!0;r=r||0;for(var p=0,h=o.length;p<h;p++){var v=this._getGraphemeBox(o[p],f,p+r,c,d);l+=v.kernedWidth,c=o[p]}return l},_wrapLine:function(o,f,r,O){var c=0,d=this.splitByGrapheme,p=[],h=[],v=d?n.util.string.graphemeSplit(o):o.split(this._wordJoiners),_="",y=0,x=d?"":" ",b=0,w=0,M=0,S=!0,C=this._getWidthOfCharSpacing(),O=O||0;v.length===0&&v.push([]),r-=O;for(var k=0;k<v.length;k++)_=d?v[k]:n.util.string.graphemeSplit(v[k]),b=this._measureWord(_,f,y),y+=_.length,c+=w+b-C,c>r&&!S?(p.push(h),h=[],c=b,S=!0):c+=C,!S&&!d&&h.push(x),h=h.concat(_),w=d?0:this._measureWord([x],f,y),y++,S=!1,b>M&&(M=b);return k&&p.push(h),M+O>this.dynamicMinWidth&&(this.dynamicMinWidth=M-C+O),p},isEndOfWrapping:function(o){return!this._styleMap[o+1]||this._styleMap[o+1].line!==this._styleMap[o].line},missingNewlineOffset:function(o){return this.splitByGrapheme?this.isEndOfWrapping(o)?1:0:1},_splitTextIntoLines:function(o){for(var f=n.Text.prototype._splitTextIntoLines.call(this,o),r=this._wrapText(f.lines,this.width),l=new Array(r.length),c=0;c<r.length;c++)l[c]=r[c].join("");return f.lines=l,f.graphemeLines=r,f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var o={};for(var f in this._styleMap)this._textLines[f]&&(o[this._styleMap[f].line]=1);for(var f in this.styles)o[f]||delete this.styles[f]},toObject:function(o){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(o))}}),n.Textbox.fromObject=function(o,f){var r=n.util.stylesFromArray(o.styles,o.text),l=Object.assign({},o,{styles:r});return n.Object._fromObject("Textbox",l,f,"text")}}(m),function(){var s=e.controlsUtils,n=s.scaleSkewCursorStyleHandler,o=s.scaleCursorStyleHandler,f=s.scalingEqually,r=s.scalingYOrSkewingX,l=s.scalingXOrSkewingY,c=s.scaleOrSkewActionName,d=e.Object.prototype.controls;if(d.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:n,actionHandler:l,getActionName:c}),d.mr=new e.Control({x:.5,y:0,cursorStyleHandler:n,actionHandler:l,getActionName:c}),d.mb=new e.Control({x:0,y:.5,cursorStyleHandler:n,actionHandler:r,getActionName:c}),d.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:n,actionHandler:r,getActionName:c}),d.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:o,actionHandler:f}),d.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:o,actionHandler:f}),d.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:o,actionHandler:f}),d.br=new e.Control({x:.5,y:.5,cursorStyleHandler:o,actionHandler:f}),d.mtr=new e.Control({x:0,y:-.5,actionHandler:s.rotationWithSnapping,cursorStyleHandler:s.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var p=e.Textbox.prototype.controls={};p.mtr=d.mtr,p.tr=d.tr,p.br=d.br,p.tl=d.tl,p.bl=d.bl,p.mt=d.mt,p.mb=d.mb,p.mr=new e.Control({x:.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:n,actionName:"resizing"}),p.ml=new e.Control({x:-.5,y:0,actionHandler:s.changeWidth,cursorStyleHandler:n,actionName:"resizing"})}}()})(Bn);var mu={exports:{}};(function(m){(function(){function e(p,h){document.addEventListener?p.addEventListener("scroll",h,!1):p.attachEvent("scroll",h)}function t(p){document.body?p():document.addEventListener?document.addEventListener("DOMContentLoaded",function h(){document.removeEventListener("DOMContentLoaded",h),p()}):document.attachEvent("onreadystatechange",function h(){(document.readyState=="interactive"||document.readyState=="complete")&&(document.detachEvent("onreadystatechange",h),p())})}function i(p){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(p)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function a(p,h){p.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+h+";"}function u(p){var h=p.g.offsetWidth,v=h+100;return p.j.style.width=v+"px",p.i.scrollLeft=v,p.h.scrollLeft=p.h.scrollWidth+100,p.l!==h?(p.l=h,!0):!1}function g(p,h){function v(){var y=_;u(y)&&y.g.parentNode!==null&&h(y.l)}var _=p;e(p.h,v),e(p.i,v),u(p)}function s(p,h,v){h=h||{},v=v||window,this.family=p,this.style=h.style||"normal",this.weight=h.weight||"normal",this.stretch=h.stretch||"normal",this.context=v}var n=null,o=null,f=null,r=null;function l(p){return o===null&&(c(p)&&/Apple/.test(window.navigator.vendor)?(p=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),o=!!p&&603>parseInt(p[1],10)):o=!1),o}function c(p){return r===null&&(r=!!p.document.fonts),r}function d(p,h){var v=p.style,_=p.weight;if(f===null){var y=document.createElement("div");try{y.style.font="condensed 100px sans-serif"}catch{}f=y.style.font!==""}return[v,_,f?p.stretch:"","100px",h].join(" ")}s.prototype.load=function(p,h){var v=this,_=p||"BESbswy",y=0,x=h||3e3,b=new Date().getTime();return new Promise(function(w,M){if(c(v.context)&&!l(v.context)){var S=new Promise(function(O,k){function Y(){new Date().getTime()-b>=x?k(Error(""+x+"ms timeout exceeded")):v.context.document.fonts.load(d(v,'"'+v.family+'"'),_).then(function(H){1<=H.length?O():setTimeout(Y,25)},k)}Y()}),C=new Promise(function(O,k){y=setTimeout(function(){k(Error(""+x+"ms timeout exceeded"))},x)});Promise.race([C,S]).then(function(){clearTimeout(y),w(v)},M)}else t(function(){function O(){var L;(L=U!=-1&&G!=-1||U!=-1&&j!=-1||G!=-1&&j!=-1)&&((L=U!=G&&U!=j&&G!=j)||(n===null&&(L=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),n=!!L&&(536>parseInt(L[1],10)||parseInt(L[1],10)===536&&11>=parseInt(L[2],10))),L=n&&(U==q&&G==q&&j==q||U==T&&G==T&&j==T||U==P&&G==P&&j==P)),L=!L),L&&(R.parentNode!==null&&R.parentNode.removeChild(R),clearTimeout(y),w(v))}function k(){if(new Date().getTime()-b>=x)R.parentNode!==null&&R.parentNode.removeChild(R),M(Error(""+x+"ms timeout exceeded"));else{var L=v.context.document.hidden;(L===!0||L===void 0)&&(U=Y.g.offsetWidth,G=H.g.offsetWidth,j=N.g.offsetWidth,O()),y=setTimeout(k,50)}}var Y=new i(_),H=new i(_),N=new i(_),U=-1,G=-1,j=-1,q=-1,T=-1,P=-1,R=document.createElement("div");R.dir="ltr",a(Y,d(v,"sans-serif")),a(H,d(v,"serif")),a(N,d(v,"monospace")),R.appendChild(Y.g),R.appendChild(H.g),R.appendChild(N.g),v.context.document.body.appendChild(R),q=Y.g.offsetWidth,T=H.g.offsetWidth,P=N.g.offsetWidth,k(),g(Y,function(L){U=L,O()}),a(Y,d(v,'"'+v.family+'",sans-serif')),g(H,function(L){G=L,O()}),a(H,d(v,'"'+v.family+'",serif')),g(N,function(L){j=L,O()}),a(N,d(v,'"'+v.family+'",monospace'))})})},m.exports=s})()})(mu);var ly=mu.exports;const cy=m=>{m=m.replace(/^#/,"");const e=parseInt(m,16),t=e>>16&255,i=e>>8&255,a=e&255;return{r:t,g:i,b:a}};class hy{constructor(){this.experience=new wi,this.resources=this.experience.resources,this.scene=this.experience.scene,this.renderer=this.experience.renderer,this.canvasId="futkit_texture",this.fontFamily="Helvetica",this.kitName="Ronaldo",this.kitUrl="https://futfc.github.io/fut_card/custom_textures/jersey_7622_0_0_color.png",this.kitNumber=99,this.kitTextColor="#FFFFFF",this.kitNameSize=100,this.kitNumberSize=300,this.modelScale=.015,this.modelOffsetY=-3.5,this.modelRotationY=-Math.PI/6,this.textureImg=null,this.colorMatrixFilter=null,this.setTexture(),this.setModel()}setModel(){this.model={},this.model.mesh=this.resources.items.jersey.children[2],this.model.mesh=this.resources.items.jersey.children[1],this.model.mesh=this.resources.items.jersey.children[0],this.model.textureColor=this.resources.items.manutdColor,this.model.textureNormal=this.resources.items.manutdNormal,this.model.textureCoeff=this.resources.items.manutdCoeff,this.model.mesh.scale.set(this.modelScale,this.modelScale,this.modelScale),this.model.mesh.position.y=this.modelOffsetY,this.model.mesh.rotation.y=this.modelRotationY,this.scene.add(this.model.mesh),this.model.mesh.material=new ln({map:this.canvasTexture,normalMap:this.model.textureNormal,side:Si});let e=this.resources.items.collar08.children[0];e.scale.set(this.modelScale,this.modelScale,this.modelScale),e.position.y=this.modelOffsetY,e.rotation.y=this.modelRotationY,this.scene.add(e),e.material=new ln({map:this.canvasTexture,normalMap:this.model.textureNormal,side:Si}),this.model.collar=e;const t=new Mh(16777215);this.scene.add(t);const i=new zn(16777215,2);i.position.z=4,i.position.y=4,i.target=this.model.mesh,this.scene.add(i);const a=new zn(16777215,2);a.position.z=-4,a.position.y=-4,a.target=this.model.mesh,this.scene.add(a);const u=new zn(16777215,2);u.position.x=-4,u.target=this.model.mesh,this.scene.add(u);const g=new zn(16777215,2);g.position.x=4,g.target=this.model.mesh,this.scene.add(g)}setCanvasTexture(){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.canvasId),this.canvas.setAttribute("width","1024"),this.canvas.setAttribute("height","1024"),document.body.appendChild(this.canvas),this.canvasTexture=new Dv(this.canvas),this.canvasTexture.colorSpace=kt,this.canvasTexture.encoding=ze,this.fbCanvas=new Bn.fabric.Canvas(this.canvasId,{backgroundColor:"#FFBE9F"}),this.fbCanvas.wrapperEl.style.display="none"}applyColorSwapFilter(e,t){const i=t.map(u=>{const g=cy(u);return{r:g.r/255,g:g.g/255,b:g.b/255}}),a=[i[0].r,i[1].r,i[2].r,0,0,i[0].g,i[1].g,i[2].g,0,0,i[0].b,i[1].b,i[2].b,0,0,0,0,0,1,0];console.log(a),this.colorMatrixFilter?(this.colorMatrixFilter.matrix=a,e.filters=[this.colorMatrixFilter]):(this.colorMatrixFilter=new Bn.fabric.Image.filters.ColorMatrix({matrix:a}),e.filters.push(this.colorMatrixFilter)),e.applyFilters()}drawCanvas(){this.fbCanvas.clear(),Bn.fabric.Image.fromURL(this.kitUrl,e=>{this.applyColorSwapFilter(e,["#ff0000","#00ff00","#0000ff"]),e.scaleToWidth(1024,!1),this.textureImg=e,this.fbCanvas.add(e),this.setText(this.kitName,this.kitNumber)},{crossOrigin:"anonymous"}),this.fbCanvas.on("after:render",()=>{this.canvasTexture.needsUpdate=!0})}setTexture(){this.setCanvasTexture(),this.drawCanvas()}setText(){const e=new Bn.fabric.Text(this.kitName,{fill:this.kitTextColor,left:512,top:375,fontSize:.5*this.kitNameSize,textAlign:"center",originX:"center",width:250,flipY:"true",flipX:"true",fontFamily:this.fontFamily});this.fbCanvas.add(e);const t=new Bn.fabric.Text(this.kitNumber.toString(),{fill:this.kitTextColor,left:.5*2048/2,top:.5*400,fontSize:.5*this.kitNumberSize,textAlign:"center",originX:"center",width:.5*500,flipY:"true",flipX:"true",fontFamily:this.fontFamily});this.fbCanvas.add(t)}changeTexture(e){this.kitUrl=e;const t=document.getElementById("app-bg");t.style.backgroundImage=`url('${e}')`,this.drawCanvas()}async changePrint({fontFamily:e,name:t,number:i,kitTextColor:a="#FFFFFF",kitNameSize:u=100,kitNumberSize:g=300}){await this._loadFont(e),this.fontFamily=e,this.kitNumber=i,this.kitName=t,this.kitTextColor=a,this.kitNameSize=u,this.kitNumberSize=g,this.drawCanvas()}async _loadFont(e){const t=new ly(e);try{await t.load()}catch(i){console.log(i),console.log("font loading failed "+e)}}changeMatrixColor(e){this.applyColorSwapFilter(this.textureImg,e),this.fbCanvas.requestRenderAll()}}class uy{constructor(e){this.experience=new wi,this.config=this.experience.config,this.scene=this.experience.scene,this.resources=this.experience.resources,this.resources.on("groupEnd",t=>{t.name==="base"&&this.setJersey()})}setJersey(){this.jersey=new hy,window.jersey=this.jersey}resize(){}update(){}destroy(){}}var fy=[{name:"base",data:{},items:[{name:"jersey",source:"https://futfc.github.io/futkit/assets/models/jersey.obj",type:"model"},{name:"collar08",source:"https://futfc.github.io/futkit/assets/models/collar/collar_08.obj",type:"model"},{name:"manutdColor",source:"https://futfc.github.io/futkit/assets/textures/manutd/jersey_11_0_0_color.png",type:"texture"},{name:"manutdCoeff",source:"https://futfc.github.io/futkit/assets/textures/manutd/jersey_11_0_0_coeff.png",type:"texture"},{name:"manutdNormal",source:"https://futfc.github.io/futkit/assets/textures/manutd/jersey_11_0_0_normal.png",type:"texture"}]}];const Ar=class{constructor(e={}){if(Ar.instance)return Ar.instance;if(Ar.instance=this,this.targetElement=e.targetElement,!this.targetElement){console.warn("Missing 'targetElement' property");return}this.time=new w0,this.sizes=new S0,this.setConfig(),this.setDebug(),this.setStats(),this.setScene(),this.setCamera(),this.setRenderer(),this.setResources(),this.setWorld(),this.sizes.on("resize",()=>{this.resize()}),this.update()}setConfig(){this.config={},this.config.debug=window.location.hash==="#debug",this.config.pixelRatio=Math.min(Math.max(window.devicePixelRatio,1),2);const e=this.targetElement.getBoundingClientRect();this.config.width=e.width,this.config.height=e.height||window.innerHeight}setDebug(){this.config.debug&&(this.debug=new go)}setStats(){this.config.debug&&(this.stats=new C0(!0))}setScene(){this.scene=new Tv}setCamera(){this.camera=new sy}setRenderer(){this.renderer=new ny({rendererInstance:this.rendererInstance}),this.targetElement.appendChild(this.renderer.instance.domElement)}setResources(){this.resources=new Z_(fy)}setWorld(){this.world=new uy}update(){this.stats&&this.stats.update(),this.camera.update(),this.world&&this.world.update(),this.renderer&&this.renderer.update(),window.requestAnimationFrame(()=>{this.update()})}resize(){const e=this.targetElement.getBoundingClientRect();this.config.width=e.width,this.config.height=e.height,this.config.pixelRatio=Math.min(Math.max(window.devicePixelRatio,1),2),this.camera&&this.camera.resize(),this.renderer&&this.renderer.resize(),this.world&&this.world.resize()}destroy(){}};let wi=Ar;Io(wi,"instance");new wi({targetElement:document.querySelector(".experience")});
